<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage for src/thunderfish/eodanalysis.py: 30%</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_8e611ae1.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="pyfile">
<header>
    <div class="content">
        <h1>
            <span class="text">Coverage for </span><b>src/thunderfish/eodanalysis.py</b>:
            <span class="pc_cov">30%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>r</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        &nbsp; toggle line displays
                    </p>
                    <p>
                        <kbd>j</kbd>
                        <kbd>k</kbd>
                        &nbsp; next/prev highlighted chunk
                    </p>
                    <p>
                        <kbd>0</kbd> &nbsp; (zero) top of page
                    </p>
                    <p>
                        <kbd>1</kbd> &nbsp; (one) first highlighted chunk
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>u</kbd> &nbsp; up to the index
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <h2>
            <span class="text">1458 statements &nbsp;</span>
            <button type="button" class="run button_toggle_run" value="run" data-shortcut="r" title="Toggle lines run">438<span class="text"> run</span></button>
            <button type="button" class="mis show_mis button_toggle_mis" value="mis" data-shortcut="m" title="Toggle lines missing">1020<span class="text"> missing</span></button>
            <button type="button" class="exc show_exc button_toggle_exc" value="exc" data-shortcut="x" title="Toggle lines excluded">0<span class="text"> excluded</span></button>
        </h2>
        <p class="text">
            <a id="prevFileLink" class="nav" href="z_bbf95fe1437c662b_efield_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a id="indexLink" class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a id="nextFileLink" class="nav" href="z_bbf95fe1437c662b_eodexplorer_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.7.1">coverage.py v7.7.1</a>,
            created at 2025-03-23 22:57 +0000
        </p>
        <aside class="hidden">
            <button type="button" class="button_next_chunk" data-shortcut="j"></button>
            <button type="button" class="button_prev_chunk" data-shortcut="k"></button>
            <button type="button" class="button_top_of_page" data-shortcut="0"></button>
            <button type="button" class="button_first_chunk" data-shortcut="1"></button>
            <button type="button" class="button_prev_file" data-shortcut="["></button>
            <button type="button" class="button_next_file" data-shortcut="]"></button>
            <button type="button" class="button_to_index" data-shortcut="u"></button>
            <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
        </aside>
    </div>
</header>
<main id="source">
    <p class="pln"><span class="n"><a id="t1" href="#t1">1</a></span><span class="t"><span class="str">"""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2" href="#t2">2</a></span><span class="t"><span class="str">Analysis of EOD waveforms.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3" href="#t3">3</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t4" href="#t4">4</a></span><span class="t"><span class="str">## EOD waveform analysis</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t5" href="#t5">5</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t6" href="#t6">6</a></span><span class="t"><span class="str">- `eod_waveform()`: compute an averaged EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t7" href="#t7">7</a></span><span class="t"><span class="str">- `waveeod_waveform()`: retrieve average EOD waveform via Fourier transform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t8" href="#t8">8</a></span><span class="t"><span class="str">- `analyze_wave()`: analyze the EOD waveform of a wave fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t9" href="#t9">9</a></span><span class="t"><span class="str">- `analyze_pulse()`: analyze the EOD waveform of a pulse fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t10" href="#t10">10</a></span><span class="t"><span class="str">- `adjust_eodf()`: adjust EOD frequencies to a standard temperature.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t11" href="#t11">11</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t12" href="#t12">12</a></span><span class="t"><span class="str">## Similarity of EOD waveforms</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t13" href="#t13">13</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t14" href="#t14">14</a></span><span class="t"><span class="str">- `wave_similarity()`: root-mean squared difference between two wave fish EODs.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t15" href="#t15">15</a></span><span class="t"><span class="str">- `pulse_similarity()`: root-mean squared difference between two pulse fish EODs.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t16" href="#t16">16</a></span><span class="t"><span class="str">- `load_species_waveforms()`: load template EOD waveforms for species matching.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t17" href="#t17">17</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t18" href="#t18">18</a></span><span class="t"><span class="str">## Quality assessment</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t19" href="#t19">19</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t20" href="#t20">20</a></span><span class="t"><span class="str">- `clipped_fraction()`: compute fraction of clipped EOD waveform snippets.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t21" href="#t21">21</a></span><span class="t"><span class="str">- `wave_quality()`: asses quality of EOD waveform of a wave fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t22" href="#t22">22</a></span><span class="t"><span class="str">- `pulse_quality()`: asses quality of EOD waveform of a pulse fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t23" href="#t23">23</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t24" href="#t24">24</a></span><span class="t"><span class="str">## Visualization</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t25" href="#t25">25</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t26" href="#t26">26</a></span><span class="t"><span class="str">- `plot_eod_recording()`: plot a zoomed in range of the recorded trace.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t27" href="#t27">27</a></span><span class="t"><span class="str">- `plot_pulse_eods()`: mark pulse EODs in a plot of an EOD recording.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t28" href="#t28">28</a></span><span class="t"><span class="str">- `plot_eod_snippets()`: plot a few EOD waveform snippets.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t29" href="#t29">29</a></span><span class="t"><span class="str">- `plot_eod_waveform()`: plot and annotate the averaged EOD-waveform with standard error.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t30" href="#t30">30</a></span><span class="t"><span class="str">- `plot_wave_spectrum()`: plot and annotate spectrum of wave EODs.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t31" href="#t31">31</a></span><span class="t"><span class="str">- `plot_pulse_spectrum()`: plot and annotate spectrum of single pulse EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t32" href="#t32">32</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t33" href="#t33">33</a></span><span class="t"><span class="str">## Storage</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t34" href="#t34">34</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t35" href="#t35">35</a></span><span class="t"><span class="str">- `save_eod_waveform()`: save mean EOD waveform to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t36" href="#t36">36</a></span><span class="t"><span class="str">- `load_eod_waveform()`: load EOD waveform from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t37" href="#t37">37</a></span><span class="t"><span class="str">- `save_wave_eodfs()`: save frequencies of wave EODs to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t38" href="#t38">38</a></span><span class="t"><span class="str">- `load_wave_eodfs()`: load frequencies of wave EODs from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t39" href="#t39">39</a></span><span class="t"><span class="str">- `save_wave_fish()`: save properties of wave EODs to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t40" href="#t40">40</a></span><span class="t"><span class="str">- `load_wave_fish()`: load properties of wave EODs from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t41" href="#t41">41</a></span><span class="t"><span class="str">- `save_pulse_fish()`: save properties of pulse EODs to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t42" href="#t42">42</a></span><span class="t"><span class="str">- `load_pulse_fish()`: load properties of pulse EODs from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t43" href="#t43">43</a></span><span class="t"><span class="str">- `save_wave_spectrum()`: save amplitude and phase spectrum of wave EOD to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t44" href="#t44">44</a></span><span class="t"><span class="str">- `load_wave_spectrum()`: load amplitude and phase spectrum of wave EOD from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t45" href="#t45">45</a></span><span class="t"><span class="str">- `save_pulse_spectrum()`: save power spectrum of pulse EOD to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t46" href="#t46">46</a></span><span class="t"><span class="str">- `load_pulse_spectrum()`: load power spectrum of pulse EOD from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t47" href="#t47">47</a></span><span class="t"><span class="str">- `save_pulse_peaks()`: save peak properties of pulse EOD to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t48" href="#t48">48</a></span><span class="t"><span class="str">- `load_pulse_peaks()`: load peak properties of pulse EOD from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t49" href="#t49">49</a></span><span class="t"><span class="str">- `save_pulse_times()`: save times of pulse EOD to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t50" href="#t50">50</a></span><span class="t"><span class="str">- `load_pulse_times()`: load times of pulse EOD from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t51" href="#t51">51</a></span><span class="t"><span class="str">- `parse_filename()`: parse components of an EOD analysis file name.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t52" href="#t52">52</a></span><span class="t"><span class="str">- `save_analysis(): save EOD analysis results to files.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t53" href="#t53">53</a></span><span class="t"><span class="str">- `load_analysis()`: load EOD analysis files.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t54" href="#t54">54</a></span><span class="t"><span class="str">- `load_recording()`: load recording.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t55" href="#t55">55</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t56" href="#t56">56</a></span><span class="t"><span class="str">## Fit functions</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t57" href="#t57">57</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t58" href="#t58">58</a></span><span class="t"><span class="str">- `fourier_series()`: Fourier series of sine waves with amplitudes and phases.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t59" href="#t59">59</a></span><span class="t"><span class="str">- `exp_decay()`: exponential decay.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t60" href="#t60">60</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t61" href="#t61">61</a></span><span class="t"><span class="str">## Filter functions</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t62" href="#t62">62</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t63" href="#t63">63</a></span><span class="t"><span class="str">- `unfilter()`: apply inverse low-pass filter on data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t64" href="#t64">64</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t65" href="#t65">65</a></span><span class="t"><span class="str">## Configuration</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t66" href="#t66">66</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t67" href="#t67">67</a></span><span class="t"><span class="str">- `add_eod_analysis_config()`: add parameters for EOD analysis functions to configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t68" href="#t68">68</a></span><span class="t"><span class="str">- `eod_waveform_args()`: retrieve parameters for `eod_waveform()` from configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t69" href="#t69">69</a></span><span class="t"><span class="str">- `analyze_wave_args()`: retrieve parameters for `analyze_wave()` from configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t70" href="#t70">70</a></span><span class="t"><span class="str">- `analyze_pulse_args()`: retrieve parameters for `analyze_pulse()` from configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t71" href="#t71">71</a></span><span class="t"><span class="str">- `add_species_config()`: add parameters needed for assigning EOD waveforms to species.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t72" href="#t72">72</a></span><span class="t"><span class="str">- `add_eod_quality_config()`: add parameters needed for assesing the quality of an EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t73" href="#t73">73</a></span><span class="t"><span class="str">- `wave_quality_args()`: retrieve parameters for `wave_quality()` from configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t74" href="#t74">74</a></span><span class="t"><span class="str">- `pulse_quality_args()`: retrieve parameters for `pulse_quality()` from configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t75" href="#t75">75</a></span><span class="t"><span class="str">"""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t76" href="#t76">76</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t77" href="#t77">77</a></span><span class="t"><span class="key">import</span> <span class="nam">os</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t78" href="#t78">78</a></span><span class="t"><span class="key">import</span> <span class="nam">io</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t79" href="#t79">79</a></span><span class="t"><span class="key">import</span> <span class="nam">glob</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t80" href="#t80">80</a></span><span class="t"><span class="key">import</span> <span class="nam">zipfile</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t81" href="#t81">81</a></span><span class="t"><span class="key">import</span> <span class="nam">numpy</span> <span class="key">as</span> <span class="nam">np</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t82" href="#t82">82</a></span><span class="t"><span class="key">from</span> <span class="nam">scipy</span><span class="op">.</span><span class="nam">optimize</span> <span class="key">import</span> <span class="nam">curve_fit</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t83" href="#t83">83</a></span><span class="t"><span class="key">from</span> <span class="nam">numba</span> <span class="key">import</span> <span class="nam">jit</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t84" href="#t84">84</a></span><span class="t"><span class="key">from</span> <span class="nam">thunderlab</span><span class="op">.</span><span class="nam">eventdetection</span> <span class="key">import</span> <span class="nam">percentile_threshold</span><span class="op">,</span> <span class="nam">detect_peaks</span><span class="op">,</span> <span class="nam">snippets</span><span class="op">,</span> <span class="nam">peak_width</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t85" href="#t85">85</a></span><span class="t"><span class="key">from</span> <span class="nam">thunderlab</span><span class="op">.</span><span class="nam">eventdetection</span> <span class="key">import</span> <span class="nam">threshold_crossings</span><span class="op">,</span> <span class="nam">threshold_crossing_times</span><span class="op">,</span> <span class="nam">merge_events</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t86" href="#t86">86</a></span><span class="t"><span class="key">from</span> <span class="nam">thunderlab</span><span class="op">.</span><span class="nam">powerspectrum</span> <span class="key">import</span> <span class="nam">next_power_of_two</span><span class="op">,</span> <span class="nam">nfft</span><span class="op">,</span> <span class="nam">decibel</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t87" href="#t87">87</a></span><span class="t"><span class="key">from</span> <span class="nam">thunderlab</span><span class="op">.</span><span class="nam">tabledata</span> <span class="key">import</span> <span class="nam">TableData</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t88" href="#t88">88</a></span><span class="t"><span class="key">from</span> <span class="nam">thunderlab</span><span class="op">.</span><span class="nam">dataloader</span> <span class="key">import</span> <span class="nam">load_data</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t89" href="#t89">89</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">harmonics</span> <span class="key">import</span> <span class="nam">fundamental_freqs_and_power</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t90" href="#t90">90</a></span><span class="t"><span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t91" href="#t91">91</a></span><span class="t">    <span class="key">import</span> <span class="nam">matplotlib</span><span class="op">.</span><span class="nam">pyplot</span> <span class="key">as</span> <span class="nam">plt</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t92" href="#t92">92</a></span><span class="t"><span class="key">except</span> <span class="nam">ImportError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t93" href="#t93">93</a></span><span class="t">    <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t94" href="#t94">94</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t95" href="#t95">95</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t96" href="#t96">96</a></span><span class="t"><span class="key">def</span> <span class="nam">eod_waveform</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">eod_times</span><span class="op">,</span> <span class="nam">win_fac</span><span class="op">=</span><span class="num">2.0</span><span class="op">,</span> <span class="nam">min_win</span><span class="op">=</span><span class="num">0.01</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t97" href="#t97">97</a></span><span class="t">                 <span class="nam">min_sem</span><span class="op">=</span><span class="key">False</span><span class="op">,</span> <span class="nam">max_eods</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">unfilter_cutoff</span><span class="op">=</span><span class="num">0.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t98" href="#t98">98</a></span><span class="t">    <span class="str">"""Extract data snippets around each EOD, and compute a mean waveform with standard error.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t99" href="#t99">99</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t100" href="#t100">100</a></span><span class="t"><span class="str">    Retrieving the EOD waveform of a wave fish works under the following</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t101" href="#t101">101</a></span><span class="t"><span class="str">    conditions: (i) at a signal-to-noise ratio \\(SNR = P_s/P_n\\),</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t102" href="#t102">102</a></span><span class="t"><span class="str">    i.e. the power \\(P_s\\) of the EOD of interest relative to the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t103" href="#t103">103</a></span><span class="t"><span class="str">    largest other EOD \\(P_n\\), we need to average over at least \\(n ></span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t104" href="#t104">104</a></span><span class="t"><span class="str">    (SNR \\cdot c_s^2)^{-1}\\) snippets to bring the standard error of the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t105" href="#t105">105</a></span><span class="t"><span class="str">    averaged EOD waveform down to \\(c_s\\) relative to its</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t106" href="#t106">106</a></span><span class="t"><span class="str">    amplitude. For a s.e.m. less than 5% ( \\(c_s=0.05\\) ) and an SNR of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t107" href="#t107">107</a></span><span class="t"><span class="str">    -10dB (the signal is 10 times smaller than the noise, \\(SNR=0.1\\) ) we</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t108" href="#t108">108</a></span><span class="t"><span class="str">    get \\(n > 0.00025^{-1} = 4000\\) data snippets - a recording a</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t109" href="#t109">109</a></span><span class="t"><span class="str">    couple of seconds long.  (ii) Very important for wave fish is that</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t110" href="#t110">110</a></span><span class="t"><span class="str">    they keep their frequency constant.  Slight changes in the EOD</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t111" href="#t111">111</a></span><span class="t"><span class="str">    frequency will corrupt the average waveform.  If the period of the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t112" href="#t112">112</a></span><span class="t"><span class="str">    waveform changes by \\(c_f=\\Delta T/T\\), then after \\(n =</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t113" href="#t113">113</a></span><span class="t"><span class="str">    1/c_f\\) periods moved the modified waveform through a whole period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t114" href="#t114">114</a></span><span class="t"><span class="str">    This is in the range of hundreds or thousands waveforms.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t115" href="#t115">115</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t116" href="#t116">116</a></span><span class="t"><span class="str">    NOTE: we need to take into account a possible error in the estimate</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t117" href="#t117">117</a></span><span class="t"><span class="str">    of the EOD period. This will limit the maximum number of snippets to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t118" href="#t118">118</a></span><span class="t"><span class="str">    be averaged.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t119" href="#t119">119</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t120" href="#t120">120</a></span><span class="t"><span class="str">    If `min_sem` is set, the algorithm checks for a global minimum of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t121" href="#t121">121</a></span><span class="t"><span class="str">    the s.e.m.  as a function of snippet number. If there is one then</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t122" href="#t122">122</a></span><span class="t"><span class="str">    the average is computed for this number of snippets, otherwise all</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t123" href="#t123">123</a></span><span class="t"><span class="str">    snippets are taken from the provided data segment. Note that this</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t124" href="#t124">124</a></span><span class="t"><span class="str">    check only works for the strongest EOD in a recording.  For weaker</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t125" href="#t125">125</a></span><span class="t"><span class="str">    EOD the s.e.m. always decays with snippet number (empirical</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t126" href="#t126">126</a></span><span class="t"><span class="str">    observation).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t127" href="#t127">127</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t128" href="#t128">128</a></span><span class="t"><span class="str">    TODO: use power spectra to check for changes in EOD frequency!</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t129" href="#t129">129</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t130" href="#t130">130</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t131" href="#t131">131</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t132" href="#t132">132</a></span><span class="t"><span class="str">    data: 1-D array of float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t133" href="#t133">133</a></span><span class="t"><span class="str">        The data to be analysed.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t134" href="#t134">134</a></span><span class="t"><span class="str">    rate: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t135" href="#t135">135</a></span><span class="t"><span class="str">        Sampling rate of the data in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t136" href="#t136">136</a></span><span class="t"><span class="str">    eod_times: 1-D array of float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t137" href="#t137">137</a></span><span class="t"><span class="str">        Array of EOD times in seconds over which the waveform should be</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t138" href="#t138">138</a></span><span class="t"><span class="str">        averaged.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t139" href="#t139">139</a></span><span class="t"><span class="str">        WARNING: The first data point must be at time zero!</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t140" href="#t140">140</a></span><span class="t"><span class="str">    win_fac: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t141" href="#t141">141</a></span><span class="t"><span class="str">        The snippet size is the EOD period times `win_fac`. The EOD period</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t142" href="#t142">142</a></span><span class="t"><span class="str">        is determined as the minimum interval between EOD times.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t143" href="#t143">143</a></span><span class="t"><span class="str">    min_win: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t144" href="#t144">144</a></span><span class="t"><span class="str">        The minimum size of the snippets in seconds.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t145" href="#t145">145</a></span><span class="t"><span class="str">    min_sem: bool</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t146" href="#t146">146</a></span><span class="t"><span class="str">        If set, check for minimum in s.e.m. to set the maximum numbers</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t147" href="#t147">147</a></span><span class="t"><span class="str">        of EODs to be used for computing the average waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t148" href="#t148">148</a></span><span class="t"><span class="str">    max_eods: int or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t149" href="#t149">149</a></span><span class="t"><span class="str">        Maximum number of EODs to be used for averaging.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t150" href="#t150">150</a></span><span class="t"><span class="str">    unfilter_cutoff: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t151" href="#t151">151</a></span><span class="t"><span class="str">        If not zero, the cutoff frequency for an inverse high-pass filter</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t152" href="#t152">152</a></span><span class="t"><span class="str">        applied to the mean EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t153" href="#t153">153</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t154" href="#t154">154</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t155" href="#t155">155</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t156" href="#t156">156</a></span><span class="t"><span class="str">    mean_eod: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t157" href="#t157">157</a></span><span class="t"><span class="str">        Average of the EOD snippets. First column is time in seconds,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t158" href="#t158">158</a></span><span class="t"><span class="str">        second column the mean eod, third column the standard error.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t159" href="#t159">159</a></span><span class="t"><span class="str">    eod_times: 1-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t160" href="#t160">160</a></span><span class="t"><span class="str">        Times of EOD peaks in seconds that have been actually used to calculate the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t161" href="#t161">161</a></span><span class="t"><span class="str">        averaged EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t162" href="#t162">162</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t163" href="#t163">163</a></span><span class="t">    <span class="com"># indices of EOD times:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t164" href="#t164">164</a></span><span class="t">    <span class="nam">eod_idx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="nam">eod_times</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span><span class="op">.</span><span class="nam">astype</span><span class="op">(</span><span class="nam">int</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t165" href="#t165">165</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t166" href="#t166">166</a></span><span class="t">    <span class="com"># window size:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t167" href="#t167">167</a></span><span class="t">    <span class="nam">period</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">diff</span><span class="op">(</span><span class="nam">eod_times</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t168" href="#t168">168</a></span><span class="t">    <span class="nam">win</span> <span class="op">=</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">win_fac</span><span class="op">*</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t169" href="#t169">169</a></span><span class="t">    <span class="key">if</span> <span class="num">2</span><span class="op">*</span><span class="nam">win</span> <span class="op">&lt;</span> <span class="nam">min_win</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t170" href="#t170">170</a></span><span class="t">        <span class="nam">win</span> <span class="op">=</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">min_win</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t171" href="#t171">171</a></span><span class="t">    <span class="nam">win_inx</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">win</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t172" href="#t172">172</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t173" href="#t173">173</a></span><span class="t">    <span class="com"># extract snippets:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t174" href="#t174">174</a></span><span class="t">    <span class="nam">eod_times</span> <span class="op">=</span> <span class="nam">eod_times</span><span class="op">[</span><span class="op">(</span><span class="nam">eod_idx</span> <span class="op">>=</span> <span class="nam">win_inx</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="nam">eod_idx</span> <span class="op">&lt;</span> <span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">-</span><span class="nam">win_inx</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t175" href="#t175">175</a></span><span class="t">    <span class="nam">eod_idx</span> <span class="op">=</span> <span class="nam">eod_idx</span><span class="op">[</span><span class="op">(</span><span class="nam">eod_idx</span> <span class="op">>=</span> <span class="nam">win_inx</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="nam">eod_idx</span> <span class="op">&lt;</span> <span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">-</span><span class="nam">win_inx</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t176" href="#t176">176</a></span><span class="t">    <span class="key">if</span> <span class="nam">max_eods</span> <span class="key">and</span> <span class="nam">max_eods</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_idx</span><span class="op">)</span> <span class="op">></span> <span class="nam">max_eods</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t177" href="#t177">177</a></span><span class="t">        <span class="nam">dn</span> <span class="op">=</span> <span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">eod_idx</span><span class="op">)</span> <span class="op">-</span> <span class="nam">max_eods</span><span class="op">)</span><span class="op">//</span><span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t178" href="#t178">178</a></span><span class="t">        <span class="nam">eod_times</span> <span class="op">=</span> <span class="nam">eod_times</span><span class="op">[</span><span class="nam">dn</span><span class="op">:</span><span class="nam">dn</span><span class="op">+</span><span class="nam">max_eods</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t179" href="#t179">179</a></span><span class="t">        <span class="nam">eod_idx</span> <span class="op">=</span> <span class="nam">eod_idx</span><span class="op">[</span><span class="nam">dn</span><span class="op">:</span><span class="nam">dn</span><span class="op">+</span><span class="nam">max_eods</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t180" href="#t180">180</a></span><span class="t">    <span class="nam">eod_snippets</span> <span class="op">=</span> <span class="nam">snippets</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">eod_idx</span><span class="op">,</span> <span class="op">-</span><span class="nam">win_inx</span><span class="op">,</span> <span class="nam">win_inx</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t181" href="#t181">181</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_snippets</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t182" href="#t182">182</a></span><span class="t">        <span class="key">return</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="num">3</span><span class="op">)</span><span class="op">)</span><span class="op">,</span> <span class="nam">eod_times</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t183" href="#t183">183</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t184" href="#t184">184</a></span><span class="t">    <span class="com"># optimal number of snippets:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t185" href="#t185">185</a></span><span class="t">    <span class="nam">step</span> <span class="op">=</span> <span class="num">10</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t186" href="#t186">186</a></span><span class="t">    <span class="key">if</span> <span class="nam">min_sem</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_snippets</span><span class="op">)</span> <span class="op">></span> <span class="nam">step</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t187" href="#t187">187</a></span><span class="t">        <span class="nam">sems</span> <span class="op">=</span> <span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">eod_snippets</span><span class="op">[</span><span class="op">:</span><span class="nam">k</span><span class="op">]</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">ddof</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">/</span><span class="nam">np</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="nam">k</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t188" href="#t188">188</a></span><span class="t">                <span class="key">for</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">step</span><span class="op">,</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_snippets</span><span class="op">)</span><span class="op">,</span> <span class="nam">step</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t189" href="#t189">189</a></span><span class="t">        <span class="nam">idx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">sems</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t190" href="#t190">190</a></span><span class="t">        <span class="com"># there is a local minimum:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t191" href="#t191">191</a></span><span class="t">        <span class="key">if</span> <span class="nam">idx</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="nam">idx</span> <span class="op">&lt;</span> <span class="nam">len</span><span class="op">(</span><span class="nam">sems</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t192" href="#t192">192</a></span><span class="t">            <span class="nam">maxn</span> <span class="op">=</span> <span class="nam">step</span><span class="op">*</span><span class="op">(</span><span class="nam">idx</span><span class="op">+</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t193" href="#t193">193</a></span><span class="t">            <span class="nam">eod_snippets</span> <span class="op">=</span> <span class="nam">eod_snippets</span><span class="op">[</span><span class="op">:</span><span class="nam">maxn</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t194" href="#t194">194</a></span><span class="t">            <span class="nam">eod_times</span> <span class="op">=</span> <span class="nam">eod_times</span><span class="op">[</span><span class="op">:</span><span class="nam">maxn</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t195" href="#t195">195</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t196" href="#t196">196</a></span><span class="t">    <span class="com"># mean and std of snippets:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t197" href="#t197">197</a></span><span class="t">    <span class="nam">mean_eod</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">eod_snippets</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">,</span> <span class="num">3</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t198" href="#t198">198</a></span><span class="t">    <span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">eod_snippets</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t199" href="#t199">199</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_snippets</span><span class="op">)</span> <span class="op">></span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t200" href="#t200">200</a></span><span class="t">        <span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">2</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">eod_snippets</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">ddof</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">/</span><span class="nam">np</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">eod_snippets</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t201" href="#t201">201</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t202" href="#t202">202</a></span><span class="t">    <span class="com"># apply inverse filter:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t203" href="#t203">203</a></span><span class="t">    <span class="key">if</span> <span class="nam">unfilter_cutoff</span> <span class="key">and</span> <span class="nam">unfilter_cutoff</span> <span class="op">></span> <span class="num">0.0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t204" href="#t204">204</a></span><span class="t">        <span class="nam">unfilter</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">unfilter_cutoff</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t205" href="#t205">205</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t206" href="#t206">206</a></span><span class="t">    <span class="com"># time axis:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t207" href="#t207">207</a></span><span class="t">    <span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="nam">win_inx</span><span class="op">)</span> <span class="op">/</span> <span class="nam">rate</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t208" href="#t208">208</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t209" href="#t209">209</a></span><span class="t">    <span class="key">return</span> <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">eod_times</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t210" href="#t210">210</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t211" href="#t211">211</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t212" href="#t212">212</a></span><span class="t"><span class="key">def</span> <span class="nam">waveeod_waveform</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">freq</span><span class="op">,</span> <span class="nam">win_fac</span><span class="op">=</span><span class="num">2.0</span><span class="op">,</span> <span class="nam">unfilter_cutoff</span><span class="op">=</span><span class="num">0.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t213" href="#t213">213</a></span><span class="t">    <span class="str">"""Retrieve average EOD waveform via Fourier transform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t214" href="#t214">214</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t215" href="#t215">215</a></span><span class="t"><span class="str">    TODO: use power spectra to check minimum data segment needed and</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t216" href="#t216">216</a></span><span class="t"><span class="str">    check for changes in frequency over several segments!</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t217" href="#t217">217</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t218" href="#t218">218</a></span><span class="t"><span class="str">    TODO: return waveform with higher samplign rate? (important for</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t219" href="#t219">219</a></span><span class="t"><span class="str">    2kHz waves on 24kHz sampling). But this seems to render some EODs</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t220" href="#t220">220</a></span><span class="t"><span class="str">    inacceptable in the further thunderfish processing pipeline.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t221" href="#t221">221</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t222" href="#t222">222</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t223" href="#t223">223</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t224" href="#t224">224</a></span><span class="t"><span class="str">    data: 1-D array of float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t225" href="#t225">225</a></span><span class="t"><span class="str">        The data to be analysed.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t226" href="#t226">226</a></span><span class="t"><span class="str">    rate: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t227" href="#t227">227</a></span><span class="t"><span class="str">        Sampling rate of the data in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t228" href="#t228">228</a></span><span class="t"><span class="str">    freq: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t229" href="#t229">229</a></span><span class="t"><span class="str">        EOD frequency.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t230" href="#t230">230</a></span><span class="t"><span class="str">    win_fac: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t231" href="#t231">231</a></span><span class="t"><span class="str">        The snippet size is the EOD period times `win_fac`. The EOD period</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t232" href="#t232">232</a></span><span class="t"><span class="str">        is determined as the minimum interval between EOD times.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t233" href="#t233">233</a></span><span class="t"><span class="str">    unfilter_cutoff: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t234" href="#t234">234</a></span><span class="t"><span class="str">        If not zero, the cutoff frequency for an inverse high-pass filter</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t235" href="#t235">235</a></span><span class="t"><span class="str">        applied to the mean EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t236" href="#t236">236</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t237" href="#t237">237</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t238" href="#t238">238</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t239" href="#t239">239</a></span><span class="t"><span class="str">    mean_eod: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t240" href="#t240">240</a></span><span class="t"><span class="str">        Average of the EOD snippets. First column is time in seconds,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t241" href="#t241">241</a></span><span class="t"><span class="str">        second column the mean eod, third column the standard error.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t242" href="#t242">242</a></span><span class="t"><span class="str">    eod_times: 1-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t243" href="#t243">243</a></span><span class="t"><span class="str">        Times of EOD peaks in seconds that have been actually used to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t244" href="#t244">244</a></span><span class="t"><span class="str">        calculate the averaged EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t245" href="#t245">245</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t246" href="#t246">246</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t247" href="#t247">247</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t248" href="#t248">248</a></span><span class="t">    <span class="op">@</span><span class="nam">jit</span><span class="op">(</span><span class="nam">nopython</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t249" href="#t249">249</a></span><span class="t">    <span class="key">def</span> <span class="nam">fourier_wave</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">freq</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t250" href="#t250">250</a></span><span class="t">        <span class="str">"""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t251" href="#t251">251</a></span><span class="t"><span class="str">        extracting wave via fourier coefficients</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t252" href="#t252">252</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t253" href="#t253">253</a></span><span class="t">        <span class="nam">twave</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="op">(</span><span class="num">1</span><span class="op">+</span><span class="nam">win_fac</span><span class="op">)</span><span class="op">/</span><span class="nam">freq</span><span class="op">,</span> <span class="num">1</span><span class="op">/</span><span class="nam">rate</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t254" href="#t254">254</a></span><span class="t">        <span class="nam">wave</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">twave</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t255" href="#t255">255</a></span><span class="t">        <span class="nam">t</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">rate</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t256" href="#t256">256</a></span><span class="t">        <span class="key">for</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="num">31</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t257" href="#t257">257</a></span><span class="t">            <span class="nam">Xk</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">trapz</span><span class="op">(</span><span class="nam">data</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">exp</span><span class="op">(</span><span class="op">-</span><span class="num">1j</span><span class="op">*</span><span class="num">2</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">pi</span><span class="op">*</span><span class="nam">k</span><span class="op">*</span><span class="nam">freq</span><span class="op">*</span><span class="nam">t</span><span class="op">)</span><span class="op">,</span> <span class="nam">t</span><span class="op">)</span><span class="op">*</span><span class="num">2</span><span class="op">/</span><span class="nam">t</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t258" href="#t258">258</a></span><span class="t">            <span class="nam">wave</span> <span class="op">+=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">real</span><span class="op">(</span><span class="nam">Xk</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">exp</span><span class="op">(</span><span class="num">1j</span><span class="op">*</span><span class="num">2</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">pi</span><span class="op">*</span><span class="nam">k</span><span class="op">*</span><span class="nam">freq</span><span class="op">*</span><span class="nam">twave</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t259" href="#t259">259</a></span><span class="t">        <span class="key">return</span> <span class="nam">wave</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t260" href="#t260">260</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t261" href="#t261">261</a></span><span class="t">    <span class="op">@</span><span class="nam">jit</span><span class="op">(</span><span class="nam">nopython</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t262" href="#t262">262</a></span><span class="t">    <span class="key">def</span> <span class="nam">fourier_range</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">f0</span><span class="op">,</span> <span class="nam">f1</span><span class="op">,</span> <span class="nam">df</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t263" href="#t263">263</a></span><span class="t">        <span class="nam">wave</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t264" href="#t264">264</a></span><span class="t">        <span class="nam">freq</span> <span class="op">=</span> <span class="nam">f0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t265" href="#t265">265</a></span><span class="t">        <span class="key">for</span> <span class="nam">f</span> <span class="key">in</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">f0</span><span class="op">,</span> <span class="nam">f1</span><span class="op">,</span> <span class="nam">df</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t266" href="#t266">266</a></span><span class="t">            <span class="nam">w</span> <span class="op">=</span> <span class="nam">fourier_wave</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t267" href="#t267">267</a></span><span class="t">            <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">w</span><span class="op">)</span> <span class="op">-</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">w</span><span class="op">)</span> <span class="op">></span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">wave</span><span class="op">)</span> <span class="op">-</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">wave</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t268" href="#t268">268</a></span><span class="t">                <span class="nam">wave</span> <span class="op">=</span> <span class="nam">w</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t269" href="#t269">269</a></span><span class="t">                <span class="nam">freq</span> <span class="op">=</span> <span class="nam">f</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t270" href="#t270">270</a></span><span class="t">        <span class="key">return</span> <span class="nam">wave</span><span class="op">,</span> <span class="nam">freq</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t271" href="#t271">271</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t272" href="#t272">272</a></span><span class="t">    <span class="com"># TODO: parameterize!</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t273" href="#t273">273</a></span><span class="t">    <span class="nam">tsnippet</span> <span class="op">=</span> <span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t274" href="#t274">274</a></span><span class="t">    <span class="nam">min_corr</span> <span class="op">=</span> <span class="num">0.98</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t275" href="#t275">275</a></span><span class="t">    <span class="nam">min_ampl_frac</span> <span class="op">=</span> <span class="num">0.5</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t276" href="#t276">276</a></span><span class="t">    <span class="nam">frange</span> <span class="op">=</span> <span class="num">0.1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t277" href="#t277">277</a></span><span class="t">    <span class="nam">fstep</span> <span class="op">=</span> <span class="num">0.1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t278" href="#t278">278</a></span><span class="t">    <span class="nam">waves</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t279" href="#t279">279</a></span><span class="t">    <span class="nam">freqs</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t280" href="#t280">280</a></span><span class="t">    <span class="nam">times</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t281" href="#t281">281</a></span><span class="t">    <span class="nam">step</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">tsnippet</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t282" href="#t282">282</a></span><span class="t">    <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span> <span class="op">-</span> <span class="nam">step</span><span class="op">//</span><span class="num">2</span><span class="op">,</span> <span class="nam">step</span><span class="op">//</span><span class="num">2</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t283" href="#t283">283</a></span><span class="t">        <span class="nam">w</span><span class="op">,</span> <span class="nam">f</span> <span class="op">=</span> <span class="nam">fourier_range</span><span class="op">(</span><span class="nam">data</span><span class="op">[</span><span class="nam">i</span><span class="op">:</span><span class="nam">i</span> <span class="op">+</span> <span class="nam">step</span><span class="op">]</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">freq</span> <span class="op">-</span> <span class="nam">frange</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t284" href="#t284">284</a></span><span class="t">                             <span class="nam">freq</span> <span class="op">+</span> <span class="nam">frange</span> <span class="op">+</span> <span class="nam">fstep</span><span class="op">/</span><span class="num">2</span><span class="op">,</span> <span class="nam">fstep</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t285" href="#t285">285</a></span><span class="t">        <span class="nam">waves</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">w</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t286" href="#t286">286</a></span><span class="t">        <span class="nam">freqs</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t287" href="#t287">287</a></span><span class="t">        <span class="str">"""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t288" href="#t288">288</a></span><span class="t"><span class="str">        waves.append(np.zeros(1))</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t289" href="#t289">289</a></span><span class="t"><span class="str">        freqs.append(freq)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t290" href="#t290">290</a></span><span class="t"><span class="str">        for f in np.arange(freq - frange, freq + frange + fstep/2, fstep):</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t291" href="#t291">291</a></span><span class="t"><span class="str">            w = fourier_wave(data[i:i + step], rate, f)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t292" href="#t292">292</a></span><span class="t"><span class="str">            if np.max(w) - np.min(w) > np.max(waves[-1]) - np.min(waves[-1]):</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t293" href="#t293">293</a></span><span class="t"><span class="str">                waves[-1] = w</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t294" href="#t294">294</a></span><span class="t"><span class="str">                freqs[-1] = f</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t295" href="#t295">295</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t296" href="#t296">296</a></span><span class="t">        <span class="nam">times</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">i</span><span class="op">/</span><span class="nam">rate</span><span class="op">,</span> <span class="op">(</span><span class="nam">i</span> <span class="op">+</span> <span class="nam">step</span><span class="op">)</span><span class="op">/</span><span class="nam">rate</span><span class="op">,</span> <span class="num">1</span><span class="op">/</span><span class="nam">freqs</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t297" href="#t297">297</a></span><span class="t">    <span class="nam">eod_freq</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">freqs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t298" href="#t298">298</a></span><span class="t">    <span class="nam">mean_eod</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="num">3</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t299" href="#t299">299</a></span><span class="t">    <span class="nam">eod_times</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t300" href="#t300">300</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">waves</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t301" href="#t301">301</a></span><span class="t">        <span class="key">return</span> <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">eod_times</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t302" href="#t302">302</a></span><span class="t">    <span class="key">for</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">waves</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t303" href="#t303">303</a></span><span class="t">        <span class="nam">period</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">ceil</span><span class="op">(</span><span class="nam">rate</span><span class="op">/</span><span class="nam">freqs</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t304" href="#t304">304</a></span><span class="t">        <span class="nam">i</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">waves</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span><span class="op">[</span><span class="op">:</span><span class="nam">period</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t305" href="#t305">305</a></span><span class="t">        <span class="nam">waves</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span> <span class="op">=</span> <span class="nam">waves</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span><span class="op">[</span><span class="nam">i</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t306" href="#t306">306</a></span><span class="t">    <span class="nam">n</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="op">[</span><span class="nam">len</span><span class="op">(</span><span class="nam">w</span><span class="op">)</span> <span class="key">for</span> <span class="nam">w</span> <span class="key">in</span> <span class="nam">waves</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t307" href="#t307">307</a></span><span class="t">    <span class="nam">waves</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="op">[</span><span class="nam">w</span><span class="op">[</span><span class="op">:</span><span class="nam">n</span><span class="op">]</span> <span class="key">for</span> <span class="nam">w</span> <span class="key">in</span> <span class="nam">waves</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t308" href="#t308">308</a></span><span class="t">    <span class="com"># only snippets that are similar:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t309" href="#t309">309</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">waves</span><span class="op">)</span> <span class="op">></span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t310" href="#t310">310</a></span><span class="t">        <span class="nam">corr</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">corrcoef</span><span class="op">(</span><span class="nam">waves</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t311" href="#t311">311</a></span><span class="t">        <span class="nam">nmax</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">corr</span> <span class="op">></span> <span class="nam">min_corr</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t312" href="#t312">312</a></span><span class="t">        <span class="key">if</span> <span class="nam">nmax</span> <span class="op">&lt;=</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t313" href="#t313">313</a></span><span class="t">            <span class="nam">nmax</span> <span class="op">=</span> <span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t314" href="#t314">314</a></span><span class="t">        <span class="nam">select</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">corr</span> <span class="op">></span> <span class="nam">min_corr</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span> <span class="op">>=</span> <span class="nam">nmax</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t315" href="#t315">315</a></span><span class="t">        <span class="nam">waves</span> <span class="op">=</span> <span class="nam">waves</span><span class="op">[</span><span class="nam">select</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t316" href="#t316">316</a></span><span class="t">        <span class="nam">times</span> <span class="op">=</span> <span class="op">[</span><span class="nam">times</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span> <span class="key">for</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times</span><span class="op">)</span><span class="op">)</span> <span class="key">if</span> <span class="nam">select</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t317" href="#t317">317</a></span><span class="t">        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">waves</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t318" href="#t318">318</a></span><span class="t">            <span class="key">return</span> <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">eod_times</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t319" href="#t319">319</a></span><span class="t">    <span class="com"># only the largest snippets:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t320" href="#t320">320</a></span><span class="t">    <span class="nam">ampls</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">waves</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t321" href="#t321">321</a></span><span class="t">    <span class="nam">select</span> <span class="op">=</span> <span class="nam">ampls</span> <span class="op">>=</span> <span class="nam">min_ampl_frac</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">ampls</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t322" href="#t322">322</a></span><span class="t">    <span class="nam">waves</span> <span class="op">=</span> <span class="nam">waves</span><span class="op">[</span><span class="nam">select</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t323" href="#t323">323</a></span><span class="t">    <span class="nam">times</span> <span class="op">=</span> <span class="op">[</span><span class="nam">times</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span> <span class="key">for</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times</span><span class="op">)</span><span class="op">)</span> <span class="key">if</span> <span class="nam">select</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t324" href="#t324">324</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">waves</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t325" href="#t325">325</a></span><span class="t">        <span class="key">return</span> <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">eod_times</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t326" href="#t326">326</a></span><span class="t">    <span class="str">"""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t327" href="#t327">327</a></span><span class="t"><span class="str">    #plt.plot(freqs)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t328" href="#t328">328</a></span><span class="t"><span class="str">    plt.plot(waves.T)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t329" href="#t329">329</a></span><span class="t"><span class="str">    plt.show()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t330" href="#t330">330</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t331" href="#t331">331</a></span><span class="t">    <span class="nam">mean_eod</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="nam">n</span><span class="op">,</span> <span class="num">3</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t332" href="#t332">332</a></span><span class="t">    <span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span> <span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">rate</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t333" href="#t333">333</a></span><span class="t">    <span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span> <span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">waves</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t334" href="#t334">334</a></span><span class="t">    <span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span> <span class="num">2</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">waves</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t335" href="#t335">335</a></span><span class="t">    <span class="nam">eod_times</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">concatenate</span><span class="op">(</span><span class="nam">times</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t336" href="#t336">336</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t337" href="#t337">337</a></span><span class="t">    <span class="com"># apply inverse filter:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t338" href="#t338">338</a></span><span class="t">    <span class="key">if</span> <span class="nam">unfilter_cutoff</span> <span class="key">and</span> <span class="nam">unfilter_cutoff</span> <span class="op">></span> <span class="num">0.0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t339" href="#t339">339</a></span><span class="t">        <span class="nam">unfilter</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span> <span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">unfilter_cutoff</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t340" href="#t340">340</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t341" href="#t341">341</a></span><span class="t">    <span class="key">return</span> <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">eod_times</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t342" href="#t342">342</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t343" href="#t343">343</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t344" href="#t344">344</a></span><span class="t"><span class="key">def</span> <span class="nam">unfilter</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">cutoff</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t345" href="#t345">345</a></span><span class="t">    <span class="str">"""Apply inverse high-pass filter on data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t346" href="#t346">346</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t347" href="#t347">347</a></span><span class="t"><span class="str">    Assumes high-pass filter</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t348" href="#t348">348</a></span><span class="t"><span class="str">    \\[ \\tau \\dot y = -y + \\tau \\dot x \\]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t349" href="#t349">349</a></span><span class="t"><span class="str">    has been applied on the original data \\(x\\), where</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t350" href="#t350">350</a></span><span class="t"><span class="str">    \\(\\tau=(2\\pi f_{cutoff})^{-1}\\) is the time constant of the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t351" href="#t351">351</a></span><span class="t"><span class="str">    filter. To recover \\(x\\) the ODE</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t352" href="#t352">352</a></span><span class="t"><span class="str">    \\[ \\tau \\dot x = y + \\tau \\dot y \\]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t353" href="#t353">353</a></span><span class="t"><span class="str">    is applied on the filtered data \\(y\\).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t354" href="#t354">354</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t355" href="#t355">355</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t356" href="#t356">356</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t357" href="#t357">357</a></span><span class="t"><span class="str">    data: ndarray</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t358" href="#t358">358</a></span><span class="t"><span class="str">        High-pass filtered original data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t359" href="#t359">359</a></span><span class="t"><span class="str">    rate: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t360" href="#t360">360</a></span><span class="t"><span class="str">        Sampling rate of `data` in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t361" href="#t361">361</a></span><span class="t"><span class="str">    cutoff: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t362" href="#t362">362</a></span><span class="t"><span class="str">        Cutoff frequency \\(f_{cutoff}\\) of the high-pass filter in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t363" href="#t363">363</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t364" href="#t364">364</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t365" href="#t365">365</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t366" href="#t366">366</a></span><span class="t"><span class="str">    data: ndarray</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t367" href="#t367">367</a></span><span class="t"><span class="str">        Recovered original data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t368" href="#t368">368</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t369" href="#t369">369</a></span><span class="t">    <span class="nam">tau</span> <span class="op">=</span> <span class="num">0.5</span><span class="op">/</span><span class="nam">np</span><span class="op">.</span><span class="nam">pi</span><span class="op">/</span><span class="nam">cutoff</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t370" href="#t370">370</a></span><span class="t">    <span class="nam">fac</span> <span class="op">=</span> <span class="nam">tau</span><span class="op">*</span><span class="nam">rate</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t371" href="#t371">371</a></span><span class="t">    <span class="nam">data</span> <span class="op">-=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t372" href="#t372">372</a></span><span class="t">    <span class="nam">d0</span> <span class="op">=</span> <span class="nam">data</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t373" href="#t373">373</a></span><span class="t">    <span class="nam">x</span> <span class="op">=</span> <span class="nam">d0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t374" href="#t374">374</a></span><span class="t">    <span class="key">for</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t375" href="#t375">375</a></span><span class="t">        <span class="nam">d1</span> <span class="op">=</span> <span class="nam">data</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t376" href="#t376">376</a></span><span class="t">        <span class="nam">x</span> <span class="op">+=</span> <span class="op">(</span><span class="nam">d1</span> <span class="op">-</span> <span class="nam">d0</span><span class="op">)</span> <span class="op">+</span> <span class="nam">d0</span><span class="op">/</span><span class="nam">fac</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t377" href="#t377">377</a></span><span class="t">        <span class="nam">data</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span> <span class="op">=</span> <span class="nam">x</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t378" href="#t378">378</a></span><span class="t">        <span class="nam">d0</span> <span class="op">=</span> <span class="nam">d1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t379" href="#t379">379</a></span><span class="t">    <span class="key">return</span> <span class="nam">data</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t380" href="#t380">380</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t381" href="#t381">381</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t382" href="#t382">382</a></span><span class="t"><span class="key">def</span> <span class="nam">fourier_series</span><span class="op">(</span><span class="nam">t</span><span class="op">,</span> <span class="nam">freq</span><span class="op">,</span> <span class="op">*</span><span class="nam">ap</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t383" href="#t383">383</a></span><span class="t">    <span class="str">"""Fourier series of sine waves with amplitudes and phases.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t384" href="#t384">384</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t385" href="#t385">385</a></span><span class="t"><span class="str">    x(t) = sum_{i=0}^n ap[2*i]*sin(2 pi (i+1) freq t + ap[2*i+1])</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t386" href="#t386">386</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t387" href="#t387">387</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t388" href="#t388">388</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t389" href="#t389">389</a></span><span class="t"><span class="str">    t: float or array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t390" href="#t390">390</a></span><span class="t"><span class="str">        Time.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t391" href="#t391">391</a></span><span class="t"><span class="str">    freq: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t392" href="#t392">392</a></span><span class="t"><span class="str">        Fundamental frequency.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t393" href="#t393">393</a></span><span class="t"><span class="str">    *ap: list of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t394" href="#t394">394</a></span><span class="t"><span class="str">        The amplitudes and phases (in rad) of the fundamental and harmonics.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t395" href="#t395">395</a></span><span class="t"><span class="str">        </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t396" href="#t396">396</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t397" href="#t397">397</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t398" href="#t398">398</a></span><span class="t"><span class="str">    x: float or array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t399" href="#t399">399</a></span><span class="t"><span class="str">        The Fourier series evaluated at times `t`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t400" href="#t400">400</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t401" href="#t401">401</a></span><span class="t">    <span class="nam">omega</span> <span class="op">=</span> <span class="num">2.0</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">pi</span><span class="op">*</span><span class="nam">freq</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t402" href="#t402">402</a></span><span class="t">    <span class="nam">x</span> <span class="op">=</span> <span class="num">0.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t403" href="#t403">403</a></span><span class="t">    <span class="key">for</span> <span class="nam">i</span><span class="op">,</span> <span class="op">(</span><span class="nam">a</span><span class="op">,</span> <span class="nam">p</span><span class="op">)</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">zip</span><span class="op">(</span><span class="nam">ap</span><span class="op">[</span><span class="num">0</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">,</span> <span class="nam">ap</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t404" href="#t404">404</a></span><span class="t">        <span class="nam">x</span> <span class="op">+=</span> <span class="nam">a</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">sin</span><span class="op">(</span><span class="op">(</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">*</span><span class="nam">omega</span><span class="op">*</span><span class="nam">t</span><span class="op">+</span><span class="nam">p</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t405" href="#t405">405</a></span><span class="t">    <span class="key">return</span> <span class="nam">x</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t406" href="#t406">406</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t407" href="#t407">407</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t408" href="#t408">408</a></span><span class="t"><span class="key">def</span> <span class="nam">analyze_wave</span><span class="op">(</span><span class="nam">eod</span><span class="op">,</span> <span class="nam">freq</span><span class="op">,</span> <span class="nam">n_harm</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">power_n_harmonics</span><span class="op">=</span><span class="num">0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t409" href="#t409">409</a></span><span class="t">                 <span class="nam">n_harmonics</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">flip_wave</span><span class="op">=</span><span class="str">'none'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t410" href="#t410">410</a></span><span class="t">    <span class="str">"""Analyze the EOD waveform of a wave fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t411" href="#t411">411</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t412" href="#t412">412</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t413" href="#t413">413</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t414" href="#t414">414</a></span><span class="t"><span class="str">    eod: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t415" href="#t415">415</a></span><span class="t"><span class="str">        The eod waveform. First column is time in seconds, second</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t416" href="#t416">416</a></span><span class="t"><span class="str">        column the EOD waveform, third column, if present, is the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t417" href="#t417">417</a></span><span class="t"><span class="str">        standard error of the EOD waveform, Further columns are</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t418" href="#t418">418</a></span><span class="t"><span class="str">        optional but not used.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t419" href="#t419">419</a></span><span class="t"><span class="str">    freq: float or 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t420" href="#t420">420</a></span><span class="t"><span class="str">        The frequency of the EOD or the list of harmonics (rows) with</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t421" href="#t421">421</a></span><span class="t"><span class="str">        frequency and peak height (columns) as returned from</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t422" href="#t422">422</a></span><span class="t"><span class="str">        `harmonics.harmonic_groups()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t423" href="#t423">423</a></span><span class="t"><span class="str">    n_harm: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t424" href="#t424">424</a></span><span class="t"><span class="str">        Maximum number of harmonics used for the Fourier decomposition.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t425" href="#t425">425</a></span><span class="t"><span class="str">    power_n_harmonics: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t426" href="#t426">426</a></span><span class="t"><span class="str">        Sum over the first `power_n_harmonics` harmonics for computing</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t427" href="#t427">427</a></span><span class="t"><span class="str">        the total power.  If 0 sum over all harmonics.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t428" href="#t428">428</a></span><span class="t"><span class="str">    n_harmonics: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t429" href="#t429">429</a></span><span class="t"><span class="str">        The maximum power of higher harmonics is computed from</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t430" href="#t430">430</a></span><span class="t"><span class="str">        harmonics higher than the maximum harmonics within the first</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t431" href="#t431">431</a></span><span class="t"><span class="str">        three harmonics plus `n_harmonics`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t432" href="#t432">432</a></span><span class="t"><span class="str">    flip_wave: 'auto', 'none', 'flip'</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t433" href="#t433">433</a></span><span class="t"><span class="str">        - 'auto' flip waveform such that the larger extremum is positive.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t434" href="#t434">434</a></span><span class="t"><span class="str">        - 'flip' flip waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t435" href="#t435">435</a></span><span class="t"><span class="str">        - 'none' do not flip waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t436" href="#t436">436</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t437" href="#t437">437</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t438" href="#t438">438</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t439" href="#t439">439</a></span><span class="t"><span class="str">    meod: 2-D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t440" href="#t440">440</a></span><span class="t"><span class="str">        The eod waveform. First column is time in seconds, second</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t441" href="#t441">441</a></span><span class="t"><span class="str">        column the eod waveform.  Further columns are kept from the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t442" href="#t442">442</a></span><span class="t"><span class="str">        input `eod`. And a column is added with the fit of the fourier</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t443" href="#t443">443</a></span><span class="t"><span class="str">        series to the waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t444" href="#t444">444</a></span><span class="t"><span class="str">    props: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t445" href="#t445">445</a></span><span class="t"><span class="str">        A dictionary with properties of the analyzed EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t446" href="#t446">446</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t447" href="#t447">447</a></span><span class="t"><span class="str">        - type: set to 'wave'.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t448" href="#t448">448</a></span><span class="t"><span class="str">        - EODf: is set to the EOD fundamental frequency.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t449" href="#t449">449</a></span><span class="t"><span class="str">        - p-p-amplitude: peak-to-peak amplitude of the Fourier fit.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t450" href="#t450">450</a></span><span class="t"><span class="str">        - flipped: True if the waveform was flipped.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t451" href="#t451">451</a></span><span class="t"><span class="str">        - amplitude: amplitude factor of the Fourier fit.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t452" href="#t452">452</a></span><span class="t"><span class="str">        - noise: root-mean squared standard error mean of the averaged</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t453" href="#t453">453</a></span><span class="t"><span class="str">          EOD waveform relative to the p-p amplitude.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t454" href="#t454">454</a></span><span class="t"><span class="str">        - rmserror: root-mean-square error between Fourier-fit and</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t455" href="#t455">455</a></span><span class="t"><span class="str">          EOD waveform relative to the p-p amplitude. If larger than</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t456" href="#t456">456</a></span><span class="t"><span class="str">          about 0.05 the data are bad.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t457" href="#t457">457</a></span><span class="t"><span class="str">        - ncrossings: number of zero crossings per period</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t458" href="#t458">458</a></span><span class="t"><span class="str">        - peakwidth: width of the peak at the averaged amplitude relative</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t459" href="#t459">459</a></span><span class="t"><span class="str">          to EOD period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t460" href="#t460">460</a></span><span class="t"><span class="str">        - troughwidth: width of the trough at the averaged amplitude</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t461" href="#t461">461</a></span><span class="t"><span class="str">          relative to EOD period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t462" href="#t462">462</a></span><span class="t"><span class="str">        - minwidth: peakwidth or troughwidth, whichever is smaller.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t463" href="#t463">463</a></span><span class="t"><span class="str">        - leftpeak: time from positive zero crossing to peak relative</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t464" href="#t464">464</a></span><span class="t"><span class="str">          to EOD period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t465" href="#t465">465</a></span><span class="t"><span class="str">        - rightpeak: time from peak to negative zero crossing relative to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t466" href="#t466">466</a></span><span class="t"><span class="str">          EOD period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t467" href="#t467">467</a></span><span class="t"><span class="str">        - lefttrough: time from negative zero crossing to trough relative to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t468" href="#t468">468</a></span><span class="t"><span class="str">          EOD period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t469" href="#t469">469</a></span><span class="t"><span class="str">        - righttrough: time from trough to positive zero crossing relative to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t470" href="#t470">470</a></span><span class="t"><span class="str">          EOD period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t471" href="#t471">471</a></span><span class="t"><span class="str">        - p-p-distance: time between peak and trough relative to EOD period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t472" href="#t472">472</a></span><span class="t"><span class="str">        - min-p-p-distance: p-p-distance or EOD period minus p-p-distance,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t473" href="#t473">473</a></span><span class="t"><span class="str">          whichever is smaller, relative to EOD period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t474" href="#t474">474</a></span><span class="t"><span class="str">        - relpeakampl: amplitude of peak or trough, whichever is larger,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t475" href="#t475">475</a></span><span class="t"><span class="str">          relative to p-p amplitude.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t476" href="#t476">476</a></span><span class="t"><span class="str">        - power: summed power of all harmonics of the extracted EOD waveform</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t477" href="#t477">477</a></span><span class="t"><span class="str">          in decibel relative to one.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t478" href="#t478">478</a></span><span class="t"><span class="str">        - datapower: summed power of all harmonics of the original data in</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t479" href="#t479">479</a></span><span class="t"><span class="str">          decibel relative to one. Only if `freq` is a list of harmonics.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t480" href="#t480">480</a></span><span class="t"><span class="str">        - thd: total harmonic distortion, i.e. square root of sum of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t481" href="#t481">481</a></span><span class="t"><span class="str">          amplitudes squared of harmonics relative to amplitude</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t482" href="#t482">482</a></span><span class="t"><span class="str">          of fundamental.  </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t483" href="#t483">483</a></span><span class="t"><span class="str">        - dbdiff: smoothness of power spectrum as standard deviation of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t484" href="#t484">484</a></span><span class="t"><span class="str">          differences in decibel power.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t485" href="#t485">485</a></span><span class="t"><span class="str">        - maxdb: maximum power of higher harmonics relative to peak power</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t486" href="#t486">486</a></span><span class="t"><span class="str">          in decibel.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t487" href="#t487">487</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t488" href="#t488">488</a></span><span class="t"><span class="str">    spec_data: 2-D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t489" href="#t489">489</a></span><span class="t"><span class="str">        First six columns are from the spectrum of the extracted</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t490" href="#t490">490</a></span><span class="t"><span class="str">        waveform.  First column is the index of the harmonics, second</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t491" href="#t491">491</a></span><span class="t"><span class="str">        column its frequency, third column its amplitude, fourth</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t492" href="#t492">492</a></span><span class="t"><span class="str">        column its amplitude relative to the fundamental, fifth column</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t493" href="#t493">493</a></span><span class="t"><span class="str">        is power of harmonics relative to fundamental in decibel, and</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t494" href="#t494">494</a></span><span class="t"><span class="str">        sixth column the phase shift relative to the fundamental.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t495" href="#t495">495</a></span><span class="t"><span class="str">        If `freq` is a list of harmonics, a seventh column is added to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t496" href="#t496">496</a></span><span class="t"><span class="str">        `spec_data` that contains the powers of the harmonics from the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t497" href="#t497">497</a></span><span class="t"><span class="str">        original power spectrum of the raw data.  Rows are the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t498" href="#t498">498</a></span><span class="t"><span class="str">        harmonics, first row is the fundamental frequency with index</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t499" href="#t499">499</a></span><span class="t"><span class="str">        0, relative amplitude of one, relative power of 0dB, and phase</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t500" href="#t500">500</a></span><span class="t"><span class="str">        shift of zero.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t501" href="#t501">501</a></span><span class="t"><span class="str">    error_str: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t502" href="#t502">502</a></span><span class="t"><span class="str">        If fitting of the fourier series failed,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t503" href="#t503">503</a></span><span class="t"><span class="str">        this is reported in this string.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t504" href="#t504">504</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t505" href="#t505">505</a></span><span class="t"><span class="str">    Raises</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t506" href="#t506">506</a></span><span class="t"><span class="str">    ------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t507" href="#t507">507</a></span><span class="t"><span class="str">    IndexError:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t508" href="#t508">508</a></span><span class="t"><span class="str">        EOD data is less than one period long.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t509" href="#t509">509</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t510" href="#t510">510</a></span><span class="t">    <span class="nam">error_str</span> <span class="op">=</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t511" href="#t511">511</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t512" href="#t512">512</a></span><span class="t">    <span class="nam">freq0</span> <span class="op">=</span> <span class="nam">freq</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t513" href="#t513">513</a></span><span class="t">    <span class="key">if</span> <span class="nam">hasattr</span><span class="op">(</span><span class="nam">freq</span><span class="op">,</span> <span class="str">'shape'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t514" href="#t514">514</a></span><span class="t">        <span class="nam">freq0</span> <span class="op">=</span> <span class="nam">freq</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t515" href="#t515">515</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t516" href="#t516">516</a></span><span class="t">    <span class="com"># storage:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t517" href="#t517">517</a></span><span class="t">    <span class="nam">meod</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="nam">eod</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">eod</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t518" href="#t518">518</a></span><span class="t">    <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">eod</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t519" href="#t519">519</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t520" href="#t520">520</a></span><span class="t">    <span class="com"># subtract mean and flip:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t521" href="#t521">521</a></span><span class="t">    <span class="nam">period</span> <span class="op">=</span> <span class="num">1.0</span><span class="op">/</span><span class="nam">freq0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t522" href="#t522">522</a></span><span class="t">    <span class="nam">pinx</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">ceil</span><span class="op">(</span><span class="nam">period</span><span class="op">/</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="num">1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t523" href="#t523">523</a></span><span class="t">    <span class="nam">maxn</span> <span class="op">=</span> <span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">//</span><span class="nam">pinx</span><span class="op">)</span><span class="op">*</span><span class="nam">pinx</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t524" href="#t524">524</a></span><span class="t">    <span class="key">if</span> <span class="nam">maxn</span> <span class="op">&lt;</span> <span class="nam">pinx</span><span class="op">:</span> <span class="nam">maxn</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t525" href="#t525">525</a></span><span class="t">    <span class="nam">offs</span> <span class="op">=</span> <span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span> <span class="op">-</span> <span class="nam">maxn</span><span class="op">)</span><span class="op">//</span><span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t526" href="#t526">526</a></span><span class="t">    <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">offs</span><span class="op">:</span><span class="nam">offs</span><span class="op">+</span><span class="nam">pinx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t527" href="#t527">527</a></span><span class="t">    <span class="nam">flipped</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t528" href="#t528">528</a></span><span class="t">    <span class="key">if</span> <span class="str">'flip'</span> <span class="key">in</span> <span class="nam">flip_wave</span> <span class="key">or</span> <span class="op">(</span><span class="str">'auto'</span> <span class="key">in</span> <span class="nam">flip_wave</span> <span class="key">and</span> <span class="op">-</span><span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t529" href="#t529">529</a></span><span class="t">        <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t530" href="#t530">530</a></span><span class="t">        <span class="nam">flipped</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t531" href="#t531">531</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t532" href="#t532">532</a></span><span class="t">    <span class="com"># move peak of waveform to zero:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t533" href="#t533">533</a></span><span class="t">    <span class="nam">offs</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">//</span><span class="num">4</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t534" href="#t534">534</a></span><span class="t">    <span class="nam">maxinx</span> <span class="op">=</span> <span class="nam">offs</span><span class="op">+</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">offs</span><span class="op">:</span><span class="num">3</span><span class="op">*</span><span class="nam">offs</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t535" href="#t535">535</a></span><span class="t">    <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">maxinx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t536" href="#t536">536</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t537" href="#t537">537</a></span><span class="t">    <span class="com"># indices of exactly one or two periods around peak:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t538" href="#t538">538</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span> <span class="op">&lt;</span> <span class="nam">pinx</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t539" href="#t539">539</a></span><span class="t">        <span class="key">raise</span> <span class="nam">IndexError</span><span class="op">(</span><span class="str">'data need to contain at least one EOD period'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t540" href="#t540">540</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span> <span class="op">>=</span> <span class="num">2</span><span class="op">*</span><span class="nam">pinx</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t541" href="#t541">541</a></span><span class="t">        <span class="nam">i0</span> <span class="op">=</span> <span class="nam">maxinx</span> <span class="op">-</span> <span class="nam">pinx</span> <span class="key">if</span> <span class="nam">maxinx</span> <span class="op">>=</span> <span class="nam">pinx</span> <span class="key">else</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t542" href="#t542">542</a></span><span class="t">        <span class="nam">i1</span> <span class="op">=</span> <span class="nam">i0</span> <span class="op">+</span> <span class="num">2</span><span class="op">*</span><span class="nam">pinx</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t543" href="#t543">543</a></span><span class="t">        <span class="key">if</span> <span class="nam">i1</span> <span class="op">></span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t544" href="#t544">544</a></span><span class="t">            <span class="nam">i1</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t545" href="#t545">545</a></span><span class="t">            <span class="nam">i0</span> <span class="op">=</span> <span class="nam">i1</span> <span class="op">-</span> <span class="num">2</span><span class="op">*</span><span class="nam">pinx</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t546" href="#t546">546</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t547" href="#t547">547</a></span><span class="t">        <span class="nam">i0</span> <span class="op">=</span> <span class="nam">maxinx</span> <span class="op">-</span> <span class="nam">pinx</span><span class="op">//</span><span class="num">2</span> <span class="key">if</span> <span class="nam">maxinx</span> <span class="op">>=</span> <span class="nam">pinx</span><span class="op">//</span><span class="num">2</span> <span class="key">else</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t548" href="#t548">548</a></span><span class="t">        <span class="nam">i1</span> <span class="op">=</span> <span class="nam">i0</span> <span class="op">+</span> <span class="nam">pinx</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t549" href="#t549">549</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t550" href="#t550">550</a></span><span class="t">    <span class="com"># subtract mean:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t551" href="#t551">551</a></span><span class="t">    <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t552" href="#t552">552</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t553" href="#t553">553</a></span><span class="t">    <span class="com"># zero crossings:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t554" href="#t554">554</a></span><span class="t">    <span class="nam">ui</span><span class="op">,</span> <span class="nam">di</span> <span class="op">=</span> <span class="nam">threshold_crossings</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="num">0.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t555" href="#t555">555</a></span><span class="t">    <span class="nam">ut</span><span class="op">,</span> <span class="nam">dt</span> <span class="op">=</span> <span class="nam">threshold_crossing_times</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="num">0.0</span><span class="op">,</span> <span class="nam">ui</span><span class="op">,</span> <span class="nam">di</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t556" href="#t556">556</a></span><span class="t">    <span class="nam">ut</span><span class="op">,</span> <span class="nam">dt</span> <span class="op">=</span> <span class="nam">merge_events</span><span class="op">(</span><span class="nam">ut</span><span class="op">,</span> <span class="nam">dt</span><span class="op">,</span> <span class="num">0.02</span><span class="op">/</span><span class="nam">freq0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t557" href="#t557">557</a></span><span class="t">    <span class="nam">ncrossings</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">ut</span><span class="op">)</span> <span class="op">+</span> <span class="nam">len</span><span class="op">(</span><span class="nam">dt</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="nam">freq0</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t558" href="#t558">558</a></span><span class="t">    <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">any</span><span class="op">(</span><span class="nam">ut</span><span class="op">&lt;</span><span class="num">0.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t559" href="#t559">559</a></span><span class="t">        <span class="nam">up_time</span> <span class="op">=</span> <span class="nam">ut</span><span class="op">[</span><span class="nam">ut</span><span class="op">&lt;</span><span class="num">0.0</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t560" href="#t560">560</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t561" href="#t561">561</a></span><span class="t">        <span class="nam">up_time</span> <span class="op">=</span> <span class="num">0.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t562" href="#t562">562</a></span><span class="t">        <span class="nam">error_str</span> <span class="op">+=</span> <span class="str">'%.1f Hz wave fish: no upward zero crossing. '</span> <span class="op">%</span> <span class="nam">freq0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t563" href="#t563">563</a></span><span class="t">    <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">any</span><span class="op">(</span><span class="nam">dt</span><span class="op">></span><span class="num">0.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t564" href="#t564">564</a></span><span class="t">        <span class="nam">down_time</span> <span class="op">=</span> <span class="nam">dt</span><span class="op">[</span><span class="nam">dt</span><span class="op">></span><span class="num">0.0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t565" href="#t565">565</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t566" href="#t566">566</a></span><span class="t">        <span class="nam">down_time</span> <span class="op">=</span> <span class="num">0.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t567" href="#t567">567</a></span><span class="t">        <span class="nam">error_str</span> <span class="op">+=</span> <span class="str">'%.1f Hz wave fish: no downward zero crossing. '</span> <span class="op">%</span> <span class="nam">freq0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t568" href="#t568">568</a></span><span class="t">    <span class="nam">peak_width</span> <span class="op">=</span> <span class="nam">down_time</span> <span class="op">-</span> <span class="nam">up_time</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t569" href="#t569">569</a></span><span class="t">    <span class="nam">trough_width</span> <span class="op">=</span> <span class="nam">period</span> <span class="op">-</span> <span class="nam">peak_width</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t570" href="#t570">570</a></span><span class="t">    <span class="nam">peak_time</span> <span class="op">=</span> <span class="num">0.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t571" href="#t571">571</a></span><span class="t">    <span class="nam">trough_time</span> <span class="op">=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">maxinx</span><span class="op">+</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">maxinx</span><span class="op">:</span><span class="nam">maxinx</span><span class="op">+</span><span class="nam">pinx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t572" href="#t572">572</a></span><span class="t">    <span class="nam">phase1</span> <span class="op">=</span> <span class="nam">peak_time</span> <span class="op">-</span> <span class="nam">up_time</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t573" href="#t573">573</a></span><span class="t">    <span class="nam">phase2</span> <span class="op">=</span> <span class="nam">down_time</span> <span class="op">-</span> <span class="nam">peak_time</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t574" href="#t574">574</a></span><span class="t">    <span class="nam">phase3</span> <span class="op">=</span> <span class="nam">trough_time</span> <span class="op">-</span> <span class="nam">down_time</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t575" href="#t575">575</a></span><span class="t">    <span class="nam">phase4</span> <span class="op">=</span> <span class="nam">up_time</span> <span class="op">+</span> <span class="nam">period</span> <span class="op">-</span> <span class="nam">trough_time</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t576" href="#t576">576</a></span><span class="t">    <span class="nam">distance</span> <span class="op">=</span> <span class="nam">trough_time</span> <span class="op">-</span> <span class="nam">peak_time</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t577" href="#t577">577</a></span><span class="t">    <span class="nam">min_distance</span> <span class="op">=</span> <span class="nam">distance</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t578" href="#t578">578</a></span><span class="t">    <span class="key">if</span> <span class="nam">distance</span> <span class="op">></span> <span class="nam">period</span><span class="op">/</span><span class="num">2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t579" href="#t579">579</a></span><span class="t">        <span class="nam">min_distance</span> <span class="op">=</span> <span class="nam">period</span> <span class="op">-</span> <span class="nam">distance</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t580" href="#t580">580</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t581" href="#t581">581</a></span><span class="t">    <span class="com"># fit fourier series:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t582" href="#t582">582</a></span><span class="t">    <span class="nam">ampl</span> <span class="op">=</span> <span class="num">0.5</span><span class="op">*</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t583" href="#t583">583</a></span><span class="t">    <span class="key">while</span> <span class="nam">n_harm</span> <span class="op">></span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t584" href="#t584">584</a></span><span class="t">        <span class="nam">params</span> <span class="op">=</span> <span class="op">[</span><span class="nam">freq0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t585" href="#t585">585</a></span><span class="t">        <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="num">1</span><span class="op">,</span> <span class="nam">n_harm</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t586" href="#t586">586</a></span><span class="t">            <span class="nam">params</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="op">[</span><span class="nam">ampl</span><span class="op">/</span><span class="nam">i</span><span class="op">,</span> <span class="num">0.0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t587" href="#t587">587</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t588" href="#t588">588</a></span><span class="t">            <span class="nam">popt</span><span class="op">,</span> <span class="nam">pcov</span> <span class="op">=</span> <span class="nam">curve_fit</span><span class="op">(</span><span class="nam">fourier_series</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t589" href="#t589">589</a></span><span class="t">                                   <span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">params</span><span class="op">,</span> <span class="nam">maxfev</span><span class="op">=</span><span class="num">2000</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t590" href="#t590">590</a></span><span class="t">            <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t591" href="#t591">591</a></span><span class="t">        <span class="key">except</span> <span class="op">(</span><span class="nam">RuntimeError</span><span class="op">,</span> <span class="nam">TypeError</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t592" href="#t592">592</a></span><span class="t">            <span class="nam">error_str</span> <span class="op">+=</span> <span class="str">'%.1f Hz wave fish: fit of fourier series failed for %d harmonics. '</span> <span class="op">%</span> <span class="op">(</span><span class="nam">freq0</span><span class="op">,</span> <span class="nam">n_harm</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t593" href="#t593">593</a></span><span class="t">            <span class="nam">n_harm</span> <span class="op">//=</span> <span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t594" href="#t594">594</a></span><span class="t">    <span class="com"># store fourier fit:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t595" href="#t595">595</a></span><span class="t">    <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">fourier_series</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="op">*</span><span class="nam">popt</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t596" href="#t596">596</a></span><span class="t">    <span class="com"># make all amplitudes positive:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t597" href="#t597">597</a></span><span class="t">    <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">n_harm</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t598" href="#t598">598</a></span><span class="t">        <span class="key">if</span> <span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="num">0.0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t599" href="#t599">599</a></span><span class="t">            <span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">1</span><span class="op">]</span> <span class="op">*=</span> <span class="op">-</span><span class="num">1.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t600" href="#t600">600</a></span><span class="t">            <span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">2</span><span class="op">]</span> <span class="op">+=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">pi</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t601" href="#t601">601</a></span><span class="t">    <span class="com"># phases relative to fundamental:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t602" href="#t602">602</a></span><span class="t">    <span class="com"># phi0 = 2*pi*f0*dt &lt;=> dt = phi0/(2*pi*f0)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t603" href="#t603">603</a></span><span class="t">    <span class="com"># phik = 2*pi*i*f0*dt = i*phi0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t604" href="#t604">604</a></span><span class="t">    <span class="nam">phi0</span> <span class="op">=</span> <span class="nam">popt</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t605" href="#t605">605</a></span><span class="t">    <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">n_harm</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t606" href="#t606">606</a></span><span class="t">        <span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">2</span><span class="op">]</span> <span class="op">-=</span> <span class="op">(</span><span class="nam">i</span> <span class="op">+</span> <span class="num">1</span><span class="op">)</span><span class="op">*</span><span class="nam">phi0</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t607" href="#t607">607</a></span><span class="t">        <span class="com"># all phases in the range -pi to pi:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t608" href="#t608">608</a></span><span class="t">        <span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">2</span><span class="op">]</span> <span class="op">%=</span> <span class="num">2</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">pi</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t609" href="#t609">609</a></span><span class="t">        <span class="key">if</span> <span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">2</span><span class="op">]</span> <span class="op">></span> <span class="nam">np</span><span class="op">.</span><span class="nam">pi</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t610" href="#t610">610</a></span><span class="t">            <span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">2</span><span class="op">]</span> <span class="op">-=</span> <span class="num">2</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">pi</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t611" href="#t611">611</a></span><span class="t">    <span class="com"># store fourier spectrum:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t612" href="#t612">612</a></span><span class="t">    <span class="key">if</span> <span class="nam">hasattr</span><span class="op">(</span><span class="nam">freq</span><span class="op">,</span> <span class="str">'shape'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t613" href="#t613">613</a></span><span class="t">        <span class="nam">n</span> <span class="op">=</span> <span class="nam">n_harm</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t614" href="#t614">614</a></span><span class="t">        <span class="nam">n</span> <span class="op">+=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">freq</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">></span> <span class="op">(</span><span class="nam">n_harm</span><span class="op">+</span><span class="num">0.5</span><span class="op">)</span><span class="op">*</span><span class="nam">freq</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t615" href="#t615">615</a></span><span class="t">        <span class="nam">spec_data</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="nam">n</span><span class="op">,</span> <span class="num">7</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t616" href="#t616">616</a></span><span class="t">        <span class="nam">spec_data</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">nan</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t617" href="#t617">617</a></span><span class="t">        <span class="nam">k</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t618" href="#t618">618</a></span><span class="t">        <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">n_harm</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t619" href="#t619">619</a></span><span class="t">            <span class="key">while</span> <span class="nam">k</span> <span class="op">&lt;</span> <span class="nam">len</span><span class="op">(</span><span class="nam">freq</span><span class="op">)</span> <span class="key">and</span> <span class="nam">freq</span><span class="op">[</span><span class="nam">k</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">&lt;</span> <span class="op">(</span><span class="nam">i</span><span class="op">+</span><span class="num">0.5</span><span class="op">)</span><span class="op">*</span><span class="nam">freq0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t620" href="#t620">620</a></span><span class="t">                <span class="nam">k</span> <span class="op">+=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t621" href="#t621">621</a></span><span class="t">            <span class="key">if</span> <span class="nam">k</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">freq</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t622" href="#t622">622</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t623" href="#t623">623</a></span><span class="t">            <span class="key">if</span> <span class="nam">freq</span><span class="op">[</span><span class="nam">k</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">&lt;</span> <span class="op">(</span><span class="nam">i</span><span class="op">+</span><span class="num">1.5</span><span class="op">)</span><span class="op">*</span><span class="nam">freq0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t624" href="#t624">624</a></span><span class="t">                <span class="nam">spec_data</span><span class="op">[</span><span class="nam">i</span><span class="op">,</span><span class="num">6</span><span class="op">]</span> <span class="op">=</span> <span class="nam">freq</span><span class="op">[</span><span class="nam">k</span><span class="op">,</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t625" href="#t625">625</a></span><span class="t">                <span class="nam">k</span> <span class="op">+=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t626" href="#t626">626</a></span><span class="t">        <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">n_harm</span><span class="op">,</span> <span class="nam">n</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t627" href="#t627">627</a></span><span class="t">            <span class="key">if</span> <span class="nam">k</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">freq</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t628" href="#t628">628</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t629" href="#t629">629</a></span><span class="t">            <span class="nam">spec_data</span><span class="op">[</span><span class="nam">i</span><span class="op">,</span><span class="op">:</span><span class="num">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="nam">freq</span><span class="op">[</span><span class="nam">k</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">/</span><span class="nam">freq0</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">,</span> <span class="nam">freq</span><span class="op">[</span><span class="nam">k</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t630" href="#t630">630</a></span><span class="t">            <span class="nam">spec_data</span><span class="op">[</span><span class="nam">i</span><span class="op">,</span><span class="num">6</span><span class="op">]</span> <span class="op">=</span> <span class="nam">freq</span><span class="op">[</span><span class="nam">k</span><span class="op">,</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t631" href="#t631">631</a></span><span class="t">            <span class="nam">k</span> <span class="op">+=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t632" href="#t632">632</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t633" href="#t633">633</a></span><span class="t">        <span class="nam">spec_data</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="nam">n_harm</span><span class="op">,</span> <span class="num">6</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t634" href="#t634">634</a></span><span class="t">    <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">n_harm</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t635" href="#t635">635</a></span><span class="t">        <span class="nam">spec_data</span><span class="op">[</span><span class="nam">i</span><span class="op">,</span><span class="op">:</span><span class="num">6</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="nam">i</span><span class="op">,</span> <span class="op">(</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">*</span><span class="nam">freq0</span><span class="op">,</span> <span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">/</span><span class="nam">popt</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t636" href="#t636">636</a></span><span class="t">                           <span class="nam">decibel</span><span class="op">(</span><span class="op">(</span><span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">/</span><span class="nam">popt</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">**</span><span class="num">2.0</span><span class="op">)</span><span class="op">,</span> <span class="nam">popt</span><span class="op">[</span><span class="nam">i</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">2</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t637" href="#t637">637</a></span><span class="t">    <span class="com"># smoothness of power spectrum:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t638" href="#t638">638</a></span><span class="t">    <span class="nam">db_powers</span> <span class="op">=</span> <span class="nam">decibel</span><span class="op">(</span><span class="nam">spec_data</span><span class="op">[</span><span class="op">:</span><span class="nam">n_harm</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">**</span><span class="num">2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t639" href="#t639">639</a></span><span class="t">    <span class="nam">db_diff</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">diff</span><span class="op">(</span><span class="nam">db_powers</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t640" href="#t640">640</a></span><span class="t">    <span class="com"># maximum relative power of higher harmonics:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t641" href="#t641">641</a></span><span class="t">    <span class="nam">p_max</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">db_powers</span><span class="op">[</span><span class="op">:</span><span class="num">3</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t642" href="#t642">642</a></span><span class="t">    <span class="nam">db_powers</span> <span class="op">-=</span> <span class="nam">db_powers</span><span class="op">[</span><span class="nam">p_max</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t643" href="#t643">643</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">db_powers</span><span class="op">[</span><span class="nam">p_max</span><span class="op">+</span><span class="nam">n_harmonics</span><span class="op">:</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t644" href="#t644">644</a></span><span class="t">        <span class="nam">max_harmonics_power</span> <span class="op">=</span> <span class="op">-</span><span class="num">100.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t645" href="#t645">645</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t646" href="#t646">646</a></span><span class="t">        <span class="nam">max_harmonics_power</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">db_powers</span><span class="op">[</span><span class="nam">p_max</span><span class="op">+</span><span class="nam">n_harmonics</span><span class="op">:</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t647" href="#t647">647</a></span><span class="t">    <span class="com"># total harmonic distortion:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t648" href="#t648">648</a></span><span class="t">    <span class="nam">thd</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">nansum</span><span class="op">(</span><span class="nam">spec_data</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">,</span><span class="num">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t649" href="#t649">649</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t650" href="#t650">650</a></span><span class="t">    <span class="com"># peak-to-peak and trough amplitudes:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t651" href="#t651">651</a></span><span class="t">    <span class="nam">ppampl</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t652" href="#t652">652</a></span><span class="t">    <span class="nam">relpeakampl</span> <span class="op">=</span> <span class="nam">max</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">,</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">ppampl</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t653" href="#t653">653</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t654" href="#t654">654</a></span><span class="t">    <span class="com"># variance and fit error:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t655" href="#t655">655</a></span><span class="t">    <span class="nam">rmssem</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">**</span><span class="num">2.0</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">ppampl</span> <span class="key">if</span> <span class="nam">eod</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">2</span> <span class="key">else</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t656" href="#t656">656</a></span><span class="t">    <span class="nam">rmserror</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">**</span><span class="num">2.0</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">ppampl</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t657" href="#t657">657</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t658" href="#t658">658</a></span><span class="t">    <span class="com"># store results:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t659" href="#t659">659</a></span><span class="t">    <span class="nam">props</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t660" href="#t660">660</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'type'</span><span class="op">]</span> <span class="op">=</span> <span class="str">'wave'</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t661" href="#t661">661</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'EODf'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">freq0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t662" href="#t662">662</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'p-p-amplitude'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">ppampl</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t663" href="#t663">663</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'flipped'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">flipped</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t664" href="#t664">664</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'amplitude'</span><span class="op">]</span> <span class="op">=</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">ppampl</span>  <span class="com"># remove it</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t665" href="#t665">665</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'rmserror'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">rmserror</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t666" href="#t666">666</a></span><span class="t">    <span class="key">if</span> <span class="nam">rmssem</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t667" href="#t667">667</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'noise'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">rmssem</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t668" href="#t668">668</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'ncrossings'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">ncrossings</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t669" href="#t669">669</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'peakwidth'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">peak_width</span><span class="op">/</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t670" href="#t670">670</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'troughwidth'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">trough_width</span><span class="op">/</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t671" href="#t671">671</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'minwidth'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">min</span><span class="op">(</span><span class="nam">peak_width</span><span class="op">,</span> <span class="nam">trough_width</span><span class="op">)</span><span class="op">/</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t672" href="#t672">672</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'leftpeak'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">phase1</span><span class="op">/</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t673" href="#t673">673</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'rightpeak'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">phase2</span><span class="op">/</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t674" href="#t674">674</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'lefttrough'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">phase3</span><span class="op">/</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t675" href="#t675">675</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'righttrough'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">phase4</span><span class="op">/</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t676" href="#t676">676</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'p-p-distance'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">distance</span><span class="op">/</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t677" href="#t677">677</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'min-p-p-distance'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">min_distance</span><span class="op">/</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t678" href="#t678">678</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'relpeakampl'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">relpeakampl</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t679" href="#t679">679</a></span><span class="t">    <span class="nam">pnh</span> <span class="op">=</span> <span class="nam">power_n_harmonics</span> <span class="key">if</span> <span class="nam">power_n_harmonics</span> <span class="op">></span> <span class="num">0</span> <span class="key">else</span> <span class="nam">n_harm</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t680" href="#t680">680</a></span><span class="t">    <span class="nam">pnh</span> <span class="op">=</span> <span class="nam">min</span><span class="op">(</span><span class="nam">n_harm</span><span class="op">,</span> <span class="nam">pnh</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t681" href="#t681">681</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'power'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">decibel</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">spec_data</span><span class="op">[</span><span class="op">:</span><span class="nam">pnh</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">**</span><span class="num">2.0</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t682" href="#t682">682</a></span><span class="t">    <span class="key">if</span> <span class="nam">hasattr</span><span class="op">(</span><span class="nam">freq</span><span class="op">,</span> <span class="str">'shape'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t683" href="#t683">683</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'datapower'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">decibel</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">freq</span><span class="op">[</span><span class="op">:</span><span class="nam">pnh</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t684" href="#t684">684</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'thd'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">thd</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t685" href="#t685">685</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'dbdiff'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">db_diff</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t686" href="#t686">686</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'maxdb'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">max_harmonics_power</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t687" href="#t687">687</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t688" href="#t688">688</a></span><span class="t">    <span class="key">return</span> <span class="nam">meod</span><span class="op">,</span> <span class="nam">props</span><span class="op">,</span> <span class="nam">spec_data</span><span class="op">,</span> <span class="nam">error_str</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t689" href="#t689">689</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t690" href="#t690">690</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t691" href="#t691">691</a></span><span class="t"><span class="key">def</span> <span class="nam">exp_decay</span><span class="op">(</span><span class="nam">t</span><span class="op">,</span> <span class="nam">tau</span><span class="op">,</span> <span class="nam">ampl</span><span class="op">,</span> <span class="nam">offs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t692" href="#t692">692</a></span><span class="t">    <span class="str">"""Exponential decay function.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t693" href="#t693">693</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t694" href="#t694">694</a></span><span class="t"><span class="str">    x(t) = ampl*exp(-t/tau) + offs</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t695" href="#t695">695</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t696" href="#t696">696</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t697" href="#t697">697</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t698" href="#t698">698</a></span><span class="t"><span class="str">    t: float or array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t699" href="#t699">699</a></span><span class="t"><span class="str">        Time.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t700" href="#t700">700</a></span><span class="t"><span class="str">    tau: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t701" href="#t701">701</a></span><span class="t"><span class="str">        Time constant of exponential decay.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t702" href="#t702">702</a></span><span class="t"><span class="str">    ampl: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t703" href="#t703">703</a></span><span class="t"><span class="str">        Amplitude of exponential decay, i.e. initial value minus</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t704" href="#t704">704</a></span><span class="t"><span class="str">        steady-state value.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t705" href="#t705">705</a></span><span class="t"><span class="str">    offs: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t706" href="#t706">706</a></span><span class="t"><span class="str">        Steady-state value.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t707" href="#t707">707</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t708" href="#t708">708</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t709" href="#t709">709</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t710" href="#t710">710</a></span><span class="t"><span class="str">    x: float or array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t711" href="#t711">711</a></span><span class="t"><span class="str">        The exponential decay evaluated at times `t`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t712" href="#t712">712</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t713" href="#t713">713</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t714" href="#t714">714</a></span><span class="t">    <span class="key">return</span> <span class="nam">offs</span> <span class="op">+</span> <span class="nam">ampl</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">exp</span><span class="op">(</span><span class="op">-</span><span class="nam">t</span><span class="op">/</span><span class="nam">tau</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t715" href="#t715">715</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t716" href="#t716">716</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t717" href="#t717">717</a></span><span class="t"><span class="key">def</span> <span class="nam">analyze_pulse</span><span class="op">(</span><span class="nam">eod</span><span class="op">,</span> <span class="nam">eod_times</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">min_pulse_win</span><span class="op">=</span><span class="num">0.001</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t718" href="#t718">718</a></span><span class="t">                  <span class="nam">peak_thresh_fac</span><span class="op">=</span><span class="num">0.01</span><span class="op">,</span> <span class="nam">min_dist</span><span class="op">=</span><span class="num">50.0e-6</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t719" href="#t719">719</a></span><span class="t">                  <span class="nam">width_frac</span><span class="op">=</span><span class="num">0.5</span><span class="op">,</span> <span class="nam">fit_frac</span> <span class="op">=</span> <span class="num">0.5</span><span class="op">,</span> <span class="nam">freq_resolution</span><span class="op">=</span><span class="num">1.0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t720" href="#t720">720</a></span><span class="t">                  <span class="nam">flip_pulse</span><span class="op">=</span><span class="str">'none'</span><span class="op">,</span> <span class="nam">ipi_cv_thresh</span><span class="op">=</span><span class="num">0.5</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t721" href="#t721">721</a></span><span class="t">                  <span class="nam">ipi_percentile</span><span class="op">=</span><span class="num">30.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t722" href="#t722">722</a></span><span class="t">    <span class="str">"""Analyze the EOD waveform of a pulse fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t723" href="#t723">723</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t724" href="#t724">724</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t725" href="#t725">725</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t726" href="#t726">726</a></span><span class="t"><span class="str">    eod: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t727" href="#t727">727</a></span><span class="t"><span class="str">        The eod waveform. First column is time in seconds, second</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t728" href="#t728">728</a></span><span class="t"><span class="str">        column the EOD waveform, third column, if present, is the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t729" href="#t729">729</a></span><span class="t"><span class="str">        standard error of the EOD waveform, Further columns are</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t730" href="#t730">730</a></span><span class="t"><span class="str">        optional but not used.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t731" href="#t731">731</a></span><span class="t"><span class="str">    eod_times: 1-D array or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t732" href="#t732">732</a></span><span class="t"><span class="str">        List of times of detected EOD peaks.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t733" href="#t733">733</a></span><span class="t"><span class="str">    min_pulse_win: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t734" href="#t734">734</a></span><span class="t"><span class="str">        The minimum size of cut-out EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t735" href="#t735">735</a></span><span class="t"><span class="str">    peak_thresh_fac: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t736" href="#t736">736</a></span><span class="t"><span class="str">        Set the threshold for peak detection to the maximum pulse</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t737" href="#t737">737</a></span><span class="t"><span class="str">        amplitude times this factor.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t738" href="#t738">738</a></span><span class="t"><span class="str">    min_dist: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t739" href="#t739">739</a></span><span class="t"><span class="str">        Minimum distance between peak and troughs of the pulse.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t740" href="#t740">740</a></span><span class="t"><span class="str">    width_frac: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t741" href="#t741">741</a></span><span class="t"><span class="str">        The width of a peak is measured at this fraction of a peak's</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t742" href="#t742">742</a></span><span class="t"><span class="str">        height (0-1).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t743" href="#t743">743</a></span><span class="t"><span class="str">    fit_frac: float or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t744" href="#t744">744</a></span><span class="t"><span class="str">        An exponential is fitted to the tail of the last peak/trough</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t745" href="#t745">745</a></span><span class="t"><span class="str">        starting where the waveform falls below this fraction of the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t746" href="#t746">746</a></span><span class="t"><span class="str">        peak's height (0-1).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t747" href="#t747">747</a></span><span class="t"><span class="str">    freq_resolution: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t748" href="#t748">748</a></span><span class="t"><span class="str">        The frequency resolution of the power spectrum of the single pulse.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t749" href="#t749">749</a></span><span class="t"><span class="str">    flip_pulse: 'auto', 'none', 'flip'</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t750" href="#t750">750</a></span><span class="t"><span class="str">        - 'auto' flip waveform such that the first large extremum is positive.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t751" href="#t751">751</a></span><span class="t"><span class="str">        - 'flip' flip waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t752" href="#t752">752</a></span><span class="t"><span class="str">        - 'none' do not flip waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t753" href="#t753">753</a></span><span class="t"><span class="str">    ipi_cv_thresh: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t754" href="#t754">754</a></span><span class="t"><span class="str">        If the coefficient of variation of the interpulse intervals</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t755" href="#t755">755</a></span><span class="t"><span class="str">        are smaller than this threshold, then the EOD frequency is</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t756" href="#t756">756</a></span><span class="t"><span class="str">        computed as the inverse of the mean of all interpulse</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t757" href="#t757">757</a></span><span class="t"><span class="str">        intervals. Otherwise only intervals smaller than a certain</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t758" href="#t758">758</a></span><span class="t"><span class="str">        quantile are used.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t759" href="#t759">759</a></span><span class="t"><span class="str">    ipi_percentile: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t760" href="#t760">760</a></span><span class="t"><span class="str">        When computing the EOD frequency, period, mean and standard</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t761" href="#t761">761</a></span><span class="t"><span class="str">        deviation of interpulse intervals from a subset of the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t762" href="#t762">762</a></span><span class="t"><span class="str">        interpulse intervals, only intervals smaller than this</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t763" href="#t763">763</a></span><span class="t"><span class="str">        percentile (between 0 and 100) are used.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t764" href="#t764">764</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t765" href="#t765">765</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t766" href="#t766">766</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t767" href="#t767">767</a></span><span class="t"><span class="str">    meod: 2-D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t768" href="#t768">768</a></span><span class="t"><span class="str">        The eod waveform. First column is time in seconds,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t769" href="#t769">769</a></span><span class="t"><span class="str">        second column the eod waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t770" href="#t770">770</a></span><span class="t"><span class="str">        Further columns are kept from the input `eod`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t771" href="#t771">771</a></span><span class="t"><span class="str">        As a last column the fit to the tail of the last peak is appended.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t772" href="#t772">772</a></span><span class="t"><span class="str">    props: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t773" href="#t773">773</a></span><span class="t"><span class="str">        A dictionary with properties of the analyzed EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t774" href="#t774">774</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t775" href="#t775">775</a></span><span class="t"><span class="str">        - type: set to 'pulse'.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t776" href="#t776">776</a></span><span class="t"><span class="str">        - EODf: the inverse of the median interval between `eod_times`,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t777" href="#t777">777</a></span><span class="t"><span class="str">          if provided.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t778" href="#t778">778</a></span><span class="t"><span class="str">        - period: the median interval between `eod_times`, if provided.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t779" href="#t779">779</a></span><span class="t"><span class="str">        - IPI-mean: the mean interval between `eod_times`, if provided.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t780" href="#t780">780</a></span><span class="t"><span class="str">        - IPI-std: the standard deviation of the intervals between</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t781" href="#t781">781</a></span><span class="t"><span class="str">          `eod_times`, if provided.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t782" href="#t782">782</a></span><span class="t"><span class="str">        - max-ampl: the amplitude of the largest positive peak (P1).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t783" href="#t783">783</a></span><span class="t"><span class="str">        - min-ampl: the amplitude of the largest negative peak (P2).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t784" href="#t784">784</a></span><span class="t"><span class="str">        - p-p-amplitude: peak-to-peak amplitude of the EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t785" href="#t785">785</a></span><span class="t"><span class="str">        - noise: root-mean squared standard error mean of the averaged</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t786" href="#t786">786</a></span><span class="t"><span class="str">          EOD waveform relative to the p-p amplitude.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t787" href="#t787">787</a></span><span class="t"><span class="str">        - tstart: time in seconds where the pulse starts,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t788" href="#t788">788</a></span><span class="t"><span class="str">          i.e. crosses the threshold for the first time.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t789" href="#t789">789</a></span><span class="t"><span class="str">        - tend: time in seconds where the pulse ends,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t790" href="#t790">790</a></span><span class="t"><span class="str">          i.e. crosses the threshold for the last time.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t791" href="#t791">791</a></span><span class="t"><span class="str">        - width: total width of the pulse in seconds (tend-tstart).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t792" href="#t792">792</a></span><span class="t"><span class="str">        - P2-P1-dist: distance between P2 and P1 in seconds.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t793" href="#t793">793</a></span><span class="t"><span class="str">        - tau: time constant of exponential decay of pulse tail in seconds.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t794" href="#t794">794</a></span><span class="t"><span class="str">        - firstpeak: index of the first peak in the pulse (i.e. -1 for P-1)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t795" href="#t795">795</a></span><span class="t"><span class="str">        - lastpeak: index of the last peak in the pulse (i.e. 3 for P3)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t796" href="#t796">796</a></span><span class="t"><span class="str">        - totalarea: sum of areas under positive and negative peaks.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t797" href="#t797">797</a></span><span class="t"><span class="str">        - positivearea: area under positive peaks relative to total area.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t798" href="#t798">798</a></span><span class="t"><span class="str">        - negativearea: area under negative peaks relative to total area.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t799" href="#t799">799</a></span><span class="t"><span class="str">        - polaritybalance: contrast between areas under positive and</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t800" href="#t800">800</a></span><span class="t"><span class="str">          negative peak.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t801" href="#t801">801</a></span><span class="t"><span class="str">        - peakfreq: frequency at peak power of the single pulse spectrum</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t802" href="#t802">802</a></span><span class="t"><span class="str">          in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t803" href="#t803">803</a></span><span class="t"><span class="str">        - peakpower: peak power of the single pulse spectrum in decibel.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t804" href="#t804">804</a></span><span class="t"><span class="str">        - poweratt5: how much the average power below 5 Hz is attenuated</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t805" href="#t805">805</a></span><span class="t"><span class="str">          relative to the peak power in decibel.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t806" href="#t806">806</a></span><span class="t"><span class="str">        - poweratt50: how much the average power below 5 Hz is attenuated</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t807" href="#t807">807</a></span><span class="t"><span class="str">          relative to the peak power in decibel.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t808" href="#t808">808</a></span><span class="t"><span class="str">        - lowcutoff: frequency at which the power reached half of the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t809" href="#t809">809</a></span><span class="t"><span class="str">          peak power relative to the initial power in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t810" href="#t810">810</a></span><span class="t"><span class="str">        - flipped: True if the waveform was flipped.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t811" href="#t811">811</a></span><span class="t"><span class="str">        - n: number of pulses analyzed  (i.e. `len(eod_times)`), if provided.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t812" href="#t812">812</a></span><span class="t"><span class="str">        - times: the times of the detected EOD pulses (i.e. `eod_times`),</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t813" href="#t813">813</a></span><span class="t"><span class="str">          if provided.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t814" href="#t814">814</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t815" href="#t815">815</a></span><span class="t"><span class="str">        Empty if waveform is not a pulse EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t816" href="#t816">816</a></span><span class="t"><span class="str">    peaks: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t817" href="#t817">817</a></span><span class="t"><span class="str">        For each peak and trough (rows) of the EOD waveform</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t818" href="#t818">818</a></span><span class="t"><span class="str">        7 columns: the peak index (1 is P1, i.e. the largest positive peak),</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t819" href="#t819">819</a></span><span class="t"><span class="str">        time relative to largest positive peak, amplitude,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t820" href="#t820">820</a></span><span class="t"><span class="str">        amplitude normalized to largest postive peak,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t821" href="#t821">821</a></span><span class="t"><span class="str">        width of peak/trough at half height,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t822" href="#t822">822</a></span><span class="t"><span class="str">        area under the peak, and area under the peak relative to total area.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t823" href="#t823">823</a></span><span class="t"><span class="str">        Empty if waveform is not a pulse EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t824" href="#t824">824</a></span><span class="t"><span class="str">    power: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t825" href="#t825">825</a></span><span class="t"><span class="str">        The power spectrum of a single pulse. First column are the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t826" href="#t826">826</a></span><span class="t"><span class="str">        frequencies, second column the power in x^2/Hz such that the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t827" href="#t827">827</a></span><span class="t"><span class="str">        integral equals the variance.  Empty if waveform is not a</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t828" href="#t828">828</a></span><span class="t"><span class="str">        pulse EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t829" href="#t829">829</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t830" href="#t830">830</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t831" href="#t831">831</a></span><span class="t">    <span class="com"># storage:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t832" href="#t832">832</a></span><span class="t">    <span class="nam">meod</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="nam">eod</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">eod</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t833" href="#t833">833</a></span><span class="t">    <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="nam">eod</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="nam">eod</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t834" href="#t834">834</a></span><span class="t">    <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">nan</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t835" href="#t835">835</a></span><span class="t">    <span class="nam">toffs</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t836" href="#t836">836</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t837" href="#t837">837</a></span><span class="t">    <span class="com"># cut out stable estimate if standard deviation is available:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t838" href="#t838">838</a></span><span class="t">    <span class="key">if</span> <span class="nam">eod</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">2</span> <span class="key">and</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="num">3</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t839" href="#t839">839</a></span><span class="t">        <span class="nam">n</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t840" href="#t840">840</a></span><span class="t">        <span class="nam">idx0</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">n</span><span class="op">//</span><span class="num">10</span><span class="op">:</span><span class="num">9</span><span class="op">*</span><span class="nam">n</span><span class="op">//</span><span class="num">10</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="nam">n</span><span class="op">//</span><span class="num">10</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t841" href="#t841">841</a></span><span class="t">        <span class="nam">toffs</span> <span class="op">+=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">idx0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t842" href="#t842">842</a></span><span class="t">        <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">idx0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t843" href="#t843">843</a></span><span class="t">        <span class="com"># minimum in standard deviation:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t844" href="#t844">844</a></span><span class="t">        <span class="nam">lstd_idx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="nam">idx0</span><span class="op">-</span><span class="num">5</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t845" href="#t845">845</a></span><span class="t">        <span class="nam">rstd_idx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">idx0</span><span class="op">+</span><span class="num">5</span><span class="op">:</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="nam">idx0</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t846" href="#t846">846</a></span><span class="t">        <span class="com"># central, left, and right maximum of standard deviation:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t847" href="#t847">847</a></span><span class="t">        <span class="nam">max_std</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">lstd_idx</span><span class="op">:</span><span class="nam">rstd_idx</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t848" href="#t848">848</a></span><span class="t">        <span class="nam">l_std</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">//</span><span class="num">4</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t849" href="#t849">849</a></span><span class="t">        <span class="nam">r_std</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">*</span><span class="num">3</span><span class="op">//</span><span class="num">4</span><span class="op">:</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t850" href="#t850">850</a></span><span class="t">        <span class="nam">lidx</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t851" href="#t851">851</a></span><span class="t">        <span class="nam">ridx</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t852" href="#t852">852</a></span><span class="t">        <span class="key">if</span> <span class="nam">l_std</span> <span class="op">></span> <span class="nam">max_std</span> <span class="key">and</span> <span class="nam">lstd_idx</span> <span class="op">></span> <span class="nam">lidx</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t853" href="#t853">853</a></span><span class="t">            <span class="nam">lidx</span> <span class="op">=</span> <span class="nam">lstd_idx</span> <span class="op">-</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">lstd_idx</span><span class="op">:</span><span class="num">0</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="num">2</span><span class="op">]</span> <span class="op">>=</span> <span class="num">0.25</span><span class="op">*</span><span class="nam">l_std</span> <span class="op">+</span> <span class="num">0.75</span><span class="op">*</span><span class="nam">meod</span><span class="op">[</span><span class="nam">lstd_idx</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t854" href="#t854">854</a></span><span class="t">        <span class="key">if</span> <span class="nam">r_std</span> <span class="op">></span> <span class="nam">max_std</span> <span class="key">and</span> <span class="nam">rstd_idx</span> <span class="op">&lt;</span> <span class="nam">ridx</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t855" href="#t855">855</a></span><span class="t">            <span class="nam">ridx</span> <span class="op">=</span> <span class="nam">rstd_idx</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">rstd_idx</span><span class="op">:</span><span class="op">,</span><span class="num">2</span><span class="op">]</span> <span class="op">>=</span> <span class="num">0.25</span><span class="op">*</span><span class="nam">r_std</span> <span class="op">+</span> <span class="num">0.75</span><span class="op">*</span><span class="nam">meod</span><span class="op">[</span><span class="nam">rstd_idx</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t856" href="#t856">856</a></span><span class="t">        <span class="com">#plt.plot(meod[:,0], meod[:,1])</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t857" href="#t857">857</a></span><span class="t">        <span class="com">#plt.plot(meod[:,0], meod[:,2], '-r')</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t858" href="#t858">858</a></span><span class="t">        <span class="com">#plt.plot([meod[lidx,0], meod[lidx,0]], [-0.1, 0.1], '-k')</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t859" href="#t859">859</a></span><span class="t">        <span class="com">#plt.plot([meod[ridx-1,0], meod[ridx-1,0]], [-0.1, 0.1], '-b')</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t860" href="#t860">860</a></span><span class="t">        <span class="com">#plt.show()</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t861" href="#t861">861</a></span><span class="t">        <span class="nam">meod</span> <span class="op">=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">lidx</span><span class="op">:</span><span class="nam">ridx</span><span class="op">,</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t862" href="#t862">862</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t863" href="#t863">863</a></span><span class="t">    <span class="com"># subtract mean computed from the ends of the snippet:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t864" href="#t864">864</a></span><span class="t">    <span class="nam">n</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">//</span><span class="num">20</span> <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span> <span class="op">>=</span> <span class="num">20</span> <span class="key">else</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t865" href="#t865">865</a></span><span class="t">    <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">-=</span> <span class="num">0.5</span><span class="op">*</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="nam">n</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">-</span><span class="nam">n</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t866" href="#t866">866</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t867" href="#t867">867</a></span><span class="t">    <span class="com"># largest positive and negative peak:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t868" href="#t868">868</a></span><span class="t">    <span class="nam">flipped</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t869" href="#t869">869</a></span><span class="t">    <span class="nam">max_idx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t870" href="#t870">870</a></span><span class="t">    <span class="nam">max_ampl</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">max_idx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t871" href="#t871">871</a></span><span class="t">    <span class="nam">min_idx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t872" href="#t872">872</a></span><span class="t">    <span class="nam">min_ampl</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">min_idx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t873" href="#t873">873</a></span><span class="t">    <span class="nam">amplitude</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">(</span><span class="nam">max_ampl</span><span class="op">,</span> <span class="nam">min_ampl</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t874" href="#t874">874</a></span><span class="t">    <span class="key">if</span> <span class="nam">max_ampl</span> <span class="op">></span> <span class="num">0.2</span><span class="op">*</span><span class="nam">amplitude</span> <span class="key">and</span> <span class="nam">min_ampl</span> <span class="op">></span> <span class="num">0.2</span><span class="op">*</span><span class="nam">amplitude</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t875" href="#t875">875</a></span><span class="t">        <span class="com"># two major peaks:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t876" href="#t876">876</a></span><span class="t">        <span class="key">if</span> <span class="str">'flip'</span> <span class="key">in</span> <span class="nam">flip_pulse</span> <span class="key">or</span> <span class="op">(</span><span class="str">'auto'</span> <span class="key">in</span> <span class="nam">flip_pulse</span> <span class="key">and</span> <span class="nam">min_idx</span> <span class="op">&lt;</span> <span class="nam">max_idx</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t877" href="#t877">877</a></span><span class="t">            <span class="com"># flip:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t878" href="#t878">878</a></span><span class="t">            <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t879" href="#t879">879</a></span><span class="t">            <span class="nam">peak_idx</span> <span class="op">=</span> <span class="nam">min_idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t880" href="#t880">880</a></span><span class="t">            <span class="nam">min_idx</span> <span class="op">=</span> <span class="nam">max_idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t881" href="#t881">881</a></span><span class="t">            <span class="nam">max_idx</span> <span class="op">=</span> <span class="nam">peak_idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t882" href="#t882">882</a></span><span class="t">            <span class="nam">flipped</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t883" href="#t883">883</a></span><span class="t">    <span class="key">elif</span> <span class="str">'flip'</span> <span class="key">in</span> <span class="nam">flip_pulse</span> <span class="key">or</span> <span class="op">(</span><span class="str">'auto'</span> <span class="key">in</span> <span class="nam">flip_pulse</span> <span class="key">and</span> <span class="nam">min_ampl</span> <span class="op">></span> <span class="num">0.2</span><span class="op">*</span><span class="nam">amplitude</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t884" href="#t884">884</a></span><span class="t">        <span class="com"># flip:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t885" href="#t885">885</a></span><span class="t">        <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t886" href="#t886">886</a></span><span class="t">        <span class="nam">peak_idx</span> <span class="op">=</span> <span class="nam">min_idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t887" href="#t887">887</a></span><span class="t">        <span class="nam">min_idx</span> <span class="op">=</span> <span class="nam">max_idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t888" href="#t888">888</a></span><span class="t">        <span class="nam">max_idx</span> <span class="op">=</span> <span class="nam">peak_idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t889" href="#t889">889</a></span><span class="t">        <span class="nam">flipped</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t890" href="#t890">890</a></span><span class="t">    <span class="nam">max_ampl</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">max_idx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t891" href="#t891">891</a></span><span class="t">    <span class="nam">min_ampl</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">min_idx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t892" href="#t892">892</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t893" href="#t893">893</a></span><span class="t">    <span class="com"># move peak of waveform to zero:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t894" href="#t894">894</a></span><span class="t">    <span class="nam">toffs</span> <span class="op">+=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">max_idx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t895" href="#t895">895</a></span><span class="t">    <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">max_idx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t896" href="#t896">896</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t897" href="#t897">897</a></span><span class="t">    <span class="com"># minimum threshold for peak detection:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t898" href="#t898">898</a></span><span class="t">    <span class="nam">n</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">//</span><span class="num">10</span> <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span> <span class="op">>=</span> <span class="num">20</span> <span class="key">else</span> <span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t899" href="#t899">899</a></span><span class="t">    <span class="nam">thl_max</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="nam">n</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t900" href="#t900">900</a></span><span class="t">    <span class="nam">thl_min</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="nam">n</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t901" href="#t901">901</a></span><span class="t">    <span class="nam">thr_max</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">-</span><span class="nam">n</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t902" href="#t902">902</a></span><span class="t">    <span class="nam">thr_min</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">-</span><span class="nam">n</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t903" href="#t903">903</a></span><span class="t">    <span class="nam">min_thresh</span> <span class="op">=</span> <span class="num">2</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="nam">thl_max</span><span class="op">,</span> <span class="nam">thr_max</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="op">[</span><span class="nam">thl_min</span><span class="op">,</span> <span class="nam">thr_min</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t904" href="#t904">904</a></span><span class="t">    <span class="key">if</span> <span class="nam">min_thresh</span> <span class="op">></span> <span class="num">0.5</span><span class="op">*</span><span class="op">(</span><span class="nam">max_ampl</span> <span class="op">+</span> <span class="nam">min_ampl</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t905" href="#t905">905</a></span><span class="t">        <span class="nam">min_thresh</span> <span class="op">=</span> <span class="num">0.5</span><span class="op">*</span><span class="op">(</span><span class="nam">max_ampl</span> <span class="op">+</span> <span class="nam">min_ampl</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t906" href="#t906">906</a></span><span class="t">        <span class="nam">fit_frac</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t907" href="#t907">907</a></span><span class="t">    <span class="com"># threshold for peak detection:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t908" href="#t908">908</a></span><span class="t">    <span class="nam">threshold</span> <span class="op">=</span> <span class="nam">max_ampl</span><span class="op">*</span><span class="nam">peak_thresh_fac</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t909" href="#t909">909</a></span><span class="t">    <span class="key">if</span> <span class="nam">threshold</span> <span class="op">&lt;</span> <span class="nam">min_thresh</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t910" href="#t910">910</a></span><span class="t">        <span class="nam">threshold</span> <span class="op">=</span> <span class="nam">min_thresh</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t911" href="#t911">911</a></span><span class="t">    <span class="key">if</span> <span class="nam">threshold</span> <span class="op">&lt;=</span> <span class="num">0.0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t912" href="#t912">912</a></span><span class="t">        <span class="key">return</span> <span class="nam">meod</span><span class="op">,</span> <span class="op">{</span><span class="op">}</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t913" href="#t913">913</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t914" href="#t914">914</a></span><span class="t">    <span class="com"># cut out relevant signal:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t915" href="#t915">915</a></span><span class="t">    <span class="nam">lidx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="nam">threshold</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t916" href="#t916">916</a></span><span class="t">    <span class="nam">ridx</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span> <span class="op">-</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="nam">threshold</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t917" href="#t917">917</a></span><span class="t">    <span class="nam">t0</span> <span class="op">=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">lidx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t918" href="#t918">918</a></span><span class="t">    <span class="nam">t1</span> <span class="op">=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">ridx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t919" href="#t919">919</a></span><span class="t">    <span class="nam">width</span> <span class="op">=</span> <span class="nam">t1</span> <span class="op">-</span> <span class="nam">t0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t920" href="#t920">920</a></span><span class="t">    <span class="key">if</span> <span class="nam">width</span> <span class="op">&lt;</span> <span class="nam">min_pulse_win</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t921" href="#t921">921</a></span><span class="t">        <span class="nam">width</span> <span class="op">=</span> <span class="nam">min_pulse_win</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t922" href="#t922">922</a></span><span class="t">    <span class="nam">dt</span> <span class="op">=</span> <span class="nam">meod</span><span class="op">[</span><span class="num">1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">meod</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t923" href="#t923">923</a></span><span class="t">    <span class="nam">width_idx</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="nam">width</span><span class="op">/</span><span class="nam">dt</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t924" href="#t924">924</a></span><span class="t">    <span class="com"># expand width:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t925" href="#t925">925</a></span><span class="t">    <span class="nam">leidx</span> <span class="op">=</span> <span class="nam">lidx</span> <span class="op">-</span> <span class="nam">width_idx</span><span class="op">//</span><span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t926" href="#t926">926</a></span><span class="t">    <span class="key">if</span> <span class="nam">leidx</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t927" href="#t927">927</a></span><span class="t">        <span class="nam">leidx</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t928" href="#t928">928</a></span><span class="t">    <span class="nam">reidx</span> <span class="op">=</span> <span class="nam">ridx</span> <span class="op">+</span> <span class="nam">width_idx</span><span class="op">//</span><span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t929" href="#t929">929</a></span><span class="t">    <span class="key">if</span> <span class="nam">reidx</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t930" href="#t930">930</a></span><span class="t">        <span class="nam">reidx</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t931" href="#t931">931</a></span><span class="t">    <span class="nam">meod</span> <span class="op">=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">leidx</span><span class="op">:</span><span class="nam">reidx</span><span class="op">,</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t932" href="#t932">932</a></span><span class="t">    <span class="nam">lidx</span> <span class="op">-=</span> <span class="nam">leidx</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t933" href="#t933">933</a></span><span class="t">    <span class="nam">ridx</span> <span class="op">-=</span> <span class="nam">leidx</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t934" href="#t934">934</a></span><span class="t">    <span class="nam">max_idx</span> <span class="op">-=</span> <span class="nam">leidx</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t935" href="#t935">935</a></span><span class="t">    <span class="nam">min_idx</span> <span class="op">-=</span> <span class="nam">leidx</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t936" href="#t936">936</a></span><span class="t">    <span class="nam">tau</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t937" href="#t937">937</a></span><span class="t">    <span class="nam">dist</span> <span class="op">=</span> <span class="num">0.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t938" href="#t938">938</a></span><span class="t">    <span class="nam">peaks</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t939" href="#t939">939</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t940" href="#t940">940</a></span><span class="t">    <span class="com"># amplitude and variance:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t941" href="#t941">941</a></span><span class="t">    <span class="nam">ppampl</span> <span class="op">=</span> <span class="nam">max_ampl</span> <span class="op">+</span> <span class="nam">min_ampl</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t942" href="#t942">942</a></span><span class="t">    <span class="nam">rmssem</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">**</span><span class="num">2.0</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">ppampl</span> <span class="key">if</span> <span class="nam">eod</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">2</span> <span class="key">else</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t943" href="#t943">943</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t944" href="#t944">944</a></span><span class="t">    <span class="com"># integrals and polarity balance:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t945" href="#t945">945</a></span><span class="t">    <span class="nam">pos_area</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">0</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="nam">dt</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t946" href="#t946">946</a></span><span class="t">    <span class="nam">neg_area</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="nam">dt</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t947" href="#t947">947</a></span><span class="t">    <span class="nam">total_area</span> <span class="op">=</span> <span class="nam">pos_area</span> <span class="op">-</span> <span class="nam">neg_area</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t948" href="#t948">948</a></span><span class="t">    <span class="nam">polarity_balance</span> <span class="op">=</span> <span class="op">(</span><span class="nam">pos_area</span> <span class="op">+</span> <span class="nam">neg_area</span><span class="op">)</span><span class="op">/</span><span class="nam">total_area</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t949" href="#t949">949</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t950" href="#t950">950</a></span><span class="t">    <span class="com"># find smaller peaks:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t951" href="#t951">951</a></span><span class="t">    <span class="nam">peak_idx</span><span class="op">,</span> <span class="nam">trough_idx</span> <span class="op">=</span> <span class="nam">detect_peaks</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">threshold</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t952" href="#t952">952</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t953" href="#t953">953</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">peak_idx</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t954" href="#t954">954</a></span><span class="t">        <span class="com"># and their width:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t955" href="#t955">955</a></span><span class="t">        <span class="nam">peak_widths</span> <span class="op">=</span> <span class="nam">peak_width</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">peak_idx</span><span class="op">,</span> <span class="nam">trough_idx</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t956" href="#t956">956</a></span><span class="t">                                 <span class="nam">peak_frac</span><span class="op">=</span><span class="nam">width_frac</span><span class="op">,</span> <span class="nam">base</span><span class="op">=</span><span class="str">'max'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t957" href="#t957">957</a></span><span class="t">        <span class="nam">trough_widths</span> <span class="op">=</span> <span class="nam">peak_width</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">trough_idx</span><span class="op">,</span> <span class="nam">peak_idx</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t958" href="#t958">958</a></span><span class="t">                                   <span class="nam">peak_frac</span><span class="op">=</span><span class="nam">width_frac</span><span class="op">,</span> <span class="nam">base</span><span class="op">=</span><span class="str">'max'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t959" href="#t959">959</a></span><span class="t">        <span class="com"># combine peaks and troughs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t960" href="#t960">960</a></span><span class="t">        <span class="nam">pt_idx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">concatenate</span><span class="op">(</span><span class="op">(</span><span class="nam">peak_idx</span><span class="op">,</span> <span class="nam">trough_idx</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t961" href="#t961">961</a></span><span class="t">        <span class="nam">pt_widths</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">concatenate</span><span class="op">(</span><span class="op">(</span><span class="nam">peak_widths</span><span class="op">,</span> <span class="nam">trough_widths</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t962" href="#t962">962</a></span><span class="t">        <span class="nam">pts_idx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argsort</span><span class="op">(</span><span class="nam">pt_idx</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t963" href="#t963">963</a></span><span class="t">        <span class="nam">peak_list</span> <span class="op">=</span> <span class="nam">pt_idx</span><span class="op">[</span><span class="nam">pts_idx</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t964" href="#t964">964</a></span><span class="t">        <span class="nam">width_list</span> <span class="op">=</span> <span class="nam">pt_widths</span><span class="op">[</span><span class="nam">pts_idx</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t965" href="#t965">965</a></span><span class="t">        <span class="com"># remove multiple peaks that are too close: XXX replace by Dexters function that keeps the maximum peak</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t966" href="#t966">966</a></span><span class="t">        <span class="nam">rmidx</span> <span class="op">=</span> <span class="op">[</span><span class="op">(</span><span class="nam">k</span><span class="op">,</span> <span class="nam">k</span><span class="op">+</span><span class="num">1</span><span class="op">)</span> <span class="key">for</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">np</span><span class="op">.</span><span class="nam">where</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">diff</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">peak_list</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="nam">min_dist</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t967" href="#t967">967</a></span><span class="t">        <span class="com"># flatten and keep maximum peak:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t968" href="#t968">968</a></span><span class="t">        <span class="nam">rmidx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">unique</span><span class="op">(</span><span class="op">[</span><span class="nam">k</span> <span class="key">for</span> <span class="nam">kk</span> <span class="key">in</span> <span class="nam">rmidx</span> <span class="key">for</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">kk</span> <span class="key">if</span> <span class="nam">peak_list</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span> <span class="op">!=</span> <span class="nam">max_idx</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t969" href="#t969">969</a></span><span class="t">        <span class="com"># delete:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t970" href="#t970">970</a></span><span class="t">        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">rmidx</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t971" href="#t971">971</a></span><span class="t">            <span class="nam">peak_list</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">delete</span><span class="op">(</span><span class="nam">peak_list</span><span class="op">,</span> <span class="nam">rmidx</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t972" href="#t972">972</a></span><span class="t">            <span class="nam">width_list</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">delete</span><span class="op">(</span><span class="nam">width_list</span><span class="op">,</span> <span class="nam">rmidx</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t973" href="#t973">973</a></span><span class="t">        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">peak_list</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t974" href="#t974">974</a></span><span class="t">            <span class="key">return</span> <span class="nam">meod</span><span class="op">,</span> <span class="op">{</span><span class="op">}</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t975" href="#t975">975</a></span><span class="t">        <span class="com"># find P1:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t976" href="#t976">976</a></span><span class="t">        <span class="nam">p1i</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">peak_list</span> <span class="op">==</span> <span class="nam">max_idx</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t977" href="#t977">977</a></span><span class="t">        <span class="com"># truncate peaks to the left: XXX REALLY? WHY?</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t978" href="#t978">978</a></span><span class="t">        <span class="nam">offs</span> <span class="op">=</span> <span class="num">0</span> <span class="key">if</span> <span class="nam">p1i</span> <span class="op">&lt;=</span> <span class="num">2</span> <span class="key">else</span> <span class="nam">p1i</span> <span class="op">-</span> <span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t979" href="#t979">979</a></span><span class="t">        <span class="nam">peak_list</span> <span class="op">=</span> <span class="nam">peak_list</span><span class="op">[</span><span class="nam">offs</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t980" href="#t980">980</a></span><span class="t">        <span class="nam">width_list</span> <span class="op">=</span> <span class="nam">width_list</span><span class="op">[</span><span class="nam">offs</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t981" href="#t981">981</a></span><span class="t">        <span class="nam">p1i</span> <span class="op">-=</span> <span class="nam">offs</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t982" href="#t982">982</a></span><span class="t">        <span class="com"># peak areas:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t983" href="#t983">983</a></span><span class="t">        <span class="nam">peak_areas</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">peak_list</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t984" href="#t984">984</a></span><span class="t">        <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">peak_list</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t985" href="#t985">985</a></span><span class="t">            <span class="nam">sign_fac</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sign</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">peak_list</span><span class="op">[</span><span class="nam">i</span><span class="op">]</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t986" href="#t986">986</a></span><span class="t">            <span class="nam">i0</span> <span class="op">=</span> <span class="nam">peak_list</span><span class="op">[</span><span class="nam">i</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span> <span class="key">if</span> <span class="nam">i</span> <span class="op">></span> <span class="num">0</span> <span class="key">else</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t987" href="#t987">987</a></span><span class="t">            <span class="nam">i1</span> <span class="op">=</span> <span class="nam">peak_list</span><span class="op">[</span><span class="nam">i</span> <span class="op">+</span> <span class="num">1</span><span class="op">]</span> <span class="key">if</span> <span class="nam">i</span> <span class="op">+</span> <span class="num">1</span> <span class="op">&lt;</span> <span class="nam">len</span><span class="op">(</span><span class="nam">peak_list</span><span class="op">)</span> <span class="key">else</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t988" href="#t988">988</a></span><span class="t">            <span class="nam">snippet</span> <span class="op">=</span> <span class="nam">sign_fac</span><span class="op">*</span><span class="nam">meod</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t989" href="#t989">989</a></span><span class="t">            <span class="nam">peak_areas</span><span class="op">[</span><span class="nam">i</span><span class="op">]</span> <span class="op">=</span> <span class="nam">sign_fac</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">snippet</span><span class="op">[</span><span class="nam">snippet</span> <span class="op">></span> <span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="nam">dt</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t990" href="#t990">990</a></span><span class="t">        <span class="com"># store peaks:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t991" href="#t991">991</a></span><span class="t">        <span class="nam">peaks</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">peak_list</span><span class="op">)</span><span class="op">,</span> <span class="num">7</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t992" href="#t992">992</a></span><span class="t">        <span class="key">for</span> <span class="nam">i</span><span class="op">,</span> <span class="nam">pi</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">peak_list</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t993" href="#t993">993</a></span><span class="t">            <span class="nam">peaks</span><span class="op">[</span><span class="nam">i</span><span class="op">,</span><span class="op">:</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">-</span><span class="nam">p1i</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">/</span><span class="nam">max_ampl</span><span class="op">,</span> <span class="nam">width_list</span><span class="op">[</span><span class="nam">i</span><span class="op">]</span><span class="op">,</span> <span class="nam">peak_areas</span><span class="op">[</span><span class="nam">i</span><span class="op">]</span><span class="op">,</span> <span class="nam">peak_areas</span><span class="op">[</span><span class="nam">i</span><span class="op">]</span><span class="op">/</span><span class="nam">total_area</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t994" href="#t994">994</a></span><span class="t">        <span class="com"># P2 - P1 distance:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t995" href="#t995">995</a></span><span class="t">        <span class="nam">dist</span> <span class="op">=</span> <span class="nam">peaks</span><span class="op">[</span><span class="nam">p1i</span><span class="op">+</span><span class="num">1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">peaks</span><span class="op">[</span><span class="nam">p1i</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="key">if</span> <span class="nam">p1i</span><span class="op">+</span><span class="num">1</span> <span class="op">&lt;</span> <span class="nam">len</span><span class="op">(</span><span class="nam">peaks</span><span class="op">)</span> <span class="key">else</span> <span class="num">0.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t996" href="#t996">996</a></span><span class="t">        <span class="com"># fit exponential to last peak/trough:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t997" href="#t997">997</a></span><span class="t">        <span class="nam">pi</span> <span class="op">=</span> <span class="nam">peak_list</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t998" href="#t998">998</a></span><span class="t">        <span class="com"># positive or negative decay:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t999" href="#t999">999</a></span><span class="t">        <span class="nam">sign</span> <span class="op">=</span> <span class="num">1.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1000" href="#t1000">1000</a></span><span class="t">        <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="op">-</span><span class="num">0.5</span><span class="op">*</span><span class="nam">threshold</span><span class="op">)</span> <span class="op">></span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">0.5</span><span class="op">*</span><span class="nam">threshold</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1001" href="#t1001">1001</a></span><span class="t">            <span class="nam">sign</span> <span class="op">=</span> <span class="op">-</span><span class="num">1.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1002" href="#t1002">1002</a></span><span class="t">        <span class="key">if</span> <span class="nam">sign</span><span class="op">*</span><span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="num">0.0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1003" href="#t1003">1003</a></span><span class="t">            <span class="nam">pi</span> <span class="op">+=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">sign</span><span class="op">*</span><span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1004" href="#t1004">1004</a></span><span class="t">        <span class="nam">pi_ampl</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1005" href="#t1005">1005</a></span><span class="t">        <span class="nam">n</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">:</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1006" href="#t1006">1006</a></span><span class="t">        <span class="com"># no sufficiently large initial value:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1007" href="#t1007">1007</a></span><span class="t">        <span class="key">if</span> <span class="nam">fit_frac</span> <span class="key">and</span> <span class="nam">pi_ampl</span><span class="op">*</span><span class="nam">fit_frac</span> <span class="op">&lt;=</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">threshold</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1008" href="#t1008">1008</a></span><span class="t">            <span class="nam">fit_frac</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1009" href="#t1009">1009</a></span><span class="t">        <span class="com"># no sufficiently long decay:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1010" href="#t1010">1010</a></span><span class="t">        <span class="key">if</span> <span class="nam">n</span> <span class="op">&lt;</span> <span class="num">10</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1011" href="#t1011">1011</a></span><span class="t">            <span class="nam">fit_frac</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1012" href="#t1012">1012</a></span><span class="t">        <span class="com"># not decaying towards zero:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1013" href="#t1013">1013</a></span><span class="t">        <span class="nam">max_line</span> <span class="op">=</span> <span class="nam">pi_ampl</span> <span class="op">-</span> <span class="op">(</span><span class="nam">pi_ampl</span><span class="op">-</span><span class="nam">threshold</span><span class="op">)</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">n</span><span class="op">)</span><span class="op">/</span><span class="nam">n</span> <span class="op">+</span> <span class="num">1e-8</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1014" href="#t1014">1014</a></span><span class="t">        <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">any</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">+</span><span class="num">2</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="nam">max_line</span><span class="op">[</span><span class="num">2</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1015" href="#t1015">1015</a></span><span class="t">            <span class="nam">fit_frac</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1016" href="#t1016">1016</a></span><span class="t">        <span class="key">if</span> <span class="nam">fit_frac</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1017" href="#t1017">1017</a></span><span class="t">            <span class="nam">thresh</span> <span class="op">=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">*</span><span class="nam">fit_frac</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1018" href="#t1018">1018</a></span><span class="t">            <span class="nam">inx</span> <span class="op">=</span> <span class="nam">pi</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">sign</span><span class="op">*</span><span class="nam">meod</span><span class="op">[</span><span class="nam">pi</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="nam">sign</span><span class="op">*</span><span class="nam">thresh</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1019" href="#t1019">1019</a></span><span class="t">            <span class="nam">thresh</span> <span class="op">=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">exp</span><span class="op">(</span><span class="op">-</span><span class="num">1.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1020" href="#t1020">1020</a></span><span class="t">            <span class="nam">tau_inx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">sign</span><span class="op">*</span><span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="nam">sign</span><span class="op">*</span><span class="nam">thresh</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1021" href="#t1021">1021</a></span><span class="t">            <span class="key">if</span> <span class="nam">tau_inx</span> <span class="op">&lt;</span> <span class="num">2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1022" href="#t1022">1022</a></span><span class="t">                <span class="nam">tau_inx</span> <span class="op">=</span> <span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1023" href="#t1023">1023</a></span><span class="t">            <span class="nam">rridx</span> <span class="op">=</span> <span class="nam">inx</span> <span class="op">+</span> <span class="num">6</span><span class="op">*</span><span class="nam">tau_inx</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1024" href="#t1024">1024</a></span><span class="t">            <span class="key">if</span> <span class="nam">rridx</span> <span class="op">></span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1025" href="#t1025">1025</a></span><span class="t">                <span class="nam">tau</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1026" href="#t1026">1026</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1027" href="#t1027">1027</a></span><span class="t">                <span class="nam">tau</span> <span class="op">=</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">+</span><span class="nam">tau_inx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1028" href="#t1028">1028</a></span><span class="t">                <span class="nam">params</span> <span class="op">=</span> <span class="op">[</span><span class="nam">tau</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="nam">rridx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">rridx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1029" href="#t1029">1029</a></span><span class="t">                <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1030" href="#t1030">1030</a></span><span class="t">                    <span class="nam">popt</span><span class="op">,</span> <span class="nam">pcov</span> <span class="op">=</span> <span class="nam">curve_fit</span><span class="op">(</span><span class="nam">exp_decay</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="nam">rridx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1031" href="#t1031">1031</a></span><span class="t">                                           <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="nam">rridx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">params</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1032" href="#t1032">1032</a></span><span class="t">                                           <span class="nam">bounds</span><span class="op">=</span><span class="op">(</span><span class="op">[</span><span class="num">0.0</span><span class="op">,</span> <span class="op">-</span><span class="nam">np</span><span class="op">.</span><span class="nam">inf</span><span class="op">,</span> <span class="op">-</span><span class="nam">np</span><span class="op">.</span><span class="nam">inf</span><span class="op">]</span><span class="op">,</span> <span class="nam">np</span><span class="op">.</span><span class="nam">inf</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1033" href="#t1033">1033</a></span><span class="t">                <span class="key">except</span> <span class="nam">TypeError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1034" href="#t1034">1034</a></span><span class="t">                    <span class="nam">popt</span><span class="op">,</span> <span class="nam">pcov</span> <span class="op">=</span> <span class="nam">curve_fit</span><span class="op">(</span><span class="nam">exp_decay</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="nam">rridx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1035" href="#t1035">1035</a></span><span class="t">                                           <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="nam">rridx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">params</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1036" href="#t1036">1036</a></span><span class="t">                <span class="key">if</span> <span class="nam">popt</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">></span> <span class="num">1.2</span><span class="op">*</span><span class="nam">tau</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1037" href="#t1037">1037</a></span><span class="t">                    <span class="nam">tau_inx</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="nam">popt</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">/</span><span class="nam">dt</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1038" href="#t1038">1038</a></span><span class="t">                    <span class="nam">rridx</span> <span class="op">=</span> <span class="nam">inx</span> <span class="op">+</span> <span class="num">6</span><span class="op">*</span><span class="nam">tau_inx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1039" href="#t1039">1039</a></span><span class="t">                    <span class="key">if</span> <span class="nam">rridx</span> <span class="op">></span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1040" href="#t1040">1040</a></span><span class="t">                        <span class="nam">rridx</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">-</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1041" href="#t1041">1041</a></span><span class="t">                    <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1042" href="#t1042">1042</a></span><span class="t">                        <span class="nam">popt</span><span class="op">,</span> <span class="nam">pcov</span> <span class="op">=</span> <span class="nam">curve_fit</span><span class="op">(</span><span class="nam">exp_decay</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="nam">rridx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1043" href="#t1043">1043</a></span><span class="t">                                               <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="nam">rridx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">popt</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1044" href="#t1044">1044</a></span><span class="t">                                               <span class="nam">bounds</span><span class="op">=</span><span class="op">(</span><span class="op">[</span><span class="num">0.0</span><span class="op">,</span> <span class="op">-</span><span class="nam">np</span><span class="op">.</span><span class="nam">inf</span><span class="op">,</span> <span class="op">-</span><span class="nam">np</span><span class="op">.</span><span class="nam">inf</span><span class="op">]</span><span class="op">,</span> <span class="nam">np</span><span class="op">.</span><span class="nam">inf</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1045" href="#t1045">1045</a></span><span class="t">                    <span class="key">except</span> <span class="nam">TypeError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1046" href="#t1046">1046</a></span><span class="t">                        <span class="nam">popt</span><span class="op">,</span> <span class="nam">pcov</span> <span class="op">=</span> <span class="nam">curve_fit</span><span class="op">(</span><span class="nam">exp_decay</span><span class="op">,</span> <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="nam">rridx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1047" href="#t1047">1047</a></span><span class="t">                                               <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="nam">rridx</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">popt</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1048" href="#t1048">1048</a></span><span class="t">                <span class="nam">tau</span> <span class="op">=</span> <span class="nam">popt</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1049" href="#t1049">1049</a></span><span class="t">                <span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="nam">rridx</span><span class="op">,</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">exp_decay</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">:</span><span class="nam">rridx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="nam">inx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="op">*</span><span class="nam">popt</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1050" href="#t1050">1050</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1051" href="#t1051">1051</a></span><span class="t">    <span class="com"># power spectrum of single pulse:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1052" href="#t1052">1052</a></span><span class="t">    <span class="nam">rate</span> <span class="op">=</span> <span class="num">1.0</span><span class="op">/</span><span class="op">(</span><span class="nam">meod</span><span class="op">[</span><span class="num">1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">meod</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1053" href="#t1053">1053</a></span><span class="t">    <span class="nam">n_fft</span> <span class="op">=</span> <span class="nam">nfft</span><span class="op">(</span><span class="nam">rate</span><span class="op">,</span> <span class="nam">freq_resolution</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1054" href="#t1054">1054</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1055" href="#t1055">1055</a></span><span class="t">    <span class="nam">n0</span> <span class="op">=</span> <span class="nam">max_idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1056" href="#t1056">1056</a></span><span class="t">    <span class="nam">n1</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">meod</span><span class="op">)</span><span class="op">-</span><span class="nam">max_idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1057" href="#t1057">1057</a></span><span class="t">    <span class="nam">n</span> <span class="op">=</span> <span class="num">2</span><span class="op">*</span><span class="nam">max</span><span class="op">(</span><span class="nam">n0</span><span class="op">,</span> <span class="nam">n1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1058" href="#t1058">1058</a></span><span class="t">    <span class="key">if</span> <span class="nam">n_fft</span> <span class="op">&lt;</span> <span class="nam">n</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1059" href="#t1059">1059</a></span><span class="t">        <span class="nam">n_fft</span> <span class="op">=</span> <span class="nam">next_power_of_two</span><span class="op">(</span><span class="nam">n</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1060" href="#t1060">1060</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="nam">n_fft</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1061" href="#t1061">1061</a></span><span class="t">    <span class="nam">data</span><span class="op">[</span><span class="nam">n_fft</span><span class="op">//</span><span class="num">2</span><span class="op">-</span><span class="nam">n0</span><span class="op">:</span><span class="nam">n_fft</span><span class="op">//</span><span class="num">2</span><span class="op">+</span><span class="nam">n1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">meod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1062" href="#t1062">1062</a></span><span class="t">    <span class="nam">nr</span> <span class="op">=</span> <span class="nam">n</span><span class="op">//</span><span class="num">4</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1063" href="#t1063">1063</a></span><span class="t">    <span class="nam">data</span><span class="op">[</span><span class="nam">n_fft</span><span class="op">//</span><span class="num">2</span><span class="op">-</span><span class="nam">n0</span><span class="op">:</span><span class="nam">n_fft</span><span class="op">//</span><span class="num">2</span><span class="op">-</span><span class="nam">n0</span><span class="op">+</span><span class="nam">nr</span><span class="op">]</span> <span class="op">*=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">nr</span><span class="op">)</span><span class="op">/</span><span class="nam">nr</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1064" href="#t1064">1064</a></span><span class="t">    <span class="nam">data</span><span class="op">[</span><span class="nam">n_fft</span><span class="op">//</span><span class="num">2</span><span class="op">+</span><span class="nam">n1</span><span class="op">-</span><span class="nam">nr</span><span class="op">:</span><span class="nam">n_fft</span><span class="op">//</span><span class="num">2</span><span class="op">+</span><span class="nam">n1</span><span class="op">]</span> <span class="op">*=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">nr</span><span class="op">)</span><span class="op">[</span><span class="op">:</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">/</span><span class="nam">nr</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1065" href="#t1065">1065</a></span><span class="t">    <span class="nam">freqs</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">fft</span><span class="op">.</span><span class="nam">rfftfreq</span><span class="op">(</span><span class="nam">n_fft</span><span class="op">,</span> <span class="num">1.0</span><span class="op">/</span><span class="nam">rate</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1066" href="#t1066">1066</a></span><span class="t">    <span class="nam">fourier</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">fft</span><span class="op">.</span><span class="nam">rfft</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">/</span><span class="nam">n_fft</span><span class="op">/</span><span class="nam">freqs</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1067" href="#t1067">1067</a></span><span class="t">    <span class="nam">power</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">fourier</span><span class="op">)</span><span class="op">**</span><span class="num">2.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1068" href="#t1068">1068</a></span><span class="t">    <span class="nam">ppower</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">power</span><span class="op">)</span><span class="op">,</span> <span class="num">2</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1069" href="#t1069">1069</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1070" href="#t1070">1070</a></span><span class="t">    <span class="nam">ppower</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="nam">freqs</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1071" href="#t1071">1071</a></span><span class="t">    <span class="nam">ppower</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">power</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1072" href="#t1072">1072</a></span><span class="t">    <span class="nam">maxpower</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">power</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1073" href="#t1073">1073</a></span><span class="t">    <span class="nam">att5</span> <span class="op">=</span> <span class="nam">decibel</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">power</span><span class="op">[</span><span class="nam">freqs</span><span class="op">&lt;</span><span class="num">5.0</span><span class="op">]</span><span class="op">)</span><span class="op">,</span> <span class="nam">maxpower</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1074" href="#t1074">1074</a></span><span class="t">    <span class="nam">att50</span> <span class="op">=</span> <span class="nam">decibel</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">power</span><span class="op">[</span><span class="nam">freqs</span><span class="op">&lt;</span><span class="num">50.0</span><span class="op">]</span><span class="op">)</span><span class="op">,</span> <span class="nam">maxpower</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1075" href="#t1075">1075</a></span><span class="t">    <span class="nam">lowcutoff</span> <span class="op">=</span> <span class="nam">freqs</span><span class="op">[</span><span class="nam">decibel</span><span class="op">(</span><span class="nam">power</span><span class="op">,</span> <span class="nam">maxpower</span><span class="op">)</span> <span class="op">></span> <span class="num">0.5</span><span class="op">*</span><span class="nam">att5</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1076" href="#t1076">1076</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1077" href="#t1077">1077</a></span><span class="t">    <span class="com"># analyze pulse timing:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1078" href="#t1078">1078</a></span><span class="t">    <span class="key">if</span> <span class="nam">eod_times</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1079" href="#t1079">1079</a></span><span class="t">        <span class="nam">inter_pulse_intervals</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">diff</span><span class="op">(</span><span class="nam">eod_times</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1080" href="#t1080">1080</a></span><span class="t">        <span class="nam">ipi_cv</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">inter_pulse_intervals</span><span class="op">)</span><span class="op">/</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">inter_pulse_intervals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1081" href="#t1081">1081</a></span><span class="t">        <span class="key">if</span> <span class="nam">ipi_cv</span> <span class="op">&lt;</span> <span class="nam">ipi_cv_thresh</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1082" href="#t1082">1082</a></span><span class="t">            <span class="nam">period</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">median</span><span class="op">(</span><span class="nam">inter_pulse_intervals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1083" href="#t1083">1083</a></span><span class="t">            <span class="nam">ipi_mean</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">inter_pulse_intervals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1084" href="#t1084">1084</a></span><span class="t">            <span class="nam">ipi_std</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">inter_pulse_intervals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1085" href="#t1085">1085</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1086" href="#t1086">1086</a></span><span class="t">            <span class="nam">intervals</span> <span class="op">=</span> <span class="nam">inter_pulse_intervals</span><span class="op">[</span><span class="nam">inter_pulse_intervals</span> <span class="op">&lt;</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1087" href="#t1087">1087</a></span><span class="t">                                    <span class="nam">np</span><span class="op">.</span><span class="nam">percentile</span><span class="op">(</span><span class="nam">inter_pulse_intervals</span><span class="op">,</span> <span class="nam">ipi_percentile</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1088" href="#t1088">1088</a></span><span class="t">            <span class="nam">period</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">median</span><span class="op">(</span><span class="nam">intervals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1089" href="#t1089">1089</a></span><span class="t">            <span class="nam">ipi_mean</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">intervals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1090" href="#t1090">1090</a></span><span class="t">            <span class="nam">ipi_std</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">intervals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1091" href="#t1091">1091</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1092" href="#t1092">1092</a></span><span class="t">    <span class="com"># store properties:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1093" href="#t1093">1093</a></span><span class="t">    <span class="nam">props</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1094" href="#t1094">1094</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'type'</span><span class="op">]</span> <span class="op">=</span> <span class="str">'pulse'</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1095" href="#t1095">1095</a></span><span class="t">    <span class="key">if</span> <span class="nam">eod_times</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1096" href="#t1096">1096</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'EODf'</span><span class="op">]</span> <span class="op">=</span> <span class="num">1.0</span><span class="op">/</span><span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1097" href="#t1097">1097</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'period'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">period</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1098" href="#t1098">1098</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'IPI-mean'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">ipi_mean</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1099" href="#t1099">1099</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'IPI-std'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">ipi_std</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1100" href="#t1100">1100</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'max-ampl'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">max_ampl</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1101" href="#t1101">1101</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'min-ampl'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">min_ampl</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1102" href="#t1102">1102</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'p-p-amplitude'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">ppampl</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1103" href="#t1103">1103</a></span><span class="t">    <span class="key">if</span> <span class="nam">rmssem</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1104" href="#t1104">1104</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'noise'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">rmssem</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1105" href="#t1105">1105</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'tstart'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">t0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1106" href="#t1106">1106</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'tend'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">t1</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1107" href="#t1107">1107</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'width'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">t1</span> <span class="op">-</span> <span class="nam">t0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1108" href="#t1108">1108</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'P2-P1-dist'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">dist</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1109" href="#t1109">1109</a></span><span class="t">    <span class="key">if</span> <span class="nam">tau</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1110" href="#t1110">1110</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'tau'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">tau</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1111" href="#t1111">1111</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'firstpeak'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">peaks</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="num">0</span><span class="op">]</span> <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">peaks</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span> <span class="key">else</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1112" href="#t1112">1112</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'lastpeak'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">peaks</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">,</span> <span class="num">0</span><span class="op">]</span> <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">peaks</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span> <span class="key">else</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1113" href="#t1113">1113</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'totalarea'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">total_area</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1114" href="#t1114">1114</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'positivearea'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">pos_area</span><span class="op">/</span><span class="nam">total_area</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1115" href="#t1115">1115</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'negativearea'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">neg_area</span><span class="op">/</span><span class="nam">total_area</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1116" href="#t1116">1116</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'polaritybalance'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">polarity_balance</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1117" href="#t1117">1117</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'peakfreq'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">freqs</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">power</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1118" href="#t1118">1118</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'peakpower'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">decibel</span><span class="op">(</span><span class="nam">maxpower</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1119" href="#t1119">1119</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'poweratt5'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">att5</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1120" href="#t1120">1120</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'poweratt50'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">att50</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1121" href="#t1121">1121</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'lowcutoff'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">lowcutoff</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1122" href="#t1122">1122</a></span><span class="t">    <span class="nam">props</span><span class="op">[</span><span class="str">'flipped'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">flipped</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1123" href="#t1123">1123</a></span><span class="t">    <span class="key">if</span> <span class="nam">eod_times</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1124" href="#t1124">1124</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'n'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_times</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1125" href="#t1125">1125</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'times'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">eod_times</span> <span class="op">+</span> <span class="nam">toffs</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1126" href="#t1126">1126</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1127" href="#t1127">1127</a></span><span class="t">    <span class="key">return</span> <span class="nam">meod</span><span class="op">,</span> <span class="nam">props</span><span class="op">,</span> <span class="nam">peaks</span><span class="op">,</span> <span class="nam">ppower</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1128" href="#t1128">1128</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1129" href="#t1129">1129</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1130" href="#t1130">1130</a></span><span class="t"><span class="key">def</span> <span class="nam">adjust_eodf</span><span class="op">(</span><span class="nam">eodf</span><span class="op">,</span> <span class="nam">temp</span><span class="op">,</span> <span class="nam">temp_adjust</span><span class="op">=</span><span class="num">25.0</span><span class="op">,</span> <span class="nam">q10</span><span class="op">=</span><span class="num">1.62</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1131" href="#t1131">1131</a></span><span class="t">    <span class="str">"""Adjust EOD frequencies to a standard temperature using Q10.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1132" href="#t1132">1132</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1133" href="#t1133">1133</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1134" href="#t1134">1134</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1135" href="#t1135">1135</a></span><span class="t"><span class="str">    eodf: float or ndarray</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1136" href="#t1136">1136</a></span><span class="t"><span class="str">        EOD frequencies.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1137" href="#t1137">1137</a></span><span class="t"><span class="str">    temp: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1138" href="#t1138">1138</a></span><span class="t"><span class="str">        Temperature in degree celsisus at which EOD frequencies in</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1139" href="#t1139">1139</a></span><span class="t"><span class="str">        `eodf` were measured.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1140" href="#t1140">1140</a></span><span class="t"><span class="str">    temp_adjust: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1141" href="#t1141">1141</a></span><span class="t"><span class="str">        Standard temperature in degree celsisus to which EOD</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1142" href="#t1142">1142</a></span><span class="t"><span class="str">        frequencies are adjusted.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1143" href="#t1143">1143</a></span><span class="t"><span class="str">    q10: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1144" href="#t1144">1144</a></span><span class="t"><span class="str">        Q10 value describing temperature dependence of EOD</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1145" href="#t1145">1145</a></span><span class="t"><span class="str">        frequencies.  The default of 1.62 is from Dunlap, Smith, Yetka</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1146" href="#t1146">1146</a></span><span class="t"><span class="str">        (2000) Brain Behav Evol, measured for Apteronotus</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1147" href="#t1147">1147</a></span><span class="t"><span class="str">        lepthorhynchus in the lab.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1148" href="#t1148">1148</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1149" href="#t1149">1149</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1150" href="#t1150">1150</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1151" href="#t1151">1151</a></span><span class="t"><span class="str">    eodf_corrected: float or array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1152" href="#t1152">1152</a></span><span class="t"><span class="str">        EOD frequencies adjusted to `temp_adjust` using `q10`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1153" href="#t1153">1153</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1154" href="#t1154">1154</a></span><span class="t">    <span class="key">return</span> <span class="nam">eodf</span><span class="op">*</span><span class="nam">q10</span><span class="op">**</span><span class="op">(</span><span class="op">(</span><span class="nam">temp_adjust</span> <span class="op">-</span> <span class="nam">temp</span><span class="op">)</span> <span class="op">/</span> <span class="num">10.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1155" href="#t1155">1155</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1156" href="#t1156">1156</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1157" href="#t1157">1157</a></span><span class="t"><span class="key">def</span> <span class="nam">load_species_waveforms</span><span class="op">(</span><span class="nam">species_file</span><span class="op">=</span><span class="str">'none'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1158" href="#t1158">1158</a></span><span class="t">    <span class="str">"""Load template EOD waveforms for species matching.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1159" href="#t1159">1159</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1160" href="#t1160">1160</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1161" href="#t1161">1161</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1162" href="#t1162">1162</a></span><span class="t"><span class="str">    species_file: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1163" href="#t1163">1163</a></span><span class="t"><span class="str">        Name of file containing species definitions. The content of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1164" href="#t1164">1164</a></span><span class="t"><span class="str">        this file is as follows:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1165" href="#t1165">1165</a></span><span class="t"><span class="str">        </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1166" href="#t1166">1166</a></span><span class="t"><span class="str">        - Empty lines and line starting with a hash ('#') are skipped.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1167" href="#t1167">1167</a></span><span class="t"><span class="str">        - A line with the key-word 'wavefish' marks the beginning of the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1168" href="#t1168">1168</a></span><span class="t"><span class="str">          table for wave fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1169" href="#t1169">1169</a></span><span class="t"><span class="str">        - A line with the key-word 'pulsefish' marks the beginning of the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1170" href="#t1170">1170</a></span><span class="t"><span class="str">          table for pulse fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1171" href="#t1171">1171</a></span><span class="t"><span class="str">        - Each line in a species table has three fields,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1172" href="#t1172">1172</a></span><span class="t"><span class="str">          separated by colons (':'):</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1173" href="#t1173">1173</a></span><span class="t"><span class="str">        </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1174" href="#t1174">1174</a></span><span class="t"><span class="str">          1. First field is an abbreviation of the species name.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1175" href="#t1175">1175</a></span><span class="t"><span class="str">          2. Second field is the filename of the recording containing the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1176" href="#t1176">1176</a></span><span class="t"><span class="str">             EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1177" href="#t1177">1177</a></span><span class="t"><span class="str">          3. The optional third field is the EOD frequency of the EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1178" href="#t1178">1178</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1179" href="#t1179">1179</a></span><span class="t"><span class="str">          The EOD frequency is used to normalize the time axis of a</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1180" href="#t1180">1180</a></span><span class="t"><span class="str">          wave fish EOD to one EOD period. If it is not specified in</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1181" href="#t1181">1181</a></span><span class="t"><span class="str">          the third field, it is taken from the corresponding</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1182" href="#t1182">1182</a></span><span class="t"><span class="str">          *-wavespectrum-* file, if present.  Otherwise the species is</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1183" href="#t1183">1183</a></span><span class="t"><span class="str">          excluded and a warning is issued.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1184" href="#t1184">1184</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1185" href="#t1185">1185</a></span><span class="t"><span class="str">        Example file content:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1186" href="#t1186">1186</a></span><span class="t"><span class="str">        ``` plain</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1187" href="#t1187">1187</a></span><span class="t"><span class="str">        Wavefish</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1188" href="#t1188">1188</a></span><span class="t"><span class="str">        Aptero : F_91009L20-eodwaveform-0.csv : 823Hz</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1189" href="#t1189">1189</a></span><span class="t"><span class="str">        Eigen  : C_91008L01-eodwaveform-0.csv</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1190" href="#t1190">1190</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1191" href="#t1191">1191</a></span><span class="t"><span class="str">        Pulsefish</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1192" href="#t1192">1192</a></span><span class="t"><span class="str">        Gymnotus : pulsefish/gymnotus.csv</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1193" href="#t1193">1193</a></span><span class="t"><span class="str">        Brachy   : H_91009L11-eodwaveform-0.csv</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1194" href="#t1194">1194</a></span><span class="t"><span class="str">        ```</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1195" href="#t1195">1195</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1196" href="#t1196">1196</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1197" href="#t1197">1197</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1198" href="#t1198">1198</a></span><span class="t"><span class="str">    wave_names: list of strings</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1199" href="#t1199">1199</a></span><span class="t"><span class="str">        List of species names of wave-type fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1200" href="#t1200">1200</a></span><span class="t"><span class="str">    wave_eods: list of 2-D arrays</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1201" href="#t1201">1201</a></span><span class="t"><span class="str">        List of EOD waveforms of wave-type fish corresponding to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1202" href="#t1202">1202</a></span><span class="t"><span class="str">        `wave_names`.  First column of a waveform is time in seconds,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1203" href="#t1203">1203</a></span><span class="t"><span class="str">        second column is the EOD waveform.  The waveforms contain</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1204" href="#t1204">1204</a></span><span class="t"><span class="str">        exactly one EOD period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1205" href="#t1205">1205</a></span><span class="t"><span class="str">    pulse_names: list of strings</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1206" href="#t1206">1206</a></span><span class="t"><span class="str">        List of species names of pulse-type fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1207" href="#t1207">1207</a></span><span class="t"><span class="str">    pulse_eods: list of 2-D arrays</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1208" href="#t1208">1208</a></span><span class="t"><span class="str">        List of EOD waveforms of pulse-type fish corresponding to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1209" href="#t1209">1209</a></span><span class="t"><span class="str">        `pulse_names`.  First column of a waveform is time in seconds,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1210" href="#t1210">1210</a></span><span class="t"><span class="str">        second column is the EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1211" href="#t1211">1211</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1212" href="#t1212">1212</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">species_file</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span> <span class="key">or</span> <span class="nam">species_file</span> <span class="op">==</span> <span class="str">'none'</span> <span class="key">or</span> <span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1213" href="#t1213">1213</a></span><span class="t">       <span class="key">not</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">isfile</span><span class="op">(</span><span class="nam">species_file</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1214" href="#t1214">1214</a></span><span class="t">        <span class="key">return</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1215" href="#t1215">1215</a></span><span class="t">    <span class="nam">wave_names</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1216" href="#t1216">1216</a></span><span class="t">    <span class="nam">wave_eods</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1217" href="#t1217">1217</a></span><span class="t">    <span class="nam">pulse_names</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1218" href="#t1218">1218</a></span><span class="t">    <span class="nam">pulse_eods</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1219" href="#t1219">1219</a></span><span class="t">    <span class="nam">fish_type</span> <span class="op">=</span> <span class="str">'wave'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1220" href="#t1220">1220</a></span><span class="t">    <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">species_file</span><span class="op">,</span> <span class="str">'r'</span><span class="op">)</span> <span class="key">as</span> <span class="nam">sf</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1221" href="#t1221">1221</a></span><span class="t">        <span class="key">for</span> <span class="nam">line</span> <span class="key">in</span> <span class="nam">sf</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1222" href="#t1222">1222</a></span><span class="t">            <span class="nam">line</span> <span class="op">=</span> <span class="nam">line</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1223" href="#t1223">1223</a></span><span class="t">            <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">line</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span> <span class="key">or</span> <span class="nam">line</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="str">'#'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1224" href="#t1224">1224</a></span><span class="t">                <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1225" href="#t1225">1225</a></span><span class="t">            <span class="key">if</span> <span class="nam">line</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="str">'wavefish'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1226" href="#t1226">1226</a></span><span class="t">                <span class="nam">fish_type</span> <span class="op">=</span> <span class="str">'wave'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1227" href="#t1227">1227</a></span><span class="t">            <span class="key">elif</span> <span class="nam">line</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="str">'pulsefish'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1228" href="#t1228">1228</a></span><span class="t">                <span class="nam">fish_type</span> <span class="op">=</span> <span class="str">'pulse'</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1229" href="#t1229">1229</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1230" href="#t1230">1230</a></span><span class="t">                <span class="nam">ls</span> <span class="op">=</span> <span class="op">[</span><span class="nam">s</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span> <span class="key">for</span> <span class="nam">s</span> <span class="key">in</span> <span class="nam">line</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">':'</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1231" href="#t1231">1231</a></span><span class="t">                <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">ls</span><span class="op">)</span> <span class="op">&lt;</span>  <span class="num">2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1232" href="#t1232">1232</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1233" href="#t1233">1233</a></span><span class="t">                <span class="nam">name</span> <span class="op">=</span> <span class="nam">ls</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1234" href="#t1234">1234</a></span><span class="t">                <span class="nam">waveform_file</span> <span class="op">=</span> <span class="nam">ls</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1235" href="#t1235">1235</a></span><span class="t">                <span class="nam">eod</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">waveform_file</span><span class="op">)</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1236" href="#t1236">1236</a></span><span class="t">                <span class="nam">eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">*=</span> <span class="num">0.001</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1237" href="#t1237">1237</a></span><span class="t">                <span class="key">if</span> <span class="nam">fish_type</span> <span class="op">==</span> <span class="str">'wave'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1238" href="#t1238">1238</a></span><span class="t">                    <span class="nam">eodf</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1239" href="#t1239">1239</a></span><span class="t">                    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">ls</span><span class="op">)</span> <span class="op">></span>  <span class="num">2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1240" href="#t1240">1240</a></span><span class="t">                        <span class="nam">eodf</span> <span class="op">=</span> <span class="nam">float</span><span class="op">(</span><span class="nam">ls</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="str">'Hz'</span><span class="op">,</span> <span class="str">''</span><span class="op">)</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1241" href="#t1241">1241</a></span><span class="t">                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1242" href="#t1242">1242</a></span><span class="t">                        <span class="nam">spectrum_file</span> <span class="op">=</span> <span class="nam">waveform_file</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="str">'eodwaveform'</span><span class="op">,</span> <span class="str">'wavespectrum'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1243" href="#t1243">1243</a></span><span class="t">                        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1244" href="#t1244">1244</a></span><span class="t">                            <span class="nam">wave_spec</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">spectrum_file</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1245" href="#t1245">1245</a></span><span class="t">                            <span class="nam">eodf</span> <span class="op">=</span> <span class="nam">wave_spec</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1246" href="#t1246">1246</a></span><span class="t">                        <span class="key">except</span> <span class="nam">FileNotFoundError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1247" href="#t1247">1247</a></span><span class="t">                            <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1248" href="#t1248">1248</a></span><span class="t">                    <span class="key">if</span> <span class="nam">eodf</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1249" href="#t1249">1249</a></span><span class="t">                        <span class="nam">print</span><span class="op">(</span><span class="str">'warning: unknown EOD frequency of %s. Skip.'</span> <span class="op">%</span> <span class="nam">name</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1250" href="#t1250">1250</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1251" href="#t1251">1251</a></span><span class="t">                    <span class="nam">eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">*=</span> <span class="nam">eodf</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1252" href="#t1252">1252</a></span><span class="t">                    <span class="nam">wave_names</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">name</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1253" href="#t1253">1253</a></span><span class="t">                    <span class="nam">wave_eods</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1254" href="#t1254">1254</a></span><span class="t">                <span class="key">elif</span> <span class="nam">fish_type</span> <span class="op">==</span> <span class="str">'pulse'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1255" href="#t1255">1255</a></span><span class="t">                    <span class="nam">pulse_names</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">name</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1256" href="#t1256">1256</a></span><span class="t">                    <span class="nam">pulse_eods</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1257" href="#t1257">1257</a></span><span class="t">    <span class="key">return</span> <span class="nam">wave_names</span><span class="op">,</span> <span class="nam">wave_eods</span><span class="op">,</span> <span class="nam">pulse_names</span><span class="op">,</span> <span class="nam">pulse_eods</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1258" href="#t1258">1258</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1259" href="#t1259">1259</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1260" href="#t1260">1260</a></span><span class="t"><span class="key">def</span> <span class="nam">wave_similarity</span><span class="op">(</span><span class="nam">eod1</span><span class="op">,</span> <span class="nam">eod2</span><span class="op">,</span> <span class="nam">eod1f</span><span class="op">=</span><span class="num">1.0</span><span class="op">,</span> <span class="nam">eod2f</span><span class="op">=</span><span class="num">1.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1261" href="#t1261">1261</a></span><span class="t">    <span class="str">"""Root-mean squared difference between two wave fish EODs.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1262" href="#t1262">1262</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1263" href="#t1263">1263</a></span><span class="t"><span class="str">    Compute the root-mean squared difference between two wave fish</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1264" href="#t1264">1264</a></span><span class="t"><span class="str">    EODs over one period. The better sampled signal is down-sampled to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1265" href="#t1265">1265</a></span><span class="t"><span class="str">    the worse sampled one. Amplitude are normalized to peak-to-peak</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1266" href="#t1266">1266</a></span><span class="t"><span class="str">    amplitude before computing rms difference.  Also compute the rms</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1267" href="#t1267">1267</a></span><span class="t"><span class="str">    difference between the one EOD and the other one inverted in</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1268" href="#t1268">1268</a></span><span class="t"><span class="str">    amplitude. The smaller of the two rms values is returned.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1269" href="#t1269">1269</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1270" href="#t1270">1270</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1271" href="#t1271">1271</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1272" href="#t1272">1272</a></span><span class="t"><span class="str">    eod1: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1273" href="#t1273">1273</a></span><span class="t"><span class="str">        Time and amplitude of reference EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1274" href="#t1274">1274</a></span><span class="t"><span class="str">    eod2: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1275" href="#t1275">1275</a></span><span class="t"><span class="str">        Time and amplitude of EOD that is to be compared to `eod1`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1276" href="#t1276">1276</a></span><span class="t"><span class="str">    eod1f: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1277" href="#t1277">1277</a></span><span class="t"><span class="str">        EOD frequency of `eod1` used to transform the time axis of `eod1`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1278" href="#t1278">1278</a></span><span class="t"><span class="str">        to multiples of the EOD period. If already normalized to EOD period,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1279" href="#t1279">1279</a></span><span class="t"><span class="str">        as for example by the `load_species_waveforms()` function, then</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1280" href="#t1280">1280</a></span><span class="t"><span class="str">        set the EOD frequency to one (default).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1281" href="#t1281">1281</a></span><span class="t"><span class="str">    eod2f: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1282" href="#t1282">1282</a></span><span class="t"><span class="str">        EOD frequency of `eod2` used to transform the time axis of `eod2`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1283" href="#t1283">1283</a></span><span class="t"><span class="str">        to multiples of the EOD period. If already normalized to EOD period,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1284" href="#t1284">1284</a></span><span class="t"><span class="str">        as for example by the `load_species_waveforms()` function, then</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1285" href="#t1285">1285</a></span><span class="t"><span class="str">        set the EOD frequency to one (default).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1286" href="#t1286">1286</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1287" href="#t1287">1287</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1288" href="#t1288">1288</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1289" href="#t1289">1289</a></span><span class="t"><span class="str">    rmse: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1290" href="#t1290">1290</a></span><span class="t"><span class="str">        Root-mean-squared difference between the two EOD waveforms relative to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1291" href="#t1291">1291</a></span><span class="t"><span class="str">        their standard deviation over one period.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1292" href="#t1292">1292</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1293" href="#t1293">1293</a></span><span class="t">    <span class="com"># copy:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1294" href="#t1294">1294</a></span><span class="t">    <span class="nam">eod1</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1295" href="#t1295">1295</a></span><span class="t">    <span class="nam">eod2</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1296" href="#t1296">1296</a></span><span class="t">    <span class="com"># scale to multiples of EOD period:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1297" href="#t1297">1297</a></span><span class="t">    <span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">*=</span> <span class="nam">eod1f</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1298" href="#t1298">1298</a></span><span class="t">    <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">*=</span> <span class="nam">eod2f</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1299" href="#t1299">1299</a></span><span class="t">    <span class="com"># make eod1 the waveform with less samples per period:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1300" href="#t1300">1300</a></span><span class="t">    <span class="nam">n1</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="num">1.0</span><span class="op">/</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="num">1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">eod1</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1301" href="#t1301">1301</a></span><span class="t">    <span class="nam">n2</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="num">1.0</span><span class="op">/</span><span class="op">(</span><span class="nam">eod2</span><span class="op">[</span><span class="num">1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">eod2</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1302" href="#t1302">1302</a></span><span class="t">    <span class="key">if</span> <span class="nam">n1</span> <span class="op">></span> <span class="nam">n2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1303" href="#t1303">1303</a></span><span class="t">        <span class="nam">eod1</span><span class="op">,</span> <span class="nam">eod2</span> <span class="op">=</span> <span class="nam">eod2</span><span class="op">,</span> <span class="nam">eod1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1304" href="#t1304">1304</a></span><span class="t">        <span class="nam">n1</span><span class="op">,</span> <span class="nam">n2</span> <span class="op">=</span> <span class="nam">n2</span><span class="op">,</span> <span class="nam">n1</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1305" href="#t1305">1305</a></span><span class="t">    <span class="com"># one period around time zero:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1306" href="#t1306">1306</a></span><span class="t">    <span class="nam">i0</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1307" href="#t1307">1307</a></span><span class="t">    <span class="nam">k0</span> <span class="op">=</span> <span class="nam">i0</span><span class="op">-</span><span class="nam">n1</span><span class="op">//</span><span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1308" href="#t1308">1308</a></span><span class="t">    <span class="key">if</span> <span class="nam">k0</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1309" href="#t1309">1309</a></span><span class="t">        <span class="nam">k0</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1310" href="#t1310">1310</a></span><span class="t">    <span class="nam">k1</span> <span class="op">=</span> <span class="nam">k0</span> <span class="op">+</span> <span class="nam">n1</span> <span class="op">+</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1311" href="#t1311">1311</a></span><span class="t">    <span class="key">if</span> <span class="nam">k1</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod1</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1312" href="#t1312">1312</a></span><span class="t">        <span class="nam">k1</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1313" href="#t1313">1313</a></span><span class="t">    <span class="com"># cut out one period from the reference EOD around maximum:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1314" href="#t1314">1314</a></span><span class="t">    <span class="nam">i</span> <span class="op">=</span> <span class="nam">k0</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="nam">k0</span><span class="op">:</span><span class="nam">k1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1315" href="#t1315">1315</a></span><span class="t">    <span class="nam">k0</span> <span class="op">=</span> <span class="nam">i</span><span class="op">-</span><span class="nam">n1</span><span class="op">//</span><span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1316" href="#t1316">1316</a></span><span class="t">    <span class="key">if</span> <span class="nam">k0</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1317" href="#t1317">1317</a></span><span class="t">        <span class="nam">k0</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1318" href="#t1318">1318</a></span><span class="t">    <span class="nam">k1</span> <span class="op">=</span> <span class="nam">k0</span> <span class="op">+</span> <span class="nam">n1</span> <span class="op">+</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1319" href="#t1319">1319</a></span><span class="t">    <span class="key">if</span> <span class="nam">k1</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod1</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1320" href="#t1320">1320</a></span><span class="t">        <span class="nam">k1</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1321" href="#t1321">1321</a></span><span class="t">    <span class="nam">eod1</span> <span class="op">=</span> <span class="nam">eod1</span><span class="op">[</span><span class="nam">k0</span><span class="op">:</span><span class="nam">k1</span><span class="op">,</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1322" href="#t1322">1322</a></span><span class="t">    <span class="com"># normalize amplitudes of first EOD:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1323" href="#t1323">1323</a></span><span class="t">    <span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1324" href="#t1324">1324</a></span><span class="t">    <span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">/=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1325" href="#t1325">1325</a></span><span class="t">    <span class="nam">sigma</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1326" href="#t1326">1326</a></span><span class="t">    <span class="com"># set time zero to maximum of second EOD:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1327" href="#t1327">1327</a></span><span class="t">    <span class="nam">i0</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1328" href="#t1328">1328</a></span><span class="t">    <span class="nam">k0</span> <span class="op">=</span> <span class="nam">i0</span><span class="op">-</span><span class="nam">n2</span><span class="op">//</span><span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1329" href="#t1329">1329</a></span><span class="t">    <span class="key">if</span> <span class="nam">k0</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1330" href="#t1330">1330</a></span><span class="t">        <span class="nam">k0</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1331" href="#t1331">1331</a></span><span class="t">    <span class="nam">k1</span> <span class="op">=</span> <span class="nam">k0</span> <span class="op">+</span> <span class="nam">n2</span> <span class="op">+</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1332" href="#t1332">1332</a></span><span class="t">    <span class="key">if</span> <span class="nam">k1</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod2</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1333" href="#t1333">1333</a></span><span class="t">        <span class="nam">k1</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1334" href="#t1334">1334</a></span><span class="t">    <span class="nam">i</span> <span class="op">=</span> <span class="nam">k0</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">eod2</span><span class="op">[</span><span class="nam">k0</span><span class="op">:</span><span class="nam">k1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1335" href="#t1335">1335</a></span><span class="t">    <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">eod2</span><span class="op">[</span><span class="nam">i</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1336" href="#t1336">1336</a></span><span class="t">    <span class="com"># interpolate eod2 to the time base of eod1:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1337" href="#t1337">1337</a></span><span class="t">    <span class="nam">eod2w</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">interp</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1338" href="#t1338">1338</a></span><span class="t">    <span class="com"># normalize amplitudes of second EOD:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1339" href="#t1339">1339</a></span><span class="t">    <span class="nam">eod2w</span> <span class="op">-=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">eod2w</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1340" href="#t1340">1340</a></span><span class="t">    <span class="nam">eod2w</span> <span class="op">/=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">eod2w</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1341" href="#t1341">1341</a></span><span class="t">    <span class="com"># root-mean-square difference:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1342" href="#t1342">1342</a></span><span class="t">    <span class="nam">rmse1</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">eod2w</span><span class="op">)</span><span class="op">**</span><span class="num">2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">sigma</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1343" href="#t1343">1343</a></span><span class="t">    <span class="com"># root-mean-square difference of the flipped signal:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1344" href="#t1344">1344</a></span><span class="t">    <span class="nam">i</span> <span class="op">=</span> <span class="nam">k0</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">eod2</span><span class="op">[</span><span class="nam">k0</span><span class="op">:</span><span class="nam">k1</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1345" href="#t1345">1345</a></span><span class="t">    <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">eod2</span><span class="op">[</span><span class="nam">i</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1346" href="#t1346">1346</a></span><span class="t">    <span class="nam">eod2w</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">interp</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="op">-</span><span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1347" href="#t1347">1347</a></span><span class="t">    <span class="nam">eod2w</span> <span class="op">-=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">eod2w</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1348" href="#t1348">1348</a></span><span class="t">    <span class="nam">eod2w</span> <span class="op">/=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">eod2w</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1349" href="#t1349">1349</a></span><span class="t">    <span class="nam">rmse2</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">eod2w</span><span class="op">)</span><span class="op">**</span><span class="num">2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">sigma</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1350" href="#t1350">1350</a></span><span class="t">    <span class="com"># take the smaller value:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1351" href="#t1351">1351</a></span><span class="t">    <span class="nam">rmse</span> <span class="op">=</span> <span class="nam">min</span><span class="op">(</span><span class="nam">rmse1</span><span class="op">,</span> <span class="nam">rmse2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1352" href="#t1352">1352</a></span><span class="t">    <span class="key">return</span> <span class="nam">rmse</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1353" href="#t1353">1353</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1354" href="#t1354">1354</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1355" href="#t1355">1355</a></span><span class="t"><span class="key">def</span> <span class="nam">pulse_similarity</span><span class="op">(</span><span class="nam">eod1</span><span class="op">,</span> <span class="nam">eod2</span><span class="op">,</span> <span class="nam">wfac</span><span class="op">=</span><span class="num">10.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1356" href="#t1356">1356</a></span><span class="t">    <span class="str">"""Root-mean squared difference between two pulse fish EODs.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1357" href="#t1357">1357</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1358" href="#t1358">1358</a></span><span class="t"><span class="str">    Compute the root-mean squared difference between two pulse fish</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1359" href="#t1359">1359</a></span><span class="t"><span class="str">    EODs over `wfac` times the distance between minimum and maximum of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1360" href="#t1360">1360</a></span><span class="t"><span class="str">    the wider EOD. The waveforms are normalized to their maxima prior</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1361" href="#t1361">1361</a></span><span class="t"><span class="str">    to computing the rms difference.  Also compute the rms difference</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1362" href="#t1362">1362</a></span><span class="t"><span class="str">    between the one EOD and the other one inverted in amplitude. The</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1363" href="#t1363">1363</a></span><span class="t"><span class="str">    smaller of the two rms values is returned.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1364" href="#t1364">1364</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1365" href="#t1365">1365</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1366" href="#t1366">1366</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1367" href="#t1367">1367</a></span><span class="t"><span class="str">    eod1: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1368" href="#t1368">1368</a></span><span class="t"><span class="str">        Time and amplitude of reference EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1369" href="#t1369">1369</a></span><span class="t"><span class="str">    eod2: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1370" href="#t1370">1370</a></span><span class="t"><span class="str">        Time and amplitude of EOD that is to be compared to `eod1`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1371" href="#t1371">1371</a></span><span class="t"><span class="str">    wfac: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1372" href="#t1372">1372</a></span><span class="t"><span class="str">        Multiply the distance between minimum and maximum by this factor</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1373" href="#t1373">1373</a></span><span class="t"><span class="str">        to get the window size over which to compute the rms difference.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1374" href="#t1374">1374</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1375" href="#t1375">1375</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1376" href="#t1376">1376</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1377" href="#t1377">1377</a></span><span class="t"><span class="str">    rmse: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1378" href="#t1378">1378</a></span><span class="t"><span class="str">        Root-mean-squared difference between the two EOD waveforms</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1379" href="#t1379">1379</a></span><span class="t"><span class="str">        relative to their standard deviation over the analysis window.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1380" href="#t1380">1380</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1381" href="#t1381">1381</a></span><span class="t">    <span class="com"># copy:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1382" href="#t1382">1382</a></span><span class="t">    <span class="nam">eod1</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1383" href="#t1383">1383</a></span><span class="t">    <span class="nam">eod2</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1384" href="#t1384">1384</a></span><span class="t">    <span class="com"># width of the pulses:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1385" href="#t1385">1385</a></span><span class="t">    <span class="nam">imin1</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1386" href="#t1386">1386</a></span><span class="t">    <span class="nam">imax1</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1387" href="#t1387">1387</a></span><span class="t">    <span class="nam">w1</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="nam">imax1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">eod1</span><span class="op">[</span><span class="nam">imin1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1388" href="#t1388">1388</a></span><span class="t">    <span class="nam">imin2</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1389" href="#t1389">1389</a></span><span class="t">    <span class="nam">imax2</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1390" href="#t1390">1390</a></span><span class="t">    <span class="nam">w2</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">eod2</span><span class="op">[</span><span class="nam">imax2</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">eod2</span><span class="op">[</span><span class="nam">imin2</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1391" href="#t1391">1391</a></span><span class="t">    <span class="nam">w</span> <span class="op">=</span> <span class="nam">wfac</span><span class="op">*</span><span class="nam">max</span><span class="op">(</span><span class="nam">w1</span><span class="op">,</span> <span class="nam">w2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1392" href="#t1392">1392</a></span><span class="t">    <span class="com"># cut out signal from the reference EOD:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1393" href="#t1393">1393</a></span><span class="t">    <span class="nam">n</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">w</span><span class="op">/</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="num">1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">eod1</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1394" href="#t1394">1394</a></span><span class="t">    <span class="nam">i0</span> <span class="op">=</span> <span class="nam">imax1</span><span class="op">-</span><span class="nam">n</span><span class="op">//</span><span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1395" href="#t1395">1395</a></span><span class="t">    <span class="key">if</span> <span class="nam">i0</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1396" href="#t1396">1396</a></span><span class="t">        <span class="nam">i0</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1397" href="#t1397">1397</a></span><span class="t">    <span class="nam">i1</span> <span class="op">=</span> <span class="nam">imax1</span><span class="op">+</span><span class="nam">n</span><span class="op">//</span><span class="num">2</span><span class="op">+</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1398" href="#t1398">1398</a></span><span class="t">    <span class="key">if</span> <span class="nam">i1</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod1</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1399" href="#t1399">1399</a></span><span class="t">        <span class="nam">i1</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1400" href="#t1400">1400</a></span><span class="t">    <span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">eod1</span><span class="op">[</span><span class="nam">imax1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1401" href="#t1401">1401</a></span><span class="t">    <span class="nam">eod1</span> <span class="op">=</span> <span class="nam">eod1</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">,</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1402" href="#t1402">1402</a></span><span class="t">    <span class="com"># normalize amplitude of first EOD:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1403" href="#t1403">1403</a></span><span class="t">    <span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">/=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1404" href="#t1404">1404</a></span><span class="t">    <span class="nam">sigma</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1405" href="#t1405">1405</a></span><span class="t">    <span class="com"># interpolate eod2 to the time base of eod1:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1406" href="#t1406">1406</a></span><span class="t">    <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">eod2</span><span class="op">[</span><span class="nam">imax2</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1407" href="#t1407">1407</a></span><span class="t">    <span class="nam">eod2w</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">interp</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1408" href="#t1408">1408</a></span><span class="t">    <span class="com"># normalize amplitude of second EOD:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1409" href="#t1409">1409</a></span><span class="t">    <span class="nam">eod2w</span> <span class="op">/=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">eod2w</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1410" href="#t1410">1410</a></span><span class="t">    <span class="com"># root-mean-square difference:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1411" href="#t1411">1411</a></span><span class="t">    <span class="nam">rmse1</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">eod2w</span><span class="op">)</span><span class="op">**</span><span class="num">2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">sigma</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1412" href="#t1412">1412</a></span><span class="t">    <span class="com"># root-mean-square difference of the flipped signal:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1413" href="#t1413">1413</a></span><span class="t">    <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">-=</span> <span class="nam">eod2</span><span class="op">[</span><span class="nam">imin2</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1414" href="#t1414">1414</a></span><span class="t">    <span class="nam">eod2w</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">interp</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="op">-</span><span class="nam">eod2</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1415" href="#t1415">1415</a></span><span class="t">    <span class="nam">eod2w</span> <span class="op">/=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">eod2w</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1416" href="#t1416">1416</a></span><span class="t">    <span class="nam">rmse2</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="op">(</span><span class="nam">eod1</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">eod2w</span><span class="op">)</span><span class="op">**</span><span class="num">2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">sigma</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1417" href="#t1417">1417</a></span><span class="t">    <span class="com"># take the smaller value:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1418" href="#t1418">1418</a></span><span class="t">    <span class="nam">rmse</span> <span class="op">=</span> <span class="nam">min</span><span class="op">(</span><span class="nam">rmse1</span><span class="op">,</span> <span class="nam">rmse2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1419" href="#t1419">1419</a></span><span class="t">    <span class="key">return</span> <span class="nam">rmse</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1420" href="#t1420">1420</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1421" href="#t1421">1421</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1422" href="#t1422">1422</a></span><span class="t"><span class="key">def</span> <span class="nam">clipped_fraction</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">eod_times</span><span class="op">,</span> <span class="nam">mean_eod</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1423" href="#t1423">1423</a></span><span class="t">                     <span class="nam">min_clip</span><span class="op">=</span><span class="op">-</span><span class="nam">np</span><span class="op">.</span><span class="nam">inf</span><span class="op">,</span> <span class="nam">max_clip</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">inf</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1424" href="#t1424">1424</a></span><span class="t">    <span class="str">"""Compute fraction of clipped EOD waveform snippets.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1425" href="#t1425">1425</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1426" href="#t1426">1426</a></span><span class="t"><span class="str">    Cut out snippets at each `eod_times` based on time axis of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1427" href="#t1427">1427</a></span><span class="t"><span class="str">    `mean_eod`.  Check which fraction of snippets exceeds clipping</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1428" href="#t1428">1428</a></span><span class="t"><span class="str">    amplitude `min_clip` and `max_clip`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1429" href="#t1429">1429</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1430" href="#t1430">1430</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1431" href="#t1431">1431</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1432" href="#t1432">1432</a></span><span class="t"><span class="str">    data: 1-D array of float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1433" href="#t1433">1433</a></span><span class="t"><span class="str">        The data to be analysed.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1434" href="#t1434">1434</a></span><span class="t"><span class="str">    rate: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1435" href="#t1435">1435</a></span><span class="t"><span class="str">        Sampling rate of the data in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1436" href="#t1436">1436</a></span><span class="t"><span class="str">    eod_times: 1-D array of float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1437" href="#t1437">1437</a></span><span class="t"><span class="str">        Array of EOD times in seconds.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1438" href="#t1438">1438</a></span><span class="t"><span class="str">    mean_eod: 2-D array with time, mean, sem, and fit.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1439" href="#t1439">1439</a></span><span class="t"><span class="str">        Averaged EOD waveform of wave fish. Only the time axis is used</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1440" href="#t1440">1440</a></span><span class="t"><span class="str">        to set width of snippets.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1441" href="#t1441">1441</a></span><span class="t"><span class="str">    min_clip: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1442" href="#t1442">1442</a></span><span class="t"><span class="str">        Minimum amplitude that is not clipped.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1443" href="#t1443">1443</a></span><span class="t"><span class="str">    max_clip: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1444" href="#t1444">1444</a></span><span class="t"><span class="str">        Maximum amplitude that is not clipped.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1445" href="#t1445">1445</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1446" href="#t1446">1446</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1447" href="#t1447">1447</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1448" href="#t1448">1448</a></span><span class="t"><span class="str">    clipped_frac: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1449" href="#t1449">1449</a></span><span class="t"><span class="str">        Fraction of snippets that are clipped.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1450" href="#t1450">1450</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1451" href="#t1451">1451</a></span><span class="t">    <span class="com"># snippets:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1452" href="#t1452">1452</a></span><span class="t">    <span class="nam">idx0</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="com"># index of time zero</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1453" href="#t1453">1453</a></span><span class="t">    <span class="nam">w0</span> <span class="op">=</span> <span class="op">-</span><span class="nam">idx0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1454" href="#t1454">1454</a></span><span class="t">    <span class="nam">w1</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="nam">idx0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1455" href="#t1455">1455</a></span><span class="t">    <span class="nam">eod_idx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="nam">eod_times</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span><span class="op">.</span><span class="nam">astype</span><span class="op">(</span><span class="nam">int</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1456" href="#t1456">1456</a></span><span class="t">    <span class="nam">eod_snippets</span> <span class="op">=</span> <span class="nam">snippets</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">eod_idx</span><span class="op">,</span> <span class="nam">w0</span><span class="op">,</span> <span class="nam">w1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1457" href="#t1457">1457</a></span><span class="t">    <span class="com"># fraction of clipped snippets:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1458" href="#t1458">1458</a></span><span class="t">    <span class="nam">clipped_frac</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">any</span><span class="op">(</span><span class="op">(</span><span class="nam">eod_snippets</span> <span class="op">></span> <span class="nam">max_clip</span><span class="op">)</span> <span class="op">|</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1459" href="#t1459">1459</a></span><span class="t">                                 <span class="op">(</span><span class="nam">eod_snippets</span> <span class="op">&lt;</span> <span class="nam">min_clip</span><span class="op">)</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">)</span><span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1460" href="#t1460">1460</a></span><span class="t">                   <span class="op">/</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_snippets</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1461" href="#t1461">1461</a></span><span class="t">    <span class="key">return</span> <span class="nam">clipped_frac</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1462" href="#t1462">1462</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1463" href="#t1463">1463</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1464" href="#t1464">1464</a></span><span class="t"><span class="key">def</span> <span class="nam">wave_quality</span><span class="op">(</span><span class="nam">props</span><span class="op">,</span> <span class="nam">harm_relampl</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">min_freq</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1465" href="#t1465">1465</a></span><span class="t">                 <span class="nam">max_freq</span><span class="op">=</span><span class="num">2000.0</span><span class="op">,</span> <span class="nam">max_clipped_frac</span><span class="op">=</span><span class="num">0.1</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1466" href="#t1466">1466</a></span><span class="t">                 <span class="nam">max_crossings</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="nam">max_rms_sem</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span> <span class="nam">max_rms_error</span><span class="op">=</span><span class="num">0.05</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1467" href="#t1467">1467</a></span><span class="t">                 <span class="nam">min_power</span><span class="op">=</span><span class="op">-</span><span class="num">100.0</span><span class="op">,</span> <span class="nam">max_thd</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span> <span class="nam">max_db_diff</span><span class="op">=</span><span class="num">20.0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1468" href="#t1468">1468</a></span><span class="t">                 <span class="nam">max_harmonics_db</span><span class="op">=</span><span class="op">-</span><span class="num">5.0</span><span class="op">,</span> <span class="nam">max_relampl_harm1</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1469" href="#t1469">1469</a></span><span class="t">                 <span class="nam">max_relampl_harm2</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span> <span class="nam">max_relampl_harm3</span><span class="op">=</span><span class="num">0.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1470" href="#t1470">1470</a></span><span class="t">    <span class="str">"""Assess the quality of an EOD waveform of a wave fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1471" href="#t1471">1471</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1472" href="#t1472">1472</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1473" href="#t1473">1473</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1474" href="#t1474">1474</a></span><span class="t"><span class="str">    props: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1475" href="#t1475">1475</a></span><span class="t"><span class="str">        A dictionary with properties of the analyzed EOD waveform</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1476" href="#t1476">1476</a></span><span class="t"><span class="str">        as returned by `analyze_wave()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1477" href="#t1477">1477</a></span><span class="t"><span class="str">    harm_relampl: 1-D array of floats or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1478" href="#t1478">1478</a></span><span class="t"><span class="str">        Relative amplitude of at least the first 3 harmonics without</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1479" href="#t1479">1479</a></span><span class="t"><span class="str">        the fundamental.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1480" href="#t1480">1480</a></span><span class="t"><span class="str">    min_freq: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1481" href="#t1481">1481</a></span><span class="t"><span class="str">        Minimum EOD frequency (`props['EODf']`).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1482" href="#t1482">1482</a></span><span class="t"><span class="str">    max_freq: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1483" href="#t1483">1483</a></span><span class="t"><span class="str">        Maximum EOD frequency (`props['EODf']`).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1484" href="#t1484">1484</a></span><span class="t"><span class="str">    max_clipped_frac: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1485" href="#t1485">1485</a></span><span class="t"><span class="str">        If larger than zero, maximum allowed fraction of clipped data</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1486" href="#t1486">1486</a></span><span class="t"><span class="str">        (`props['clipped']`).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1487" href="#t1487">1487</a></span><span class="t"><span class="str">    max_crossings: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1488" href="#t1488">1488</a></span><span class="t"><span class="str">        If larger than zero, maximum number of zero crossings per EOD period</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1489" href="#t1489">1489</a></span><span class="t"><span class="str">        (`props['ncrossings']`).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1490" href="#t1490">1490</a></span><span class="t"><span class="str">    max_rms_sem: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1491" href="#t1491">1491</a></span><span class="t"><span class="str">        If larger than zero, maximum allowed standard error of the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1492" href="#t1492">1492</a></span><span class="t"><span class="str">        data relative to p-p amplitude (`props['noise']`).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1493" href="#t1493">1493</a></span><span class="t"><span class="str">    max_rms_error: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1494" href="#t1494">1494</a></span><span class="t"><span class="str">        If larger than zero, maximum allowed root-mean-square error</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1495" href="#t1495">1495</a></span><span class="t"><span class="str">        between EOD waveform and Fourier fit relative to p-p amplitude</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1496" href="#t1496">1496</a></span><span class="t"><span class="str">        (`props['rmserror']`).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1497" href="#t1497">1497</a></span><span class="t"><span class="str">    min_power: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1498" href="#t1498">1498</a></span><span class="t"><span class="str">        Minimum power of the EOD in dB (`props['power']`).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1499" href="#t1499">1499</a></span><span class="t"><span class="str">    max_thd: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1500" href="#t1500">1500</a></span><span class="t"><span class="str">        If larger than zero, then maximum total harmonic distortion</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1501" href="#t1501">1501</a></span><span class="t"><span class="str">        (`props['thd']`).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1502" href="#t1502">1502</a></span><span class="t"><span class="str">    max_db_diff: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1503" href="#t1503">1503</a></span><span class="t"><span class="str">        If larger than zero, maximum standard deviation of differences between</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1504" href="#t1504">1504</a></span><span class="t"><span class="str">        logarithmic powers of harmonics in decibel (`props['dbdiff']`).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1505" href="#t1505">1505</a></span><span class="t"><span class="str">        Low values enforce smoother power spectra.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1506" href="#t1506">1506</a></span><span class="t"><span class="str">    max_harmonics_db:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1507" href="#t1507">1507</a></span><span class="t"><span class="str">        Maximum power of higher harmonics relative to peak power in</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1508" href="#t1508">1508</a></span><span class="t"><span class="str">        decibel (`props['maxdb']`).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1509" href="#t1509">1509</a></span><span class="t"><span class="str">    max_relampl_harm1: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1510" href="#t1510">1510</a></span><span class="t"><span class="str">        If larger than zero, maximum allowed amplitude of first harmonic</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1511" href="#t1511">1511</a></span><span class="t"><span class="str">        relative to fundamental.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1512" href="#t1512">1512</a></span><span class="t"><span class="str">    max_relampl_harm2: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1513" href="#t1513">1513</a></span><span class="t"><span class="str">        If larger than zero, maximum allowed amplitude of second harmonic</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1514" href="#t1514">1514</a></span><span class="t"><span class="str">        relative to fundamental.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1515" href="#t1515">1515</a></span><span class="t"><span class="str">    max_relampl_harm3: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1516" href="#t1516">1516</a></span><span class="t"><span class="str">        If larger than zero, maximum allowed amplitude of third harmonic</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1517" href="#t1517">1517</a></span><span class="t"><span class="str">        relative to fundamental.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1518" href="#t1518">1518</a></span><span class="t"><span class="str">                                       </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1519" href="#t1519">1519</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1520" href="#t1520">1520</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1521" href="#t1521">1521</a></span><span class="t"><span class="str">    remove: bool</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1522" href="#t1522">1522</a></span><span class="t"><span class="str">        If True then this is most likely not an electric fish. Remove</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1523" href="#t1523">1523</a></span><span class="t"><span class="str">        it from both the waveform properties and the list of EOD</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1524" href="#t1524">1524</a></span><span class="t"><span class="str">        frequencies.  If False, keep it in the list of EOD</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1525" href="#t1525">1525</a></span><span class="t"><span class="str">        frequencies, but remove it from the waveform properties if</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1526" href="#t1526">1526</a></span><span class="t"><span class="str">        `skip_reason` is not empty.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1527" href="#t1527">1527</a></span><span class="t"><span class="str">    skip_reason: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1528" href="#t1528">1528</a></span><span class="t"><span class="str">        An empty string if the waveform is good, otherwise a string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1529" href="#t1529">1529</a></span><span class="t"><span class="str">        indicating the failure.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1530" href="#t1530">1530</a></span><span class="t"><span class="str">    msg: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1531" href="#t1531">1531</a></span><span class="t"><span class="str">        A textual representation of the values tested.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1532" href="#t1532">1532</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1533" href="#t1533">1533</a></span><span class="t">    <span class="nam">remove</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1534" href="#t1534">1534</a></span><span class="t">    <span class="nam">msg</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1535" href="#t1535">1535</a></span><span class="t">    <span class="nam">skip_reason</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1536" href="#t1536">1536</a></span><span class="t">    <span class="com"># EOD frequency:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1537" href="#t1537">1537</a></span><span class="t">    <span class="key">if</span> <span class="str">'EODf'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1538" href="#t1538">1538</a></span><span class="t">        <span class="nam">eodf</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'EODf'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1539" href="#t1539">1539</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'EODf=%5.1fHz'</span> <span class="op">%</span> <span class="nam">eodf</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1540" href="#t1540">1540</a></span><span class="t">        <span class="key">if</span> <span class="nam">eodf</span> <span class="op">&lt;</span> <span class="nam">min_freq</span> <span class="key">or</span> <span class="nam">eodf</span> <span class="op">></span> <span class="nam">max_freq</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1541" href="#t1541">1541</a></span><span class="t">            <span class="nam">remove</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1542" href="#t1542">1542</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'invalid EODf=%5.1fHz (minimumFrequency=%5.1fHz, maximumFrequency=%5.1f))'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1543" href="#t1543">1543</a></span><span class="t">                            <span class="op">(</span><span class="nam">eodf</span><span class="op">,</span> <span class="nam">min_freq</span><span class="op">,</span> <span class="nam">max_freq</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1544" href="#t1544">1544</a></span><span class="t">    <span class="com"># clipped fraction:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1545" href="#t1545">1545</a></span><span class="t">    <span class="key">if</span> <span class="str">'clipped'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1546" href="#t1546">1546</a></span><span class="t">        <span class="nam">clipped_frac</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'clipped'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1547" href="#t1547">1547</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'clipped=%3.0f%%'</span> <span class="op">%</span> <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">clipped_frac</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1548" href="#t1548">1548</a></span><span class="t">        <span class="key">if</span> <span class="nam">max_clipped_frac</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="nam">clipped_frac</span> <span class="op">>=</span> <span class="nam">max_clipped_frac</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1549" href="#t1549">1549</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'clipped=%3.0f%% (maximumClippedFraction=%3.0f%%)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1550" href="#t1550">1550</a></span><span class="t">                            <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">clipped_frac</span><span class="op">,</span> <span class="num">100.0</span><span class="op">*</span><span class="nam">max_clipped_frac</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1551" href="#t1551">1551</a></span><span class="t">    <span class="com"># too many zero crossings:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1552" href="#t1552">1552</a></span><span class="t">    <span class="key">if</span> <span class="str">'ncrossings'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1553" href="#t1553">1553</a></span><span class="t">        <span class="nam">ncrossings</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'ncrossings'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1554" href="#t1554">1554</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'zero crossings=%d'</span> <span class="op">%</span> <span class="nam">ncrossings</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1555" href="#t1555">1555</a></span><span class="t">        <span class="key">if</span> <span class="nam">max_crossings</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="nam">ncrossings</span> <span class="op">></span> <span class="nam">max_crossings</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1556" href="#t1556">1556</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'too many zero crossings=%d (maximumCrossings=%d)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1557" href="#t1557">1557</a></span><span class="t">                            <span class="op">(</span><span class="nam">ncrossings</span><span class="op">,</span> <span class="nam">max_crossings</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1558" href="#t1558">1558</a></span><span class="t">    <span class="com"># noise:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1559" href="#t1559">1559</a></span><span class="t">    <span class="nam">rms_sem</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1560" href="#t1560">1560</a></span><span class="t">    <span class="key">if</span> <span class="str">'rmssem'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1561" href="#t1561">1561</a></span><span class="t">        <span class="nam">rms_sem</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'rmssem'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1562" href="#t1562">1562</a></span><span class="t">    <span class="key">if</span> <span class="str">'noise'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1563" href="#t1563">1563</a></span><span class="t">        <span class="nam">rms_sem</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'noise'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1564" href="#t1564">1564</a></span><span class="t">    <span class="key">if</span> <span class="nam">rms_sem</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1565" href="#t1565">1565</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'rms sem waveform=%6.2f%%'</span> <span class="op">%</span> <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">rms_sem</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1566" href="#t1566">1566</a></span><span class="t">        <span class="key">if</span> <span class="nam">max_rms_sem</span> <span class="op">></span> <span class="num">0.0</span> <span class="key">and</span> <span class="nam">rms_sem</span> <span class="op">>=</span> <span class="nam">max_rms_sem</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1567" href="#t1567">1567</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'noisy waveform s.e.m.=%6.2f%% (max %6.2f%%)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1568" href="#t1568">1568</a></span><span class="t">                            <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">rms_sem</span><span class="op">,</span> <span class="num">100.0</span><span class="op">*</span><span class="nam">max_rms_sem</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1569" href="#t1569">1569</a></span><span class="t">    <span class="com"># fit error:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1570" href="#t1570">1570</a></span><span class="t">    <span class="key">if</span> <span class="str">'rmserror'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1571" href="#t1571">1571</a></span><span class="t">        <span class="nam">rms_error</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'rmserror'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1572" href="#t1572">1572</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'rmserror=%6.2f%%'</span> <span class="op">%</span> <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">rms_error</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1573" href="#t1573">1573</a></span><span class="t">        <span class="key">if</span> <span class="nam">max_rms_error</span> <span class="op">></span> <span class="num">0.0</span> <span class="key">and</span> <span class="nam">rms_error</span> <span class="op">>=</span> <span class="nam">max_rms_error</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1574" href="#t1574">1574</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'noisy rmserror=%6.2f%% (maximumVariance=%6.2f%%)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1575" href="#t1575">1575</a></span><span class="t">                            <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">rms_error</span><span class="op">,</span> <span class="num">100.0</span><span class="op">*</span><span class="nam">max_rms_error</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1576" href="#t1576">1576</a></span><span class="t">    <span class="com"># wave power:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1577" href="#t1577">1577</a></span><span class="t">    <span class="key">if</span> <span class="str">'power'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1578" href="#t1578">1578</a></span><span class="t">        <span class="nam">power</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'power'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1579" href="#t1579">1579</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'power=%6.1fdB'</span> <span class="op">%</span> <span class="nam">power</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1580" href="#t1580">1580</a></span><span class="t">        <span class="key">if</span> <span class="nam">power</span> <span class="op">&lt;</span> <span class="nam">min_power</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1581" href="#t1581">1581</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'small power=%6.1fdB (minimumPower=%6.1fdB)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1582" href="#t1582">1582</a></span><span class="t">                            <span class="op">(</span><span class="nam">power</span><span class="op">,</span> <span class="nam">min_power</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1583" href="#t1583">1583</a></span><span class="t">    <span class="com"># total harmonic distortion:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1584" href="#t1584">1584</a></span><span class="t">    <span class="key">if</span> <span class="str">'thd'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1585" href="#t1585">1585</a></span><span class="t">        <span class="nam">thd</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'thd'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1586" href="#t1586">1586</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'thd=%5.1f%%'</span> <span class="op">%</span> <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">thd</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1587" href="#t1587">1587</a></span><span class="t">        <span class="key">if</span> <span class="nam">max_thd</span> <span class="op">></span> <span class="num">0.0</span> <span class="key">and</span> <span class="nam">thd</span> <span class="op">></span> <span class="nam">max_thd</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1588" href="#t1588">1588</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'large THD=%5.1f%% (maxximumTotalHarmonicDistortion=%5.1f%%)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1589" href="#t1589">1589</a></span><span class="t">                            <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">thd</span><span class="op">,</span> <span class="num">100.0</span><span class="op">*</span><span class="nam">max_thd</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1590" href="#t1590">1590</a></span><span class="t">    <span class="com"># smoothness of spectrum:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1591" href="#t1591">1591</a></span><span class="t">    <span class="key">if</span> <span class="str">'dbdiff'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1592" href="#t1592">1592</a></span><span class="t">        <span class="nam">db_diff</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'dbdiff'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1593" href="#t1593">1593</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'dBdiff=%5.1fdB'</span> <span class="op">%</span> <span class="nam">db_diff</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1594" href="#t1594">1594</a></span><span class="t">        <span class="key">if</span> <span class="nam">max_db_diff</span> <span class="op">></span> <span class="num">0.0</span> <span class="key">and</span> <span class="nam">db_diff</span> <span class="op">></span> <span class="nam">max_db_diff</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1595" href="#t1595">1595</a></span><span class="t">            <span class="nam">remove</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1596" href="#t1596">1596</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'not smooth s.d. diff=%5.1fdB (maxximumPowerDifference=%5.1fdB)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1597" href="#t1597">1597</a></span><span class="t">                            <span class="op">(</span><span class="nam">db_diff</span><span class="op">,</span> <span class="nam">max_db_diff</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1598" href="#t1598">1598</a></span><span class="t">    <span class="com"># maximum power of higher harmonics:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1599" href="#t1599">1599</a></span><span class="t">    <span class="key">if</span> <span class="str">'maxdb'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1600" href="#t1600">1600</a></span><span class="t">        <span class="nam">max_harmonics</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'maxdb'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1601" href="#t1601">1601</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'max harmonics=%5.1fdB'</span> <span class="op">%</span> <span class="nam">max_harmonics</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1602" href="#t1602">1602</a></span><span class="t">        <span class="key">if</span> <span class="nam">max_harmonics</span> <span class="op">></span> <span class="nam">max_harmonics_db</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1603" href="#t1603">1603</a></span><span class="t">            <span class="nam">remove</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1604" href="#t1604">1604</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'maximum harmonics=%5.1fdB too strong (maximumHarmonicsPower=%5.1fdB)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1605" href="#t1605">1605</a></span><span class="t">                            <span class="op">(</span><span class="nam">max_harmonics</span><span class="op">,</span> <span class="nam">max_harmonics_db</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1606" href="#t1606">1606</a></span><span class="t">    <span class="com"># relative amplitude of harmonics:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1607" href="#t1607">1607</a></span><span class="t">    <span class="key">if</span> <span class="nam">harm_relampl</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1608" href="#t1608">1608</a></span><span class="t">        <span class="key">for</span> <span class="nam">k</span><span class="op">,</span> <span class="nam">max_relampl</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="op">[</span><span class="nam">max_relampl_harm1</span><span class="op">,</span> <span class="nam">max_relampl_harm2</span><span class="op">,</span> <span class="nam">max_relampl_harm3</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1609" href="#t1609">1609</a></span><span class="t">            <span class="key">if</span> <span class="nam">k</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">harm_relampl</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1610" href="#t1610">1610</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1611" href="#t1611">1611</a></span><span class="t">            <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'ampl%d=%5.1f%%'</span> <span class="op">%</span> <span class="op">(</span><span class="nam">k</span><span class="op">+</span><span class="num">1</span><span class="op">,</span> <span class="num">100.0</span><span class="op">*</span><span class="nam">harm_relampl</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1612" href="#t1612">1612</a></span><span class="t">            <span class="key">if</span> <span class="nam">max_relampl</span> <span class="op">></span> <span class="num">0.0</span> <span class="key">and</span> <span class="nam">k</span> <span class="op">&lt;</span> <span class="nam">len</span><span class="op">(</span><span class="nam">harm_relampl</span><span class="op">)</span> <span class="key">and</span> <span class="nam">harm_relampl</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span> <span class="op">>=</span> <span class="nam">max_relampl</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1613" href="#t1613">1613</a></span><span class="t">                <span class="nam">num_str</span> <span class="op">=</span> <span class="op">[</span><span class="str">'First'</span><span class="op">,</span> <span class="str">'Second'</span><span class="op">,</span> <span class="str">'Third'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1614" href="#t1614">1614</a></span><span class="t">                <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'distorted ampl%d=%5.1f%% (maximum%sHarmonicAmplitude=%5.1f%%)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1615" href="#t1615">1615</a></span><span class="t">                                <span class="op">(</span><span class="nam">k</span><span class="op">+</span><span class="num">1</span><span class="op">,</span> <span class="num">100.0</span><span class="op">*</span><span class="nam">harm_relampl</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span><span class="op">,</span> <span class="nam">num_str</span><span class="op">[</span><span class="nam">k</span><span class="op">]</span><span class="op">,</span> <span class="num">100.0</span><span class="op">*</span><span class="nam">max_relampl</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1616" href="#t1616">1616</a></span><span class="t">    <span class="key">return</span> <span class="nam">remove</span><span class="op">,</span> <span class="str">', '</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">skip_reason</span><span class="op">)</span><span class="op">,</span> <span class="str">', '</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">msg</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1617" href="#t1617">1617</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1618" href="#t1618">1618</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1619" href="#t1619">1619</a></span><span class="t"><span class="key">def</span> <span class="nam">pulse_quality</span><span class="op">(</span><span class="nam">props</span><span class="op">,</span> <span class="nam">max_clipped_frac</span><span class="op">=</span><span class="num">0.1</span><span class="op">,</span> <span class="nam">max_rms_sem</span><span class="op">=</span><span class="num">0.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1620" href="#t1620">1620</a></span><span class="t">    <span class="str">"""Assess the quality of an EOD waveform of a pulse fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1621" href="#t1621">1621</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1622" href="#t1622">1622</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1623" href="#t1623">1623</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1624" href="#t1624">1624</a></span><span class="t"><span class="str">    props: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1625" href="#t1625">1625</a></span><span class="t"><span class="str">        A dictionary with properties of the analyzed EOD waveform</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1626" href="#t1626">1626</a></span><span class="t"><span class="str">        as returned by `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1627" href="#t1627">1627</a></span><span class="t"><span class="str">    max_clipped_frac: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1628" href="#t1628">1628</a></span><span class="t"><span class="str">        Maximum allowed fraction of clipped data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1629" href="#t1629">1629</a></span><span class="t"><span class="str">    max_rms_sem: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1630" href="#t1630">1630</a></span><span class="t"><span class="str">        If not zero, maximum allowed standard error of the data</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1631" href="#t1631">1631</a></span><span class="t"><span class="str">        relative to p-p amplitude.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1632" href="#t1632">1632</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1633" href="#t1633">1633</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1634" href="#t1634">1634</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1635" href="#t1635">1635</a></span><span class="t"><span class="str">    skip_reason: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1636" href="#t1636">1636</a></span><span class="t"><span class="str">        An empty string if the waveform is good, otherwise a string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1637" href="#t1637">1637</a></span><span class="t"><span class="str">        indicating the failure.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1638" href="#t1638">1638</a></span><span class="t"><span class="str">    msg: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1639" href="#t1639">1639</a></span><span class="t"><span class="str">        A textual representation of the values tested.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1640" href="#t1640">1640</a></span><span class="t"><span class="str">    skipped_clipped: bool</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1641" href="#t1641">1641</a></span><span class="t"><span class="str">        True if waveform was skipped because of clipping.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1642" href="#t1642">1642</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1643" href="#t1643">1643</a></span><span class="t">    <span class="nam">msg</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1644" href="#t1644">1644</a></span><span class="t">    <span class="nam">skip_reason</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1645" href="#t1645">1645</a></span><span class="t">    <span class="nam">skipped_clipped</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1646" href="#t1646">1646</a></span><span class="t">    <span class="com"># clipped fraction:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1647" href="#t1647">1647</a></span><span class="t">    <span class="key">if</span> <span class="str">'clipped'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1648" href="#t1648">1648</a></span><span class="t">        <span class="nam">clipped_frac</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'clipped'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1649" href="#t1649">1649</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'clipped=%3.0f%%'</span> <span class="op">%</span> <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">clipped_frac</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1650" href="#t1650">1650</a></span><span class="t">        <span class="key">if</span> <span class="nam">clipped_frac</span> <span class="op">>=</span> <span class="nam">max_clipped_frac</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1651" href="#t1651">1651</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'clipped=%3.0f%% (maximumClippedFraction=%3.0f%%)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1652" href="#t1652">1652</a></span><span class="t">                            <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">clipped_frac</span><span class="op">,</span> <span class="num">100.0</span><span class="op">*</span><span class="nam">max_clipped_frac</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1653" href="#t1653">1653</a></span><span class="t">            <span class="nam">skipped_clipped</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1654" href="#t1654">1654</a></span><span class="t">    <span class="com"># noise:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1655" href="#t1655">1655</a></span><span class="t">    <span class="nam">rms_sem</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1656" href="#t1656">1656</a></span><span class="t">    <span class="key">if</span> <span class="str">'rmssem'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1657" href="#t1657">1657</a></span><span class="t">        <span class="nam">rms_sem</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'rmssem'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1658" href="#t1658">1658</a></span><span class="t">    <span class="key">if</span> <span class="str">'noise'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1659" href="#t1659">1659</a></span><span class="t">        <span class="nam">rms_sem</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'noise'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1660" href="#t1660">1660</a></span><span class="t">    <span class="key">if</span> <span class="nam">rms_sem</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1661" href="#t1661">1661</a></span><span class="t">        <span class="nam">msg</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'rms sem waveform=%6.2f%%'</span> <span class="op">%</span> <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">rms_sem</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1662" href="#t1662">1662</a></span><span class="t">        <span class="key">if</span> <span class="nam">max_rms_sem</span> <span class="op">></span> <span class="num">0.0</span> <span class="key">and</span> <span class="nam">rms_sem</span> <span class="op">>=</span> <span class="nam">max_rms_sem</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1663" href="#t1663">1663</a></span><span class="t">            <span class="nam">skip_reason</span> <span class="op">+=</span> <span class="op">[</span><span class="str">'noisy waveform s.e.m.=%6.2f%% (maximumRMSNoise=%6.2f%%)'</span> <span class="op">%</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1664" href="#t1664">1664</a></span><span class="t">                            <span class="op">(</span><span class="num">100.0</span><span class="op">*</span><span class="nam">rms_sem</span><span class="op">,</span> <span class="num">100.0</span><span class="op">*</span><span class="nam">max_rms_sem</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1665" href="#t1665">1665</a></span><span class="t">    <span class="key">return</span> <span class="str">', '</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">skip_reason</span><span class="op">)</span><span class="op">,</span> <span class="str">', '</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">msg</span><span class="op">)</span><span class="op">,</span> <span class="nam">skipped_clipped</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1666" href="#t1666">1666</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1667" href="#t1667">1667</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1668" href="#t1668">1668</a></span><span class="t"><span class="key">def</span> <span class="nam">plot_eod_recording</span><span class="op">(</span><span class="nam">ax</span><span class="op">,</span> <span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">unit</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">width</span><span class="op">=</span><span class="num">0.1</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1669" href="#t1669">1669</a></span><span class="t">                       <span class="nam">toffs</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span> <span class="nam">pstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">lw</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'tab:red'</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1670" href="#t1670">1670</a></span><span class="t">    <span class="str">"""Plot a zoomed in range of the recorded trace.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1671" href="#t1671">1671</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1672" href="#t1672">1672</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1673" href="#t1673">1673</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1674" href="#t1674">1674</a></span><span class="t"><span class="str">    ax: matplotlib axes</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1675" href="#t1675">1675</a></span><span class="t"><span class="str">        Axes used for plotting.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1676" href="#t1676">1676</a></span><span class="t"><span class="str">    data: 1D ndarray</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1677" href="#t1677">1677</a></span><span class="t"><span class="str">        Recorded data to be plotted.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1678" href="#t1678">1678</a></span><span class="t"><span class="str">    rate: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1679" href="#t1679">1679</a></span><span class="t"><span class="str">        Sampling rate of the data in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1680" href="#t1680">1680</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1681" href="#t1681">1681</a></span><span class="t"><span class="str">        Optional unit of the data used for y-label.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1682" href="#t1682">1682</a></span><span class="t"><span class="str">    width: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1683" href="#t1683">1683</a></span><span class="t"><span class="str">        Width of data segment to be plotted in seconds.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1684" href="#t1684">1684</a></span><span class="t"><span class="str">    toffs: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1685" href="#t1685">1685</a></span><span class="t"><span class="str">        Time of first data value in seconds.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1686" href="#t1686">1686</a></span><span class="t"><span class="str">    pstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1687" href="#t1687">1687</a></span><span class="t"><span class="str">        Arguments passed on to the plot command for the recorded trace.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1688" href="#t1688">1688</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1689" href="#t1689">1689</a></span><span class="t">    <span class="nam">widx2</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">width</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span><span class="op">//</span><span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1690" href="#t1690">1690</a></span><span class="t">    <span class="nam">i0</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">//</span><span class="num">2</span> <span class="op">-</span> <span class="nam">widx2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1691" href="#t1691">1691</a></span><span class="t">    <span class="nam">i0</span> <span class="op">=</span> <span class="op">(</span><span class="nam">i0</span><span class="op">//</span><span class="nam">widx2</span><span class="op">)</span><span class="op">*</span><span class="nam">widx2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1692" href="#t1692">1692</a></span><span class="t">    <span class="nam">i1</span> <span class="op">=</span> <span class="nam">i0</span> <span class="op">+</span> <span class="num">2</span><span class="op">*</span><span class="nam">widx2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1693" href="#t1693">1693</a></span><span class="t">    <span class="key">if</span> <span class="nam">i0</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1694" href="#t1694">1694</a></span><span class="t">        <span class="nam">i0</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1695" href="#t1695">1695</a></span><span class="t">    <span class="key">if</span> <span class="nam">i1</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1696" href="#t1696">1696</a></span><span class="t">        <span class="nam">i1</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1697" href="#t1697">1697</a></span><span class="t">    <span class="nam">time</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="nam">rate</span> <span class="op">+</span> <span class="nam">toffs</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1698" href="#t1698">1698</a></span><span class="t">    <span class="nam">tunit</span> <span class="op">=</span> <span class="str">'sec'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1699" href="#t1699">1699</a></span><span class="t">    <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">time</span><span class="op">[</span><span class="nam">i0</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">1.0</span> <span class="key">and</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">time</span><span class="op">[</span><span class="nam">i1</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">1.0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1700" href="#t1700">1700</a></span><span class="t">        <span class="nam">time</span> <span class="op">*=</span> <span class="num">1000.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1701" href="#t1701">1701</a></span><span class="t">        <span class="nam">tunit</span> <span class="op">=</span> <span class="str">'ms'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1702" href="#t1702">1702</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">time</span><span class="op">,</span> <span class="nam">data</span><span class="op">,</span> <span class="op">**</span><span class="nam">pstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1703" href="#t1703">1703</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">set_xlim</span><span class="op">(</span><span class="nam">time</span><span class="op">[</span><span class="nam">i0</span><span class="op">]</span><span class="op">,</span> <span class="nam">time</span><span class="op">[</span><span class="nam">i1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1704" href="#t1704">1704</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1705" href="#t1705">1705</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">set_xlabel</span><span class="op">(</span><span class="str">'Time [%s]'</span> <span class="op">%</span> <span class="nam">tunit</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1706" href="#t1706">1706</a></span><span class="t">    <span class="nam">ymin</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">data</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1707" href="#t1707">1707</a></span><span class="t">    <span class="nam">ymax</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">data</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1708" href="#t1708">1708</a></span><span class="t">    <span class="nam">dy</span> <span class="op">=</span> <span class="nam">ymax</span> <span class="op">-</span> <span class="nam">ymin</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1709" href="#t1709">1709</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">set_ylim</span><span class="op">(</span><span class="nam">ymin</span><span class="op">-</span><span class="num">0.05</span><span class="op">*</span><span class="nam">dy</span><span class="op">,</span> <span class="nam">ymax</span><span class="op">+</span><span class="num">0.05</span><span class="op">*</span><span class="nam">dy</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1710" href="#t1710">1710</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">unit</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span> <span class="key">or</span> <span class="nam">unit</span> <span class="op">==</span> <span class="str">'a.u.'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1711" href="#t1711">1711</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">set_ylabel</span><span class="op">(</span><span class="str">'Amplitude'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1712" href="#t1712">1712</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1713" href="#t1713">1713</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">set_ylabel</span><span class="op">(</span><span class="str">'Amplitude [%s]'</span> <span class="op">%</span> <span class="nam">unit</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1714" href="#t1714">1714</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1715" href="#t1715">1715</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1716" href="#t1716">1716</a></span><span class="t"><span class="key">def</span> <span class="nam">plot_pulse_eods</span><span class="op">(</span><span class="nam">ax</span><span class="op">,</span> <span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">zoom_window</span><span class="op">,</span> <span class="nam">width</span><span class="op">,</span> <span class="nam">eod_props</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1717" href="#t1717">1717</a></span><span class="t">                    <span class="nam">toffs</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span> <span class="nam">colors</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">markers</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">marker_size</span><span class="op">=</span><span class="num">10</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1718" href="#t1718">1718</a></span><span class="t">                    <span class="nam">legend_rows</span><span class="op">=</span><span class="num">8</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1719" href="#t1719">1719</a></span><span class="t">    <span class="str">"""Mark pulse EODs in a plot of an EOD recording.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1720" href="#t1720">1720</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1721" href="#t1721">1721</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1722" href="#t1722">1722</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1723" href="#t1723">1723</a></span><span class="t"><span class="str">    ax: matplotlib axes</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1724" href="#t1724">1724</a></span><span class="t"><span class="str">        Axes used for plotting.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1725" href="#t1725">1725</a></span><span class="t"><span class="str">    data: 1D ndarray</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1726" href="#t1726">1726</a></span><span class="t"><span class="str">        Recorded data (these are not plotted!).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1727" href="#t1727">1727</a></span><span class="t"><span class="str">    rate: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1728" href="#t1728">1728</a></span><span class="t"><span class="str">        Sampling rate of the data in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1729" href="#t1729">1729</a></span><span class="t"><span class="str">    zoom_window: tuple of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1730" href="#t1730">1730</a></span><span class="t"><span class="str">       Start and end time of the data to be plotted in seconds.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1731" href="#t1731">1731</a></span><span class="t"><span class="str">    width: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1732" href="#t1732">1732</a></span><span class="t"><span class="str">       Minimum width of the data to be plotted in seconds.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1733" href="#t1733">1733</a></span><span class="t"><span class="str">    eod_props: list of dictionaries</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1734" href="#t1734">1734</a></span><span class="t"><span class="str">            Lists of EOD properties as returned by `analyze_pulse()`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1735" href="#t1735">1735</a></span><span class="t"><span class="str">            and `analyze_wave()`.  From the entries with 'type' ==</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1736" href="#t1736">1736</a></span><span class="t"><span class="str">            'pulse' the properties 'EODf' and 'times' are used. 'EODf'</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1737" href="#t1737">1737</a></span><span class="t"><span class="str">            is the averaged EOD frequency, and 'times' is a list of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1738" href="#t1738">1738</a></span><span class="t"><span class="str">            detected EOD pulse times.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1739" href="#t1739">1739</a></span><span class="t"><span class="str">    toffs: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1740" href="#t1740">1740</a></span><span class="t"><span class="str">        Time of first data value in seconds that will be added</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1741" href="#t1741">1741</a></span><span class="t"><span class="str">        to the pulse times in `eod_props`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1742" href="#t1742">1742</a></span><span class="t"><span class="str">    colors: list of colors or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1743" href="#t1743">1743</a></span><span class="t"><span class="str">            If not None list of colors for plotting each cluster</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1744" href="#t1744">1744</a></span><span class="t"><span class="str">    markers: list of markers or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1745" href="#t1745">1745</a></span><span class="t"><span class="str">            If not None list of markers for plotting each cluster</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1746" href="#t1746">1746</a></span><span class="t"><span class="str">    marker_size: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1747" href="#t1747">1747</a></span><span class="t"><span class="str">            Size of markers used to mark the pulses.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1748" href="#t1748">1748</a></span><span class="t"><span class="str">    legend_rows: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1749" href="#t1749">1749</a></span><span class="t"><span class="str">            Maximum number of rows to be used for the legend.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1750" href="#t1750">1750</a></span><span class="t"><span class="str">    kwargs: </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1751" href="#t1751">1751</a></span><span class="t"><span class="str">            Key word arguments for the legend of the plot.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1752" href="#t1752">1752</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1753" href="#t1753">1753</a></span><span class="t">    <span class="nam">k</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1754" href="#t1754">1754</a></span><span class="t">    <span class="key">for</span> <span class="nam">eod</span> <span class="key">in</span> <span class="nam">eod_props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1755" href="#t1755">1755</a></span><span class="t">        <span class="key">if</span> <span class="nam">eod</span><span class="op">[</span><span class="str">'type'</span><span class="op">]</span> <span class="op">!=</span> <span class="str">'pulse'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1756" href="#t1756">1756</a></span><span class="t">            <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1757" href="#t1757">1757</a></span><span class="t">        <span class="key">if</span> <span class="str">'times'</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">eod</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1758" href="#t1758">1758</a></span><span class="t">            <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1759" href="#t1759">1759</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1760" href="#t1760">1760</a></span><span class="t">        <span class="nam">width</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="op">[</span><span class="nam">width</span><span class="op">,</span> <span class="nam">np</span><span class="op">.</span><span class="nam">diff</span><span class="op">(</span><span class="nam">zoom_window</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1761" href="#t1761">1761</a></span><span class="t">        <span class="key">while</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod</span><span class="op">[</span><span class="str">'peaktimes'</span><span class="op">]</span><span class="op">[</span><span class="op">(</span><span class="nam">eod</span><span class="op">[</span><span class="str">'peaktimes'</span><span class="op">]</span><span class="op">></span><span class="op">(</span><span class="nam">zoom_window</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="nam">width</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="nam">eod</span><span class="op">[</span><span class="str">'peaktimes'</span><span class="op">]</span><span class="op">&lt;</span><span class="op">(</span><span class="nam">zoom_window</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1762" href="#t1762">1762</a></span><span class="t">            <span class="nam">width</span> <span class="op">*=</span> <span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1763" href="#t1763">1763</a></span><span class="t">            <span class="key">if</span> <span class="nam">zoom_window</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">width</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1764" href="#t1764">1764</a></span><span class="t">                <span class="nam">width</span> <span class="op">=</span> <span class="nam">width</span><span class="op">/</span><span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1765" href="#t1765">1765</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1766" href="#t1766">1766</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1767" href="#t1767">1767</a></span><span class="t">        <span class="nam">x</span> <span class="op">=</span> <span class="nam">eod</span><span class="op">[</span><span class="str">'peaktimes'</span><span class="op">]</span> <span class="op">+</span> <span class="nam">toffs</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1768" href="#t1768">1768</a></span><span class="t">        <span class="nam">pidx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="nam">eod</span><span class="op">[</span><span class="str">'peaktimes'</span><span class="op">]</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span><span class="op">.</span><span class="nam">astype</span><span class="op">(</span><span class="nam">int</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1769" href="#t1769">1769</a></span><span class="t">        <span class="nam">y</span> <span class="op">=</span> <span class="nam">data</span><span class="op">[</span><span class="nam">pidx</span><span class="op">[</span><span class="op">(</span><span class="nam">pidx</span><span class="op">></span><span class="num">0</span><span class="op">)</span><span class="op">&amp;</span><span class="op">(</span><span class="nam">pidx</span><span class="op">&lt;</span><span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1770" href="#t1770">1770</a></span><span class="t">        <span class="nam">x</span> <span class="op">=</span> <span class="nam">x</span><span class="op">[</span><span class="op">(</span><span class="nam">pidx</span><span class="op">></span><span class="num">0</span><span class="op">)</span><span class="op">&amp;</span><span class="op">(</span><span class="nam">pidx</span><span class="op">&lt;</span><span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1771" href="#t1771">1771</a></span><span class="t">        <span class="nam">color_kwargs</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1772" href="#t1772">1772</a></span><span class="t">        <span class="com">#if colors is not None:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1773" href="#t1773">1773</a></span><span class="t">        <span class="com">#    color_kwargs['color'] = colors[k%len(colors)]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1774" href="#t1774">1774</a></span><span class="t">        <span class="key">if</span> <span class="nam">marker_size</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1775" href="#t1775">1775</a></span><span class="t">            <span class="nam">color_kwargs</span><span class="op">[</span><span class="str">'ms'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">marker_size</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1776" href="#t1776">1776</a></span><span class="t">        <span class="nam">label</span> <span class="op">=</span> <span class="str">'%6.1f Hz'</span> <span class="op">%</span> <span class="nam">eod</span><span class="op">[</span><span class="str">'EODf'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1777" href="#t1777">1777</a></span><span class="t">        <span class="key">if</span> <span class="nam">legend_rows</span> <span class="op">></span> <span class="num">5</span> <span class="key">and</span> <span class="nam">k</span> <span class="op">>=</span> <span class="nam">legend_rows</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1778" href="#t1778">1778</a></span><span class="t">            <span class="nam">label</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1779" href="#t1779">1779</a></span><span class="t">        <span class="key">if</span> <span class="nam">markers</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1780" href="#t1780">1780</a></span><span class="t">            <span class="nam">ax</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">x</span><span class="op">,</span> <span class="nam">y</span><span class="op">,</span> <span class="str">'o'</span><span class="op">,</span> <span class="nam">label</span><span class="op">=</span><span class="nam">label</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">,</span> <span class="op">**</span><span class="nam">color_kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1781" href="#t1781">1781</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1782" href="#t1782">1782</a></span><span class="t">            <span class="nam">ax</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">x</span><span class="op">,</span> <span class="nam">y</span><span class="op">,</span> <span class="nam">linestyle</span><span class="op">=</span><span class="str">'none'</span><span class="op">,</span> <span class="nam">label</span><span class="op">=</span><span class="nam">label</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1783" href="#t1783">1783</a></span><span class="t">                    <span class="nam">marker</span><span class="op">=</span><span class="nam">markers</span><span class="op">[</span><span class="nam">k</span><span class="op">%</span><span class="nam">len</span><span class="op">(</span><span class="nam">markers</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">mec</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">mew</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1784" href="#t1784">1784</a></span><span class="t">                    <span class="nam">zorder</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">,</span> <span class="op">**</span><span class="nam">color_kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1785" href="#t1785">1785</a></span><span class="t">        <span class="nam">k</span> <span class="op">+=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1786" href="#t1786">1786</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1787" href="#t1787">1787</a></span><span class="t">    <span class="com"># legend:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1788" href="#t1788">1788</a></span><span class="t">    <span class="key">if</span> <span class="nam">k</span> <span class="op">></span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1789" href="#t1789">1789</a></span><span class="t">        <span class="key">if</span> <span class="nam">legend_rows</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1790" href="#t1790">1790</a></span><span class="t">            <span class="key">if</span> <span class="nam">legend_rows</span> <span class="op">></span> <span class="num">5</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1791" href="#t1791">1791</a></span><span class="t">                <span class="nam">ncol</span> <span class="op">=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1792" href="#t1792">1792</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1793" href="#t1793">1793</a></span><span class="t">                <span class="nam">ncol</span> <span class="op">=</span> <span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">idx</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">)</span> <span class="op">//</span> <span class="nam">legend_rows</span> <span class="op">+</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1794" href="#t1794">1794</a></span><span class="t">            <span class="nam">ax</span><span class="op">.</span><span class="nam">legend</span><span class="op">(</span><span class="nam">numpoints</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">ncol</span><span class="op">=</span><span class="nam">ncol</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1795" href="#t1795">1795</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1796" href="#t1796">1796</a></span><span class="t">            <span class="nam">ax</span><span class="op">.</span><span class="nam">legend</span><span class="op">(</span><span class="nam">numpoints</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1797" href="#t1797">1797</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1798" href="#t1798">1798</a></span><span class="t">    <span class="com"># reset window so at least one EOD of each cluster is visible    </span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1799" href="#t1799">1799</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">zoom_window</span><span class="op">)</span><span class="op">></span><span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1800" href="#t1800">1800</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">set_xlim</span><span class="op">(</span><span class="nam">max</span><span class="op">(</span><span class="nam">toffs</span><span class="op">,</span><span class="nam">toffs</span><span class="op">+</span><span class="nam">zoom_window</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="nam">width</span><span class="op">)</span><span class="op">,</span> <span class="nam">toffs</span><span class="op">+</span><span class="nam">zoom_window</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1801" href="#t1801">1801</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1802" href="#t1802">1802</a></span><span class="t">        <span class="nam">i0</span> <span class="op">=</span> <span class="nam">max</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">int</span><span class="op">(</span><span class="op">(</span><span class="nam">zoom_window</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="nam">width</span><span class="op">)</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1803" href="#t1803">1803</a></span><span class="t">        <span class="nam">i1</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">zoom_window</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1804" href="#t1804">1804</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1805" href="#t1805">1805</a></span><span class="t">        <span class="nam">ymin</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">data</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1806" href="#t1806">1806</a></span><span class="t">        <span class="nam">ymax</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">data</span><span class="op">[</span><span class="nam">i0</span><span class="op">:</span><span class="nam">i1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1807" href="#t1807">1807</a></span><span class="t">        <span class="nam">dy</span> <span class="op">=</span> <span class="nam">ymax</span> <span class="op">-</span> <span class="nam">ymin</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1808" href="#t1808">1808</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">set_ylim</span><span class="op">(</span><span class="nam">ymin</span><span class="op">-</span><span class="num">0.05</span><span class="op">*</span><span class="nam">dy</span><span class="op">,</span> <span class="nam">ymax</span><span class="op">+</span><span class="num">0.05</span><span class="op">*</span><span class="nam">dy</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1809" href="#t1809">1809</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1810" href="#t1810">1810</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1811" href="#t1811">1811</a></span><span class="t"><span class="key">def</span> <span class="nam">plot_eod_snippets</span><span class="op">(</span><span class="nam">ax</span><span class="op">,</span> <span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">tmin</span><span class="op">,</span> <span class="nam">tmax</span><span class="op">,</span> <span class="nam">eod_times</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1812" href="#t1812">1812</a></span><span class="t">                      <span class="nam">n_snippets</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">flip</span><span class="op">=</span><span class="key">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1813" href="#t1813">1813</a></span><span class="t">                      <span class="nam">sstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">scaley</span><span class="op">=</span><span class="key">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1814" href="#t1814">1814</a></span><span class="t">                                  <span class="nam">lw</span><span class="op">=</span><span class="num">0.5</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'0.6'</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1815" href="#t1815">1815</a></span><span class="t">    <span class="str">"""Plot a few EOD waveform snippets.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1816" href="#t1816">1816</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1817" href="#t1817">1817</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1818" href="#t1818">1818</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1819" href="#t1819">1819</a></span><span class="t"><span class="str">    ax: matplotlib axes</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1820" href="#t1820">1820</a></span><span class="t"><span class="str">        Axes used for plotting.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1821" href="#t1821">1821</a></span><span class="t"><span class="str">    data: 1D ndarray</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1822" href="#t1822">1822</a></span><span class="t"><span class="str">        Recorded data from which the snippets are taken.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1823" href="#t1823">1823</a></span><span class="t"><span class="str">    rate: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1824" href="#t1824">1824</a></span><span class="t"><span class="str">        Sampling rate of the data in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1825" href="#t1825">1825</a></span><span class="t"><span class="str">    tmin: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1826" href="#t1826">1826</a></span><span class="t"><span class="str">        Start time of each snippet.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1827" href="#t1827">1827</a></span><span class="t"><span class="str">    tmax: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1828" href="#t1828">1828</a></span><span class="t"><span class="str">        End time of each snippet.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1829" href="#t1829">1829</a></span><span class="t"><span class="str">    eod_times: 1-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1830" href="#t1830">1830</a></span><span class="t"><span class="str">        EOD peak times from which a few are selected to be plotted.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1831" href="#t1831">1831</a></span><span class="t"><span class="str">    n_snippets: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1832" href="#t1832">1832</a></span><span class="t"><span class="str">        Number of snippets to be plotted. If zero do not plot anything.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1833" href="#t1833">1833</a></span><span class="t"><span class="str">    flip: bool</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1834" href="#t1834">1834</a></span><span class="t"><span class="str">        If True flip the snippets upside down.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1835" href="#t1835">1835</a></span><span class="t"><span class="str">    sstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1836" href="#t1836">1836</a></span><span class="t"><span class="str">        Arguments passed on to the plot command for plotting the snippets.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1837" href="#t1837">1837</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1838" href="#t1838">1838</a></span><span class="t">    <span class="key">if</span> <span class="nam">n_snippets</span> <span class="op">&lt;=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1839" href="#t1839">1839</a></span><span class="t">        <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1840" href="#t1840">1840</a></span><span class="t">    <span class="nam">i0</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">tmin</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1841" href="#t1841">1841</a></span><span class="t">    <span class="nam">i1</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">tmax</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1842" href="#t1842">1842</a></span><span class="t">    <span class="nam">time</span> <span class="op">=</span> <span class="num">1000.0</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">i0</span><span class="op">,</span> <span class="nam">i1</span><span class="op">)</span><span class="op">/</span><span class="nam">rate</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1843" href="#t1843">1843</a></span><span class="t">    <span class="nam">step</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_times</span><span class="op">)</span><span class="op">//</span><span class="nam">n_snippets</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1844" href="#t1844">1844</a></span><span class="t">    <span class="key">if</span> <span class="nam">step</span> <span class="op">&lt;</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1845" href="#t1845">1845</a></span><span class="t">        <span class="nam">step</span> <span class="op">=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1846" href="#t1846">1846</a></span><span class="t">    <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">eod_times</span><span class="op">[</span><span class="nam">n_snippets</span><span class="op">//</span><span class="num">2</span><span class="op">:</span><span class="op">:</span><span class="nam">step</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1847" href="#t1847">1847</a></span><span class="t">        <span class="nam">idx</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="nam">t</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1848" href="#t1848">1848</a></span><span class="t">        <span class="key">if</span> <span class="nam">idx</span><span class="op">+</span><span class="nam">i0</span> <span class="op">&lt;</span> <span class="num">0</span> <span class="key">or</span> <span class="nam">idx</span><span class="op">+</span><span class="nam">i1</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1849" href="#t1849">1849</a></span><span class="t">            <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1850" href="#t1850">1850</a></span><span class="t">        <span class="nam">snippet</span> <span class="op">=</span> <span class="nam">data</span><span class="op">[</span><span class="nam">idx</span><span class="op">+</span><span class="nam">i0</span><span class="op">:</span><span class="nam">idx</span><span class="op">+</span><span class="nam">i1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1851" href="#t1851">1851</a></span><span class="t">        <span class="key">if</span> <span class="nam">flip</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1852" href="#t1852">1852</a></span><span class="t">            <span class="nam">snippet</span> <span class="op">*=</span> <span class="op">-</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1853" href="#t1853">1853</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">time</span><span class="op">,</span> <span class="nam">snippet</span> <span class="op">-</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">snippet</span><span class="op">[</span><span class="op">:</span><span class="nam">len</span><span class="op">(</span><span class="nam">snippet</span><span class="op">)</span><span class="op">//</span><span class="num">4</span><span class="op">]</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1854" href="#t1854">1854</a></span><span class="t">                <span class="nam">zorder</span><span class="op">=</span><span class="op">-</span><span class="num">5</span><span class="op">,</span> <span class="op">**</span><span class="nam">sstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1855" href="#t1855">1855</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1856" href="#t1856">1856</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1857" href="#t1857">1857</a></span><span class="t"><span class="key">def</span> <span class="nam">plot_eod_waveform</span><span class="op">(</span><span class="nam">ax</span><span class="op">,</span> <span class="nam">eod_waveform</span><span class="op">,</span> <span class="nam">props</span><span class="op">,</span> <span class="nam">peaks</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">unit</span><span class="op">=</span><span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1858" href="#t1858">1858</a></span><span class="t">                      <span class="nam">mstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">lw</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'tab:red'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1859" href="#t1859">1859</a></span><span class="t">                      <span class="nam">pstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">facecolor</span><span class="op">=</span><span class="str">'tab:green'</span><span class="op">,</span> <span class="nam">alpha</span><span class="op">=</span><span class="num">0.2</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1860" href="#t1860">1860</a></span><span class="t">                                  <span class="nam">edgecolor</span><span class="op">=</span><span class="str">'none'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1861" href="#t1861">1861</a></span><span class="t">                      <span class="nam">nstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">facecolor</span><span class="op">=</span><span class="str">'tab:blue'</span><span class="op">,</span> <span class="nam">alpha</span><span class="op">=</span><span class="num">0.2</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1862" href="#t1862">1862</a></span><span class="t">                                  <span class="nam">edgecolor</span><span class="op">=</span><span class="str">'none'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1863" href="#t1863">1863</a></span><span class="t">                      <span class="nam">sstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">color</span><span class="op">=</span><span class="str">'0.8'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1864" href="#t1864">1864</a></span><span class="t">                      <span class="nam">fstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">lw</span><span class="op">=</span><span class="num">6</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'tab:blue'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1865" href="#t1865">1865</a></span><span class="t">                      <span class="nam">zstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">lw</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'0.7'</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1866" href="#t1866">1866</a></span><span class="t">    <span class="str">"""Plot mean EOD, its standard error, and an optional fit to the EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1867" href="#t1867">1867</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1868" href="#t1868">1868</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1869" href="#t1869">1869</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1870" href="#t1870">1870</a></span><span class="t"><span class="str">    ax: matplotlib axes</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1871" href="#t1871">1871</a></span><span class="t"><span class="str">        Axes used for plotting.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1872" href="#t1872">1872</a></span><span class="t"><span class="str">    eod_waveform: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1873" href="#t1873">1873</a></span><span class="t"><span class="str">        EOD waveform. First column is time in seconds, second column</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1874" href="#t1874">1874</a></span><span class="t"><span class="str">        the (mean) eod waveform. The optional third column is the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1875" href="#t1875">1875</a></span><span class="t"><span class="str">        standard error, and the optional fourth column is a fit on the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1876" href="#t1876">1876</a></span><span class="t"><span class="str">        waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1877" href="#t1877">1877</a></span><span class="t"><span class="str">    props: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1878" href="#t1878">1878</a></span><span class="t"><span class="str">        A dictionary with properties of the analyzed EOD waveform as</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1879" href="#t1879">1879</a></span><span class="t"><span class="str">        returned by `analyze_wave()` and `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1880" href="#t1880">1880</a></span><span class="t"><span class="str">    peaks: 2_D arrays or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1881" href="#t1881">1881</a></span><span class="t"><span class="str">        List of peak properties (index, time, and amplitude) of a EOD pulse</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1882" href="#t1882">1882</a></span><span class="t"><span class="str">        as returned by `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1883" href="#t1883">1883</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1884" href="#t1884">1884</a></span><span class="t"><span class="str">        Optional unit of the data used for y-label.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1885" href="#t1885">1885</a></span><span class="t"><span class="str">    mstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1886" href="#t1886">1886</a></span><span class="t"><span class="str">        Arguments passed on to the plot command for the mean EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1887" href="#t1887">1887</a></span><span class="t"><span class="str">    pstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1888" href="#t1888">1888</a></span><span class="t"><span class="str">        Arguments passed on to the fill_between command for coloring</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1889" href="#t1889">1889</a></span><span class="t"><span class="str">        positive phases.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1890" href="#t1890">1890</a></span><span class="t"><span class="str">    nstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1891" href="#t1891">1891</a></span><span class="t"><span class="str">        Arguments passed on to the fill_between command for coloring</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1892" href="#t1892">1892</a></span><span class="t"><span class="str">        negative phases.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1893" href="#t1893">1893</a></span><span class="t"><span class="str">    sstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1894" href="#t1894">1894</a></span><span class="t"><span class="str">        Arguments passed on to the fill_between command for the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1895" href="#t1895">1895</a></span><span class="t"><span class="str">        standard error of the EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1896" href="#t1896">1896</a></span><span class="t"><span class="str">    fstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1897" href="#t1897">1897</a></span><span class="t"><span class="str">        Arguments passed on to the plot command for the fitted EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1898" href="#t1898">1898</a></span><span class="t"><span class="str">    zstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1899" href="#t1899">1899</a></span><span class="t"><span class="str">        Arguments passed on to the plot command for the zero line.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1900" href="#t1900">1900</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1901" href="#t1901">1901</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">autoscale</span><span class="op">(</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1902" href="#t1902">1902</a></span><span class="t">    <span class="nam">time</span> <span class="op">=</span> <span class="num">1000</span> <span class="op">*</span> <span class="nam">eod_waveform</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1903" href="#t1903">1903</a></span><span class="t">    <span class="nam">mean_eod</span> <span class="op">=</span> <span class="nam">eod_waveform</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1904" href="#t1904">1904</a></span><span class="t">    <span class="com"># plot zero line:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1905" href="#t1905">1905</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">axhline</span><span class="op">(</span><span class="num">0.0</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="op">-</span><span class="num">5</span><span class="op">,</span> <span class="op">**</span><span class="nam">zstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1906" href="#t1906">1906</a></span><span class="t">    <span class="com"># plot areas:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1907" href="#t1907">1907</a></span><span class="t">    <span class="key">if</span> <span class="nam">peaks</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">peaks</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1908" href="#t1908">1908</a></span><span class="t">        <span class="key">if</span> <span class="nam">pstyle</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">pstyle</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1909" href="#t1909">1909</a></span><span class="t">            <span class="nam">ax</span><span class="op">.</span><span class="nam">fill_between</span><span class="op">(</span><span class="nam">time</span><span class="op">,</span> <span class="nam">mean_eod</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="nam">mean_eod</span> <span class="op">>=</span> <span class="num">0</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">4</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1910" href="#t1910">1910</a></span><span class="t">                            <span class="op">**</span><span class="nam">pstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1911" href="#t1911">1911</a></span><span class="t">        <span class="key">if</span> <span class="nam">nstyle</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">nstyle</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1912" href="#t1912">1912</a></span><span class="t">                <span class="nam">ax</span><span class="op">.</span><span class="nam">fill_between</span><span class="op">(</span><span class="nam">time</span><span class="op">,</span> <span class="nam">mean_eod</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="nam">mean_eod</span> <span class="op">&lt;=</span> <span class="num">0</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">4</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1913" href="#t1913">1913</a></span><span class="t">                                <span class="op">**</span><span class="nam">nstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1914" href="#t1914">1914</a></span><span class="t">    <span class="com"># plot fit:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1915" href="#t1915">1915</a></span><span class="t">    <span class="key">if</span> <span class="nam">eod_waveform</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">3</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1916" href="#t1916">1916</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">time</span><span class="op">,</span> <span class="nam">eod_waveform</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">3</span><span class="op">]</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">5</span><span class="op">,</span> <span class="op">**</span><span class="nam">fstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1917" href="#t1917">1917</a></span><span class="t">    <span class="com"># plot waveform:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1918" href="#t1918">1918</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">time</span><span class="op">,</span> <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="op">**</span><span class="nam">mstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1919" href="#t1919">1919</a></span><span class="t">    <span class="com"># plot standard error:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1920" href="#t1920">1920</a></span><span class="t">    <span class="key">if</span> <span class="nam">eod_waveform</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1921" href="#t1921">1921</a></span><span class="t">        <span class="nam">std_eod</span> <span class="op">=</span> <span class="nam">eod_waveform</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1922" href="#t1922">1922</a></span><span class="t">        <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">std_eod</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">)</span> <span class="op">-</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">)</span><span class="op">)</span> <span class="op">></span> <span class="num">0.1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1923" href="#t1923">1923</a></span><span class="t">            <span class="nam">ax</span><span class="op">.</span><span class="nam">autoscale_view</span><span class="op">(</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1924" href="#t1924">1924</a></span><span class="t">            <span class="nam">ax</span><span class="op">.</span><span class="nam">autoscale</span><span class="op">(</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1925" href="#t1925">1925</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">fill_between</span><span class="op">(</span><span class="nam">time</span><span class="op">,</span> <span class="nam">mean_eod</span> <span class="op">+</span> <span class="nam">std_eod</span><span class="op">,</span> <span class="nam">mean_eod</span> <span class="op">-</span> <span class="nam">std_eod</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1926" href="#t1926">1926</a></span><span class="t">                        <span class="nam">zorder</span><span class="op">=</span><span class="op">-</span><span class="num">10</span><span class="op">,</span> <span class="op">**</span><span class="nam">sstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1927" href="#t1927">1927</a></span><span class="t">    <span class="com"># ax height dimensions:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1928" href="#t1928">1928</a></span><span class="t">    <span class="nam">pixely</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">diff</span><span class="op">(</span><span class="nam">ax</span><span class="op">.</span><span class="nam">get_window_extent</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">get_points</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1929" href="#t1929">1929</a></span><span class="t">    <span class="nam">ymin</span><span class="op">,</span> <span class="nam">ymax</span> <span class="op">=</span> <span class="nam">ax</span><span class="op">.</span><span class="nam">get_ylim</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1930" href="#t1930">1930</a></span><span class="t">    <span class="nam">unity</span> <span class="op">=</span> <span class="nam">ymax</span> <span class="op">-</span> <span class="nam">ymin</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1931" href="#t1931">1931</a></span><span class="t">    <span class="nam">dyu</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">unity</span><span class="op">)</span><span class="op">/</span><span class="nam">pixely</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1932" href="#t1932">1932</a></span><span class="t">    <span class="nam">font_size</span> <span class="op">=</span> <span class="nam">plt</span><span class="op">.</span><span class="nam">rcParams</span><span class="op">[</span><span class="str">'font.size'</span><span class="op">]</span><span class="op">*</span><span class="nam">dyu</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1933" href="#t1933">1933</a></span><span class="t">    <span class="com"># annotate fit:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1934" href="#t1934">1934</a></span><span class="t">    <span class="nam">tau</span> <span class="op">=</span> <span class="key">None</span> <span class="key">if</span> <span class="nam">props</span> <span class="key">is</span> <span class="key">None</span> <span class="key">else</span> <span class="nam">props</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'tau'</span><span class="op">,</span> <span class="key">None</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1935" href="#t1935">1935</a></span><span class="t">    <span class="nam">ty</span> <span class="op">=</span> <span class="num">0.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1936" href="#t1936">1936</a></span><span class="t">    <span class="key">if</span> <span class="nam">tau</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">eod_waveform</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">3</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1937" href="#t1937">1937</a></span><span class="t">        <span class="key">if</span> <span class="nam">tau</span> <span class="op">&lt;</span> <span class="num">0.001</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1938" href="#t1938">1938</a></span><span class="t">            <span class="nam">label</span> <span class="op">=</span> <span class="fst">f'</span><span class="fst">\u03c4=</span><span class="op">{</span><span class="num">1.e6</span><span class="op">*</span><span class="nam">tau</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst">\u00b5s</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1939" href="#t1939">1939</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1940" href="#t1940">1940</a></span><span class="t">            <span class="nam">label</span> <span class="op">=</span> <span class="fst">f'</span><span class="fst">\u03c4=</span><span class="op">{</span><span class="num">1.e3</span><span class="op">*</span><span class="nam">tau</span><span class="op">:</span><span class="fst">.2f</span><span class="op">}</span><span class="fst">ms</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1941" href="#t1941">1941</a></span><span class="t">        <span class="nam">inx</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">isnan</span><span class="op">(</span><span class="nam">eod_waveform</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1942" href="#t1942">1942</a></span><span class="t">        <span class="nam">x</span> <span class="op">=</span> <span class="nam">eod_waveform</span><span class="op">[</span><span class="nam">inx</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">+</span> <span class="num">1.5</span><span class="op">*</span><span class="nam">tau</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1943" href="#t1943">1943</a></span><span class="t">        <span class="nam">ty</span> <span class="op">=</span> <span class="num">0.7</span><span class="op">*</span><span class="nam">eod_waveform</span><span class="op">[</span><span class="nam">inx</span><span class="op">,</span><span class="num">3</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1944" href="#t1944">1944</a></span><span class="t">        <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">ty</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">font_size</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1945" href="#t1945">1945</a></span><span class="t">            <span class="nam">ty</span> <span class="op">=</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">font_size</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">sign</span><span class="op">(</span><span class="nam">ty</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1946" href="#t1946">1946</a></span><span class="t">        <span class="nam">va</span> <span class="op">=</span> <span class="str">'bottom'</span> <span class="key">if</span> <span class="nam">ty</span> <span class="op">></span> <span class="num">0.0</span> <span class="key">else</span> <span class="str">'top'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1947" href="#t1947">1947</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">1000</span><span class="op">*</span><span class="nam">x</span><span class="op">,</span> <span class="nam">ty</span><span class="op">,</span> <span class="nam">label</span><span class="op">,</span> <span class="nam">ha</span><span class="op">=</span><span class="str">'left'</span><span class="op">,</span> <span class="nam">va</span><span class="op">=</span><span class="nam">va</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">20</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1948" href="#t1948">1948</a></span><span class="t">    <span class="com"># annotate peaks:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t1949" href="#t1949">1949</a></span><span class="t">    <span class="key">if</span> <span class="nam">peaks</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">peaks</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1950" href="#t1950">1950</a></span><span class="t">        <span class="key">for</span> <span class="nam">i</span><span class="op">,</span> <span class="nam">p</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">peaks</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1951" href="#t1951">1951</a></span><span class="t">            <span class="nam">ax</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="num">1000</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">p</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">,</span> <span class="str">'o'</span><span class="op">,</span> <span class="nam">clip_on</span><span class="op">=</span><span class="key">False</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1952" href="#t1952">1952</a></span><span class="t">                    <span class="nam">alpha</span><span class="op">=</span><span class="num">0.4</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="nam">mstyle</span><span class="op">[</span><span class="str">'color'</span><span class="op">]</span><span class="op">,</span> <span class="nam">ms</span><span class="op">=</span><span class="num">12</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1953" href="#t1953">1953</a></span><span class="t">                    <span class="nam">mec</span><span class="op">=</span><span class="str">'none'</span><span class="op">,</span> <span class="nam">mew</span><span class="op">=</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1954" href="#t1954">1954</a></span><span class="t">            <span class="nam">label</span> <span class="op">=</span> <span class="fst">f'</span><span class="fst">P</span><span class="op">{</span><span class="nam">p</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1955" href="#t1955">1955</a></span><span class="t">            <span class="key">if</span> <span class="nam">p</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">!=</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1956" href="#t1956">1956</a></span><span class="t">                <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">0.001</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1957" href="#t1957">1957</a></span><span class="t">                    <span class="nam">ts</span> <span class="op">=</span> <span class="fst">f'</span><span class="op">{</span><span class="num">1.0e6</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst">\u00b5s</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1958" href="#t1958">1958</a></span><span class="t">                <span class="key">elif</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">0.01</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1959" href="#t1959">1959</a></span><span class="t">                    <span class="nam">ts</span> <span class="op">=</span> <span class="fst">f'</span><span class="op">{</span><span class="num">1.0e3</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">:</span><span class="fst">.2f</span><span class="op">}</span><span class="fst">ms</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1960" href="#t1960">1960</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1961" href="#t1961">1961</a></span><span class="t">                    <span class="nam">ts</span> <span class="op">=</span> <span class="fst">f'</span><span class="op">{</span><span class="num">1.0e3</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">:</span><span class="fst">.3g</span><span class="op">}</span><span class="fst">ms</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1962" href="#t1962">1962</a></span><span class="t">                <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">p</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">0.05</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1963" href="#t1963">1963</a></span><span class="t">                    <span class="nam">ps</span> <span class="op">=</span> <span class="fst">f'</span><span class="op">{</span><span class="num">100</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">:</span><span class="fst">.1f</span><span class="op">}</span><span class="fst">%</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1964" href="#t1964">1964</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1965" href="#t1965">1965</a></span><span class="t">                    <span class="nam">ps</span> <span class="op">=</span> <span class="fst">f'</span><span class="op">{</span><span class="num">100</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst">%</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1966" href="#t1966">1966</a></span><span class="t">                <span class="nam">label</span> <span class="op">+=</span> <span class="fst">f'</span><span class="fst">(</span><span class="op">{</span><span class="nam">ps</span><span class="op">}</span><span class="fst"> @ </span><span class="op">{</span><span class="nam">ts</span><span class="op">}</span><span class="fst">)</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1967" href="#t1967">1967</a></span><span class="t">            <span class="nam">va</span> <span class="op">=</span> <span class="str">'baseline'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1968" href="#t1968">1968</a></span><span class="t">            <span class="nam">dy</span> <span class="op">=</span> <span class="num">0.4</span><span class="op">*</span><span class="nam">font_size</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1969" href="#t1969">1969</a></span><span class="t">            <span class="nam">sign</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sign</span><span class="op">(</span><span class="nam">p</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1970" href="#t1970">1970</a></span><span class="t">            <span class="key">if</span> <span class="nam">sign</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1971" href="#t1971">1971</a></span><span class="t">                <span class="nam">va</span> <span class="op">=</span> <span class="str">'top'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1972" href="#t1972">1972</a></span><span class="t">                <span class="nam">dy</span> <span class="op">=</span> <span class="op">-</span><span class="nam">dy</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1973" href="#t1973">1973</a></span><span class="t">            <span class="key">if</span> <span class="nam">p</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1974" href="#t1974">1974</a></span><span class="t">                <span class="nam">dy</span> <span class="op">=</span> <span class="num">0.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1975" href="#t1975">1975</a></span><span class="t">            <span class="str">"""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1976" href="#t1976">1976</a></span><span class="t"><span class="str">            if p[2] &lt;= np.min(peaks[:,2]):</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1977" href="#t1977">1977</a></span><span class="t"><span class="str">                dy = -0.8*font_size</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1978" href="#t1978">1978</a></span><span class="t"><span class="str">                va = 'baseline'</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1979" href="#t1979">1979</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1980" href="#t1980">1980</a></span><span class="t">            <span class="key">if</span> <span class="nam">p</span><span class="op">[</span><span class="num">2</span><span class="op">]</span> <span class="op">+</span> <span class="nam">dy</span> <span class="op">&lt;</span> <span class="nam">ymin</span> <span class="op">+</span> <span class="num">1.3</span><span class="op">*</span><span class="nam">font_size</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1981" href="#t1981">1981</a></span><span class="t">                <span class="nam">dy</span> <span class="op">=</span> <span class="nam">ymin</span> <span class="op">+</span> <span class="num">1.3</span><span class="op">*</span><span class="nam">font_size</span> <span class="op">-</span> <span class="nam">p</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1982" href="#t1982">1982</a></span><span class="t">            <span class="key">if</span> <span class="nam">p</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">peaks</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span> <span class="key">and</span> <span class="nam">ty</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">2</span><span class="op">]</span> <span class="op">></span> <span class="num">0.0</span> <span class="key">and</span> <span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1983" href="#t1983">1983</a></span><span class="t">               <span class="nam">sign</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">+</span><span class="nam">dy</span> <span class="op">&lt;</span> <span class="nam">sign</span><span class="op">*</span><span class="nam">ty</span><span class="op">+</span><span class="num">1.2</span><span class="op">*</span><span class="nam">font_size</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1984" href="#t1984">1984</a></span><span class="t">                <span class="nam">dy</span> <span class="op">=</span> <span class="nam">ty</span> <span class="op">+</span> <span class="nam">sign</span><span class="op">*</span><span class="num">1.2</span><span class="op">*</span><span class="nam">font_size</span> <span class="op">-</span> <span class="nam">p</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1985" href="#t1985">1985</a></span><span class="t">            <span class="nam">dx</span> <span class="op">=</span> <span class="num">0.05</span><span class="op">*</span><span class="nam">time</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1986" href="#t1986">1986</a></span><span class="t">            <span class="key">if</span> <span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">>=</span> <span class="num">0.0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1987" href="#t1987">1987</a></span><span class="t">                <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">1000</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">+</span><span class="nam">dx</span><span class="op">,</span> <span class="nam">p</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">+</span><span class="nam">dy</span><span class="op">,</span> <span class="nam">label</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1988" href="#t1988">1988</a></span><span class="t">                        <span class="nam">ha</span><span class="op">=</span><span class="str">'left'</span><span class="op">,</span> <span class="nam">va</span><span class="op">=</span><span class="nam">va</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">20</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1989" href="#t1989">1989</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1990" href="#t1990">1990</a></span><span class="t">                <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">1000</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="nam">dx</span><span class="op">,</span> <span class="nam">p</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">+</span><span class="nam">dy</span><span class="op">,</span> <span class="nam">label</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1991" href="#t1991">1991</a></span><span class="t">                        <span class="nam">ha</span><span class="op">=</span><span class="str">'right'</span><span class="op">,</span> <span class="nam">va</span><span class="op">=</span><span class="nam">va</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">20</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1992" href="#t1992">1992</a></span><span class="t">            <span class="com"># area:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1993" href="#t1993">1993</a></span><span class="t">            <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">p</span><span class="op">)</span> <span class="op">></span> <span class="num">6</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1994" href="#t1994">1994</a></span><span class="t">                <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">p</span><span class="op">[</span><span class="num">6</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">0.05</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1995" href="#t1995">1995</a></span><span class="t">                    <span class="nam">label</span> <span class="op">=</span> <span class="fst">f'</span><span class="op">{</span><span class="num">100</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">6</span><span class="op">]</span><span class="op">:</span><span class="fst">.1f</span><span class="op">}</span><span class="fst">%</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t1996" href="#t1996">1996</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1997" href="#t1997">1997</a></span><span class="t">                    <span class="nam">label</span> <span class="op">=</span> <span class="fst">f'</span><span class="op">{</span><span class="num">100</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">6</span><span class="op">]</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst">%</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1998" href="#t1998">1998</a></span><span class="t">                <span class="nam">dxl</span> <span class="op">=</span> <span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">peaks</span><span class="op">[</span><span class="nam">i</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">if</span> <span class="nam">i</span> <span class="op">></span> <span class="num">0</span> <span class="key">else</span> <span class="nam">np</span><span class="op">.</span><span class="nam">inf</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t1999" href="#t1999">1999</a></span><span class="t">                <span class="nam">dxr</span> <span class="op">=</span> <span class="nam">peaks</span><span class="op">[</span><span class="nam">i</span> <span class="op">+</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">if</span> <span class="nam">i</span> <span class="op">&lt;</span> <span class="nam">len</span><span class="op">(</span><span class="nam">peaks</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span> <span class="key">else</span> <span class="nam">np</span><span class="op">.</span><span class="nam">inf</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2000" href="#t2000">2000</a></span><span class="t">                <span class="nam">dx</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2001" href="#t2001">2001</a></span><span class="t">                <span class="key">if</span> <span class="nam">dxl</span> <span class="op">&lt;</span> <span class="nam">dxr</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2002" href="#t2002">2002</a></span><span class="t">                    <span class="nam">dx</span> <span class="op">=</span> <span class="op">+</span><span class="num">1000</span><span class="op">*</span><span class="num">0.2</span><span class="op">*</span><span class="nam">dxl</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2003" href="#t2003">2003</a></span><span class="t">                <span class="key">elif</span> <span class="nam">dxr</span> <span class="op">&lt;</span> <span class="nam">dxl</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2004" href="#t2004">2004</a></span><span class="t">                    <span class="nam">dx</span> <span class="op">=</span> <span class="op">-</span><span class="num">1000</span><span class="op">*</span><span class="num">0.2</span><span class="op">*</span><span class="nam">dxr</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2005" href="#t2005">2005</a></span><span class="t">                <span class="key">if</span> <span class="nam">abs</span><span class="op">(</span><span class="nam">p</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="num">0.5</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2006" href="#t2006">2006</a></span><span class="t">                    <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">1000</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">+</span> <span class="nam">dx</span><span class="op">,</span> <span class="nam">sign</span><span class="op">*</span><span class="num">0.6</span><span class="op">*</span><span class="nam">font_size</span><span class="op">,</span> <span class="nam">label</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2007" href="#t2007">2007</a></span><span class="t">                            <span class="nam">rotation</span><span class="op">=</span><span class="str">'vertical'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2008" href="#t2008">2008</a></span><span class="t">                            <span class="nam">va</span><span class="op">=</span><span class="str">'top'</span> <span class="key">if</span> <span class="nam">sign</span> <span class="op">&lt;</span> <span class="num">0</span> <span class="key">else</span> <span class="str">'bottom'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2009" href="#t2009">2009</a></span><span class="t">                            <span class="nam">ha</span><span class="op">=</span><span class="str">'center'</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">20</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2010" href="#t2010">2010</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2011" href="#t2011">2011</a></span><span class="t">                    <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">1000</span><span class="op">*</span><span class="nam">p</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">+</span> <span class="nam">dx</span><span class="op">,</span> <span class="op">-</span><span class="nam">sign</span><span class="op">*</span><span class="num">0.4</span><span class="op">*</span><span class="nam">font_size</span><span class="op">,</span> <span class="nam">label</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2012" href="#t2012">2012</a></span><span class="t">                            <span class="nam">va</span><span class="op">=</span><span class="str">'baseline'</span> <span class="key">if</span> <span class="nam">sign</span> <span class="op">&lt;</span> <span class="num">0</span> <span class="key">else</span> <span class="str">'top'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2013" href="#t2013">2013</a></span><span class="t">                            <span class="nam">ha</span><span class="op">=</span><span class="str">'center'</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">20</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2014" href="#t2014">2014</a></span><span class="t">    <span class="com"># annotate plot:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2015" href="#t2015">2015</a></span><span class="t">    <span class="key">if</span> <span class="nam">unit</span> <span class="key">is</span> <span class="key">None</span> <span class="key">or</span> <span class="nam">len</span><span class="op">(</span><span class="nam">unit</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span> <span class="key">or</span> <span class="nam">unit</span> <span class="op">==</span> <span class="str">'a.u.'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2016" href="#t2016">2016</a></span><span class="t">        <span class="nam">unit</span> <span class="op">=</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2017" href="#t2017">2017</a></span><span class="t">    <span class="key">if</span> <span class="nam">props</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2018" href="#t2018">2018</a></span><span class="t">        <span class="nam">label</span> <span class="op">=</span> <span class="fst">f'</span><span class="fst">p-p amplitude = </span><span class="op">{</span><span class="nam">props</span><span class="op">[</span><span class="str">"p-p-amplitude"</span><span class="op">]</span><span class="op">:</span><span class="fst">.3g</span><span class="op">}</span><span class="fst"> </span><span class="op">{</span><span class="nam">unit</span><span class="op">}</span><span class="fst">\n</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2019" href="#t2019">2019</a></span><span class="t">        <span class="key">if</span> <span class="str">'n'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2020" href="#t2020">2020</a></span><span class="t">            <span class="nam">eods</span> <span class="op">=</span> <span class="str">'EODs'</span> <span class="key">if</span> <span class="nam">props</span><span class="op">[</span><span class="str">'n'</span><span class="op">]</span> <span class="op">></span> <span class="num">1</span> <span class="key">else</span> <span class="str">'EOD'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2021" href="#t2021">2021</a></span><span class="t">            <span class="nam">label</span> <span class="op">+=</span> <span class="fst">f'</span><span class="fst">n = </span><span class="op">{</span><span class="nam">props</span><span class="op">[</span><span class="str">"n"</span><span class="op">]</span><span class="op">}</span><span class="fst"> </span><span class="op">{</span><span class="nam">eods</span><span class="op">}</span><span class="fst">\n</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2022" href="#t2022">2022</a></span><span class="t">        <span class="key">if</span> <span class="str">'flipped'</span> <span class="key">in</span> <span class="nam">props</span> <span class="key">and</span> <span class="nam">props</span><span class="op">[</span><span class="str">'flipped'</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2023" href="#t2023">2023</a></span><span class="t">            <span class="nam">label</span> <span class="op">+=</span> <span class="str">'flipped\n'</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2024" href="#t2024">2024</a></span><span class="t">        <span class="key">if</span> <span class="str">'polaritybalance'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2025" href="#t2025">2025</a></span><span class="t">            <span class="nam">label</span> <span class="op">+=</span> <span class="fst">f'</span><span class="fst">PB=</span><span class="op">{</span><span class="num">100</span><span class="op">*</span><span class="nam">props</span><span class="op">[</span><span class="str">"polaritybalance"</span><span class="op">]</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst"> %\n</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2026" href="#t2026">2026</a></span><span class="t">        <span class="key">if</span> <span class="op">-</span><span class="nam">eod_waveform</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">&lt;</span> <span class="num">0.6</span><span class="op">*</span><span class="nam">eod_waveform</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2027" href="#t2027">2027</a></span><span class="t">            <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">0.97</span><span class="op">,</span> <span class="num">0.97</span><span class="op">,</span> <span class="nam">label</span><span class="op">,</span> <span class="nam">transform</span><span class="op">=</span><span class="nam">ax</span><span class="op">.</span><span class="nam">transAxes</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2028" href="#t2028">2028</a></span><span class="t">                    <span class="nam">va</span><span class="op">=</span><span class="str">'top'</span><span class="op">,</span> <span class="nam">ha</span><span class="op">=</span><span class="str">'right'</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">20</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2029" href="#t2029">2029</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2030" href="#t2030">2030</a></span><span class="t">            <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">0.03</span><span class="op">,</span> <span class="num">0.97</span><span class="op">,</span> <span class="nam">label</span><span class="op">,</span> <span class="nam">transform</span><span class="op">=</span><span class="nam">ax</span><span class="op">.</span><span class="nam">transAxes</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2031" href="#t2031">2031</a></span><span class="t">                    <span class="nam">va</span><span class="op">=</span><span class="str">'top'</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">20</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2032" href="#t2032">2032</a></span><span class="t">    <span class="com"># axis:                </span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2033" href="#t2033">2033</a></span><span class="t">    <span class="key">if</span> <span class="nam">props</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">props</span><span class="op">[</span><span class="str">'type'</span><span class="op">]</span> <span class="op">==</span> <span class="str">'wave'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2034" href="#t2034">2034</a></span><span class="t">        <span class="nam">lim</span> <span class="op">=</span> <span class="num">750.0</span><span class="op">/</span><span class="nam">props</span><span class="op">[</span><span class="str">'EODf'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2035" href="#t2035">2035</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">set_xlim</span><span class="op">(</span><span class="op">[</span><span class="op">-</span><span class="nam">lim</span><span class="op">,</span> <span class="op">+</span><span class="nam">lim</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2036" href="#t2036">2036</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2037" href="#t2037">2037</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">set_xlim</span><span class="op">(</span><span class="nam">time</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">time</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2038" href="#t2038">2038</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">set_xlabel</span><span class="op">(</span><span class="str">'Time [msec]'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2039" href="#t2039">2039</a></span><span class="t">    <span class="key">if</span> <span class="nam">unit</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2040" href="#t2040">2040</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">set_ylabel</span><span class="op">(</span><span class="fst">f'</span><span class="fst">Amplitude [</span><span class="op">{</span><span class="nam">unit</span><span class="op">}</span><span class="fst">]</span><span class="fst">'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2041" href="#t2041">2041</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2042" href="#t2042">2042</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">set_ylabel</span><span class="op">(</span><span class="str">'Amplitude'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2043" href="#t2043">2043</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2044" href="#t2044">2044</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2045" href="#t2045">2045</a></span><span class="t"><span class="key">def</span> <span class="nam">plot_wave_spectrum</span><span class="op">(</span><span class="nam">axa</span><span class="op">,</span> <span class="nam">axp</span><span class="op">,</span> <span class="nam">spec</span><span class="op">,</span> <span class="nam">props</span><span class="op">,</span> <span class="nam">unit</span><span class="op">=</span><span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2046" href="#t2046">2046</a></span><span class="t">                       <span class="nam">mstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">color</span><span class="op">=</span><span class="str">'tab:blue'</span><span class="op">,</span> <span class="nam">markersize</span><span class="op">=</span><span class="num">10</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2047" href="#t2047">2047</a></span><span class="t">                       <span class="nam">sstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">color</span><span class="op">=</span><span class="str">'tab:blue'</span><span class="op">,</span> <span class="nam">alpha</span><span class="op">=</span><span class="num">0.5</span><span class="op">,</span> <span class="nam">lw</span><span class="op">=</span><span class="num">2</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2048" href="#t2048">2048</a></span><span class="t">    <span class="str">"""Plot and annotate spectrum of wave EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2049" href="#t2049">2049</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2050" href="#t2050">2050</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2051" href="#t2051">2051</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2052" href="#t2052">2052</a></span><span class="t"><span class="str">    axa: matplotlib axes</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2053" href="#t2053">2053</a></span><span class="t"><span class="str">        Axes for amplitude plot.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2054" href="#t2054">2054</a></span><span class="t"><span class="str">    axp: matplotlib axes</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2055" href="#t2055">2055</a></span><span class="t"><span class="str">        Axes for phase plot.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2056" href="#t2056">2056</a></span><span class="t"><span class="str">    spec: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2057" href="#t2057">2057</a></span><span class="t"><span class="str">        The amplitude spectrum of a single pulse as returned by</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2058" href="#t2058">2058</a></span><span class="t"><span class="str">        `analyze_wave()`.  First column is the index of the harmonics,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2059" href="#t2059">2059</a></span><span class="t"><span class="str">        second column its frequency, third column its amplitude,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2060" href="#t2060">2060</a></span><span class="t"><span class="str">        fourth column its amplitude relative to the fundamental, fifth</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2061" href="#t2061">2061</a></span><span class="t"><span class="str">        column is power of harmonics relative to fundamental in</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2062" href="#t2062">2062</a></span><span class="t"><span class="str">        decibel, and sixth column the phase shift relative to the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2063" href="#t2063">2063</a></span><span class="t"><span class="str">        fundamental.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2064" href="#t2064">2064</a></span><span class="t"><span class="str">    props: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2065" href="#t2065">2065</a></span><span class="t"><span class="str">        A dictionary with properties of the analyzed EOD waveform as</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2066" href="#t2066">2066</a></span><span class="t"><span class="str">        returned by `analyze_wave()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2067" href="#t2067">2067</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2068" href="#t2068">2068</a></span><span class="t"><span class="str">        Optional unit of the data used for y-label.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2069" href="#t2069">2069</a></span><span class="t"><span class="str">    mstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2070" href="#t2070">2070</a></span><span class="t"><span class="str">        Arguments passed on to the stem plot command for the markers.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2071" href="#t2071">2071</a></span><span class="t"><span class="str">    sstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2072" href="#t2072">2072</a></span><span class="t"><span class="str">        Arguments passed on to the stem plot command for the stem lines.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2073" href="#t2073">2073</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2074" href="#t2074">2074</a></span><span class="t">    <span class="nam">n</span> <span class="op">=</span> <span class="nam">min</span><span class="op">(</span><span class="num">9</span><span class="op">,</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">isfinite</span><span class="op">(</span><span class="nam">spec</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2075" href="#t2075">2075</a></span><span class="t">    <span class="com"># amplitudes:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2076" href="#t2076">2076</a></span><span class="t">    <span class="nam">markers</span><span class="op">,</span> <span class="nam">stemlines</span><span class="op">,</span> <span class="nam">_</span> <span class="op">=</span> <span class="nam">axa</span><span class="op">.</span><span class="nam">stem</span><span class="op">(</span><span class="nam">spec</span><span class="op">[</span><span class="op">:</span><span class="nam">n</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">+</span><span class="num">1</span><span class="op">,</span> <span class="nam">spec</span><span class="op">[</span><span class="op">:</span><span class="nam">n</span><span class="op">,</span><span class="num">2</span><span class="op">]</span><span class="op">,</span> <span class="nam">basefmt</span><span class="op">=</span><span class="str">'none'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2077" href="#t2077">2077</a></span><span class="t">    <span class="nam">plt</span><span class="op">.</span><span class="nam">setp</span><span class="op">(</span><span class="nam">markers</span><span class="op">,</span> <span class="nam">clip_on</span><span class="op">=</span><span class="key">False</span><span class="op">,</span> <span class="op">**</span><span class="nam">mstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2078" href="#t2078">2078</a></span><span class="t">    <span class="nam">plt</span><span class="op">.</span><span class="nam">setp</span><span class="op">(</span><span class="nam">stemlines</span><span class="op">,</span> <span class="op">**</span><span class="nam">sstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2079" href="#t2079">2079</a></span><span class="t">    <span class="nam">axa</span><span class="op">.</span><span class="nam">set_xlim</span><span class="op">(</span><span class="num">0.5</span><span class="op">,</span> <span class="nam">n</span><span class="op">+</span><span class="num">0.5</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2080" href="#t2080">2080</a></span><span class="t">    <span class="nam">axa</span><span class="op">.</span><span class="nam">set_ylim</span><span class="op">(</span><span class="nam">bottom</span><span class="op">=</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2081" href="#t2081">2081</a></span><span class="t">    <span class="nam">axa</span><span class="op">.</span><span class="nam">xaxis</span><span class="op">.</span><span class="nam">set_major_locator</span><span class="op">(</span><span class="nam">plt</span><span class="op">.</span><span class="nam">MultipleLocator</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2082" href="#t2082">2082</a></span><span class="t">    <span class="nam">axa</span><span class="op">.</span><span class="nam">tick_params</span><span class="op">(</span><span class="str">'x'</span><span class="op">,</span> <span class="nam">direction</span><span class="op">=</span><span class="str">'out'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2083" href="#t2083">2083</a></span><span class="t">    <span class="key">if</span> <span class="nam">unit</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2084" href="#t2084">2084</a></span><span class="t">        <span class="nam">axa</span><span class="op">.</span><span class="nam">set_ylabel</span><span class="op">(</span><span class="fst">f'</span><span class="fst">Amplitude [</span><span class="op">{</span><span class="nam">unit</span><span class="op">}</span><span class="fst">]</span><span class="fst">'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2085" href="#t2085">2085</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2086" href="#t2086">2086</a></span><span class="t">        <span class="nam">axa</span><span class="op">.</span><span class="nam">set_ylabel</span><span class="op">(</span><span class="str">'Amplitude'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2087" href="#t2087">2087</a></span><span class="t">    <span class="com"># phases:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2088" href="#t2088">2088</a></span><span class="t">    <span class="nam">phases</span> <span class="op">=</span> <span class="nam">spec</span><span class="op">[</span><span class="op">:</span><span class="nam">n</span><span class="op">,</span><span class="num">5</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2089" href="#t2089">2089</a></span><span class="t">    <span class="nam">phases</span><span class="op">[</span><span class="nam">phases</span><span class="op">&lt;</span><span class="num">0.0</span><span class="op">]</span> <span class="op">=</span> <span class="nam">phases</span><span class="op">[</span><span class="nam">phases</span><span class="op">&lt;</span><span class="num">0.0</span><span class="op">]</span> <span class="op">+</span> <span class="num">2.0</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">pi</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2090" href="#t2090">2090</a></span><span class="t">    <span class="nam">markers</span><span class="op">,</span> <span class="nam">stemlines</span><span class="op">,</span> <span class="nam">_</span> <span class="op">=</span> <span class="nam">axp</span><span class="op">.</span><span class="nam">stem</span><span class="op">(</span><span class="nam">spec</span><span class="op">[</span><span class="op">:</span><span class="nam">n</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">+</span><span class="num">1</span><span class="op">,</span> <span class="nam">phases</span><span class="op">[</span><span class="op">:</span><span class="nam">n</span><span class="op">]</span><span class="op">,</span> <span class="nam">basefmt</span><span class="op">=</span><span class="str">'none'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2091" href="#t2091">2091</a></span><span class="t">    <span class="nam">plt</span><span class="op">.</span><span class="nam">setp</span><span class="op">(</span><span class="nam">markers</span><span class="op">,</span> <span class="nam">clip_on</span><span class="op">=</span><span class="key">False</span><span class="op">,</span> <span class="op">**</span><span class="nam">mstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2092" href="#t2092">2092</a></span><span class="t">    <span class="nam">plt</span><span class="op">.</span><span class="nam">setp</span><span class="op">(</span><span class="nam">stemlines</span><span class="op">,</span> <span class="op">**</span><span class="nam">sstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2093" href="#t2093">2093</a></span><span class="t">    <span class="nam">axp</span><span class="op">.</span><span class="nam">set_xlim</span><span class="op">(</span><span class="num">0.5</span><span class="op">,</span> <span class="nam">n</span><span class="op">+</span><span class="num">0.5</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2094" href="#t2094">2094</a></span><span class="t">    <span class="nam">axp</span><span class="op">.</span><span class="nam">xaxis</span><span class="op">.</span><span class="nam">set_major_locator</span><span class="op">(</span><span class="nam">plt</span><span class="op">.</span><span class="nam">MultipleLocator</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2095" href="#t2095">2095</a></span><span class="t">    <span class="nam">axp</span><span class="op">.</span><span class="nam">tick_params</span><span class="op">(</span><span class="str">'x'</span><span class="op">,</span> <span class="nam">direction</span><span class="op">=</span><span class="str">'out'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2096" href="#t2096">2096</a></span><span class="t">    <span class="nam">axp</span><span class="op">.</span><span class="nam">set_ylim</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="num">2.0</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">pi</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2097" href="#t2097">2097</a></span><span class="t">    <span class="nam">axp</span><span class="op">.</span><span class="nam">set_yticks</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">np</span><span class="op">.</span><span class="nam">pi</span><span class="op">,</span> <span class="num">2.0</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">pi</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2098" href="#t2098">2098</a></span><span class="t">    <span class="nam">axp</span><span class="op">.</span><span class="nam">set_yticklabels</span><span class="op">(</span><span class="op">[</span><span class="str">'0'</span><span class="op">,</span> <span class="str">'\u03c0'</span><span class="op">,</span> <span class="str">'2\u03c0'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2099" href="#t2099">2099</a></span><span class="t">    <span class="nam">axp</span><span class="op">.</span><span class="nam">set_xlabel</span><span class="op">(</span><span class="str">'Harmonics'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2100" href="#t2100">2100</a></span><span class="t">    <span class="nam">axp</span><span class="op">.</span><span class="nam">set_ylabel</span><span class="op">(</span><span class="str">'Phase'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2101" href="#t2101">2101</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2102" href="#t2102">2102</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2103" href="#t2103">2103</a></span><span class="t"><span class="key">def</span> <span class="nam">plot_pulse_spectrum</span><span class="op">(</span><span class="nam">ax</span><span class="op">,</span> <span class="nam">power</span><span class="op">,</span> <span class="nam">props</span><span class="op">,</span> <span class="nam">min_freq</span><span class="op">=</span><span class="num">1.0</span><span class="op">,</span> <span class="nam">max_freq</span><span class="op">=</span><span class="num">10000.0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2104" href="#t2104">2104</a></span><span class="t">                        <span class="nam">sstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">lw</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'tab:blue'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2105" href="#t2105">2105</a></span><span class="t">                        <span class="nam">pstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">ls</span><span class="op">=</span><span class="str">''</span><span class="op">,</span> <span class="nam">marker</span><span class="op">=</span><span class="str">'o'</span><span class="op">,</span> <span class="nam">markersize</span><span class="op">=</span><span class="num">10</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2106" href="#t2106">2106</a></span><span class="t">                                    <span class="nam">color</span><span class="op">=</span><span class="str">'tab:blue'</span><span class="op">,</span> <span class="nam">mec</span><span class="op">=</span><span class="str">'none'</span><span class="op">,</span> <span class="nam">mew</span><span class="op">=</span><span class="num">0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2107" href="#t2107">2107</a></span><span class="t">                                    <span class="nam">alpha</span><span class="op">=</span><span class="num">0.4</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2108" href="#t2108">2108</a></span><span class="t">                        <span class="nam">cstyle</span><span class="op">=</span><span class="nam">dict</span><span class="op">(</span><span class="nam">lw</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">ls</span><span class="op">=</span><span class="str">'-'</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'0.5'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2109" href="#t2109">2109</a></span><span class="t">                        <span class="nam">att5_color</span><span class="op">=</span><span class="str">'0.8'</span><span class="op">,</span> <span class="nam">att50_color</span><span class="op">=</span><span class="str">'0.9'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2110" href="#t2110">2110</a></span><span class="t">    <span class="str">"""Plot and annotate spectrum of single pulse EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2111" href="#t2111">2111</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2112" href="#t2112">2112</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2113" href="#t2113">2113</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2114" href="#t2114">2114</a></span><span class="t"><span class="str">    ax: matplotlib axes</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2115" href="#t2115">2115</a></span><span class="t"><span class="str">        Axes used for plotting.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2116" href="#t2116">2116</a></span><span class="t"><span class="str">    power: 2-D array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2117" href="#t2117">2117</a></span><span class="t"><span class="str">        The power spectrum of a single pulse as returned by `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2118" href="#t2118">2118</a></span><span class="t"><span class="str">        First column are the frequencies, second column the power.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2119" href="#t2119">2119</a></span><span class="t"><span class="str">    props: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2120" href="#t2120">2120</a></span><span class="t"><span class="str">        A dictionary with properties of the analyzed EOD waveform as</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2121" href="#t2121">2121</a></span><span class="t"><span class="str">        returned by `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2122" href="#t2122">2122</a></span><span class="t"><span class="str">    min_freq: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2123" href="#t2123">2123</a></span><span class="t"><span class="str">        Minimun frequency of the spectrum to be plotted (logscale!).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2124" href="#t2124">2124</a></span><span class="t"><span class="str">    max_freq: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2125" href="#t2125">2125</a></span><span class="t"><span class="str">        Maximun frequency of the spectrum to be plotted (logscale!).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2126" href="#t2126">2126</a></span><span class="t"><span class="str">    sstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2127" href="#t2127">2127</a></span><span class="t"><span class="str">        Arguments passed on to the plot command for the power spectrum.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2128" href="#t2128">2128</a></span><span class="t"><span class="str">    pstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2129" href="#t2129">2129</a></span><span class="t"><span class="str">        Arguments passed on to the plot command for marking the peak frequency.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2130" href="#t2130">2130</a></span><span class="t"><span class="str">    cstyle: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2131" href="#t2131">2131</a></span><span class="t"><span class="str">        Arguments passed on to the plot command for the line marking</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2132" href="#t2132">2132</a></span><span class="t"><span class="str">        the lower cutoff frequency.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2133" href="#t2133">2133</a></span><span class="t"><span class="str">    att5_color: matplotlib color specification</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2134" href="#t2134">2134</a></span><span class="t"><span class="str">        Color for the rectangular patch marking the first 5 Hz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2135" href="#t2135">2135</a></span><span class="t"><span class="str">    att50_color: matplotlib color specification</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2136" href="#t2136">2136</a></span><span class="t"><span class="str">        Color for the rectangular patch marking the first 50 Hz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2137" href="#t2137">2137</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2138" href="#t2138">2138</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">axvspan</span><span class="op">(</span><span class="num">1</span><span class="op">,</span> <span class="num">50</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="nam">att50_color</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2139" href="#t2139">2139</a></span><span class="t">    <span class="nam">att</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'poweratt50'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2140" href="#t2140">2140</a></span><span class="t">    <span class="key">if</span> <span class="nam">att</span> <span class="op">&lt;</span> <span class="op">-</span><span class="num">5.0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2141" href="#t2141">2141</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">10.0</span><span class="op">,</span> <span class="nam">att</span><span class="op">+</span><span class="num">1.0</span><span class="op">,</span> <span class="fst">f'</span><span class="op">{</span><span class="nam">att</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst"> dB</span><span class="fst">'</span><span class="op">,</span> <span class="nam">ha</span><span class="op">=</span><span class="str">'left'</span><span class="op">,</span> <span class="nam">va</span><span class="op">=</span><span class="str">'bottom'</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">10</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2142" href="#t2142">2142</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2143" href="#t2143">2143</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">10.0</span><span class="op">,</span> <span class="nam">att</span><span class="op">-</span><span class="num">1.0</span><span class="op">,</span> <span class="fst">f'</span><span class="op">{</span><span class="nam">att</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst"> dB</span><span class="fst">'</span><span class="op">,</span> <span class="nam">ha</span><span class="op">=</span><span class="str">'left'</span><span class="op">,</span> <span class="nam">va</span><span class="op">=</span><span class="str">'top'</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">10</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2144" href="#t2144">2144</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">axvspan</span><span class="op">(</span><span class="num">1</span><span class="op">,</span> <span class="num">5</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="nam">att5_color</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2145" href="#t2145">2145</a></span><span class="t">    <span class="nam">att</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'poweratt5'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2146" href="#t2146">2146</a></span><span class="t">    <span class="key">if</span> <span class="nam">att</span> <span class="op">&lt;</span> <span class="op">-</span><span class="num">5.0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2147" href="#t2147">2147</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">4.0</span><span class="op">,</span> <span class="nam">att</span><span class="op">+</span><span class="num">1.0</span><span class="op">,</span> <span class="fst">f'</span><span class="op">{</span><span class="nam">att</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst"> dB</span><span class="fst">'</span><span class="op">,</span> <span class="nam">ha</span><span class="op">=</span><span class="str">'right'</span><span class="op">,</span> <span class="nam">va</span><span class="op">=</span><span class="str">'bottom'</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">10</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2148" href="#t2148">2148</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2149" href="#t2149">2149</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">4.0</span><span class="op">,</span> <span class="nam">att</span><span class="op">-</span><span class="num">1.0</span><span class="op">,</span> <span class="fst">f'</span><span class="op">{</span><span class="nam">att</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst"> dB</span><span class="fst">'</span><span class="op">,</span> <span class="nam">ha</span><span class="op">=</span><span class="str">'right'</span><span class="op">,</span> <span class="nam">va</span><span class="op">=</span><span class="str">'top'</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">10</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2150" href="#t2150">2150</a></span><span class="t">    <span class="nam">lowcutoff</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'lowcutoff'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2151" href="#t2151">2151</a></span><span class="t">    <span class="key">if</span> <span class="nam">lowcutoff</span> <span class="op">>=</span> <span class="nam">min_freq</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2152" href="#t2152">2152</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="op">[</span><span class="nam">lowcutoff</span><span class="op">,</span> <span class="nam">lowcutoff</span><span class="op">,</span> <span class="num">1.0</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">-</span><span class="num">60.0</span><span class="op">,</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">att</span><span class="op">,</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">att</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2153" href="#t2153">2153</a></span><span class="t">                <span class="nam">zorder</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="op">**</span><span class="nam">cstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2154" href="#t2154">2154</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="num">1.2</span><span class="op">*</span><span class="nam">lowcutoff</span><span class="op">,</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">att</span><span class="op">-</span><span class="num">1.0</span><span class="op">,</span> <span class="fst">f'</span><span class="op">{</span><span class="nam">lowcutoff</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst"> Hz</span><span class="fst">'</span><span class="op">,</span> <span class="nam">ha</span><span class="op">=</span><span class="str">'left'</span><span class="op">,</span> <span class="nam">va</span><span class="op">=</span><span class="str">'top'</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">10</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2155" href="#t2155">2155</a></span><span class="t">    <span class="nam">db</span> <span class="op">=</span> <span class="nam">decibel</span><span class="op">(</span><span class="nam">power</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2156" href="#t2156">2156</a></span><span class="t">    <span class="nam">smax</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">nanmax</span><span class="op">(</span><span class="nam">db</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2157" href="#t2157">2157</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">power</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">db</span> <span class="op">-</span> <span class="nam">smax</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="op">**</span><span class="nam">sstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2158" href="#t2158">2158</a></span><span class="t">    <span class="nam">peakfreq</span> <span class="op">=</span> <span class="nam">props</span><span class="op">[</span><span class="str">'peakfreq'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2159" href="#t2159">2159</a></span><span class="t">    <span class="key">if</span> <span class="nam">peakfreq</span> <span class="op">>=</span> <span class="nam">min_freq</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2160" href="#t2160">2160</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="op">[</span><span class="nam">peakfreq</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="num">0.0</span><span class="op">]</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">5</span><span class="op">,</span> <span class="op">**</span><span class="nam">pstyle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2161" href="#t2161">2161</a></span><span class="t">        <span class="nam">ax</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="nam">peakfreq</span><span class="op">*</span><span class="num">1.2</span><span class="op">,</span> <span class="num">1.0</span><span class="op">,</span> <span class="fst">f'</span><span class="op">{</span><span class="nam">peakfreq</span><span class="op">:</span><span class="fst">.0f</span><span class="op">}</span><span class="fst"> Hz</span><span class="fst">'</span><span class="op">,</span> <span class="nam">va</span><span class="op">=</span><span class="str">'bottom'</span><span class="op">,</span> <span class="nam">zorder</span><span class="op">=</span><span class="num">10</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2162" href="#t2162">2162</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">set_xlim</span><span class="op">(</span><span class="nam">min_freq</span><span class="op">,</span> <span class="nam">max_freq</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2163" href="#t2163">2163</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">set_xscale</span><span class="op">(</span><span class="str">'log'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2164" href="#t2164">2164</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">set_ylim</span><span class="op">(</span><span class="op">-</span><span class="num">60.0</span><span class="op">,</span> <span class="num">2.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2165" href="#t2165">2165</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">set_xlabel</span><span class="op">(</span><span class="str">'Frequency [Hz]'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2166" href="#t2166">2166</a></span><span class="t">    <span class="nam">ax</span><span class="op">.</span><span class="nam">set_ylabel</span><span class="op">(</span><span class="str">'Power [dB]'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2167" href="#t2167">2167</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2168" href="#t2168">2168</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2169" href="#t2169">2169</a></span><span class="t"><span class="key">def</span> <span class="nam">save_eod_waveform</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">idx</span><span class="op">,</span> <span class="nam">basename</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2170" href="#t2170">2170</a></span><span class="t">    <span class="str">"""Save mean EOD waveform to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2171" href="#t2171">2171</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2172" href="#t2172">2172</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2173" href="#t2173">2173</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2174" href="#t2174">2174</a></span><span class="t"><span class="str">    mean_eod: 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2175" href="#t2175">2175</a></span><span class="t"><span class="str">        Averaged EOD waveform as returned by `eod_waveform()`,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2176" href="#t2176">2176</a></span><span class="t"><span class="str">        `analyze_wave()`, and `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2177" href="#t2177">2177</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2178" href="#t2178">2178</a></span><span class="t"><span class="str">        Unit of the waveform data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2179" href="#t2179">2179</a></span><span class="t"><span class="str">    idx: int or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2180" href="#t2180">2180</a></span><span class="t"><span class="str">        Index of fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2181" href="#t2181">2181</a></span><span class="t"><span class="str">    basename: string or stream</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2182" href="#t2182">2182</a></span><span class="t"><span class="str">        If string, path and basename of file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2183" href="#t2183">2183</a></span><span class="t"><span class="str">        If `basename` does not have an extension,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2184" href="#t2184">2184</a></span><span class="t"><span class="str">        '-eodwaveform', the fish index, and a file extension are appended.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2185" href="#t2185">2185</a></span><span class="t"><span class="str">        If stream, write EOD waveform data into this stream.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2186" href="#t2186">2186</a></span><span class="t"><span class="str">    kwargs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2187" href="#t2187">2187</a></span><span class="t"><span class="str">        Arguments passed on to `TableData.write()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2188" href="#t2188">2188</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2189" href="#t2189">2189</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2190" href="#t2190">2190</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2191" href="#t2191">2191</a></span><span class="t"><span class="str">    filename: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2192" href="#t2192">2192</a></span><span class="t"><span class="str">        Path and full name of the written file in case of `basename`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2193" href="#t2193">2193</a></span><span class="t"><span class="str">        being a string. Otherwise, the file name and extension that</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2194" href="#t2194">2194</a></span><span class="t"><span class="str">        would have been appended to a basename.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2195" href="#t2195">2195</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2196" href="#t2196">2196</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2197" href="#t2197">2197</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2198" href="#t2198">2198</a></span><span class="t"><span class="str">    load_eod_waveform()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2199" href="#t2199">2199</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2200" href="#t2200">2200</a></span><span class="t">    <span class="nam">td</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="num">3</span><span class="op">]</span><span class="op">*</span><span class="op">[</span><span class="num">1000.0</span><span class="op">,</span> <span class="num">1.0</span><span class="op">,</span> <span class="num">1.0</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="str">'time'</span><span class="op">,</span> <span class="str">'mean'</span><span class="op">,</span> <span class="str">'sem'</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2201" href="#t2201">2201</a></span><span class="t">                   <span class="op">[</span><span class="str">'ms'</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">unit</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="str">'%.3f'</span><span class="op">,</span> <span class="str">'%.6g'</span><span class="op">,</span> <span class="str">'%.6g'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2202" href="#t2202">2202</a></span><span class="t">    <span class="key">if</span> <span class="nam">mean_eod</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">3</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2203" href="#t2203">2203</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'fit'</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="str">'%.5f'</span><span class="op">,</span> <span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">3</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2204" href="#t2204">2204</a></span><span class="t">    <span class="nam">_</span><span class="op">,</span> <span class="nam">ext</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">basename</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2205" href="#t2205">2205</a></span><span class="t">    <span class="nam">fp</span> <span class="op">=</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2206" href="#t2206">2206</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">ext</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2207" href="#t2207">2207</a></span><span class="t">        <span class="nam">fp</span> <span class="op">=</span> <span class="str">'-eodwaveform'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2208" href="#t2208">2208</a></span><span class="t">        <span class="key">if</span> <span class="nam">idx</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2209" href="#t2209">2209</a></span><span class="t">            <span class="nam">fp</span> <span class="op">+=</span> <span class="fst">f'</span><span class="fst">-</span><span class="op">{</span><span class="nam">idx</span><span class="op">}</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2210" href="#t2210">2210</a></span><span class="t">    <span class="key">return</span> <span class="nam">td</span><span class="op">.</span><span class="nam">write_file_stream</span><span class="op">(</span><span class="nam">basename</span><span class="op">,</span> <span class="nam">fp</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2211" href="#t2211">2211</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2212" href="#t2212">2212</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2213" href="#t2213">2213</a></span><span class="t"><span class="key">def</span> <span class="nam">load_eod_waveform</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2214" href="#t2214">2214</a></span><span class="t">    <span class="str">"""Load EOD waveform from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2215" href="#t2215">2215</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2216" href="#t2216">2216</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2217" href="#t2217">2217</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2218" href="#t2218">2218</a></span><span class="t"><span class="str">    file_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2219" href="#t2219">2219</a></span><span class="t"><span class="str">        Path of the file to be loaded.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2220" href="#t2220">2220</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2221" href="#t2221">2221</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2222" href="#t2222">2222</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2223" href="#t2223">2223</a></span><span class="t"><span class="str">    mean_eod: 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2224" href="#t2224">2224</a></span><span class="t"><span class="str">        Averaged EOD waveform: time in seconds, mean, standard deviation, fit.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2225" href="#t2225">2225</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2226" href="#t2226">2226</a></span><span class="t"><span class="str">        Unit of EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2227" href="#t2227">2227</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2228" href="#t2228">2228</a></span><span class="t"><span class="str">    Raises</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2229" href="#t2229">2229</a></span><span class="t"><span class="str">    ------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2230" href="#t2230">2230</a></span><span class="t"><span class="str">    FileNotFoundError:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2231" href="#t2231">2231</a></span><span class="t"><span class="str">        If `file_path` does not exist.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2232" href="#t2232">2232</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2233" href="#t2233">2233</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2234" href="#t2234">2234</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2235" href="#t2235">2235</a></span><span class="t"><span class="str">    save_eod_waveform()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2236" href="#t2236">2236</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2237" href="#t2237">2237</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2238" href="#t2238">2238</a></span><span class="t">    <span class="nam">mean_eod</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2239" href="#t2239">2239</a></span><span class="t">    <span class="nam">mean_eod</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">*=</span> <span class="num">0.001</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2240" href="#t2240">2240</a></span><span class="t">    <span class="key">return</span> <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">data</span><span class="op">.</span><span class="nam">unit</span><span class="op">(</span><span class="str">'mean'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2241" href="#t2241">2241</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2242" href="#t2242">2242</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2243" href="#t2243">2243</a></span><span class="t"><span class="key">def</span> <span class="nam">save_wave_eodfs</span><span class="op">(</span><span class="nam">wave_eodfs</span><span class="op">,</span> <span class="nam">wave_indices</span><span class="op">,</span> <span class="nam">basename</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2244" href="#t2244">2244</a></span><span class="t">    <span class="str">"""Save frequencies of wave EODs to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2245" href="#t2245">2245</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2246" href="#t2246">2246</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2247" href="#t2247">2247</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2248" href="#t2248">2248</a></span><span class="t"><span class="str">    wave_eodfs: list of 2D arrays</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2249" href="#t2249">2249</a></span><span class="t"><span class="str">        Each item is a matrix with the frequencies and powers</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2250" href="#t2250">2250</a></span><span class="t"><span class="str">        (columns) of the fundamental and harmonics (rows) as returned</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2251" href="#t2251">2251</a></span><span class="t"><span class="str">        by `harmonics.harmonic_groups()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2252" href="#t2252">2252</a></span><span class="t"><span class="str">    wave_indices: array</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2253" href="#t2253">2253</a></span><span class="t"><span class="str">        Indices identifying each fish or NaN.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2254" href="#t2254">2254</a></span><span class="t"><span class="str">        If None no index column is inserted.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2255" href="#t2255">2255</a></span><span class="t"><span class="str">    basename: string or stream</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2256" href="#t2256">2256</a></span><span class="t"><span class="str">        If string, path and basename of file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2257" href="#t2257">2257</a></span><span class="t"><span class="str">        If `basename` does not have an extension,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2258" href="#t2258">2258</a></span><span class="t"><span class="str">        '-waveeodfs' and a file extension according to `kwargs` are appended.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2259" href="#t2259">2259</a></span><span class="t"><span class="str">        If stream, write EOD frequencies data into this stream.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2260" href="#t2260">2260</a></span><span class="t"><span class="str">    kwargs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2261" href="#t2261">2261</a></span><span class="t"><span class="str">        Arguments passed on to `TableData.write()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2262" href="#t2262">2262</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2263" href="#t2263">2263</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2264" href="#t2264">2264</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2265" href="#t2265">2265</a></span><span class="t"><span class="str">    filename: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2266" href="#t2266">2266</a></span><span class="t"><span class="str">        Path and full name of the written file in case of `basename`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2267" href="#t2267">2267</a></span><span class="t"><span class="str">        being a string. Otherwise, the file name and extension that</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2268" href="#t2268">2268</a></span><span class="t"><span class="str">        would have been appended to a basename.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2269" href="#t2269">2269</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2270" href="#t2270">2270</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2271" href="#t2271">2271</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2272" href="#t2272">2272</a></span><span class="t"><span class="str">    load_wave_eodfs()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2273" href="#t2273">2273</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2274" href="#t2274">2274</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2275" href="#t2275">2275</a></span><span class="t">    <span class="nam">eodfs</span> <span class="op">=</span> <span class="nam">fundamental_freqs_and_power</span><span class="op">(</span><span class="nam">wave_eodfs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2276" href="#t2276">2276</a></span><span class="t">    <span class="nam">td</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2277" href="#t2277">2277</a></span><span class="t">    <span class="key">if</span> <span class="nam">wave_indices</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2278" href="#t2278">2278</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'index'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="op">[</span><span class="nam">wi</span> <span class="key">if</span> <span class="nam">wi</span> <span class="op">>=</span> <span class="num">0</span> <span class="key">else</span> <span class="nam">np</span><span class="op">.</span><span class="nam">nan</span> <span class="key">for</span> <span class="nam">wi</span> <span class="key">in</span> <span class="nam">wave_indices</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2279" href="#t2279">2279</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'EODf'</span><span class="op">,</span> <span class="str">'Hz'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">eodfs</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2280" href="#t2280">2280</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'datapower'</span><span class="op">,</span> <span class="str">'dB'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">eodfs</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2281" href="#t2281">2281</a></span><span class="t">    <span class="nam">_</span><span class="op">,</span> <span class="nam">ext</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">basename</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2282" href="#t2282">2282</a></span><span class="t">    <span class="nam">fp</span> <span class="op">=</span> <span class="str">'-waveeodfs'</span> <span class="key">if</span> <span class="key">not</span> <span class="nam">ext</span> <span class="key">else</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2283" href="#t2283">2283</a></span><span class="t">    <span class="key">return</span> <span class="nam">td</span><span class="op">.</span><span class="nam">write_file_stream</span><span class="op">(</span><span class="nam">basename</span><span class="op">,</span> <span class="nam">fp</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2284" href="#t2284">2284</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2285" href="#t2285">2285</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2286" href="#t2286">2286</a></span><span class="t"><span class="key">def</span> <span class="nam">load_wave_eodfs</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2287" href="#t2287">2287</a></span><span class="t">    <span class="str">"""Load frequencies of wave EODs from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2288" href="#t2288">2288</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2289" href="#t2289">2289</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2290" href="#t2290">2290</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2291" href="#t2291">2291</a></span><span class="t"><span class="str">    file_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2292" href="#t2292">2292</a></span><span class="t"><span class="str">        Path of the file to be loaded.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2293" href="#t2293">2293</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2294" href="#t2294">2294</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2295" href="#t2295">2295</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2296" href="#t2296">2296</a></span><span class="t"><span class="str">    eodfs: 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2297" href="#t2297">2297</a></span><span class="t"><span class="str">        EODfs and power of wave type fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2298" href="#t2298">2298</a></span><span class="t"><span class="str">    indices: array of ints</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2299" href="#t2299">2299</a></span><span class="t"><span class="str">        Corresponding indices of fish, can contain negative numbers to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2300" href="#t2300">2300</a></span><span class="t"><span class="str">        indicate frequencies without fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2301" href="#t2301">2301</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2302" href="#t2302">2302</a></span><span class="t"><span class="str">    Raises</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2303" href="#t2303">2303</a></span><span class="t"><span class="str">    ------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2304" href="#t2304">2304</a></span><span class="t"><span class="str">    FileNotFoundError:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2305" href="#t2305">2305</a></span><span class="t"><span class="str">        If `file_path` does not exist.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2306" href="#t2306">2306</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2307" href="#t2307">2307</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2308" href="#t2308">2308</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2309" href="#t2309">2309</a></span><span class="t"><span class="str">    save_wave_eodfs()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2310" href="#t2310">2310</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2311" href="#t2311">2311</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2312" href="#t2312">2312</a></span><span class="t">    <span class="nam">eodfs</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2313" href="#t2313">2313</a></span><span class="t">    <span class="key">if</span> <span class="str">'index'</span> <span class="key">in</span> <span class="nam">data</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2314" href="#t2314">2314</a></span><span class="t">        <span class="nam">indices</span> <span class="op">=</span> <span class="nam">data</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="str">'index'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2315" href="#t2315">2315</a></span><span class="t">        <span class="nam">indices</span><span class="op">[</span><span class="op">~</span><span class="nam">np</span><span class="op">.</span><span class="nam">isfinite</span><span class="op">(</span><span class="nam">indices</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2316" href="#t2316">2316</a></span><span class="t">        <span class="nam">indices</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="nam">indices</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">int</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2317" href="#t2317">2317</a></span><span class="t">        <span class="nam">eodfs</span> <span class="op">=</span> <span class="nam">eodfs</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2318" href="#t2318">2318</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2319" href="#t2319">2319</a></span><span class="t">        <span class="nam">indices</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="nam">data</span><span class="op">.</span><span class="nam">rows</span><span class="op">(</span><span class="op">)</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">int</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2320" href="#t2320">2320</a></span><span class="t">    <span class="key">return</span> <span class="nam">eodfs</span><span class="op">,</span> <span class="nam">indices</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2321" href="#t2321">2321</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2322" href="#t2322">2322</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2323" href="#t2323">2323</a></span><span class="t"><span class="key">def</span> <span class="nam">save_wave_fish</span><span class="op">(</span><span class="nam">eod_props</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">basename</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2324" href="#t2324">2324</a></span><span class="t">    <span class="str">"""Save properties of wave EODs to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2325" href="#t2325">2325</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2326" href="#t2326">2326</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2327" href="#t2327">2327</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2328" href="#t2328">2328</a></span><span class="t"><span class="str">    eod_props: list of dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2329" href="#t2329">2329</a></span><span class="t"><span class="str">        Properties of EODs as returned by `analyze_wave()` and</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2330" href="#t2330">2330</a></span><span class="t"><span class="str">        `analyze_pulse()`.  Only properties of wave fish are saved.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2331" href="#t2331">2331</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2332" href="#t2332">2332</a></span><span class="t"><span class="str">        Unit of the waveform data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2333" href="#t2333">2333</a></span><span class="t"><span class="str">    basename: string or stream</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2334" href="#t2334">2334</a></span><span class="t"><span class="str">        If string, path and basename of file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2335" href="#t2335">2335</a></span><span class="t"><span class="str">        If `basename` does not have an extension,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2336" href="#t2336">2336</a></span><span class="t"><span class="str">        '-wavefish' and a file extension are appended.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2337" href="#t2337">2337</a></span><span class="t"><span class="str">        If stream, write wave fish properties into this stream.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2338" href="#t2338">2338</a></span><span class="t"><span class="str">    kwargs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2339" href="#t2339">2339</a></span><span class="t"><span class="str">        Arguments passed on to `TableData.write()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2340" href="#t2340">2340</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2341" href="#t2341">2341</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2342" href="#t2342">2342</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2343" href="#t2343">2343</a></span><span class="t"><span class="str">    filename: string or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2344" href="#t2344">2344</a></span><span class="t"><span class="str">        Path and full name of the written file in case of `basename`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2345" href="#t2345">2345</a></span><span class="t"><span class="str">        being a string. Otherwise, the file name and extension that</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2346" href="#t2346">2346</a></span><span class="t"><span class="str">        would have been appended to a basename.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2347" href="#t2347">2347</a></span><span class="t"><span class="str">        None if no wave fish are contained in eod_props and</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2348" href="#t2348">2348</a></span><span class="t"><span class="str">        consequently no file was written.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2349" href="#t2349">2349</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2350" href="#t2350">2350</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2351" href="#t2351">2351</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2352" href="#t2352">2352</a></span><span class="t"><span class="str">    load_wave_fish()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2353" href="#t2353">2353</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2354" href="#t2354">2354</a></span><span class="t">    <span class="nam">wave_props</span> <span class="op">=</span> <span class="op">[</span><span class="nam">p</span> <span class="key">for</span> <span class="nam">p</span> <span class="key">in</span> <span class="nam">eod_props</span> <span class="key">if</span> <span class="nam">p</span><span class="op">[</span><span class="str">'type'</span><span class="op">]</span> <span class="op">==</span> <span class="str">'wave'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2355" href="#t2355">2355</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">wave_props</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2356" href="#t2356">2356</a></span><span class="t">        <span class="key">return</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2357" href="#t2357">2357</a></span><span class="t">    <span class="nam">td</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2358" href="#t2358">2358</a></span><span class="t">    <span class="key">if</span> <span class="str">'twin'</span> <span class="key">in</span> <span class="nam">wave_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">or</span> <span class="str">'rate'</span> <span class="key">in</span> <span class="nam">wave_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">or</span> <span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2359" href="#t2359">2359</a></span><span class="t">       <span class="str">'nfft'</span> <span class="key">in</span> <span class="nam">wave_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2360" href="#t2360">2360</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append_section</span><span class="op">(</span><span class="str">'recording'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2361" href="#t2361">2361</a></span><span class="t">    <span class="key">if</span> <span class="str">'twin'</span> <span class="key">in</span> <span class="nam">wave_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2362" href="#t2362">2362</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'twin'</span><span class="op">,</span> <span class="str">'s'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2363" href="#t2363">2363</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'window'</span><span class="op">,</span> <span class="str">'s'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2364" href="#t2364">2364</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'winclipped'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2365" href="#t2365">2365</a></span><span class="t">    <span class="key">if</span> <span class="str">'samplerate'</span> <span class="key">in</span> <span class="nam">wave_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2366" href="#t2366">2366</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'samplerate'</span><span class="op">,</span> <span class="str">'kHz'</span><span class="op">,</span> <span class="str">'%.3f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">0.001</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2367" href="#t2367">2367</a></span><span class="t">    <span class="key">if</span> <span class="str">'nfft'</span> <span class="key">in</span> <span class="nam">wave_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2368" href="#t2368">2368</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'nfft'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2369" href="#t2369">2369</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'dfreq'</span><span class="op">,</span> <span class="str">'Hz'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2370" href="#t2370">2370</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append_section</span><span class="op">(</span><span class="str">'waveform'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2371" href="#t2371">2371</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'index'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2372" href="#t2372">2372</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'EODf'</span><span class="op">,</span> <span class="str">'Hz'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2373" href="#t2373">2373</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'p-p-amplitude'</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="str">'%.5f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2374" href="#t2374">2374</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'power'</span><span class="op">,</span> <span class="str">'dB'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2375" href="#t2375">2375</a></span><span class="t">    <span class="key">if</span> <span class="str">'datapower'</span> <span class="key">in</span> <span class="nam">wave_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2376" href="#t2376">2376</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'datapower'</span><span class="op">,</span> <span class="str">'dB'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2377" href="#t2377">2377</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'thd'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2378" href="#t2378">2378</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'dbdiff'</span><span class="op">,</span> <span class="str">'dB'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2379" href="#t2379">2379</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'maxdb'</span><span class="op">,</span> <span class="str">'dB'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2380" href="#t2380">2380</a></span><span class="t">    <span class="key">if</span> <span class="str">'noise'</span> <span class="key">in</span> <span class="nam">wave_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2381" href="#t2381">2381</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'noise'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.1f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2382" href="#t2382">2382</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'rmserror'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2383" href="#t2383">2383</a></span><span class="t">    <span class="key">if</span> <span class="str">'clipped'</span> <span class="key">in</span> <span class="nam">wave_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2384" href="#t2384">2384</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'clipped'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.1f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2385" href="#t2385">2385</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'flipped'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2386" href="#t2386">2386</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'n'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%5d'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2387" href="#t2387">2387</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append_section</span><span class="op">(</span><span class="str">'timing'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2388" href="#t2388">2388</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'ncrossings'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2389" href="#t2389">2389</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'peakwidth'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2390" href="#t2390">2390</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'troughwidth'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2391" href="#t2391">2391</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'minwidth'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2392" href="#t2392">2392</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'leftpeak'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2393" href="#t2393">2393</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'rightpeak'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2394" href="#t2394">2394</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'lefttrough'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2395" href="#t2395">2395</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'righttrough'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2396" href="#t2396">2396</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'p-p-distance'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2397" href="#t2397">2397</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'min-p-p-distance'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2398" href="#t2398">2398</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'relpeakampl'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">wave_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2399" href="#t2399">2399</a></span><span class="t">    <span class="nam">_</span><span class="op">,</span> <span class="nam">ext</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">basename</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2400" href="#t2400">2400</a></span><span class="t">    <span class="nam">fp</span> <span class="op">=</span> <span class="str">'-wavefish'</span> <span class="key">if</span> <span class="key">not</span> <span class="nam">ext</span> <span class="key">else</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2401" href="#t2401">2401</a></span><span class="t">    <span class="key">return</span> <span class="nam">td</span><span class="op">.</span><span class="nam">write_file_stream</span><span class="op">(</span><span class="nam">basename</span><span class="op">,</span> <span class="nam">fp</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2402" href="#t2402">2402</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2403" href="#t2403">2403</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2404" href="#t2404">2404</a></span><span class="t"><span class="key">def</span> <span class="nam">load_wave_fish</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2405" href="#t2405">2405</a></span><span class="t">    <span class="str">"""Load properties of wave EODs from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2406" href="#t2406">2406</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2407" href="#t2407">2407</a></span><span class="t"><span class="str">    All times are scaled to seconds, all frequencies to Hertz and all</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2408" href="#t2408">2408</a></span><span class="t"><span class="str">    percentages to fractions.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2409" href="#t2409">2409</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2410" href="#t2410">2410</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2411" href="#t2411">2411</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2412" href="#t2412">2412</a></span><span class="t"><span class="str">    file_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2413" href="#t2413">2413</a></span><span class="t"><span class="str">        Path of the file to be loaded.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2414" href="#t2414">2414</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2415" href="#t2415">2415</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2416" href="#t2416">2416</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2417" href="#t2417">2417</a></span><span class="t"><span class="str">    eod_props: list of dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2418" href="#t2418">2418</a></span><span class="t"><span class="str">        Properties of EODs.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2419" href="#t2419">2419</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2420" href="#t2420">2420</a></span><span class="t"><span class="str">    Raises</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2421" href="#t2421">2421</a></span><span class="t"><span class="str">    ------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2422" href="#t2422">2422</a></span><span class="t"><span class="str">    FileNotFoundError:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2423" href="#t2423">2423</a></span><span class="t"><span class="str">        If `file_path` does not exist.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2424" href="#t2424">2424</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2425" href="#t2425">2425</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2426" href="#t2426">2426</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2427" href="#t2427">2427</a></span><span class="t"><span class="str">    save_wave_fish()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2428" href="#t2428">2428</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2429" href="#t2429">2429</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2430" href="#t2430">2430</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2431" href="#t2431">2431</a></span><span class="t">    <span class="nam">eod_props</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">dicts</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2432" href="#t2432">2432</a></span><span class="t">    <span class="key">for</span> <span class="nam">props</span> <span class="key">in</span> <span class="nam">eod_props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2433" href="#t2433">2433</a></span><span class="t">        <span class="key">if</span> <span class="str">'winclipped'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2434" href="#t2434">2434</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'winclipped'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2435" href="#t2435">2435</a></span><span class="t">        <span class="key">if</span> <span class="str">'samplerate'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2436" href="#t2436">2436</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'samplerate'</span><span class="op">]</span> <span class="op">*=</span> <span class="num">1000</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2437" href="#t2437">2437</a></span><span class="t">        <span class="key">if</span> <span class="str">'nfft'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2438" href="#t2438">2438</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'nfft'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">props</span><span class="op">[</span><span class="str">'nfft'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2439" href="#t2439">2439</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'index'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">props</span><span class="op">[</span><span class="str">'index'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2440" href="#t2440">2440</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'n'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">props</span><span class="op">[</span><span class="str">'n'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2441" href="#t2441">2441</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'type'</span><span class="op">]</span> <span class="op">=</span> <span class="str">'wave'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2442" href="#t2442">2442</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'thd'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2443" href="#t2443">2443</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'noise'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2444" href="#t2444">2444</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'rmserror'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2445" href="#t2445">2445</a></span><span class="t">        <span class="key">if</span> <span class="str">'clipped'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2446" href="#t2446">2446</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'clipped'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2447" href="#t2447">2447</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'ncrossings'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">props</span><span class="op">[</span><span class="str">'ncrossings'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2448" href="#t2448">2448</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'peakwidth'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2449" href="#t2449">2449</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'troughwidth'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2450" href="#t2450">2450</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'minwidth'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2451" href="#t2451">2451</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'leftpeak'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2452" href="#t2452">2452</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'rightpeak'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2453" href="#t2453">2453</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'lefttrough'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2454" href="#t2454">2454</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'righttrough'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2455" href="#t2455">2455</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'p-p-distance'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2456" href="#t2456">2456</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'min-p-p-distance'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2457" href="#t2457">2457</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'relpeakampl'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2458" href="#t2458">2458</a></span><span class="t">    <span class="key">return</span> <span class="nam">eod_props</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2459" href="#t2459">2459</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2460" href="#t2460">2460</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2461" href="#t2461">2461</a></span><span class="t"><span class="key">def</span> <span class="nam">save_pulse_fish</span><span class="op">(</span><span class="nam">eod_props</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">basename</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2462" href="#t2462">2462</a></span><span class="t">    <span class="str">"""Save properties of pulse EODs to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2463" href="#t2463">2463</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2464" href="#t2464">2464</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2465" href="#t2465">2465</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2466" href="#t2466">2466</a></span><span class="t"><span class="str">    eod_props: list of dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2467" href="#t2467">2467</a></span><span class="t"><span class="str">        Properties of EODs as returned by `analyze_wave()` and</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2468" href="#t2468">2468</a></span><span class="t"><span class="str">        `analyze_pulse()`.  Only properties of pulse fish are saved.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2469" href="#t2469">2469</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2470" href="#t2470">2470</a></span><span class="t"><span class="str">        Unit of the waveform data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2471" href="#t2471">2471</a></span><span class="t"><span class="str">    basename: string or stream</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2472" href="#t2472">2472</a></span><span class="t"><span class="str">        If string, path and basename of file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2473" href="#t2473">2473</a></span><span class="t"><span class="str">        If `basename` does not have an extension,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2474" href="#t2474">2474</a></span><span class="t"><span class="str">        '-pulsefish' and a file extension are appended.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2475" href="#t2475">2475</a></span><span class="t"><span class="str">        If stream, write pulse fish properties into this stream.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2476" href="#t2476">2476</a></span><span class="t"><span class="str">    kwargs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2477" href="#t2477">2477</a></span><span class="t"><span class="str">        Arguments passed on to `TableData.write()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2478" href="#t2478">2478</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2479" href="#t2479">2479</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2480" href="#t2480">2480</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2481" href="#t2481">2481</a></span><span class="t"><span class="str">    filename: string or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2482" href="#t2482">2482</a></span><span class="t"><span class="str">        Path and full name of the written file in case of `basename`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2483" href="#t2483">2483</a></span><span class="t"><span class="str">        being a string. Otherwise, the file name and extension that</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2484" href="#t2484">2484</a></span><span class="t"><span class="str">        would have been appended to a basename.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2485" href="#t2485">2485</a></span><span class="t"><span class="str">        None if no pulse fish are contained in eod_props and</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2486" href="#t2486">2486</a></span><span class="t"><span class="str">        consequently no file was written.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2487" href="#t2487">2487</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2488" href="#t2488">2488</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2489" href="#t2489">2489</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2490" href="#t2490">2490</a></span><span class="t"><span class="str">    load_pulse_fish()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2491" href="#t2491">2491</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2492" href="#t2492">2492</a></span><span class="t">    <span class="nam">pulse_props</span> <span class="op">=</span> <span class="op">[</span><span class="nam">p</span> <span class="key">for</span> <span class="nam">p</span> <span class="key">in</span> <span class="nam">eod_props</span> <span class="key">if</span> <span class="nam">p</span><span class="op">[</span><span class="str">'type'</span><span class="op">]</span> <span class="op">==</span> <span class="str">'pulse'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2493" href="#t2493">2493</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">pulse_props</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2494" href="#t2494">2494</a></span><span class="t">        <span class="key">return</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2495" href="#t2495">2495</a></span><span class="t">    <span class="nam">td</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2496" href="#t2496">2496</a></span><span class="t">    <span class="key">if</span> <span class="str">'twin'</span> <span class="key">in</span> <span class="nam">pulse_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">or</span> <span class="str">'samplerate'</span> <span class="key">in</span> <span class="nam">pulse_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">or</span> <span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2497" href="#t2497">2497</a></span><span class="t">       <span class="str">'nfft'</span> <span class="key">in</span> <span class="nam">pulse_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2498" href="#t2498">2498</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append_section</span><span class="op">(</span><span class="str">'recording'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2499" href="#t2499">2499</a></span><span class="t">    <span class="key">if</span> <span class="str">'twin'</span> <span class="key">in</span> <span class="nam">pulse_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2500" href="#t2500">2500</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'twin'</span><span class="op">,</span> <span class="str">'s'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2501" href="#t2501">2501</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'window'</span><span class="op">,</span> <span class="str">'s'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2502" href="#t2502">2502</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'winclipped'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2503" href="#t2503">2503</a></span><span class="t">    <span class="key">if</span> <span class="str">'samplerate'</span> <span class="key">in</span> <span class="nam">pulse_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2504" href="#t2504">2504</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'samplerate'</span><span class="op">,</span> <span class="str">'kHz'</span><span class="op">,</span> <span class="str">'%.3f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">0.001</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2505" href="#t2505">2505</a></span><span class="t">    <span class="key">if</span> <span class="str">'nfft'</span> <span class="key">in</span> <span class="nam">pulse_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2506" href="#t2506">2506</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'nfft'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2507" href="#t2507">2507</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'dfreq'</span><span class="op">,</span> <span class="str">'Hz'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2508" href="#t2508">2508</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append_section</span><span class="op">(</span><span class="str">'waveform'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2509" href="#t2509">2509</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'index'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2510" href="#t2510">2510</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'EODf'</span><span class="op">,</span> <span class="str">'Hz'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2511" href="#t2511">2511</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'period'</span><span class="op">,</span> <span class="str">'ms'</span><span class="op">,</span> <span class="str">'%7.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">1000.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2512" href="#t2512">2512</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'max-ampl'</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="str">'%.5f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2513" href="#t2513">2513</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'min-ampl'</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="str">'%.5f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2514" href="#t2514">2514</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'p-p-amplitude'</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="str">'%.5f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2515" href="#t2515">2515</a></span><span class="t">    <span class="key">if</span> <span class="str">'noise'</span> <span class="key">in</span> <span class="nam">pulse_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2516" href="#t2516">2516</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'noise'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2517" href="#t2517">2517</a></span><span class="t">    <span class="key">if</span> <span class="str">'clipped'</span> <span class="key">in</span> <span class="nam">pulse_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2518" href="#t2518">2518</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'clipped'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2519" href="#t2519">2519</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'flipped'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2520" href="#t2520">2520</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'tstart'</span><span class="op">,</span> <span class="str">'ms'</span><span class="op">,</span> <span class="str">'%.3f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">1000.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2521" href="#t2521">2521</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'tend'</span><span class="op">,</span> <span class="str">'ms'</span><span class="op">,</span> <span class="str">'%.3f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">1000.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2522" href="#t2522">2522</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'width'</span><span class="op">,</span> <span class="str">'ms'</span><span class="op">,</span> <span class="str">'%.3f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">1000.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2523" href="#t2523">2523</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'P2-P1-dist'</span><span class="op">,</span> <span class="str">'ms'</span><span class="op">,</span> <span class="str">'%.3f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">1000.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2524" href="#t2524">2524</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'tau'</span><span class="op">,</span> <span class="str">'ms'</span><span class="op">,</span> <span class="str">'%.3f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">1000.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2525" href="#t2525">2525</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'firstpeak'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2526" href="#t2526">2526</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'lastpeak'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2527" href="#t2527">2527</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'totalarea'</span><span class="op">,</span> <span class="fst">f'</span><span class="op">{</span><span class="nam">unit</span><span class="op">}</span><span class="fst">*ms</span><span class="fst">'</span><span class="op">,</span> <span class="str">'%.4f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">1000.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2528" href="#t2528">2528</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'positivearea'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2529" href="#t2529">2529</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'negativearea'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2530" href="#t2530">2530</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'polaritybalance'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">,</span> <span class="num">100.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2531" href="#t2531">2531</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'n'</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'%d'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2532" href="#t2532">2532</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append_section</span><span class="op">(</span><span class="str">'power spectrum'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2533" href="#t2533">2533</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'peakfreq'</span><span class="op">,</span> <span class="str">'Hz'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2534" href="#t2534">2534</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'peakpower'</span><span class="op">,</span> <span class="str">'dB'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2535" href="#t2535">2535</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'poweratt5'</span><span class="op">,</span> <span class="str">'dB'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2536" href="#t2536">2536</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'poweratt50'</span><span class="op">,</span> <span class="str">'dB'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2537" href="#t2537">2537</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'lowcutoff'</span><span class="op">,</span> <span class="str">'Hz'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="nam">pulse_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2538" href="#t2538">2538</a></span><span class="t">    <span class="nam">_</span><span class="op">,</span> <span class="nam">ext</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">basename</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2539" href="#t2539">2539</a></span><span class="t">    <span class="nam">fp</span> <span class="op">=</span> <span class="str">'-pulsefish'</span> <span class="key">if</span> <span class="key">not</span> <span class="nam">ext</span> <span class="key">else</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2540" href="#t2540">2540</a></span><span class="t">    <span class="key">return</span> <span class="nam">td</span><span class="op">.</span><span class="nam">write_file_stream</span><span class="op">(</span><span class="nam">basename</span><span class="op">,</span> <span class="nam">fp</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2541" href="#t2541">2541</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2542" href="#t2542">2542</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2543" href="#t2543">2543</a></span><span class="t"><span class="key">def</span> <span class="nam">load_pulse_fish</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2544" href="#t2544">2544</a></span><span class="t">    <span class="str">"""Load properties of pulse EODs from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2545" href="#t2545">2545</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2546" href="#t2546">2546</a></span><span class="t"><span class="str">    All times are scaled to seconds, all frequencies to Hertz and all</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2547" href="#t2547">2547</a></span><span class="t"><span class="str">    percentages to fractions.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2548" href="#t2548">2548</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2549" href="#t2549">2549</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2550" href="#t2550">2550</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2551" href="#t2551">2551</a></span><span class="t"><span class="str">    file_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2552" href="#t2552">2552</a></span><span class="t"><span class="str">        Path of the file to be loaded.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2553" href="#t2553">2553</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2554" href="#t2554">2554</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2555" href="#t2555">2555</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2556" href="#t2556">2556</a></span><span class="t"><span class="str">    eod_props: list of dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2557" href="#t2557">2557</a></span><span class="t"><span class="str">        Properties of EODs.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2558" href="#t2558">2558</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2559" href="#t2559">2559</a></span><span class="t"><span class="str">    Raises</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2560" href="#t2560">2560</a></span><span class="t"><span class="str">    ------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2561" href="#t2561">2561</a></span><span class="t"><span class="str">    FileNotFoundError:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2562" href="#t2562">2562</a></span><span class="t"><span class="str">        If `file_path` does not exist.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2563" href="#t2563">2563</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2564" href="#t2564">2564</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2565" href="#t2565">2565</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2566" href="#t2566">2566</a></span><span class="t"><span class="str">    save_pulse_fish()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2567" href="#t2567">2567</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2568" href="#t2568">2568</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2569" href="#t2569">2569</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2570" href="#t2570">2570</a></span><span class="t">    <span class="nam">eod_props</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">dicts</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2571" href="#t2571">2571</a></span><span class="t">    <span class="key">for</span> <span class="nam">props</span> <span class="key">in</span> <span class="nam">eod_props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2572" href="#t2572">2572</a></span><span class="t">        <span class="key">if</span> <span class="str">'winclipped'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2573" href="#t2573">2573</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'winclipped'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2574" href="#t2574">2574</a></span><span class="t">        <span class="key">if</span> <span class="str">'samplerate'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2575" href="#t2575">2575</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'samplerate'</span><span class="op">]</span> <span class="op">*=</span> <span class="num">1000</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2576" href="#t2576">2576</a></span><span class="t">        <span class="key">if</span> <span class="str">'nfft'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2577" href="#t2577">2577</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'nfft'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">props</span><span class="op">[</span><span class="str">'nfft'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2578" href="#t2578">2578</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'index'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">props</span><span class="op">[</span><span class="str">'index'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2579" href="#t2579">2579</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'n'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">props</span><span class="op">[</span><span class="str">'n'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2580" href="#t2580">2580</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'firstpeak'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">props</span><span class="op">[</span><span class="str">'firstpeak'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2581" href="#t2581">2581</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'lastpeak'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">props</span><span class="op">[</span><span class="str">'lastpeak'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2582" href="#t2582">2582</a></span><span class="t">        <span class="key">if</span> <span class="str">'totalarea'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2583" href="#t2583">2583</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'totalarea'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">1000</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2584" href="#t2584">2584</a></span><span class="t">        <span class="key">if</span> <span class="str">'positivearea'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2585" href="#t2585">2585</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'positivearea'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2586" href="#t2586">2586</a></span><span class="t">        <span class="key">if</span> <span class="str">'negativearea'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2587" href="#t2587">2587</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'negativearea'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2588" href="#t2588">2588</a></span><span class="t">        <span class="key">if</span> <span class="str">'polaritybalance'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2589" href="#t2589">2589</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'polaritybalance'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2590" href="#t2590">2590</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'type'</span><span class="op">]</span> <span class="op">=</span> <span class="str">'pulse'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2591" href="#t2591">2591</a></span><span class="t">        <span class="key">if</span> <span class="str">'clipped'</span> <span class="key">in</span> <span class="nam">props</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2592" href="#t2592">2592</a></span><span class="t">            <span class="nam">props</span><span class="op">[</span><span class="str">'clipped'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2593" href="#t2593">2593</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'period'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">1000</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2594" href="#t2594">2594</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'noise'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2595" href="#t2595">2595</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'tstart'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">1000</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2596" href="#t2596">2596</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'tend'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">1000</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2597" href="#t2597">2597</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'width'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">1000</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2598" href="#t2598">2598</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'P2-P1-dist'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">1000</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2599" href="#t2599">2599</a></span><span class="t">        <span class="nam">props</span><span class="op">[</span><span class="str">'tau'</span><span class="op">]</span> <span class="op">/=</span> <span class="num">1000</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2600" href="#t2600">2600</a></span><span class="t">    <span class="key">return</span> <span class="nam">eod_props</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2601" href="#t2601">2601</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2602" href="#t2602">2602</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2603" href="#t2603">2603</a></span><span class="t"><span class="key">def</span> <span class="nam">save_wave_spectrum</span><span class="op">(</span><span class="nam">spec_data</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">idx</span><span class="op">,</span> <span class="nam">basename</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2604" href="#t2604">2604</a></span><span class="t">    <span class="str">"""Save amplitude and phase spectrum of wave EOD to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2605" href="#t2605">2605</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2606" href="#t2606">2606</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2607" href="#t2607">2607</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2608" href="#t2608">2608</a></span><span class="t"><span class="str">    spec_data: 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2609" href="#t2609">2609</a></span><span class="t"><span class="str">        Amplitude and phase spectrum of wave EOD as returned by</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2610" href="#t2610">2610</a></span><span class="t"><span class="str">        `analyze_wave()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2611" href="#t2611">2611</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2612" href="#t2612">2612</a></span><span class="t"><span class="str">        Unit of the waveform data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2613" href="#t2613">2613</a></span><span class="t"><span class="str">    idx: int or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2614" href="#t2614">2614</a></span><span class="t"><span class="str">        Index of fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2615" href="#t2615">2615</a></span><span class="t"><span class="str">    basename: string or stream</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2616" href="#t2616">2616</a></span><span class="t"><span class="str">        If string, path and basename of file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2617" href="#t2617">2617</a></span><span class="t"><span class="str">        If `basename` does not have an extension,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2618" href="#t2618">2618</a></span><span class="t"><span class="str">        '-wavespectrum', the fish index, and a file extension are appended.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2619" href="#t2619">2619</a></span><span class="t"><span class="str">        If stream, write wave spectrum into this stream.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2620" href="#t2620">2620</a></span><span class="t"><span class="str">    kwargs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2621" href="#t2621">2621</a></span><span class="t"><span class="str">        Arguments passed on to `TableData.write()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2622" href="#t2622">2622</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2623" href="#t2623">2623</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2624" href="#t2624">2624</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2625" href="#t2625">2625</a></span><span class="t"><span class="str">    filename: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2626" href="#t2626">2626</a></span><span class="t"><span class="str">        Path and full name of the written file in case of `basename`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2627" href="#t2627">2627</a></span><span class="t"><span class="str">        being a string. Otherwise, the file name and extension that</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2628" href="#t2628">2628</a></span><span class="t"><span class="str">        would have been appended to a basename.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2629" href="#t2629">2629</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2630" href="#t2630">2630</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2631" href="#t2631">2631</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2632" href="#t2632">2632</a></span><span class="t"><span class="str">    load_wave_spectrum()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2633" href="#t2633">2633</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2634" href="#t2634">2634</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2635" href="#t2635">2635</a></span><span class="t">    <span class="nam">td</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">spec_data</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="num">6</span><span class="op">]</span><span class="op">*</span><span class="op">[</span><span class="num">1.0</span><span class="op">,</span> <span class="num">1.0</span><span class="op">,</span> <span class="num">1.0</span><span class="op">,</span> <span class="num">100.0</span><span class="op">,</span> <span class="num">1.0</span><span class="op">,</span> <span class="num">1.0</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2636" href="#t2636">2636</a></span><span class="t">                   <span class="op">[</span><span class="str">'harmonics'</span><span class="op">,</span> <span class="str">'frequency'</span><span class="op">,</span> <span class="str">'amplitude'</span><span class="op">,</span> <span class="str">'relampl'</span><span class="op">,</span> <span class="str">'relpower'</span><span class="op">,</span> <span class="str">'phase'</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2637" href="#t2637">2637</a></span><span class="t">                   <span class="op">[</span><span class="str">''</span><span class="op">,</span> <span class="str">'Hz'</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'dB'</span><span class="op">,</span> <span class="str">'rad'</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2638" href="#t2638">2638</a></span><span class="t">                   <span class="op">[</span><span class="str">'%.0f'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="str">'%.6f'</span><span class="op">,</span> <span class="str">'%10.2f'</span><span class="op">,</span> <span class="str">'%6.2f'</span><span class="op">,</span> <span class="str">'%8.4f'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2639" href="#t2639">2639</a></span><span class="t">    <span class="key">if</span> <span class="nam">spec_data</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">6</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2640" href="#t2640">2640</a></span><span class="t">        <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'datapower'</span><span class="op">,</span> <span class="str">'%s^2/Hz'</span> <span class="op">%</span> <span class="nam">unit</span><span class="op">,</span> <span class="str">'%11.4e'</span><span class="op">,</span> <span class="nam">spec_data</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">6</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2641" href="#t2641">2641</a></span><span class="t">    <span class="nam">_</span><span class="op">,</span> <span class="nam">ext</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">basename</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2642" href="#t2642">2642</a></span><span class="t">    <span class="nam">fp</span> <span class="op">=</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2643" href="#t2643">2643</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">ext</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2644" href="#t2644">2644</a></span><span class="t">        <span class="nam">fp</span> <span class="op">=</span> <span class="str">'-wavespectrum'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2645" href="#t2645">2645</a></span><span class="t">        <span class="key">if</span> <span class="nam">idx</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2646" href="#t2646">2646</a></span><span class="t">            <span class="nam">fp</span> <span class="op">+=</span> <span class="str">'-%d'</span> <span class="op">%</span> <span class="nam">idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2647" href="#t2647">2647</a></span><span class="t">    <span class="key">return</span> <span class="nam">td</span><span class="op">.</span><span class="nam">write_file_stream</span><span class="op">(</span><span class="nam">basename</span><span class="op">,</span> <span class="nam">fp</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2648" href="#t2648">2648</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2649" href="#t2649">2649</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2650" href="#t2650">2650</a></span><span class="t"><span class="key">def</span> <span class="nam">load_wave_spectrum</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2651" href="#t2651">2651</a></span><span class="t">    <span class="str">"""Load amplitude and phase spectrum of wave EOD from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2652" href="#t2652">2652</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2653" href="#t2653">2653</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2654" href="#t2654">2654</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2655" href="#t2655">2655</a></span><span class="t"><span class="str">    file_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2656" href="#t2656">2656</a></span><span class="t"><span class="str">        Path of the file to be loaded.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2657" href="#t2657">2657</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2658" href="#t2658">2658</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2659" href="#t2659">2659</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2660" href="#t2660">2660</a></span><span class="t"><span class="str">    spec: 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2661" href="#t2661">2661</a></span><span class="t"><span class="str">        Amplitude and phase spectrum of wave EOD:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2662" href="#t2662">2662</a></span><span class="t"><span class="str">        harmonics, frequency, amplitude, relative amplitude in dB,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2663" href="#t2663">2663</a></span><span class="t"><span class="str">        relative power in dB, phase, data power in unit squared.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2664" href="#t2664">2664</a></span><span class="t"><span class="str">        Can contain NaNs.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2665" href="#t2665">2665</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2666" href="#t2666">2666</a></span><span class="t"><span class="str">        Unit of amplitudes.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2667" href="#t2667">2667</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2668" href="#t2668">2668</a></span><span class="t"><span class="str">    Raises</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2669" href="#t2669">2669</a></span><span class="t"><span class="str">    ------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2670" href="#t2670">2670</a></span><span class="t"><span class="str">    FileNotFoundError:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2671" href="#t2671">2671</a></span><span class="t"><span class="str">        If `file_path` does not exist.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2672" href="#t2672">2672</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2673" href="#t2673">2673</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2674" href="#t2674">2674</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2675" href="#t2675">2675</a></span><span class="t"><span class="str">    save_wave_spectrum()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2676" href="#t2676">2676</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2677" href="#t2677">2677</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2678" href="#t2678">2678</a></span><span class="t">    <span class="nam">spec</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2679" href="#t2679">2679</a></span><span class="t">    <span class="nam">spec</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">3</span><span class="op">]</span> <span class="op">*=</span> <span class="num">0.01</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2680" href="#t2680">2680</a></span><span class="t">    <span class="key">return</span> <span class="nam">spec</span><span class="op">,</span> <span class="nam">data</span><span class="op">.</span><span class="nam">unit</span><span class="op">(</span><span class="str">'amplitude'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2681" href="#t2681">2681</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2682" href="#t2682">2682</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2683" href="#t2683">2683</a></span><span class="t"><span class="key">def</span> <span class="nam">save_pulse_spectrum</span><span class="op">(</span><span class="nam">spec_data</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">idx</span><span class="op">,</span> <span class="nam">basename</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2684" href="#t2684">2684</a></span><span class="t">    <span class="str">"""Save power spectrum of pulse EOD to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2685" href="#t2685">2685</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2686" href="#t2686">2686</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2687" href="#t2687">2687</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2688" href="#t2688">2688</a></span><span class="t"><span class="str">    spec_data: 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2689" href="#t2689">2689</a></span><span class="t"><span class="str">        Power spectrum of single pulse as returned by `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2690" href="#t2690">2690</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2691" href="#t2691">2691</a></span><span class="t"><span class="str">        Unit of the waveform data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2692" href="#t2692">2692</a></span><span class="t"><span class="str">    idx: int or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2693" href="#t2693">2693</a></span><span class="t"><span class="str">        Index of fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2694" href="#t2694">2694</a></span><span class="t"><span class="str">    basename: string or stream</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2695" href="#t2695">2695</a></span><span class="t"><span class="str">        If string, path and basename of file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2696" href="#t2696">2696</a></span><span class="t"><span class="str">        If `basename` does not have an extension,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2697" href="#t2697">2697</a></span><span class="t"><span class="str">        '-pulsespectrum', the fish index, and a file extension are appended.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2698" href="#t2698">2698</a></span><span class="t"><span class="str">        If stream, write pulse spectrum into this stream.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2699" href="#t2699">2699</a></span><span class="t"><span class="str">    kwargs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2700" href="#t2700">2700</a></span><span class="t"><span class="str">        Arguments passed on to `TableData.write()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2701" href="#t2701">2701</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2702" href="#t2702">2702</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2703" href="#t2703">2703</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2704" href="#t2704">2704</a></span><span class="t"><span class="str">    filename: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2705" href="#t2705">2705</a></span><span class="t"><span class="str">        Path and full name of the written file in case of `basename`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2706" href="#t2706">2706</a></span><span class="t"><span class="str">        being a string. Otherwise, the file name and extension that</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2707" href="#t2707">2707</a></span><span class="t"><span class="str">        would have been appended to a basename.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2708" href="#t2708">2708</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2709" href="#t2709">2709</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2710" href="#t2710">2710</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2711" href="#t2711">2711</a></span><span class="t"><span class="str">    load_pulse_spectrum()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2712" href="#t2712">2712</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2713" href="#t2713">2713</a></span><span class="t">    <span class="nam">td</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">spec_data</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="str">'frequency'</span><span class="op">,</span> <span class="str">'power'</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2714" href="#t2714">2714</a></span><span class="t">                   <span class="op">[</span><span class="str">'Hz'</span><span class="op">,</span> <span class="str">'%s^2/Hz'</span> <span class="op">%</span> <span class="nam">unit</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="str">'%.2f'</span><span class="op">,</span> <span class="str">'%.4e'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2715" href="#t2715">2715</a></span><span class="t">    <span class="nam">_</span><span class="op">,</span> <span class="nam">ext</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">basename</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2716" href="#t2716">2716</a></span><span class="t">    <span class="nam">fp</span> <span class="op">=</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2717" href="#t2717">2717</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">ext</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2718" href="#t2718">2718</a></span><span class="t">        <span class="nam">fp</span> <span class="op">=</span> <span class="str">'-pulsespectrum'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2719" href="#t2719">2719</a></span><span class="t">        <span class="key">if</span> <span class="nam">idx</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2720" href="#t2720">2720</a></span><span class="t">            <span class="nam">fp</span> <span class="op">+=</span> <span class="str">'-%d'</span> <span class="op">%</span> <span class="nam">idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2721" href="#t2721">2721</a></span><span class="t">    <span class="key">return</span> <span class="nam">td</span><span class="op">.</span><span class="nam">write_file_stream</span><span class="op">(</span><span class="nam">basename</span><span class="op">,</span> <span class="nam">fp</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2722" href="#t2722">2722</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2723" href="#t2723">2723</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2724" href="#t2724">2724</a></span><span class="t"><span class="key">def</span> <span class="nam">load_pulse_spectrum</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2725" href="#t2725">2725</a></span><span class="t">    <span class="str">"""Load power spectrum of pulse EOD from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2726" href="#t2726">2726</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2727" href="#t2727">2727</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2728" href="#t2728">2728</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2729" href="#t2729">2729</a></span><span class="t"><span class="str">    file_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2730" href="#t2730">2730</a></span><span class="t"><span class="str">        Path of the file to be loaded.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2731" href="#t2731">2731</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2732" href="#t2732">2732</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2733" href="#t2733">2733</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2734" href="#t2734">2734</a></span><span class="t"><span class="str">    spec: 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2735" href="#t2735">2735</a></span><span class="t"><span class="str">        Power spectrum of single pulse: frequency, power</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2736" href="#t2736">2736</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2737" href="#t2737">2737</a></span><span class="t"><span class="str">    Raises</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2738" href="#t2738">2738</a></span><span class="t"><span class="str">    ------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2739" href="#t2739">2739</a></span><span class="t"><span class="str">    FileNotFoundError:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2740" href="#t2740">2740</a></span><span class="t"><span class="str">        If `file_path` does not exist.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2741" href="#t2741">2741</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2742" href="#t2742">2742</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2743" href="#t2743">2743</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2744" href="#t2744">2744</a></span><span class="t"><span class="str">    save_pulse_spectrum()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2745" href="#t2745">2745</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2746" href="#t2746">2746</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2747" href="#t2747">2747</a></span><span class="t">    <span class="nam">spec</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2748" href="#t2748">2748</a></span><span class="t">    <span class="key">return</span> <span class="nam">spec</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2749" href="#t2749">2749</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2750" href="#t2750">2750</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2751" href="#t2751">2751</a></span><span class="t"><span class="key">def</span> <span class="nam">save_pulse_peaks</span><span class="op">(</span><span class="nam">peak_data</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">idx</span><span class="op">,</span> <span class="nam">basename</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2752" href="#t2752">2752</a></span><span class="t">    <span class="str">"""Save peak properties of pulse EOD to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2753" href="#t2753">2753</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2754" href="#t2754">2754</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2755" href="#t2755">2755</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2756" href="#t2756">2756</a></span><span class="t"><span class="str">    peak_data: 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2757" href="#t2757">2757</a></span><span class="t"><span class="str">        Properties of peaks and troughs of pulse EOD as returned by</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2758" href="#t2758">2758</a></span><span class="t"><span class="str">        `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2759" href="#t2759">2759</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2760" href="#t2760">2760</a></span><span class="t"><span class="str">        Unit of the waveform data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2761" href="#t2761">2761</a></span><span class="t"><span class="str">    idx: int or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2762" href="#t2762">2762</a></span><span class="t"><span class="str">        Index of fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2763" href="#t2763">2763</a></span><span class="t"><span class="str">    basename: string or stream</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2764" href="#t2764">2764</a></span><span class="t"><span class="str">        If string, path and basename of file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2765" href="#t2765">2765</a></span><span class="t"><span class="str">        If `basename` does not have an extension,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2766" href="#t2766">2766</a></span><span class="t"><span class="str">        '-pulsepeaks', the fish index, and a file extension are appended.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2767" href="#t2767">2767</a></span><span class="t"><span class="str">        If stream, write pulse peaks into this stream.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2768" href="#t2768">2768</a></span><span class="t"><span class="str">    kwargs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2769" href="#t2769">2769</a></span><span class="t"><span class="str">        Arguments passed on to `TableData.write()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2770" href="#t2770">2770</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2771" href="#t2771">2771</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2772" href="#t2772">2772</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2773" href="#t2773">2773</a></span><span class="t"><span class="str">    filename: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2774" href="#t2774">2774</a></span><span class="t"><span class="str">        Path and full name of the written file in case of `basename`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2775" href="#t2775">2775</a></span><span class="t"><span class="str">        being a string. Otherwise, the file name and extension that</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2776" href="#t2776">2776</a></span><span class="t"><span class="str">        would have been appended to a basename.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2777" href="#t2777">2777</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2778" href="#t2778">2778</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2779" href="#t2779">2779</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2780" href="#t2780">2780</a></span><span class="t"><span class="str">    load_pulse_peaks()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2781" href="#t2781">2781</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2782" href="#t2782">2782</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">peak_data</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2783" href="#t2783">2783</a></span><span class="t">        <span class="key">return</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2784" href="#t2784">2784</a></span><span class="t">    <span class="nam">td</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">peak_data</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">:</span><span class="num">7</span><span class="op">]</span><span class="op">*</span><span class="op">[</span><span class="num">1</span><span class="op">,</span> <span class="num">1000</span><span class="op">,</span> <span class="num">1</span><span class="op">,</span> <span class="num">100</span><span class="op">,</span> <span class="num">1000</span><span class="op">,</span> <span class="num">1000</span><span class="op">,</span> <span class="num">100</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2785" href="#t2785">2785</a></span><span class="t">                   <span class="op">[</span><span class="str">'P'</span><span class="op">,</span> <span class="str">'time'</span><span class="op">,</span> <span class="str">'amplitude'</span><span class="op">,</span> <span class="str">'relampl'</span><span class="op">,</span> <span class="str">'width'</span><span class="op">,</span> <span class="str">'area'</span><span class="op">,</span> <span class="str">'relarea'</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2786" href="#t2786">2786</a></span><span class="t">                   <span class="op">[</span><span class="str">''</span><span class="op">,</span> <span class="str">'ms'</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'ms'</span><span class="op">,</span> <span class="fst">f'</span><span class="op">{</span><span class="nam">unit</span><span class="op">}</span><span class="fst">*ms</span><span class="fst">'</span><span class="op">,</span> <span class="str">'%'</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2787" href="#t2787">2787</a></span><span class="t">                   <span class="op">[</span><span class="str">'%.0f'</span><span class="op">,</span> <span class="str">'%.3f'</span><span class="op">,</span> <span class="str">'%.5f'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">,</span> <span class="str">'%.3f'</span><span class="op">,</span> <span class="str">'%.4f'</span><span class="op">,</span> <span class="str">'%.2f'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2788" href="#t2788">2788</a></span><span class="t">    <span class="nam">_</span><span class="op">,</span> <span class="nam">ext</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">basename</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2789" href="#t2789">2789</a></span><span class="t">    <span class="nam">fp</span> <span class="op">=</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2790" href="#t2790">2790</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">ext</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2791" href="#t2791">2791</a></span><span class="t">        <span class="nam">fp</span> <span class="op">=</span> <span class="str">'-pulsepeaks'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2792" href="#t2792">2792</a></span><span class="t">        <span class="key">if</span> <span class="nam">idx</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2793" href="#t2793">2793</a></span><span class="t">            <span class="nam">fp</span> <span class="op">+=</span> <span class="str">'-%d'</span> <span class="op">%</span> <span class="nam">idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2794" href="#t2794">2794</a></span><span class="t">    <span class="key">return</span> <span class="nam">td</span><span class="op">.</span><span class="nam">write_file_stream</span><span class="op">(</span><span class="nam">basename</span><span class="op">,</span> <span class="nam">fp</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2795" href="#t2795">2795</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2796" href="#t2796">2796</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2797" href="#t2797">2797</a></span><span class="t"><span class="key">def</span> <span class="nam">load_pulse_peaks</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2798" href="#t2798">2798</a></span><span class="t">    <span class="str">"""Load peak properties of pulse EOD from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2799" href="#t2799">2799</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2800" href="#t2800">2800</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2801" href="#t2801">2801</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2802" href="#t2802">2802</a></span><span class="t"><span class="str">    file_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2803" href="#t2803">2803</a></span><span class="t"><span class="str">        Path of the file to be loaded.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2804" href="#t2804">2804</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2805" href="#t2805">2805</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2806" href="#t2806">2806</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2807" href="#t2807">2807</a></span><span class="t"><span class="str">    peak_data: 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2808" href="#t2808">2808</a></span><span class="t"><span class="str">        Properties of peaks and troughs of pulse EOD:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2809" href="#t2809">2809</a></span><span class="t"><span class="str">        P, time, amplitude, relampl, width</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2810" href="#t2810">2810</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2811" href="#t2811">2811</a></span><span class="t"><span class="str">        Unit of peak amplitudes.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2812" href="#t2812">2812</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2813" href="#t2813">2813</a></span><span class="t"><span class="str">    Raises</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2814" href="#t2814">2814</a></span><span class="t"><span class="str">    ------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2815" href="#t2815">2815</a></span><span class="t"><span class="str">    FileNotFoundError:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2816" href="#t2816">2816</a></span><span class="t"><span class="str">        If `file_path` does not exist.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2817" href="#t2817">2817</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2818" href="#t2818">2818</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2819" href="#t2819">2819</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2820" href="#t2820">2820</a></span><span class="t"><span class="str">    save_pulse_peaks()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2821" href="#t2821">2821</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2822" href="#t2822">2822</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2823" href="#t2823">2823</a></span><span class="t">    <span class="nam">peaks</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2824" href="#t2824">2824</a></span><span class="t">    <span class="nam">peaks</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">*=</span> <span class="num">0.001</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2825" href="#t2825">2825</a></span><span class="t">    <span class="nam">peaks</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">3</span><span class="op">]</span> <span class="op">*=</span> <span class="num">0.01</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2826" href="#t2826">2826</a></span><span class="t">    <span class="nam">peaks</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">4</span><span class="op">]</span> <span class="op">*=</span> <span class="num">0.001</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2827" href="#t2827">2827</a></span><span class="t">    <span class="nam">peaks</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">5</span><span class="op">]</span> <span class="op">*=</span> <span class="num">0.001</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2828" href="#t2828">2828</a></span><span class="t">    <span class="nam">peaks</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">6</span><span class="op">]</span> <span class="op">*=</span> <span class="num">0.01</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2829" href="#t2829">2829</a></span><span class="t">    <span class="key">return</span> <span class="nam">peaks</span><span class="op">,</span> <span class="nam">data</span><span class="op">.</span><span class="nam">unit</span><span class="op">(</span><span class="str">'amplitude'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2830" href="#t2830">2830</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2831" href="#t2831">2831</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2832" href="#t2832">2832</a></span><span class="t"><span class="key">def</span> <span class="nam">save_pulse_times</span><span class="op">(</span><span class="nam">pulse_times</span><span class="op">,</span> <span class="nam">idx</span><span class="op">,</span> <span class="nam">basename</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2833" href="#t2833">2833</a></span><span class="t">    <span class="str">"""Save times of pulse EOD to file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2834" href="#t2834">2834</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2835" href="#t2835">2835</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2836" href="#t2836">2836</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2837" href="#t2837">2837</a></span><span class="t"><span class="str">    pulse_times: dict or array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2838" href="#t2838">2838</a></span><span class="t"><span class="str">        Times of EOD pulses. Either as array of times or</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2839" href="#t2839">2839</a></span><span class="t"><span class="str">        `props['peaktimes']` or `props['times']` as returned by</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2840" href="#t2840">2840</a></span><span class="t"><span class="str">        `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2841" href="#t2841">2841</a></span><span class="t"><span class="str">    idx: int or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2842" href="#t2842">2842</a></span><span class="t"><span class="str">        Index of fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2843" href="#t2843">2843</a></span><span class="t"><span class="str">    basename: string or stream</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2844" href="#t2844">2844</a></span><span class="t"><span class="str">        If string, path and basename of file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2845" href="#t2845">2845</a></span><span class="t"><span class="str">        If `basename` does not have an extension,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2846" href="#t2846">2846</a></span><span class="t"><span class="str">        '-pulsetimes', the fish index, and a file extension are appended.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2847" href="#t2847">2847</a></span><span class="t"><span class="str">        If stream, write pulse times into this stream.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2848" href="#t2848">2848</a></span><span class="t"><span class="str">    kwargs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2849" href="#t2849">2849</a></span><span class="t"><span class="str">        Arguments passed on to `TableData.write()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2850" href="#t2850">2850</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2851" href="#t2851">2851</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2852" href="#t2852">2852</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2853" href="#t2853">2853</a></span><span class="t"><span class="str">    filename: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2854" href="#t2854">2854</a></span><span class="t"><span class="str">        Path and full name of the written file in case of `basename`</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2855" href="#t2855">2855</a></span><span class="t"><span class="str">        being a string. Otherwise, the file name and extension that</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2856" href="#t2856">2856</a></span><span class="t"><span class="str">        would have been appended to a basename.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2857" href="#t2857">2857</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2858" href="#t2858">2858</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2859" href="#t2859">2859</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2860" href="#t2860">2860</a></span><span class="t"><span class="str">    load_pulse_times()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2861" href="#t2861">2861</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2862" href="#t2862">2862</a></span><span class="t">    <span class="key">if</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">pulse_times</span><span class="op">,</span> <span class="nam">dict</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2863" href="#t2863">2863</a></span><span class="t">        <span class="nam">props</span> <span class="op">=</span> <span class="nam">pulse_times</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2864" href="#t2864">2864</a></span><span class="t">        <span class="nam">pulse_times</span> <span class="op">=</span> <span class="nam">props</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'times'</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2865" href="#t2865">2865</a></span><span class="t">        <span class="nam">pulse_times</span> <span class="op">=</span> <span class="nam">props</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'peaktimes'</span><span class="op">,</span> <span class="nam">pulse_times</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2866" href="#t2866">2866</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">pulse_times</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2867" href="#t2867">2867</a></span><span class="t">        <span class="key">return</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2868" href="#t2868">2868</a></span><span class="t">    <span class="nam">td</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2869" href="#t2869">2869</a></span><span class="t">    <span class="nam">td</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">'time'</span><span class="op">,</span> <span class="str">'s'</span><span class="op">,</span> <span class="str">'%.4f'</span><span class="op">,</span> <span class="nam">pulse_times</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2870" href="#t2870">2870</a></span><span class="t">    <span class="nam">_</span><span class="op">,</span> <span class="nam">ext</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">basename</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2871" href="#t2871">2871</a></span><span class="t">    <span class="nam">fp</span> <span class="op">=</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2872" href="#t2872">2872</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">ext</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2873" href="#t2873">2873</a></span><span class="t">        <span class="nam">fp</span> <span class="op">=</span> <span class="str">'-pulsetimes'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2874" href="#t2874">2874</a></span><span class="t">        <span class="key">if</span> <span class="nam">idx</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2875" href="#t2875">2875</a></span><span class="t">            <span class="nam">fp</span> <span class="op">+=</span> <span class="str">'-%d'</span> <span class="op">%</span> <span class="nam">idx</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2876" href="#t2876">2876</a></span><span class="t">    <span class="key">return</span> <span class="nam">td</span><span class="op">.</span><span class="nam">write_file_stream</span><span class="op">(</span><span class="nam">basename</span><span class="op">,</span> <span class="nam">fp</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2877" href="#t2877">2877</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2878" href="#t2878">2878</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2879" href="#t2879">2879</a></span><span class="t"><span class="key">def</span> <span class="nam">load_pulse_times</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2880" href="#t2880">2880</a></span><span class="t">    <span class="str">"""Load times of pulse EOD from file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2881" href="#t2881">2881</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2882" href="#t2882">2882</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2883" href="#t2883">2883</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2884" href="#t2884">2884</a></span><span class="t"><span class="str">    file_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2885" href="#t2885">2885</a></span><span class="t"><span class="str">        Path of the file to be loaded.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2886" href="#t2886">2886</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2887" href="#t2887">2887</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2888" href="#t2888">2888</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2889" href="#t2889">2889</a></span><span class="t"><span class="str">    pulse_times: array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2890" href="#t2890">2890</a></span><span class="t"><span class="str">        Times of pulse EODs in seconds.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2891" href="#t2891">2891</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2892" href="#t2892">2892</a></span><span class="t"><span class="str">    Raises</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2893" href="#t2893">2893</a></span><span class="t"><span class="str">    ------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2894" href="#t2894">2894</a></span><span class="t"><span class="str">    FileNotFoundError:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2895" href="#t2895">2895</a></span><span class="t"><span class="str">        If `file_path` does not exist.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2896" href="#t2896">2896</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2897" href="#t2897">2897</a></span><span class="t"><span class="str">    See Also</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2898" href="#t2898">2898</a></span><span class="t"><span class="str">    --------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2899" href="#t2899">2899</a></span><span class="t"><span class="str">    save_pulse_times()</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2900" href="#t2900">2900</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2901" href="#t2901">2901</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="nam">TableData</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2902" href="#t2902">2902</a></span><span class="t">    <span class="nam">pulse_times</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2903" href="#t2903">2903</a></span><span class="t">    <span class="key">return</span> <span class="nam">pulse_times</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2904" href="#t2904">2904</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2905" href="#t2905">2905</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2906" href="#t2906">2906</a></span><span class="t"><span class="nam">file_types</span> <span class="op">=</span> <span class="op">[</span><span class="str">'waveeodfs'</span><span class="op">,</span> <span class="str">'wavefish'</span><span class="op">,</span> <span class="str">'pulsefish'</span><span class="op">,</span> <span class="str">'eodwaveform'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2907" href="#t2907">2907</a></span><span class="t">              <span class="str">'wavespectrum'</span><span class="op">,</span> <span class="str">'pulsepeaks'</span><span class="op">,</span> <span class="str">'pulsespectrum'</span><span class="op">,</span> <span class="str">'pulsetimes'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2908" href="#t2908">2908</a></span><span class="t"><span class="str">"""List of all file types generated and supported by the `save_*` and `load_*` functions."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2909" href="#t2909">2909</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2910" href="#t2910">2910</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2911" href="#t2911">2911</a></span><span class="t"><span class="key">def</span> <span class="nam">parse_filename</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2912" href="#t2912">2912</a></span><span class="t">    <span class="str">"""Parse components of an EOD analysis file name.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2913" href="#t2913">2913</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2914" href="#t2914">2914</a></span><span class="t"><span class="str">    Analysis files generated by the `eodanalysis` module are named</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2915" href="#t2915">2915</a></span><span class="t"><span class="str">    according to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2916" href="#t2916">2916</a></span><span class="t"><span class="str">    ```plain</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2917" href="#t2917">2917</a></span><span class="t"><span class="str">    PATH/RECORDING-CHANNEL-TIME-FTYPE-N.EXT</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2918" href="#t2918">2918</a></span><span class="t"><span class="str">    ```</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2919" href="#t2919">2919</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2920" href="#t2920">2920</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2921" href="#t2921">2921</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2922" href="#t2922">2922</a></span><span class="t"><span class="str">    file_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2923" href="#t2923">2923</a></span><span class="t"><span class="str">        Path of the file to be parsed.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2924" href="#t2924">2924</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2925" href="#t2925">2925</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2926" href="#t2926">2926</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2927" href="#t2927">2927</a></span><span class="t"><span class="str">    recording: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2928" href="#t2928">2928</a></span><span class="t"><span class="str">        Path and basename of the recording, i.e. 'PATH/RECORDING'.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2929" href="#t2929">2929</a></span><span class="t"><span class="str">        A leading './' is removed.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2930" href="#t2930">2930</a></span><span class="t"><span class="str">    base_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2931" href="#t2931">2931</a></span><span class="t"><span class="str">        Path and basename of the analysis results,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2932" href="#t2932">2932</a></span><span class="t"><span class="str">        i.e. 'PATH/RECORDING-CHANNEL-TIME'. A leading './' is removed.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2933" href="#t2933">2933</a></span><span class="t"><span class="str">    channel: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2934" href="#t2934">2934</a></span><span class="t"><span class="str">        Channel of the recording</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2935" href="#t2935">2935</a></span><span class="t"><span class="str">        ('CHANNEL' component of the file name if present).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2936" href="#t2936">2936</a></span><span class="t"><span class="str">        -1 if not present in `file_path`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2937" href="#t2937">2937</a></span><span class="t"><span class="str">    time: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2938" href="#t2938">2938</a></span><span class="t"><span class="str">        Start time of analysis window in seconds</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2939" href="#t2939">2939</a></span><span class="t"><span class="str">        ('TIME' component of the file name if present).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2940" href="#t2940">2940</a></span><span class="t"><span class="str">        `None` if not present in `file_path`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2941" href="#t2941">2941</a></span><span class="t"><span class="str">    ftype: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2942" href="#t2942">2942</a></span><span class="t"><span class="str">        Type of analysis file (e.g. 'wavespectrum', 'pulsepeaks', etc.),</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2943" href="#t2943">2943</a></span><span class="t"><span class="str">        ('FTYPE' component of the file name if present).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2944" href="#t2944">2944</a></span><span class="t"><span class="str">        See `file_types` for a list of all supported file types.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2945" href="#t2945">2945</a></span><span class="t"><span class="str">        Empty string if not present in `file_path`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2946" href="#t2946">2946</a></span><span class="t"><span class="str">    index: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2947" href="#t2947">2947</a></span><span class="t"><span class="str">        Index of the EOD.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2948" href="#t2948">2948</a></span><span class="t"><span class="str">        ('N' component of the file name if present).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2949" href="#t2949">2949</a></span><span class="t"><span class="str">        -1 if not present in `file_path`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2950" href="#t2950">2950</a></span><span class="t"><span class="str">    ext: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2951" href="#t2951">2951</a></span><span class="t"><span class="str">        File extension *without* leading period</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2952" href="#t2952">2952</a></span><span class="t"><span class="str">        ('EXT' component of the file name).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2953" href="#t2953">2953</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2954" href="#t2954">2954</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2955" href="#t2955">2955</a></span><span class="t">    <span class="nam">name</span><span class="op">,</span> <span class="nam">ext</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2956" href="#t2956">2956</a></span><span class="t">    <span class="nam">ext</span> <span class="op">=</span> <span class="nam">ext</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2957" href="#t2957">2957</a></span><span class="t">    <span class="nam">parts</span> <span class="op">=</span> <span class="nam">name</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">'-'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2958" href="#t2958">2958</a></span><span class="t">    <span class="nam">index</span> <span class="op">=</span> <span class="op">-</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2959" href="#t2959">2959</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">parts</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">isdigit</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2960" href="#t2960">2960</a></span><span class="t">        <span class="nam">index</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2961" href="#t2961">2961</a></span><span class="t">        <span class="nam">parts</span> <span class="op">=</span> <span class="nam">parts</span><span class="op">[</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2962" href="#t2962">2962</a></span><span class="t">    <span class="nam">ftype</span> <span class="op">=</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2963" href="#t2963">2963</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">parts</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2964" href="#t2964">2964</a></span><span class="t">        <span class="nam">ftype</span> <span class="op">=</span> <span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2965" href="#t2965">2965</a></span><span class="t">        <span class="nam">parts</span> <span class="op">=</span> <span class="nam">parts</span><span class="op">[</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2966" href="#t2966">2966</a></span><span class="t">    <span class="nam">base_path</span> <span class="op">=</span> <span class="str">'-'</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">parts</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2967" href="#t2967">2967</a></span><span class="t">    <span class="key">if</span> <span class="nam">base_path</span><span class="op">.</span><span class="nam">startswith</span><span class="op">(</span><span class="str">'./'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2968" href="#t2968">2968</a></span><span class="t">        <span class="nam">base_path</span> <span class="op">=</span> <span class="nam">base_path</span><span class="op">[</span><span class="num">2</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2969" href="#t2969">2969</a></span><span class="t">    <span class="nam">time</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2970" href="#t2970">2970</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">parts</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2971" href="#t2971">2971</a></span><span class="t">       <span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="str">'t'</span> <span class="key">and</span> <span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'s'</span> <span class="key">and</span> <span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2972" href="#t2972">2972</a></span><span class="t">       <span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">isdigit</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2973" href="#t2973">2973</a></span><span class="t">        <span class="nam">time</span> <span class="op">=</span> <span class="nam">float</span><span class="op">(</span><span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2974" href="#t2974">2974</a></span><span class="t">        <span class="nam">parts</span> <span class="op">=</span> <span class="nam">parts</span><span class="op">[</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2975" href="#t2975">2975</a></span><span class="t">    <span class="nam">channel</span> <span class="op">=</span> <span class="op">-</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2976" href="#t2976">2976</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">parts</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2977" href="#t2977">2977</a></span><span class="t">       <span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="str">'c'</span> <span class="key">and</span> <span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><span class="op">.</span><span class="nam">isdigit</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2978" href="#t2978">2978</a></span><span class="t">        <span class="nam">channel</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">parts</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2979" href="#t2979">2979</a></span><span class="t">        <span class="nam">parts</span> <span class="op">=</span> <span class="nam">parts</span><span class="op">[</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2980" href="#t2980">2980</a></span><span class="t">    <span class="nam">recording</span> <span class="op">=</span> <span class="str">'-'</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">parts</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2981" href="#t2981">2981</a></span><span class="t">    <span class="key">if</span> <span class="nam">recording</span><span class="op">.</span><span class="nam">startswith</span><span class="op">(</span><span class="str">'./'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2982" href="#t2982">2982</a></span><span class="t">        <span class="nam">recording</span> <span class="op">=</span> <span class="nam">recording</span><span class="op">[</span><span class="num">2</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t2983" href="#t2983">2983</a></span><span class="t">    <span class="key">return</span> <span class="nam">recording</span><span class="op">,</span> <span class="nam">base_path</span><span class="op">,</span> <span class="nam">channel</span><span class="op">,</span> <span class="nam">time</span><span class="op">,</span> <span class="nam">ftype</span><span class="op">,</span> <span class="nam">index</span><span class="op">,</span> <span class="nam">ext</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2984" href="#t2984">2984</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2985" href="#t2985">2985</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t2986" href="#t2986">2986</a></span><span class="t"><span class="key">def</span> <span class="nam">save_analysis</span><span class="op">(</span><span class="nam">output_basename</span><span class="op">,</span> <span class="nam">zip_file</span><span class="op">,</span> <span class="nam">eod_props</span><span class="op">,</span> <span class="nam">mean_eods</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2987" href="#t2987">2987</a></span><span class="t">                  <span class="nam">spec_data</span><span class="op">,</span> <span class="nam">peak_data</span><span class="op">,</span> <span class="nam">wave_eodfs</span><span class="op">,</span> <span class="nam">wave_indices</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2988" href="#t2988">2988</a></span><span class="t">                  <span class="nam">verbose</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2989" href="#t2989">2989</a></span><span class="t">    <span class="str">"""Save EOD analysis results to files.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2990" href="#t2990">2990</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2991" href="#t2991">2991</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2992" href="#t2992">2992</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2993" href="#t2993">2993</a></span><span class="t"><span class="str">    output_basename: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2994" href="#t2994">2994</a></span><span class="t"><span class="str">        Path and basename of files to be saved.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2995" href="#t2995">2995</a></span><span class="t"><span class="str">    zip_file: bool</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2996" href="#t2996">2996</a></span><span class="t"><span class="str">        If `True`, write all analysis results into a zip archive.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2997" href="#t2997">2997</a></span><span class="t"><span class="str">    eod_props: list of dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2998" href="#t2998">2998</a></span><span class="t"><span class="str">        Properties of EODs as returned by `analyze_wave()` and</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2999" href="#t2999">2999</a></span><span class="t"><span class="str">        `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3000" href="#t3000">3000</a></span><span class="t"><span class="str">    mean_eods: list of 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3001" href="#t3001">3001</a></span><span class="t"><span class="str">        Averaged EOD waveforms as returned by `eod_waveform()`,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3002" href="#t3002">3002</a></span><span class="t"><span class="str">        `analyze_wave()`, and `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3003" href="#t3003">3003</a></span><span class="t"><span class="str">    spec_data: list of 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3004" href="#t3004">3004</a></span><span class="t"><span class="str">        Power spectra of single pulses as returned by</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3005" href="#t3005">3005</a></span><span class="t"><span class="str">        `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3006" href="#t3006">3006</a></span><span class="t"><span class="str">    peak_data: list of 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3007" href="#t3007">3007</a></span><span class="t"><span class="str">        Properties of peaks and troughs of pulse EODs as returned by</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3008" href="#t3008">3008</a></span><span class="t"><span class="str">        `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3009" href="#t3009">3009</a></span><span class="t"><span class="str">    wave_eodfs: list of 2D array of float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3010" href="#t3010">3010</a></span><span class="t"><span class="str">        Each item is a matrix with the frequencies and powers</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3011" href="#t3011">3011</a></span><span class="t"><span class="str">        (columns) of the fundamental and harmonics (rows) as returned</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3012" href="#t3012">3012</a></span><span class="t"><span class="str">        by `harmonics.harmonic_groups()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3013" href="#t3013">3013</a></span><span class="t"><span class="str">    wave_indices: array of int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3014" href="#t3014">3014</a></span><span class="t"><span class="str">        Indices identifying each fish in `wave_eodfs` or NaN.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3015" href="#t3015">3015</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3016" href="#t3016">3016</a></span><span class="t"><span class="str">        Unit of the waveform data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3017" href="#t3017">3017</a></span><span class="t"><span class="str">    verbose: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3018" href="#t3018">3018</a></span><span class="t"><span class="str">        Verbosity level.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3019" href="#t3019">3019</a></span><span class="t"><span class="str">    kwargs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3020" href="#t3020">3020</a></span><span class="t"><span class="str">        Arguments passed on to `TableData.write()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3021" href="#t3021">3021</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3022" href="#t3022">3022</a></span><span class="t">    <span class="key">def</span> <span class="nam">write_file_zip</span><span class="op">(</span><span class="nam">zf</span><span class="op">,</span> <span class="nam">save_func</span><span class="op">,</span> <span class="nam">output</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3023" href="#t3023">3023</a></span><span class="t">        <span class="key">if</span> <span class="nam">zf</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3024" href="#t3024">3024</a></span><span class="t">            <span class="nam">fp</span> <span class="op">=</span> <span class="nam">save_func</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="nam">basename</span><span class="op">=</span><span class="nam">output</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3025" href="#t3025">3025</a></span><span class="t">            <span class="key">if</span> <span class="nam">verbose</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="nam">fp</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3026" href="#t3026">3026</a></span><span class="t">                <span class="nam">print</span><span class="op">(</span><span class="str">'wrote file %s'</span> <span class="op">%</span> <span class="nam">fp</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3027" href="#t3027">3027</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3028" href="#t3028">3028</a></span><span class="t">            <span class="key">with</span> <span class="nam">io</span><span class="op">.</span><span class="nam">StringIO</span><span class="op">(</span><span class="op">)</span> <span class="key">as</span> <span class="nam">df</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3029" href="#t3029">3029</a></span><span class="t">                <span class="nam">fp</span> <span class="op">=</span> <span class="nam">save_func</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="nam">basename</span><span class="op">=</span><span class="nam">df</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3030" href="#t3030">3030</a></span><span class="t">                <span class="key">if</span> <span class="nam">fp</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3031" href="#t3031">3031</a></span><span class="t">                    <span class="nam">fp</span> <span class="op">=</span> <span class="nam">output_basename</span> <span class="op">+</span> <span class="nam">fp</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3032" href="#t3032">3032</a></span><span class="t">                    <span class="nam">zf</span><span class="op">.</span><span class="nam">writestr</span><span class="op">(</span><span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">basename</span><span class="op">(</span><span class="nam">fp</span><span class="op">)</span><span class="op">,</span> <span class="nam">df</span><span class="op">.</span><span class="nam">getvalue</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3033" href="#t3033">3033</a></span><span class="t">                    <span class="key">if</span> <span class="nam">verbose</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3034" href="#t3034">3034</a></span><span class="t">                        <span class="nam">print</span><span class="op">(</span><span class="str">'zipped file %s'</span> <span class="op">%</span> <span class="nam">fp</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3035" href="#t3035">3035</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3036" href="#t3036">3036</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3037" href="#t3037">3037</a></span><span class="t">    <span class="key">if</span> <span class="str">'table_format'</span> <span class="key">in</span> <span class="nam">kwargs</span> <span class="key">and</span> <span class="nam">kwargs</span><span class="op">[</span><span class="str">'table_format'</span><span class="op">]</span> <span class="op">==</span> <span class="str">'py'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3038" href="#t3038">3038</a></span><span class="t">        <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">output_basename</span><span class="op">+</span><span class="str">'.py'</span><span class="op">,</span> <span class="str">'w'</span><span class="op">)</span> <span class="key">as</span> <span class="nam">f</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3039" href="#t3039">3039</a></span><span class="t">            <span class="nam">name</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">basename</span><span class="op">(</span><span class="nam">output_basename</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3040" href="#t3040">3040</a></span><span class="t">            <span class="key">for</span> <span class="nam">k</span><span class="op">,</span> <span class="nam">sdata</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">spec_data</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3041" href="#t3041">3041</a></span><span class="t">                <span class="com"># save wave fish only:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3042" href="#t3042">3042</a></span><span class="t">                <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">sdata</span><span class="op">)</span><span class="op">></span><span class="num">0</span> <span class="key">and</span> <span class="nam">sdata</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="num">2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3043" href="#t3043">3043</a></span><span class="t">                    <span class="nam">fish</span> <span class="op">=</span> <span class="nam">dict</span><span class="op">(</span><span class="nam">amplitudes</span><span class="op">=</span><span class="nam">sdata</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">3</span><span class="op">]</span><span class="op">,</span> <span class="nam">phases</span><span class="op">=</span><span class="nam">sdata</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">5</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3044" href="#t3044">3044</a></span><span class="t">                    <span class="nam">fish</span> <span class="op">=</span> <span class="nam">normalize_wavefish</span><span class="op">(</span><span class="nam">fish</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3045" href="#t3045">3045</a></span><span class="t">                    <span class="nam">export_wavefish</span><span class="op">(</span><span class="nam">fish</span><span class="op">,</span> <span class="nam">name</span><span class="op">+</span><span class="str">'-%d_harmonics'</span> <span class="op">%</span> <span class="nam">k</span><span class="op">,</span> <span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3046" href="#t3046">3046</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3047" href="#t3047">3047</a></span><span class="t">        <span class="nam">zf</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3048" href="#t3048">3048</a></span><span class="t">        <span class="key">if</span> <span class="nam">zip_file</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3049" href="#t3049">3049</a></span><span class="t">            <span class="nam">zf</span> <span class="op">=</span> <span class="nam">zipfile</span><span class="op">.</span><span class="nam">ZipFile</span><span class="op">(</span><span class="nam">output_basename</span> <span class="op">+</span> <span class="str">'.zip'</span><span class="op">,</span> <span class="str">'w'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3050" href="#t3050">3050</a></span><span class="t">        <span class="com"># all wave fish in wave_eodfs:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3051" href="#t3051">3051</a></span><span class="t">        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">wave_eodfs</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3052" href="#t3052">3052</a></span><span class="t">            <span class="nam">write_file_zip</span><span class="op">(</span><span class="nam">zf</span><span class="op">,</span> <span class="nam">save_wave_eodfs</span><span class="op">,</span> <span class="nam">output_basename</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3053" href="#t3053">3053</a></span><span class="t">                           <span class="nam">wave_eodfs</span><span class="op">,</span> <span class="nam">wave_indices</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3054" href="#t3054">3054</a></span><span class="t">        <span class="com"># all wave and pulse fish:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3055" href="#t3055">3055</a></span><span class="t">        <span class="key">for</span> <span class="nam">i</span><span class="op">,</span> <span class="op">(</span><span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">sdata</span><span class="op">,</span> <span class="nam">pdata</span><span class="op">,</span> <span class="nam">props</span><span class="op">)</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">zip</span><span class="op">(</span><span class="nam">mean_eods</span><span class="op">,</span> <span class="nam">spec_data</span><span class="op">,</span> <span class="nam">peak_data</span><span class="op">,</span> <span class="nam">eod_props</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3056" href="#t3056">3056</a></span><span class="t">            <span class="nam">write_file_zip</span><span class="op">(</span><span class="nam">zf</span><span class="op">,</span> <span class="nam">save_eod_waveform</span><span class="op">,</span> <span class="nam">output_basename</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3057" href="#t3057">3057</a></span><span class="t">                           <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">i</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3058" href="#t3058">3058</a></span><span class="t">            <span class="com"># power spectrum:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3059" href="#t3059">3059</a></span><span class="t">            <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">sdata</span><span class="op">)</span><span class="op">></span><span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3060" href="#t3060">3060</a></span><span class="t">                <span class="key">if</span> <span class="nam">sdata</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="num">2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3061" href="#t3061">3061</a></span><span class="t">                    <span class="nam">write_file_zip</span><span class="op">(</span><span class="nam">zf</span><span class="op">,</span> <span class="nam">save_pulse_spectrum</span><span class="op">,</span> <span class="nam">output_basename</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3062" href="#t3062">3062</a></span><span class="t">                                   <span class="nam">sdata</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">i</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3063" href="#t3063">3063</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3064" href="#t3064">3064</a></span><span class="t">                    <span class="nam">write_file_zip</span><span class="op">(</span><span class="nam">zf</span><span class="op">,</span> <span class="nam">save_wave_spectrum</span><span class="op">,</span> <span class="nam">output_basename</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3065" href="#t3065">3065</a></span><span class="t">                                   <span class="nam">sdata</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">i</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3066" href="#t3066">3066</a></span><span class="t">            <span class="com"># peaks:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3067" href="#t3067">3067</a></span><span class="t">            <span class="nam">write_file_zip</span><span class="op">(</span><span class="nam">zf</span><span class="op">,</span> <span class="nam">save_pulse_peaks</span><span class="op">,</span> <span class="nam">output_basename</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3068" href="#t3068">3068</a></span><span class="t">                           <span class="nam">pdata</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">i</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3069" href="#t3069">3069</a></span><span class="t">            <span class="com"># times:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3070" href="#t3070">3070</a></span><span class="t">            <span class="nam">write_file_zip</span><span class="op">(</span><span class="nam">zf</span><span class="op">,</span> <span class="nam">save_pulse_times</span><span class="op">,</span> <span class="nam">output_basename</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3071" href="#t3071">3071</a></span><span class="t">                           <span class="nam">props</span><span class="op">,</span> <span class="nam">i</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3072" href="#t3072">3072</a></span><span class="t">        <span class="com"># wave fish properties:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3073" href="#t3073">3073</a></span><span class="t">        <span class="nam">write_file_zip</span><span class="op">(</span><span class="nam">zf</span><span class="op">,</span> <span class="nam">save_wave_fish</span><span class="op">,</span> <span class="nam">output_basename</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3074" href="#t3074">3074</a></span><span class="t">                       <span class="nam">eod_props</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3075" href="#t3075">3075</a></span><span class="t">        <span class="com"># pulse fish properties:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3076" href="#t3076">3076</a></span><span class="t">        <span class="nam">write_file_zip</span><span class="op">(</span><span class="nam">zf</span><span class="op">,</span> <span class="nam">save_pulse_fish</span><span class="op">,</span> <span class="nam">output_basename</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3077" href="#t3077">3077</a></span><span class="t">                       <span class="nam">eod_props</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3078" href="#t3078">3078</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3079" href="#t3079">3079</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3080" href="#t3080">3080</a></span><span class="t"><span class="key">def</span> <span class="nam">load_analysis</span><span class="op">(</span><span class="nam">file_pathes</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3081" href="#t3081">3081</a></span><span class="t">    <span class="str">"""Load all EOD analysis files.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3082" href="#t3082">3082</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3083" href="#t3083">3083</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3084" href="#t3084">3084</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3085" href="#t3085">3085</a></span><span class="t"><span class="str">    file_pathes: list of string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3086" href="#t3086">3086</a></span><span class="t"><span class="str">        Pathes of the analysis files of a single recording to be loaded.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3087" href="#t3087">3087</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3088" href="#t3088">3088</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3089" href="#t3089">3089</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3090" href="#t3090">3090</a></span><span class="t"><span class="str">    mean_eods: list of 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3091" href="#t3091">3091</a></span><span class="t"><span class="str">        Averaged EOD waveforms: time in seconds, mean, standard deviation, fit.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3092" href="#t3092">3092</a></span><span class="t"><span class="str">    wave_eodfs: 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3093" href="#t3093">3093</a></span><span class="t"><span class="str">        EODfs and power of wave type fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3094" href="#t3094">3094</a></span><span class="t"><span class="str">    wave_indices: array of ints</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3095" href="#t3095">3095</a></span><span class="t"><span class="str">        Corresponding indices of fish, can contain negative numbers to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3096" href="#t3096">3096</a></span><span class="t"><span class="str">        indicate frequencies without fish.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3097" href="#t3097">3097</a></span><span class="t"><span class="str">    eod_props: list of dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3098" href="#t3098">3098</a></span><span class="t"><span class="str">        Properties of EODs. The 'index' property is an index into the</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3099" href="#t3099">3099</a></span><span class="t"><span class="str">        reurned lists.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3100" href="#t3100">3100</a></span><span class="t"><span class="str">    spec_data: list of 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3101" href="#t3101">3101</a></span><span class="t"><span class="str">        Amplitude and phase spectrum of wave-type EODs with columns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3102" href="#t3102">3102</a></span><span class="t"><span class="str">        harmonics, frequency, amplitude, relative amplitude in dB,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3103" href="#t3103">3103</a></span><span class="t"><span class="str">        relative power in dB, phase, data power in unit squared.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3104" href="#t3104">3104</a></span><span class="t"><span class="str">        Power spectrum of single pulse-type EODs with columns frequency, power</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3105" href="#t3105">3105</a></span><span class="t"><span class="str">    peak_data: list of 2D array of floats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3106" href="#t3106">3106</a></span><span class="t"><span class="str">        Properties of peaks and troughs of pulse-type EODs with columns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3107" href="#t3107">3107</a></span><span class="t"><span class="str">        P, time, amplitude, relampl, width</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3108" href="#t3108">3108</a></span><span class="t"><span class="str">    recording: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3109" href="#t3109">3109</a></span><span class="t"><span class="str">        Path and base name of the recording file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3110" href="#t3110">3110</a></span><span class="t"><span class="str">    channel: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3111" href="#t3111">3111</a></span><span class="t"><span class="str">        Analysed channel of the recording.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3112" href="#t3112">3112</a></span><span class="t"><span class="str">    unit: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3113" href="#t3113">3113</a></span><span class="t"><span class="str">        Unit of EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3114" href="#t3114">3114</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3115" href="#t3115">3115</a></span><span class="t">    <span class="nam">recording</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3116" href="#t3116">3116</a></span><span class="t">    <span class="nam">channel</span> <span class="op">=</span> <span class="op">-</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3117" href="#t3117">3117</a></span><span class="t">    <span class="nam">eod_props</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3118" href="#t3118">3118</a></span><span class="t">    <span class="nam">zf</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3119" href="#t3119">3119</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">file_pathes</span><span class="op">)</span> <span class="op">==</span> <span class="num">1</span> <span class="key">and</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">file_pathes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span> <span class="op">==</span> <span class="str">'zip'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3120" href="#t3120">3120</a></span><span class="t">        <span class="nam">zf</span> <span class="op">=</span> <span class="nam">zipfile</span><span class="op">.</span><span class="nam">ZipFile</span><span class="op">(</span><span class="nam">file_pathes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3121" href="#t3121">3121</a></span><span class="t">        <span class="nam">file_pathes</span> <span class="op">=</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">zf</span><span class="op">.</span><span class="nam">namelist</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3122" href="#t3122">3122</a></span><span class="t">    <span class="com"># first, read wave- and pulse-fish summaries:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3123" href="#t3123">3123</a></span><span class="t">    <span class="nam">pulse_fish</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3124" href="#t3124">3124</a></span><span class="t">    <span class="nam">wave_fish</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3125" href="#t3125">3125</a></span><span class="t">    <span class="key">for</span> <span class="nam">f</span> <span class="key">in</span> <span class="nam">file_pathes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3126" href="#t3126">3126</a></span><span class="t">        <span class="nam">recording</span><span class="op">,</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">channel</span><span class="op">,</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">ftype</span><span class="op">,</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">_</span> <span class="op">=</span> <span class="nam">parse_filename</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3127" href="#t3127">3127</a></span><span class="t">        <span class="key">if</span> <span class="nam">zf</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3128" href="#t3128">3128</a></span><span class="t">            <span class="nam">f</span> <span class="op">=</span> <span class="nam">io</span><span class="op">.</span><span class="nam">TextIOWrapper</span><span class="op">(</span><span class="nam">zf</span><span class="op">.</span><span class="nam">open</span><span class="op">(</span><span class="nam">f</span><span class="op">,</span> <span class="str">'r'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3129" href="#t3129">3129</a></span><span class="t">        <span class="key">if</span> <span class="nam">ftype</span> <span class="op">==</span> <span class="str">'wavefish'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3130" href="#t3130">3130</a></span><span class="t">            <span class="nam">eod_props</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">load_wave_fish</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3131" href="#t3131">3131</a></span><span class="t">            <span class="nam">wave_fish</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3132" href="#t3132">3132</a></span><span class="t">        <span class="key">elif</span> <span class="nam">ftype</span> <span class="op">==</span> <span class="str">'pulsefish'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3133" href="#t3133">3133</a></span><span class="t">            <span class="nam">eod_props</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">load_pulse_fish</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3134" href="#t3134">3134</a></span><span class="t">            <span class="nam">pulse_fish</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3135" href="#t3135">3135</a></span><span class="t">    <span class="nam">idx_offs</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3136" href="#t3136">3136</a></span><span class="t">    <span class="key">if</span> <span class="nam">wave_fish</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">pulse_fish</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3137" href="#t3137">3137</a></span><span class="t">        <span class="nam">idx_offs</span> <span class="op">=</span> <span class="nam">sorted</span><span class="op">(</span><span class="op">[</span><span class="nam">ep</span><span class="op">[</span><span class="str">'index'</span><span class="op">]</span> <span class="key">for</span> <span class="nam">ep</span> <span class="key">in</span> <span class="nam">eod_props</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3138" href="#t3138">3138</a></span><span class="t">    <span class="com"># then load all other files:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3139" href="#t3139">3139</a></span><span class="t">    <span class="nam">neods</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3140" href="#t3140">3140</a></span><span class="t">    <span class="key">if</span> <span class="nam">neods</span> <span class="op">&lt;</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3141" href="#t3141">3141</a></span><span class="t">        <span class="nam">neods</span> <span class="op">=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3142" href="#t3142">3142</a></span><span class="t">        <span class="nam">eod_props</span> <span class="op">=</span> <span class="op">[</span><span class="key">None</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3143" href="#t3143">3143</a></span><span class="t">    <span class="nam">wave_eodfs</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3144" href="#t3144">3144</a></span><span class="t">    <span class="nam">wave_indices</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3145" href="#t3145">3145</a></span><span class="t">    <span class="nam">mean_eods</span> <span class="op">=</span> <span class="op">[</span><span class="key">None</span><span class="op">]</span><span class="op">*</span><span class="nam">neods</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3146" href="#t3146">3146</a></span><span class="t">    <span class="nam">spec_data</span> <span class="op">=</span> <span class="op">[</span><span class="key">None</span><span class="op">]</span><span class="op">*</span><span class="nam">neods</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3147" href="#t3147">3147</a></span><span class="t">    <span class="nam">peak_data</span> <span class="op">=</span> <span class="op">[</span><span class="key">None</span><span class="op">]</span><span class="op">*</span><span class="nam">neods</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3148" href="#t3148">3148</a></span><span class="t">    <span class="nam">unit</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3149" href="#t3149">3149</a></span><span class="t">    <span class="key">for</span> <span class="nam">f</span> <span class="key">in</span> <span class="nam">file_pathes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3150" href="#t3150">3150</a></span><span class="t">        <span class="nam">recording</span><span class="op">,</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">channel</span><span class="op">,</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">ftype</span><span class="op">,</span> <span class="nam">idx</span><span class="op">,</span> <span class="nam">_</span> <span class="op">=</span> <span class="nam">parse_filename</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3151" href="#t3151">3151</a></span><span class="t">        <span class="key">if</span> <span class="nam">neods</span> <span class="op">==</span> <span class="num">1</span> <span class="key">and</span> <span class="nam">idx</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3152" href="#t3152">3152</a></span><span class="t">            <span class="nam">idx</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3153" href="#t3153">3153</a></span><span class="t">        <span class="nam">idx</span> <span class="op">-=</span> <span class="nam">idx_offs</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3154" href="#t3154">3154</a></span><span class="t">        <span class="key">if</span> <span class="nam">zf</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3155" href="#t3155">3155</a></span><span class="t">            <span class="nam">f</span> <span class="op">=</span> <span class="nam">io</span><span class="op">.</span><span class="nam">TextIOWrapper</span><span class="op">(</span><span class="nam">zf</span><span class="op">.</span><span class="nam">open</span><span class="op">(</span><span class="nam">f</span><span class="op">,</span> <span class="str">'r'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3156" href="#t3156">3156</a></span><span class="t">        <span class="key">if</span> <span class="nam">ftype</span> <span class="op">==</span> <span class="str">'waveeodfs'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3157" href="#t3157">3157</a></span><span class="t">            <span class="nam">wave_eodfs</span><span class="op">,</span> <span class="nam">wave_indices</span> <span class="op">=</span> <span class="nam">load_wave_eodfs</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3158" href="#t3158">3158</a></span><span class="t">        <span class="key">elif</span> <span class="nam">ftype</span> <span class="op">==</span> <span class="str">'eodwaveform'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3159" href="#t3159">3159</a></span><span class="t">            <span class="nam">mean_eods</span><span class="op">[</span><span class="nam">idx</span><span class="op">]</span><span class="op">,</span> <span class="nam">unit</span> <span class="op">=</span> <span class="nam">load_eod_waveform</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3160" href="#t3160">3160</a></span><span class="t">        <span class="key">elif</span> <span class="nam">ftype</span> <span class="op">==</span> <span class="str">'wavespectrum'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3161" href="#t3161">3161</a></span><span class="t">            <span class="nam">spec_data</span><span class="op">[</span><span class="nam">idx</span><span class="op">]</span><span class="op">,</span> <span class="nam">unit</span> <span class="op">=</span> <span class="nam">load_wave_spectrum</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3162" href="#t3162">3162</a></span><span class="t">        <span class="key">elif</span> <span class="nam">ftype</span> <span class="op">==</span> <span class="str">'pulsepeaks'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3163" href="#t3163">3163</a></span><span class="t">            <span class="nam">peak_data</span><span class="op">[</span><span class="nam">idx</span><span class="op">]</span><span class="op">,</span> <span class="nam">unit</span> <span class="op">=</span> <span class="nam">load_pulse_peaks</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3164" href="#t3164">3164</a></span><span class="t">        <span class="key">elif</span> <span class="nam">ftype</span> <span class="op">==</span> <span class="str">'pulsetimes'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3165" href="#t3165">3165</a></span><span class="t">            <span class="nam">pulse_times</span> <span class="op">=</span> <span class="nam">load_pulse_times</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3166" href="#t3166">3166</a></span><span class="t">            <span class="nam">eod_props</span><span class="op">[</span><span class="nam">idx</span><span class="op">]</span><span class="op">[</span><span class="str">'times'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">pulse_times</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3167" href="#t3167">3167</a></span><span class="t">            <span class="nam">eod_props</span><span class="op">[</span><span class="nam">idx</span><span class="op">]</span><span class="op">[</span><span class="str">'peaktimes'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">pulse_times</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3168" href="#t3168">3168</a></span><span class="t">        <span class="key">elif</span> <span class="nam">ftype</span> <span class="op">==</span> <span class="str">'pulsespectrum'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3169" href="#t3169">3169</a></span><span class="t">            <span class="nam">spec_data</span><span class="op">[</span><span class="nam">idx</span><span class="op">]</span> <span class="op">=</span> <span class="nam">load_pulse_spectrum</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3170" href="#t3170">3170</a></span><span class="t">    <span class="com"># fix wave spectra:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3171" href="#t3171">3171</a></span><span class="t">    <span class="nam">wave_eodfs</span> <span class="op">=</span> <span class="op">[</span><span class="nam">fish</span><span class="op">.</span><span class="nam">reshape</span><span class="op">(</span><span class="num">1</span><span class="op">,</span> <span class="num">2</span><span class="op">)</span> <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">fish</span><span class="op">)</span><span class="op">></span><span class="num">0</span> <span class="key">else</span> <span class="nam">fish</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3172" href="#t3172">3172</a></span><span class="t">                  <span class="key">for</span> <span class="nam">fish</span> <span class="key">in</span> <span class="nam">wave_eodfs</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3173" href="#t3173">3173</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">wave_eodfs</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">spec_data</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3174" href="#t3174">3174</a></span><span class="t">        <span class="nam">eodfs</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3175" href="#t3175">3175</a></span><span class="t">        <span class="key">for</span> <span class="nam">idx</span><span class="op">,</span> <span class="nam">fish</span> <span class="key">in</span> <span class="nam">zip</span><span class="op">(</span><span class="nam">wave_indices</span><span class="op">,</span> <span class="nam">wave_eodfs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3176" href="#t3176">3176</a></span><span class="t">            <span class="key">if</span> <span class="nam">idx</span> <span class="op">>=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3177" href="#t3177">3177</a></span><span class="t">                <span class="nam">spec</span> <span class="op">=</span> <span class="nam">spec_data</span><span class="op">[</span><span class="nam">idx</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3178" href="#t3178">3178</a></span><span class="t">                <span class="nam">specd</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">isfinite</span><span class="op">(</span><span class="nam">spec</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3179" href="#t3179">3179</a></span><span class="t">                                  <span class="num">2</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3180" href="#t3180">3180</a></span><span class="t">                <span class="nam">specd</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="nam">spec</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">isfinite</span><span class="op">(</span><span class="nam">spec</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3181" href="#t3181">3181</a></span><span class="t">                <span class="nam">specd</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">spec</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">isfinite</span><span class="op">(</span><span class="nam">spec</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3182" href="#t3182">3182</a></span><span class="t">                <span class="nam">eodfs</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">specd</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3183" href="#t3183">3183</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3184" href="#t3184">3184</a></span><span class="t">                <span class="nam">specd</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="num">10</span><span class="op">,</span> <span class="num">2</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3185" href="#t3185">3185</a></span><span class="t">                <span class="nam">specd</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">specd</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="nam">fish</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3186" href="#t3186">3186</a></span><span class="t">                <span class="nam">specd</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">nan</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3187" href="#t3187">3187</a></span><span class="t">                <span class="nam">eodfs</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">specd</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3188" href="#t3188">3188</a></span><span class="t">        <span class="nam">wave_eodfs</span> <span class="op">=</span> <span class="nam">eodfs</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3189" href="#t3189">3189</a></span><span class="t">    <span class="key">return</span> <span class="nam">mean_eods</span><span class="op">,</span> <span class="nam">wave_eodfs</span><span class="op">,</span> <span class="nam">wave_indices</span><span class="op">,</span> <span class="nam">eod_props</span><span class="op">,</span> <span class="nam">spec_data</span><span class="op">,</span> <span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3190" href="#t3190">3190</a></span><span class="t">        <span class="nam">peak_data</span><span class="op">,</span> <span class="nam">recording</span><span class="op">,</span> <span class="nam">channel</span><span class="op">,</span> <span class="nam">unit</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3191" href="#t3191">3191</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3192" href="#t3192">3192</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3193" href="#t3193">3193</a></span><span class="t"><span class="key">def</span> <span class="nam">load_recording</span><span class="op">(</span><span class="nam">file_path</span><span class="op">,</span> <span class="nam">channel</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">load_kwargs</span><span class="op">=</span><span class="op">{</span><span class="op">}</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3194" href="#t3194">3194</a></span><span class="t">                   <span class="nam">eod_props</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">verbose</span><span class="op">=</span><span class="num">0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3195" href="#t3195">3195</a></span><span class="t">    <span class="str">"""Load recording.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3196" href="#t3196">3196</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3197" href="#t3197">3197</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3198" href="#t3198">3198</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3199" href="#t3199">3199</a></span><span class="t"><span class="str">    file_path: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3200" href="#t3200">3200</a></span><span class="t"><span class="str">        Full path of the file with the recorded data.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3201" href="#t3201">3201</a></span><span class="t"><span class="str">        Extension is optional. If absent, look for the first file</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3202" href="#t3202">3202</a></span><span class="t"><span class="str">        with a reasonable extension.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3203" href="#t3203">3203</a></span><span class="t"><span class="str">    channel: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3204" href="#t3204">3204</a></span><span class="t"><span class="str">        Channel of the recording to be returned.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3205" href="#t3205">3205</a></span><span class="t"><span class="str">    load_kwargs: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3206" href="#t3206">3206</a></span><span class="t"><span class="str">        Keyword arguments that are passed on to the </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3207" href="#t3207">3207</a></span><span class="t"><span class="str">        format specific loading functions.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3208" href="#t3208">3208</a></span><span class="t"><span class="str">    eod_props: list of dict or None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3209" href="#t3209">3209</a></span><span class="t"><span class="str">        List of EOD properties from which start and end times of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3210" href="#t3210">3210</a></span><span class="t"><span class="str">        analysis window are extracted.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3211" href="#t3211">3211</a></span><span class="t"><span class="str">    verbose: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3212" href="#t3212">3212</a></span><span class="t"><span class="str">        Verbosity level passed on to load function.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3213" href="#t3213">3213</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3214" href="#t3214">3214</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3215" href="#t3215">3215</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3216" href="#t3216">3216</a></span><span class="t"><span class="str">    data: array of float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3217" href="#t3217">3217</a></span><span class="t"><span class="str">        Data of the requested `channel`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3218" href="#t3218">3218</a></span><span class="t"><span class="str">    rate: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3219" href="#t3219">3219</a></span><span class="t"><span class="str">        Sampling rate in Hertz.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3220" href="#t3220">3220</a></span><span class="t"><span class="str">    idx0: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3221" href="#t3221">3221</a></span><span class="t"><span class="str">        Start index of the analysis window.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3222" href="#t3222">3222</a></span><span class="t"><span class="str">    idx1: int</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3223" href="#t3223">3223</a></span><span class="t"><span class="str">        End index of the analysis window.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3224" href="#t3224">3224</a></span><span class="t"><span class="str">    data_file: str</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3225" href="#t3225">3225</a></span><span class="t"><span class="str">        Full path and name of the loaded file inclusively extension.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3226" href="#t3226">3226</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3227" href="#t3227">3227</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3228" href="#t3228">3228</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3229" href="#t3229">3229</a></span><span class="t">    <span class="nam">rate</span> <span class="op">=</span> <span class="num">0.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3230" href="#t3230">3230</a></span><span class="t">    <span class="nam">idx0</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3231" href="#t3231">3231</a></span><span class="t">    <span class="nam">idx1</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3232" href="#t3232">3232</a></span><span class="t">    <span class="nam">data_file</span> <span class="op">=</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3233" href="#t3233">3233</a></span><span class="t">    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3234" href="#t3234">3234</a></span><span class="t">        <span class="nam">data_file</span> <span class="op">=</span> <span class="nam">file_path</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3235" href="#t3235">3235</a></span><span class="t">    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3236" href="#t3236">3236</a></span><span class="t">        <span class="nam">data_files</span> <span class="op">=</span> <span class="nam">glob</span><span class="op">.</span><span class="nam">glob</span><span class="op">(</span><span class="nam">file_path</span> <span class="op">+</span> <span class="nam">os</span><span class="op">.</span><span class="nam">extsep</span> <span class="op">+</span> <span class="str">'*'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3237" href="#t3237">3237</a></span><span class="t">        <span class="key">for</span> <span class="nam">dfile</span> <span class="key">in</span> <span class="nam">data_files</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3238" href="#t3238">3238</a></span><span class="t">            <span class="key">if</span> <span class="key">not</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">dfile</span><span class="op">)</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span> <span class="key">in</span> <span class="op">[</span><span class="str">'zip'</span><span class="op">]</span> <span class="op">+</span> <span class="nam">list</span><span class="op">(</span><span class="nam">TableData</span><span class="op">.</span><span class="nam">ext_formats</span><span class="op">.</span><span class="nam">values</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3239" href="#t3239">3239</a></span><span class="t">                <span class="nam">data_file</span> <span class="op">=</span> <span class="nam">dfile</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3240" href="#t3240">3240</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3241" href="#t3241">3241</a></span><span class="t">    <span class="key">if</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">exists</span><span class="op">(</span><span class="nam">data_file</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3242" href="#t3242">3242</a></span><span class="t">        <span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">unit</span><span class="op">,</span> <span class="nam">amax</span> <span class="op">=</span> <span class="nam">load_data</span><span class="op">(</span><span class="nam">data_file</span><span class="op">,</span> <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3243" href="#t3243">3243</a></span><span class="t">                                           <span class="op">**</span><span class="nam">load_kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3244" href="#t3244">3244</a></span><span class="t">        <span class="nam">idx0</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3245" href="#t3245">3245</a></span><span class="t">        <span class="nam">idx1</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3246" href="#t3246">3246</a></span><span class="t">        <span class="key">if</span> <span class="nam">eod_props</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_props</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="str">'twin'</span> <span class="key">in</span> <span class="nam">eod_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3247" href="#t3247">3247</a></span><span class="t">            <span class="nam">idx0</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">eod_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="str">'twin'</span><span class="op">]</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3248" href="#t3248">3248</a></span><span class="t">        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">eod_props</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span> <span class="key">and</span> <span class="str">'window'</span> <span class="key">in</span> <span class="nam">eod_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3249" href="#t3249">3249</a></span><span class="t">            <span class="nam">idx1</span> <span class="op">=</span> <span class="nam">idx0</span> <span class="op">+</span> <span class="nam">int</span><span class="op">(</span><span class="nam">eod_props</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="str">'window'</span><span class="op">]</span><span class="op">*</span><span class="nam">rate</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3250" href="#t3250">3250</a></span><span class="t">    <span class="key">return</span> <span class="nam">data</span><span class="op">[</span><span class="op">:</span><span class="op">,</span><span class="nam">channel</span><span class="op">]</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">idx0</span><span class="op">,</span> <span class="nam">idx1</span><span class="op">,</span> <span class="nam">data_file</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3251" href="#t3251">3251</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3252" href="#t3252">3252</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3253" href="#t3253">3253</a></span><span class="t"><span class="key">def</span> <span class="nam">add_eod_analysis_config</span><span class="op">(</span><span class="nam">cfg</span><span class="op">,</span> <span class="nam">thresh_fac</span><span class="op">=</span><span class="num">0.8</span><span class="op">,</span> <span class="nam">percentile</span><span class="op">=</span><span class="num">0.1</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3254" href="#t3254">3254</a></span><span class="t">                            <span class="nam">win_fac</span><span class="op">=</span><span class="num">2.0</span><span class="op">,</span> <span class="nam">min_win</span><span class="op">=</span><span class="num">0.01</span><span class="op">,</span> <span class="nam">max_eods</span><span class="op">=</span><span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3255" href="#t3255">3255</a></span><span class="t">                            <span class="nam">min_sem</span><span class="op">=</span><span class="key">False</span><span class="op">,</span> <span class="nam">unfilter_cutoff</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3256" href="#t3256">3256</a></span><span class="t">                            <span class="nam">flip_wave</span><span class="op">=</span><span class="str">'none'</span><span class="op">,</span> <span class="nam">flip_pulse</span><span class="op">=</span><span class="str">'none'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3257" href="#t3257">3257</a></span><span class="t">                            <span class="nam">n_harm</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">min_pulse_win</span><span class="op">=</span><span class="num">0.001</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3258" href="#t3258">3258</a></span><span class="t">                            <span class="nam">peak_thresh_fac</span><span class="op">=</span><span class="num">0.01</span><span class="op">,</span> <span class="nam">min_dist</span><span class="op">=</span><span class="num">50.0e-6</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3259" href="#t3259">3259</a></span><span class="t">                            <span class="nam">width_frac</span> <span class="op">=</span> <span class="num">0.5</span><span class="op">,</span> <span class="nam">fit_frac</span> <span class="op">=</span> <span class="num">0.5</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3260" href="#t3260">3260</a></span><span class="t">                            <span class="nam">ipi_cv_thresh</span><span class="op">=</span><span class="num">0.5</span><span class="op">,</span> <span class="nam">ipi_percentile</span><span class="op">=</span><span class="num">30.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3261" href="#t3261">3261</a></span><span class="t">    <span class="str">"""Add all parameters needed for the eod analysis functions as a new</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3262" href="#t3262">3262</a></span><span class="t"><span class="str">    section to a configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3263" href="#t3263">3263</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3264" href="#t3264">3264</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3265" href="#t3265">3265</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3266" href="#t3266">3266</a></span><span class="t"><span class="str">    cfg: ConfigFile</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3267" href="#t3267">3267</a></span><span class="t"><span class="str">        The configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3268" href="#t3268">3268</a></span><span class="t"><span class="str">        </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3269" href="#t3269">3269</a></span><span class="t"><span class="str">    See `eod_waveform()`, `analyze_wave()`, and `analyze_pulse()` for</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3270" href="#t3270">3270</a></span><span class="t"><span class="str">    details on the remaining arguments.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3271" href="#t3271">3271</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3272" href="#t3272">3272</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add_section</span><span class="op">(</span><span class="str">'EOD analysis:'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3273" href="#t3273">3273</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'eodSnippetFac'</span><span class="op">,</span> <span class="nam">win_fac</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'The duration of EOD snippets is the EOD period times this factor.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3274" href="#t3274">3274</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'eodMinSnippet'</span><span class="op">,</span> <span class="nam">min_win</span><span class="op">,</span> <span class="str">'s'</span><span class="op">,</span> <span class="str">'Minimum duration of cut out EOD snippets.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3275" href="#t3275">3275</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'eodMaxEODs'</span><span class="op">,</span> <span class="nam">max_eods</span> <span class="key">or</span> <span class="num">0</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'The maximum number of EODs used to compute the average EOD. If 0 use all EODs.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3276" href="#t3276">3276</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'eodMinSem'</span><span class="op">,</span> <span class="nam">min_sem</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Use minimum of s.e.m. to set maximum number of EODs used to compute the average EOD.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3277" href="#t3277">3277</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'unfilterCutoff'</span><span class="op">,</span> <span class="nam">unfilter_cutoff</span><span class="op">,</span> <span class="str">'Hz'</span><span class="op">,</span> <span class="str">'If non-zero remove effect of high-pass filter with this cut-off frequency.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3278" href="#t3278">3278</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'flipWaveEOD'</span><span class="op">,</span> <span class="nam">flip_wave</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Flip EOD of wave fish to make largest extremum positive (flip, none, or auto).'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3279" href="#t3279">3279</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'flipPulseEOD'</span><span class="op">,</span> <span class="nam">flip_pulse</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Flip EOD of pulse fish to make the first large peak positive (flip, none, or auto).'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3280" href="#t3280">3280</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'eodHarmonics'</span><span class="op">,</span> <span class="nam">n_harm</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Number of harmonics fitted to the EOD waveform.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3281" href="#t3281">3281</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'eodMinPulseSnippet'</span><span class="op">,</span> <span class="nam">min_pulse_win</span><span class="op">,</span> <span class="str">'s'</span><span class="op">,</span> <span class="str">'Minimum duration of cut out EOD snippets for a pulse fish.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3282" href="#t3282">3282</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'eodPeakThresholdFactor'</span><span class="op">,</span> <span class="nam">peak_thresh_fac</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Threshold for detection of peaks in pulse EODs as a fraction of the pulse amplitude.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3283" href="#t3283">3283</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'eodMinimumDistance'</span><span class="op">,</span> <span class="nam">min_dist</span><span class="op">,</span> <span class="str">'s'</span><span class="op">,</span> <span class="str">'Minimum distance between peaks and troughs in a EOD pulse.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3284" href="#t3284">3284</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'eodPulseWidthFraction'</span><span class="op">,</span> <span class="nam">width_frac</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'The width of a pulse is measured at this fraction of the pulse height.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3285" href="#t3285">3285</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'eodExponentialFitFraction'</span><span class="op">,</span> <span class="nam">fit_frac</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'An exponential function is fitted on the tail of a pulse starting at this fraction of the height of the last peak.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3286" href="#t3286">3286</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'ipiCVThresh'</span><span class="op">,</span> <span class="nam">ipi_cv_thresh</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'If coefficient of variation of interpulse intervals is smaller than this threshold, then use all intervals for computing EOD frequency.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3287" href="#t3287">3287</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'ipiPercentile'</span><span class="op">,</span> <span class="nam">ipi_percentile</span><span class="op">,</span> <span class="str">'%'</span><span class="op">,</span> <span class="str">'Use only interpulse intervals shorter than this percentile to compute EOD frequency.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3288" href="#t3288">3288</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3289" href="#t3289">3289</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3290" href="#t3290">3290</a></span><span class="t"><span class="key">def</span> <span class="nam">eod_waveform_args</span><span class="op">(</span><span class="nam">cfg</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3291" href="#t3291">3291</a></span><span class="t">    <span class="str">"""Translates a configuration to the respective parameter names of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3292" href="#t3292">3292</a></span><span class="t"><span class="str">    the function `eod_waveform()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3293" href="#t3293">3293</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3294" href="#t3294">3294</a></span><span class="t"><span class="str">    The return value can then be passed as key-word arguments to this</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3295" href="#t3295">3295</a></span><span class="t"><span class="str">    function.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3296" href="#t3296">3296</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3297" href="#t3297">3297</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3298" href="#t3298">3298</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3299" href="#t3299">3299</a></span><span class="t"><span class="str">    cfg: ConfigFile</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3300" href="#t3300">3300</a></span><span class="t"><span class="str">        The configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3301" href="#t3301">3301</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3302" href="#t3302">3302</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3303" href="#t3303">3303</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3304" href="#t3304">3304</a></span><span class="t"><span class="str">    a: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3305" href="#t3305">3305</a></span><span class="t"><span class="str">        Dictionary with names of arguments of the `eod_waveform()` function</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3306" href="#t3306">3306</a></span><span class="t"><span class="str">        and their values as supplied by `cfg`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3307" href="#t3307">3307</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3308" href="#t3308">3308</a></span><span class="t">    <span class="nam">a</span> <span class="op">=</span> <span class="nam">cfg</span><span class="op">.</span><span class="nam">map</span><span class="op">(</span><span class="op">{</span><span class="str">'win_fac'</span><span class="op">:</span> <span class="str">'eodSnippetFac'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3309" href="#t3309">3309</a></span><span class="t">                 <span class="str">'min_win'</span><span class="op">:</span> <span class="str">'eodMinSnippet'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3310" href="#t3310">3310</a></span><span class="t">                 <span class="str">'max_eods'</span><span class="op">:</span> <span class="str">'eodMaxEODs'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3311" href="#t3311">3311</a></span><span class="t">                 <span class="str">'min_sem'</span><span class="op">:</span> <span class="str">'eodMinSem'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3312" href="#t3312">3312</a></span><span class="t">                 <span class="str">'unfilter_cutoff'</span><span class="op">:</span> <span class="str">'unfilterCutoff'</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3313" href="#t3313">3313</a></span><span class="t">    <span class="key">return</span> <span class="nam">a</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3314" href="#t3314">3314</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3315" href="#t3315">3315</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3316" href="#t3316">3316</a></span><span class="t"><span class="key">def</span> <span class="nam">analyze_wave_args</span><span class="op">(</span><span class="nam">cfg</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3317" href="#t3317">3317</a></span><span class="t">    <span class="str">"""Translates a configuration to the respective parameter names of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3318" href="#t3318">3318</a></span><span class="t"><span class="str">    the function `analyze_wave()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3319" href="#t3319">3319</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3320" href="#t3320">3320</a></span><span class="t"><span class="str">    The return value can then be passed as key-word arguments to this</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3321" href="#t3321">3321</a></span><span class="t"><span class="str">    function.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3322" href="#t3322">3322</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3323" href="#t3323">3323</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3324" href="#t3324">3324</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3325" href="#t3325">3325</a></span><span class="t"><span class="str">    cfg: ConfigFile</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3326" href="#t3326">3326</a></span><span class="t"><span class="str">        The configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3327" href="#t3327">3327</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3328" href="#t3328">3328</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3329" href="#t3329">3329</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3330" href="#t3330">3330</a></span><span class="t"><span class="str">    a: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3331" href="#t3331">3331</a></span><span class="t"><span class="str">        Dictionary with names of arguments of the `analyze_wave()` function</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3332" href="#t3332">3332</a></span><span class="t"><span class="str">        and their values as supplied by `cfg`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3333" href="#t3333">3333</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3334" href="#t3334">3334</a></span><span class="t">    <span class="nam">a</span> <span class="op">=</span> <span class="nam">cfg</span><span class="op">.</span><span class="nam">map</span><span class="op">(</span><span class="op">{</span><span class="str">'n_harm'</span><span class="op">:</span> <span class="str">'eodHarmonics'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3335" href="#t3335">3335</a></span><span class="t">                 <span class="str">'power_n_harmonics'</span><span class="op">:</span> <span class="str">'powerNHarmonics'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3336" href="#t3336">3336</a></span><span class="t">                 <span class="str">'flip_wave'</span><span class="op">:</span> <span class="str">'flipWaveEOD'</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3337" href="#t3337">3337</a></span><span class="t">    <span class="key">return</span> <span class="nam">a</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3338" href="#t3338">3338</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3339" href="#t3339">3339</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3340" href="#t3340">3340</a></span><span class="t"><span class="key">def</span> <span class="nam">analyze_pulse_args</span><span class="op">(</span><span class="nam">cfg</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3341" href="#t3341">3341</a></span><span class="t">    <span class="str">"""Translates a configuration to the respective parameter names of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3342" href="#t3342">3342</a></span><span class="t"><span class="str">    the function `analyze_pulse()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3343" href="#t3343">3343</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3344" href="#t3344">3344</a></span><span class="t"><span class="str">    The return value can then be passed as key-word arguments to this</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3345" href="#t3345">3345</a></span><span class="t"><span class="str">    function.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3346" href="#t3346">3346</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3347" href="#t3347">3347</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3348" href="#t3348">3348</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3349" href="#t3349">3349</a></span><span class="t"><span class="str">    cfg: ConfigFile</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3350" href="#t3350">3350</a></span><span class="t"><span class="str">        The configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3351" href="#t3351">3351</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3352" href="#t3352">3352</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3353" href="#t3353">3353</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3354" href="#t3354">3354</a></span><span class="t"><span class="str">    a: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3355" href="#t3355">3355</a></span><span class="t"><span class="str">        Dictionary with names of arguments of the `analyze_pulse()` function</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3356" href="#t3356">3356</a></span><span class="t"><span class="str">        and their values as supplied by `cfg`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3357" href="#t3357">3357</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3358" href="#t3358">3358</a></span><span class="t">    <span class="nam">a</span> <span class="op">=</span> <span class="nam">cfg</span><span class="op">.</span><span class="nam">map</span><span class="op">(</span><span class="op">{</span><span class="str">'min_pulse_win'</span><span class="op">:</span> <span class="str">'eodMinPulseSnippet'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3359" href="#t3359">3359</a></span><span class="t">                 <span class="str">'peak_thresh_fac'</span><span class="op">:</span> <span class="str">'eodPeakThresholdFactor'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3360" href="#t3360">3360</a></span><span class="t">                 <span class="str">'min_dist'</span><span class="op">:</span> <span class="str">'eodMinimumDistance'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3361" href="#t3361">3361</a></span><span class="t">                 <span class="str">'width_frac'</span><span class="op">:</span> <span class="str">'eodPulseWidthFraction'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3362" href="#t3362">3362</a></span><span class="t">                 <span class="str">'fit_frac'</span><span class="op">:</span> <span class="str">'eodExponentialFitFraction'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3363" href="#t3363">3363</a></span><span class="t">                 <span class="str">'flip_pulse'</span><span class="op">:</span> <span class="str">'flipPulseEOD'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3364" href="#t3364">3364</a></span><span class="t">                 <span class="str">'ipi_cv_thresh'</span><span class="op">:</span> <span class="str">'ipiCVThresh'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3365" href="#t3365">3365</a></span><span class="t">                 <span class="str">'ipi_percentile'</span><span class="op">:</span> <span class="str">'ipiPercentile'</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3366" href="#t3366">3366</a></span><span class="t">    <span class="key">return</span> <span class="nam">a</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3367" href="#t3367">3367</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3368" href="#t3368">3368</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3369" href="#t3369">3369</a></span><span class="t"><span class="key">def</span> <span class="nam">add_species_config</span><span class="op">(</span><span class="nam">cfg</span><span class="op">,</span> <span class="nam">species_file</span><span class="op">=</span><span class="str">'none'</span><span class="op">,</span> <span class="nam">wave_max_rms</span><span class="op">=</span><span class="num">0.2</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3370" href="#t3370">3370</a></span><span class="t">                       <span class="nam">pulse_max_rms</span><span class="op">=</span><span class="num">0.2</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3371" href="#t3371">3371</a></span><span class="t">    <span class="str">"""Add parameters needed for assigning EOD waveforms to species.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3372" href="#t3372">3372</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3373" href="#t3373">3373</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3374" href="#t3374">3374</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3375" href="#t3375">3375</a></span><span class="t"><span class="str">    cfg: ConfigFile</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3376" href="#t3376">3376</a></span><span class="t"><span class="str">        The configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3377" href="#t3377">3377</a></span><span class="t"><span class="str">    species_file: string</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3378" href="#t3378">3378</a></span><span class="t"><span class="str">        File path to a file containing species names and corresponding</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3379" href="#t3379">3379</a></span><span class="t"><span class="str">        file names of EOD waveform templates. If 'none', no species</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3380" href="#t3380">3380</a></span><span class="t"><span class="str">        assignemnt is performed.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3381" href="#t3381">3381</a></span><span class="t"><span class="str">    wave_max_rms: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3382" href="#t3382">3382</a></span><span class="t"><span class="str">        Maximum allowed rms difference (relative to standard deviation</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3383" href="#t3383">3383</a></span><span class="t"><span class="str">        of EOD waveform) to an EOD waveform template for assignment to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3384" href="#t3384">3384</a></span><span class="t"><span class="str">        a wave fish species.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3385" href="#t3385">3385</a></span><span class="t"><span class="str">    pulse_max_rms: float</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3386" href="#t3386">3386</a></span><span class="t"><span class="str">        Maximum allowed rms difference (relative to standard deviation</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3387" href="#t3387">3387</a></span><span class="t"><span class="str">        of EOD waveform) to an EOD waveform template for assignment to</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3388" href="#t3388">3388</a></span><span class="t"><span class="str">        a pulse fish species.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3389" href="#t3389">3389</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3390" href="#t3390">3390</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add_section</span><span class="op">(</span><span class="str">'Species assignment:'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3391" href="#t3391">3391</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'speciesFile'</span><span class="op">,</span> <span class="nam">species_file</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'File path to a file containing species names and corresponding file names of EOD waveform templates.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3392" href="#t3392">3392</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'maximumWaveSpeciesRMS'</span><span class="op">,</span> <span class="nam">wave_max_rms</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Maximum allowed rms difference (relative to standard deviation of EOD waveform) to an EOD waveform template for assignment to a wave fish species.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3393" href="#t3393">3393</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'maximumPulseSpeciesRMS'</span><span class="op">,</span> <span class="nam">pulse_max_rms</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Maximum allowed rms difference (relative to standard deviation of EOD waveform) to an EOD waveform template for assignment to a pulse fish species.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3394" href="#t3394">3394</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3395" href="#t3395">3395</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3396" href="#t3396">3396</a></span><span class="t"><span class="key">def</span> <span class="nam">add_eod_quality_config</span><span class="op">(</span><span class="nam">cfg</span><span class="op">,</span> <span class="nam">max_clipped_frac</span><span class="op">=</span><span class="num">0.1</span><span class="op">,</span> <span class="nam">max_variance</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3397" href="#t3397">3397</a></span><span class="t">                           <span class="nam">max_rms_error</span><span class="op">=</span><span class="num">0.05</span><span class="op">,</span> <span class="nam">min_power</span><span class="op">=</span><span class="op">-</span><span class="num">100.0</span><span class="op">,</span> <span class="nam">max_thd</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3398" href="#t3398">3398</a></span><span class="t">                           <span class="nam">max_crossings</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="nam">max_relampl_harm1</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3399" href="#t3399">3399</a></span><span class="t">                           <span class="nam">max_relampl_harm2</span><span class="op">=</span><span class="num">0.0</span><span class="op">,</span> <span class="nam">max_relampl_harm3</span><span class="op">=</span><span class="num">0.0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3400" href="#t3400">3400</a></span><span class="t">    <span class="str">"""Add parameters needed for assesing the quality of an EOD waveform.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3401" href="#t3401">3401</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3402" href="#t3402">3402</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3403" href="#t3403">3403</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3404" href="#t3404">3404</a></span><span class="t"><span class="str">    cfg: ConfigFile</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3405" href="#t3405">3405</a></span><span class="t"><span class="str">        The configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3406" href="#t3406">3406</a></span><span class="t"><span class="str">        </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3407" href="#t3407">3407</a></span><span class="t"><span class="str">    See `wave_quality()` and `pulse_quality()` for details on</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3408" href="#t3408">3408</a></span><span class="t"><span class="str">    the remaining arguments.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3409" href="#t3409">3409</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3410" href="#t3410">3410</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add_section</span><span class="op">(</span><span class="str">'Waveform selection:'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3411" href="#t3411">3411</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'maximumClippedFraction'</span><span class="op">,</span> <span class="nam">max_clipped_frac</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Take waveform of the fish with the highest power only if the fraction of clipped signals is below this value.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3412" href="#t3412">3412</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'maximumVariance'</span><span class="op">,</span> <span class="nam">max_variance</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Skip waveform of fish if the standard error of the EOD waveform relative to the peak-to-peak amplitude is larger than this number. A value of zero allows any variance.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3413" href="#t3413">3413</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'maximumRMSError'</span><span class="op">,</span> <span class="nam">max_rms_error</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Skip waveform of wave fish if the root-mean-squared error of the fit relative to the peak-to-peak amplitude is larger than this number.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3414" href="#t3414">3414</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'minimumPower'</span><span class="op">,</span> <span class="nam">min_power</span><span class="op">,</span> <span class="str">'dB'</span><span class="op">,</span> <span class="str">'Skip waveform of wave fish if its power is smaller than this value.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3415" href="#t3415">3415</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'maximumTotalHarmonicDistortion'</span><span class="op">,</span> <span class="nam">max_thd</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Skip waveform of wave fish if its total harmonic distortion is larger than this value. If set to zero do not check.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3416" href="#t3416">3416</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'maximumCrossings'</span><span class="op">,</span> <span class="nam">max_crossings</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Maximum number of zero crossings per EOD period.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3417" href="#t3417">3417</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'maximumFirstHarmonicAmplitude'</span><span class="op">,</span> <span class="nam">max_relampl_harm1</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Skip waveform of wave fish if the amplitude of the first harmonic is higher than this factor times the amplitude of the fundamental. If set to zero do not check.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3418" href="#t3418">3418</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'maximumSecondHarmonicAmplitude'</span><span class="op">,</span> <span class="nam">max_relampl_harm2</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Skip waveform of wave fish if the ampltude of the second harmonic is higher than this factor times the amplitude of the fundamental. That is, the waveform appears to have twice the frequency than the fundamental. If set to zero do not check.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3419" href="#t3419">3419</a></span><span class="t">    <span class="nam">cfg</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="str">'maximumThirdHarmonicAmplitude'</span><span class="op">,</span> <span class="nam">max_relampl_harm3</span><span class="op">,</span> <span class="str">''</span><span class="op">,</span> <span class="str">'Skip waveform of wave fish if the ampltude of the third harmonic is higher than this factor times the amplitude of the fundamental. If set to zero do not check.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3420" href="#t3420">3420</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3421" href="#t3421">3421</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3422" href="#t3422">3422</a></span><span class="t"><span class="key">def</span> <span class="nam">wave_quality_args</span><span class="op">(</span><span class="nam">cfg</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3423" href="#t3423">3423</a></span><span class="t">    <span class="str">"""Translates a configuration to the respective parameter names of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3424" href="#t3424">3424</a></span><span class="t"><span class="str">    the function `wave_quality()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3425" href="#t3425">3425</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3426" href="#t3426">3426</a></span><span class="t"><span class="str">    The return value can then be passed as key-word arguments to this</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3427" href="#t3427">3427</a></span><span class="t"><span class="str">    function.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3428" href="#t3428">3428</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3429" href="#t3429">3429</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3430" href="#t3430">3430</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3431" href="#t3431">3431</a></span><span class="t"><span class="str">    cfg: ConfigFile</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3432" href="#t3432">3432</a></span><span class="t"><span class="str">        The configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3433" href="#t3433">3433</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3434" href="#t3434">3434</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3435" href="#t3435">3435</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3436" href="#t3436">3436</a></span><span class="t"><span class="str">    a: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3437" href="#t3437">3437</a></span><span class="t"><span class="str">        Dictionary with names of arguments of the `wave_quality()` function</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3438" href="#t3438">3438</a></span><span class="t"><span class="str">        and their values as supplied by `cfg`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3439" href="#t3439">3439</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3440" href="#t3440">3440</a></span><span class="t">    <span class="nam">a</span> <span class="op">=</span> <span class="nam">cfg</span><span class="op">.</span><span class="nam">map</span><span class="op">(</span><span class="op">{</span><span class="str">'max_clipped_frac'</span><span class="op">:</span> <span class="str">'maximumClippedFraction'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3441" href="#t3441">3441</a></span><span class="t">                 <span class="str">'max_rms_sem'</span><span class="op">:</span> <span class="str">'maximumVariance'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3442" href="#t3442">3442</a></span><span class="t">                 <span class="str">'max_rms_error'</span><span class="op">:</span> <span class="str">'maximumRMSError'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3443" href="#t3443">3443</a></span><span class="t">                 <span class="str">'min_power'</span><span class="op">:</span> <span class="str">'minimumPower'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3444" href="#t3444">3444</a></span><span class="t">                 <span class="str">'max_crossings'</span><span class="op">:</span> <span class="str">'maximumCrossings'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3445" href="#t3445">3445</a></span><span class="t">                 <span class="str">'min_freq'</span><span class="op">:</span> <span class="str">'minimumFrequency'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3446" href="#t3446">3446</a></span><span class="t">                 <span class="str">'max_freq'</span><span class="op">:</span> <span class="str">'maximumFrequency'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3447" href="#t3447">3447</a></span><span class="t">                 <span class="str">'max_thd'</span><span class="op">:</span> <span class="str">'maximumTotalHarmonicDistortion'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3448" href="#t3448">3448</a></span><span class="t">                 <span class="str">'max_db_diff'</span><span class="op">:</span> <span class="str">'maximumPowerDifference'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3449" href="#t3449">3449</a></span><span class="t">                 <span class="str">'max_harmonics_db'</span><span class="op">:</span> <span class="str">'maximumHarmonicsPower'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3450" href="#t3450">3450</a></span><span class="t">                 <span class="str">'max_relampl_harm1'</span><span class="op">:</span> <span class="str">'maximumFirstHarmonicAmplitude'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3451" href="#t3451">3451</a></span><span class="t">                 <span class="str">'max_relampl_harm2'</span><span class="op">:</span> <span class="str">'maximumSecondHarmonicAmplitude'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3452" href="#t3452">3452</a></span><span class="t">                 <span class="str">'max_relampl_harm3'</span><span class="op">:</span> <span class="str">'maximumThirdHarmonicAmplitude'</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3453" href="#t3453">3453</a></span><span class="t">    <span class="key">return</span> <span class="nam">a</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3454" href="#t3454">3454</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3455" href="#t3455">3455</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3456" href="#t3456">3456</a></span><span class="t"><span class="key">def</span> <span class="nam">pulse_quality_args</span><span class="op">(</span><span class="nam">cfg</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3457" href="#t3457">3457</a></span><span class="t">    <span class="str">"""Translates a configuration to the respective parameter names of</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3458" href="#t3458">3458</a></span><span class="t"><span class="str">    the function `pulse_quality()`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3459" href="#t3459">3459</a></span><span class="t"><span class="str">    </span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3460" href="#t3460">3460</a></span><span class="t"><span class="str">    The return value can then be passed as key-word arguments to this</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3461" href="#t3461">3461</a></span><span class="t"><span class="str">    function.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3462" href="#t3462">3462</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3463" href="#t3463">3463</a></span><span class="t"><span class="str">    Parameters</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3464" href="#t3464">3464</a></span><span class="t"><span class="str">    ----------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3465" href="#t3465">3465</a></span><span class="t"><span class="str">    cfg: ConfigFile</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3466" href="#t3466">3466</a></span><span class="t"><span class="str">        The configuration.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3467" href="#t3467">3467</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3468" href="#t3468">3468</a></span><span class="t"><span class="str">    Returns</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3469" href="#t3469">3469</a></span><span class="t"><span class="str">    -------</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3470" href="#t3470">3470</a></span><span class="t"><span class="str">    a: dict</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3471" href="#t3471">3471</a></span><span class="t"><span class="str">        Dictionary with names of arguments of the `pulse_quality()` function</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3472" href="#t3472">3472</a></span><span class="t"><span class="str">        and their values as supplied by `cfg`.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3473" href="#t3473">3473</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3474" href="#t3474">3474</a></span><span class="t">    <span class="nam">a</span> <span class="op">=</span> <span class="nam">cfg</span><span class="op">.</span><span class="nam">map</span><span class="op">(</span><span class="op">{</span><span class="str">'max_clipped_frac'</span><span class="op">:</span> <span class="str">'maximumClippedFraction'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3475" href="#t3475">3475</a></span><span class="t">                 <span class="str">'max_rms_sem'</span><span class="op">:</span> <span class="str">'maximumRMSNoise'</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3476" href="#t3476">3476</a></span><span class="t">    <span class="key">return</span> <span class="nam">a</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3477" href="#t3477">3477</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3478" href="#t3478">3478</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3479" href="#t3479">3479</a></span><span class="t"><span class="key">def</span> <span class="nam">main</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3480" href="#t3480">3480</a></span><span class="t">    <span class="key">import</span> <span class="nam">matplotlib</span><span class="op">.</span><span class="nam">pyplot</span> <span class="key">as</span> <span class="nam">plt</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3481" href="#t3481">3481</a></span><span class="t">    <span class="key">from</span> <span class="op">.</span><span class="nam">fakefish</span> <span class="key">import</span> <span class="nam">pulsefish_eods</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3482" href="#t3482">3482</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3483" href="#t3483">3483</a></span><span class="t">    <span class="nam">print</span><span class="op">(</span><span class="str">'Analysis of EOD waveforms.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3484" href="#t3484">3484</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3485" href="#t3485">3485</a></span><span class="t">    <span class="com"># data:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3486" href="#t3486">3486</a></span><span class="t">    <span class="nam">rate</span> <span class="op">=</span> <span class="num">44100.0</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3487" href="#t3487">3487</a></span><span class="t">    <span class="nam">data</span> <span class="op">=</span> <span class="nam">pulsefish_eods</span><span class="op">(</span><span class="str">'Triphasic'</span><span class="op">,</span> <span class="num">83.0</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="num">5.0</span><span class="op">,</span> <span class="nam">noise_std</span><span class="op">=</span><span class="num">0.02</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3488" href="#t3488">3488</a></span><span class="t">    <span class="nam">unit</span> <span class="op">=</span> <span class="str">'mV'</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3489" href="#t3489">3489</a></span><span class="t">    <span class="nam">eod_idx</span><span class="op">,</span> <span class="nam">_</span> <span class="op">=</span> <span class="nam">detect_peaks</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="num">1.0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3490" href="#t3490">3490</a></span><span class="t">    <span class="nam">eod_times</span> <span class="op">=</span> <span class="nam">eod_idx</span><span class="op">/</span><span class="nam">rate</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3491" href="#t3491">3491</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3492" href="#t3492">3492</a></span><span class="t">    <span class="com"># analyse EOD:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3493" href="#t3493">3493</a></span><span class="t">    <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">eod_times</span> <span class="op">=</span> <span class="nam">eod_waveform</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">rate</span><span class="op">,</span> <span class="nam">eod_times</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3494" href="#t3494">3494</a></span><span class="t">    <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">props</span><span class="op">,</span> <span class="nam">peaks</span><span class="op">,</span> <span class="nam">power</span> <span class="op">=</span> <span class="nam">analyze_pulse</span><span class="op">(</span><span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">eod_times</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3495" href="#t3495">3495</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3496" href="#t3496">3496</a></span><span class="t">    <span class="com"># plot:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3497" href="#t3497">3497</a></span><span class="t">    <span class="nam">fig</span><span class="op">,</span> <span class="nam">axs</span> <span class="op">=</span> <span class="nam">plt</span><span class="op">.</span><span class="nam">subplots</span><span class="op">(</span><span class="num">1</span><span class="op">,</span> <span class="num">2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3498" href="#t3498">3498</a></span><span class="t">    <span class="nam">plot_eod_waveform</span><span class="op">(</span><span class="nam">axs</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">mean_eod</span><span class="op">,</span> <span class="nam">props</span><span class="op">,</span> <span class="nam">peaks</span><span class="op">,</span> <span class="nam">unit</span><span class="op">=</span><span class="nam">unit</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3499" href="#t3499">3499</a></span><span class="t">    <span class="nam">axs</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">set_title</span><span class="op">(</span><span class="fst">f'</span><span class="op">{</span><span class="nam">props</span><span class="op">[</span><span class="str">"type"</span><span class="op">]</span><span class="op">}</span><span class="fst"> fish: EODf = </span><span class="op">{</span><span class="nam">props</span><span class="op">[</span><span class="str">"EODf"</span><span class="op">]</span><span class="op">:</span><span class="fst">.1f</span><span class="op">}</span><span class="fst"> Hz</span><span class="fst">'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3500" href="#t3500">3500</a></span><span class="t">    <span class="nam">plot_pulse_spectrum</span><span class="op">(</span><span class="nam">axs</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">power</span><span class="op">,</span> <span class="nam">props</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3501" href="#t3501">3501</a></span><span class="t">    <span class="nam">plt</span><span class="op">.</span><span class="nam">show</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3502" href="#t3502">3502</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t3503" href="#t3503">3503</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3504" href="#t3504">3504</a></span><span class="t"><span class="key">if</span> <span class="nam">__name__</span> <span class="op">==</span> <span class="str">'__main__'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3505" href="#t3505">3505</a></span><span class="t">    <span class="nam">main</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="z_bbf95fe1437c662b_efield_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a class="nav" href="z_bbf95fe1437c662b_eodexplorer_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.7.1">coverage.py v7.7.1</a>,
            created at 2025-03-23 22:57 +0000
        </p>
    </div>
</footer>
</body>
</html>
