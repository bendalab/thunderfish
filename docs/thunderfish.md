# thunderfish

Detect, analyze, and plot all EOD waveforms in a short recording.


## Authors

The [Neuroethology-lab](https://uni-tuebingen.de/en/faculties/faculty-of-science/departments/biology/institutes/neurobiology/lehrbereiche/neuroethology/) at the Institute of Neuroscience at the University of T&uuml;bingen:

- Jan Benda
- J&ouml;rg Henninger (harmonic groups)
- Juan Sehuanes (best window)
- Till Raab (annotation)
- Liz Weerdmeester (pulse clustering)


## Principles of operation

`thunderfish` automatically detects and analyzes all wave- and
pulse-type EOD waveforms in a short recording. A short recording is
typically no longer than about 30s. The recordings are made either
with a fishfinder (a stick with two electrodes used to find electric
fish in the field) or standardized head-tail recordings in a little
tank.

1. A segment for further waveform analysis is identified in the
   recording
   ([`bestwindow`](https://bendalab.github.io/thunderfish/api/bestwindow.html)
   module). In this segment the amplitude of the recording is largest
   while at the same time most stable and not clipped.
2. A powerspectrum of a given frequency resolution is computed
   ([`powerspectrum`](https://bendalab.github.io/thunderfish/api/powerspectrum.html)
   module) and potential EOD frequencies of wave-type fish are
   detected in this power spectrum based on their harmonic structure
   ([`harmonics`](https://bendalab.github.io/thunderfish/api/harmonics.html)
   module).
3. EODs of pulse-type fish are detected and clustered according to
   their width, amplitude, and shape
   ([`pulse`](https://bendalab.github.io/thunderfish/api/pulse.html)
   module).
4. For each pulse and wave-type fish detected in the recording an
   averaged waveform is computed and its properties are analyzed
   ([`eodanalysis`](https://bendalab.github.io/thunderfish/api/eodanalysis.html)
   module)

The files generated by `thunderfish` on EOD waveform properties can be
summarized in single files by means of the
[`collectfish`](https://bendalab.github.io/thunderfish/collectfish.html)
script and then analyzed and explored with the
[`eodexplorer`](https://bendalab.github.io/thunderfish/eodexplorer.html/).


## Command line arguments

```sh
thunderfish --help
```
returns
```plain
usage: thunderfish.py [-h] [--version] [-v] [-V] [-c] [--channel CHANNEL] [-t TIME] [-T] [-m {w,p,wp}] [-a] [-S] [-b]
                      [-l [MINFREQ]] [-p] [-M PDFFILE] [-P rtpwse] [-d PATH] [-j [JOBS]] [-s] [-z]
                      [-f {dat,ascii,csv,rtai,md,tex,html,py}] [-o OUTPATH] [-k] [-i KWARGS]
                      [file [file ...]]

Analyze EOD waveforms of weakly electric fish.

positional arguments:
  file                  name of a file with time series data of an EOD recording, may include wildcards

optional arguments:
  -h, --help            show this help message and exit
  --version             show program's version number and exit
  -v                    verbosity level. Increase by specifying -v multiple times, or like -vvv
  -V                    level for debugging plots. Increase by specifying -V multiple times, or like -VVV
  -c                    save configuration to file thunderfish.cfg after reading all configuration files
  --channel CHANNEL     channel to be analyzed (defaults to first channel, negative channel selects all channels)
  -t TIME               start time of analysis window in recording: "beginning", "center", "end", "best", or time in seconds
                        (overwrites "windowPosition" in cofiguration file)
  -T                    add start time of analysis file to output file names
  -m {w,p,wp}           extract wave "w" and/or pulse "p" fish EODs
  -a                    show all EOD waveforms in the summary plot
  -S                    plot spectra for all EOD waveforms in the summary plot
  -b                    indicate bad EODs in legend of power spectrum
  -l [MINFREQ]          logarithmic frequency axis in power spectrum with optional minimum frequency (defaults to 100 Hz)
  -p                    save output plots as pdf files
  -M PDFFILE            save all summary plots of all recordings in a multi page pdf file. Disables parallel jobs.
  -P rtpwse             save subplots as separate pdf files: r) recording with analysis window, t) data trace with detected
                        pulse fish, p) power spectrum with detected wave fish, w/W) mean EOD waveform, s/S) EOD spectrum, e/E)
                        EOD waveform and spectra, d) the default summary plot. Capital letters produce a single multipage pdf
                        containing plots of all detected fish
  -d PATH               path to raw EOD recordings needed for plotting based on analysis results
  -j [JOBS]             number of jobs run in parallel. Without argument use all CPU cores.
  -s                    save analysis results to files
  -z                    save analysis results in a single zip file
  -f {dat,ascii,csv,rtai,md,tex,html,py}
                        file format used for saving analysis results, defaults to the format specified in the configuration file
                        or "csv"
  -o OUTPATH            path where to store results and figures (defaults to current working directory)
  -k                    keep path of input file when saving analysis files, i.e. append path of input file to OUTPATH
  -i KWARGS             key-word arguments for the data loader function

version 1.9.9 by Benda-Lab (2015-2022)

examples:
- analyze the single file data.wav interactively:
  > thunderfish data.wav
- extract wavefish only:
  > thunderfish -m w data.wav
- automatically analyze all wav files in the current working directory and save analysis results and plot to files:
  > thunderfish -s -p *.wav
- analyze all wav files in the river1/ directory, use all CPUs, and write files directly to "results/":
  > thunderfish -j -s -p -o results/ river1/*.wav
- analyze all wav files in the river1/ directory and write files to "results/river1/":
  > thunderfish -s -p -o results/ -k river1/*.wav
- write configuration file:
  > thunderfish -c
```


## Configuration file

Many parameters of the algorithms used by thunderfish can be set via a
configuration file.

Generate the configuration file by executing
```
thunderfish -c
```
This first reads in all configuration files found (see below) and then writes
the file `thunderfish.cfg` into the current working directory.

Whenever you run thunderfish it searches for configuration files in 

1. the current working directory 
2. the directory of each input file
3. the parent directories of each input file, up to three levels up.

Best practice is to move the configuration file to the root of the file tree
where data files of a recording session are stored.

Use the `-v` switch twice to see which configuration files are loaded:
```
thunderfish -vv data.wav
```

Open the configuration file in your favourite editor and edit the settings.
Each parameter is briefly explained in the comment preceding the parameter.


### Important configuration parameter

The list of configuration parameter is overwhelming and most of them
you do not need to touch at all. Here is a list of the few that matter
(in the order as they appear in the configuration file):

- `frequencyResolution`: this sets the nnft parameter for computing
  the power spectrum such to achieve the requested resolution in
  frequency. The longer your analysis window the smaller you can set the
  resultion (not smaller then the inverse analysis window).

- `numberPSDWindows`: If larger than one then only fish that are
  present in all windows are reported. If you have very stationary data 
  (from a restrained fish, not from a fishfinder) you may set this to one.

- `lowThresholdFactor`, `highThresholdFactor`: play around with these
  numbers if not all wavefish are detected or if too many peaks are
  detected in the power spectrum.

- `mainsFreq`: Set it to the frequency of your mains power supply
  (50 or 60 Hz) or to zero if you have hum-free recordings.

- `maxRelativePower`: Usually, the higher the harmonics the less power
  it has. In order to discard signals whose power does not decay set this
  -10 or -20 dB.  

- `maxGroups`: Set to 1 if you know that only a single fish is in your
  recording.

- `minDataAmplitude`, `maxDataAmplitude`: If the maximum voltage range
  your recording device differs from -1 to 1 (default for WAV files),
  set these two parameter to the limits, so that clipped recordings
  are detected as such.

- `windowSize`: How much of the data should be used for analysis.  If
  you have stationary data (from a restrained fish, not from a
  fishfinder) you may want to use the full recording by setting this
  to zero.

- `windowPosition`: Where to place the analysis window: at the
  "beginning", "center", or "end" of the recording. If set to "best"
  (default) thunderfish searches for the most stationary data segment
  of the requested length. Can be overwritten from the command line
  with the `-t` argument.

- `pulseWidthPercentile`: If low frequency pulse fish are missed then
  reduce this number.

- `eodMaxEODs`: The average waveform is estimated by averaging over at
  maximum this number of EODs. If wavefish change their frequency then
  you do not want to set this number too high (10 to 100 is enough for
  reducing noise). If you have several fish on your recording then
  this number needs to be high (1000) to average away the other fish.
  Set it to zero in order to use all EODs in the data segment
  selected for analysis.

- `flipWaveEOD`, `flipPulseEOD`: In case of recordings with a
  fishfinder you do not know the orientation of the fish relative to
  your electrode. That is you do not know the polarity of your
  recording.  Setting this to `auto` flips the sign of the averaged
  EOD waveform to a standardized polarity (wave-type fish: larger peak
  relative to average is positive, pulse-type fish: the first of the
  two largest peaks is positive).

- `fileFormat`: sets the default file format to be used for storing
  the analysis results.


## Summary plots

By default, `thunderfish` simply displays the analysis results in a
summary plot.

You can produce these plots either from the recording files or
directly from the saved analysis results (`.csv` or `.zip` files, see
next section). So to analyse some recordings and save the summary
plots to pdf files in the `images/` folder you call
```sh
thunderfish -p -o images data/*.wav
```
But this might take a while since the analysis is costly.

Alternatively you might first analyze the recordings and save the
analyis results as zip files in a `results/` folder:
```sh
thunderfish -j -s -z -o results data/*.wav
```
Afterwards, you then can quickly look at the results by calling
```sh
thunderfish -d data/ results/*.zip
```
and press `q` to flip through the plots. The `-d` option tells
`thunderfish` where it finds the corresponding files with the
recordings.

In the summary plots you can press

- `q`: Close the plot window and show the next one or quit.
- `p`: Play the analyzed section of the reording on the default audio device.
- `m`: Play an associated voice message file (a file with the same name but `-message` added.
- `o`: Switch on zoom mode. You can draw a rectangle with the mouse to zoom in.
- `Backspace`: Zoom back. 
- `f`: Toggle full screen mode.

Notem that the coordinates under the mouse pointer are displayed as
well (usually in the bottom right corner).

By default, the summary plots display at maximum four EOD waveforms
with the largest amplitudes. If only a single waveform is found, then
its spectrum is displayed as well. The frequencies of the power
spectrum of the recording are shown on a linear scale. These behaviors
can be modified by the following command line options:

- `-a`: plot all detected EOD waveforms in summary plots.
- `-S`: plot spectra for all displayed EOD waveforms.
- `-b`: indicate bad EODs in the legend of the power spectrum of the recording.
- `-l [MINFREQ]`: plot the power spectrum on a logarithmic frequency
  scale. The optional argument in addition allows to set the minimum
  frequency `MINFREQ` in Hertz that is displayed (defaults to 100 Hz).

The plots can alternatively be saved to pdf files via the `-p`
option. They are named `RECORDING.pdf`, where `RECORDING` is the base
name of the recording file. See next section on how to define the
output folder (`-o` and `-k` options).

The summary plots of all analyzed recordings can also be stored in a
single, multi-page pdf file, where the results of each recording are
plotted on a separate page. For this supply a name for the pdf file
via the `-M` option.

The various subplots of the summary plot can also be viewd separately
or saved in separate pdf files. For this, use the `-P` option. It
expects as an argument a string whose characters specify what you want
to plot:

- `r`: plot the whole recording with the analysis window indicated
  (saved into `RECORDING-recording.pdf`).
- `t`: plot of a small section of the data trace with detected pulse fish
  (saved into `RECORDING-trace.pdf`).
- `p`: power spectrum of the recording with detected wave fish
  (saved into `RECORDING-psd.pdf`).
- `w`/`W`: annotated mean EOD waveforms
  (saved into `RECORDING-waveforms.pdf`).
- `s`/`S`: spectrum of the EOD waveform
  (saved into `RECORDING-spectrum.pdf`).
- `e`/`E`: Both the annotated EOD waveform and its spectrum
  (saved into `RECORDING-eods.pdf`).
- `d`: the default summary plot (saved into `RECORDING.pdf`).

Capital letters produce a single multipage pdf containing the
specified plots of all detected fish of a recording. For example,
```sh
thunderfish -p -P pE -d data/ -o images/ results/*.zip
```
produces pdf files with the power spectrum of the recording and with
all the EOD waveforms together with their spectra in the folder
`images/`. For computing the power spectrum `thunderfish` needs the
raw data that it finds in the `data/` folder.


## Output pathes

Output files (plots and/or analysis results) are placed in the current
working directory if no path is specified via the `-o` switch. If the
path specified via `-o` does not exist it is created.

With the `-k` switch the pathes of the input files are appended to the
output path. This allows you to analyse recordings organized in a
nested directory structure in one step and write the files in the same
structure. For example:
```
thunderfish -s -k -o analysis river1/habitatA/*.wav river1/habitatB/*.wav river2/*.wav
```
will store the files in
```
analysis/river1/habitatA/
analysis/river1/habitatB/
analysis/river2/
```
whereas without the `-k` switch all files are stored in
```
analysis/
```

To make use of all the cores of your CPU apply the `-j` switch.


## Analysis results

With the `-s` switch analysis results are saved to files and no
interactive output plots are generated.

The many output files (see below) can be combined into a single zip
archive (one per recording) with the `-z` option.

The following files are generated:

- `RECORDING-CHANNEL-TIME-eodwaveform-N.EXT`: averaged EOD waveform
- `RECORDING-CHANNEL-TIME-waveeodfs.EXT`: list of all detected EOD frequencies and powers of wave-type fish
- `RECORDING-CHANNEL-TIME-wavefish.EXT`: list of properties of good EODs of wave-type fish
- `RECORDING-CHANNEL-TIME-wavespectrum-N.EXT`: for each wave-type fish the Fourier spectrum
- `RECORDING-CHANNEL-TIME-pulsefish.EXT`: list of properties of good EODs of pulse-type fish
- `RECORDING-CHANNEL-TIME-pulsephases-N.EXT`: for each pulse-type fish properties of EOD phases
- `RECORDING-CHANNEL-TIME-pulsegaussians-N.EXT`: for each pulse-type fish properties of Gaussians fitting the EOD phases
- `RECORDING-CHANNEL-TIME-pulsetimes-N.EXT`: for each pulse-type fish the time points of detected EODs
- `RECORDING-CHANNEL-TIME-pulsespectrum-N.EXT`: for each pulse-type fish the power spectrum of a single pulse

Filenames are composed of the basename of the input file
(`RECORDING`).  In case the input files contain more than a single
channel channel specification is appended (`CH`), a 'c' followed by
the channel number. In case the start time of the analysis window was
requested to be saved into the file name (`-T` option), this start
time is added to the file name (`TIME`) as an 't' followed by the
start time floored to integer seconds, and an 's'.  Fish detected in
the recordings are numbered, starting with 0 (`N`).  The file
extension depends on the chosen file format (`EXT`).  The following
sections describe the content of the generated files.


### RECORDING-CHANNEL-TIME-eodwaveform-N.EXT

For each fish the average waveform with standard error and fit.

<table>
<thead>
  <tr>
    <th align="left">time</th>
    <th align="left">mean</th>
    <th align="left">sem</th>
    <th align="left">fit</th>
    <th align="left">tailfit</th>
  </tr>
  <tr>
    <th align="left">ms</th>
    <th align="left">a.u.</th>
    <th align="left">a.u.</th>
    <th align="left">a.u.</th>
    <th align="left">a.u.</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td align="right">-1.750</td>
    <td align="right">0.000183971</td>
    <td align="right">0.000355154</td>
    <td align="right">-0.00000</td>
    <td align="right">-</td>
  </tr>
  <tr>
    <td align="right">-1.719</td>
    <td align="right">0.000105037</td>
    <td align="right">0.000355562</td>
    <td align="right">-0.00000</td>
    <td align="right">-</td>
  </tr>
  <tr>
    <td align="right">-1.688</td>
    <td align="right">0.000158089</td>
    <td align="right">0.000353294</td>
    <td align="right">-0.00000</td>
    <td align="right">-</td>
  </tr>
  <tr>
    <td align="right">-1.656</td>
    <td align="right">6.47331e-05</td>
    <td align="right">0.000356885</td>
    <td align="right">-0.00000</td>
    <td align="right">-</td>
  </tr>
</tbody>
</table>

The columns contain:

1. `time` Time in milliseconds.
2. `mean` Averaged waveform in the unit of the input data.
3. `sem` Corresponding standard error of the mean.
4. `fit` A fit to the averaged waveform. In case of a wave fish this
   is a Fourier series, for pulse fish it is a sum of Gaussians.
5. `tailfit` For pulse fish an exponential fit to the tail of the last
   EOD phase.


### RECORDING-CHANNEL-TIME-waveeodfs.EXT

List of all detected EOD frequencies and powers of wave-type fish.
These might be more than listed in `RECORDING-CHANNEL-TIME-wavefish.EXT`.

<table>
<thead>
  <tr>
    <th align="left">index</th>
    <th align="left">EODf</th>
    <th align="left">datapower</th>
  </tr>
  <tr>
    <th align="left">-</th>
    <th align="left">Hz</th>
    <th align="left">dB</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td align="right">1</td>
    <td align="right">111.33</td>
    <td align="right">-33.35</td>
  </tr>
  <tr>
    <td align="right">2</td>
    <td align="right">132.81</td>
    <td align="right">-37.86</td>
  </tr>
  <tr>
    <td align="right">0</td>
    <td align="right">580.08</td>
    <td align="right">-22.01</td>
  </tr>
  <tr>
    <td align="right">3</td>
    <td align="right">608.89</td>
    <td align="right">-45.45</td>
  </tr>
</tbody>
</table>

The columns contain:

1. `index` Index of the fish (the number that is also used to number the files).
2. `EODf` EOD frequency in Hertz.
3. `datapower` Power of this EOD in decibel (sum over all peaks in the
   power spectrum of the recording).


### RECORDING-CHANNEL-TIME-wavefish.EXT

Fundamental EOD frequency and other properties of each
wave-type fish detected in the recording.

<table>
<thead>
  <tr>
    <th align="left" colspan="6">recording</th>
    <th align="left" colspan="13">waveform</th>
    <th align="left" colspan="11">timing</th>
  </tr>
  <tr>
    <th align="left">twin</th>
    <th align="left">window</th>
    <th align="left">winclipped</th>
    <th align="left">samplerate</th>
    <th align="left">nfft</th>
    <th align="left">dfreq</th>
    <th align="left">index</th>
    <th align="left">EODf</th>
    <th align="left">p-p-amplitude</th>
    <th align="left">power</th>
    <th align="left">datapower</th>
    <th align="left">thd</th>
    <th align="left">dbdiff</th>
    <th align="left">maxdb</th>
    <th align="left">noise</th>
    <th align="left">rmserror</th>
    <th align="left">clipped</th>
    <th align="left">flipped</th>
    <th align="left">n</th>
    <th align="left">ncrossings</th>
    <th align="left">peakwidth</th>
    <th align="left">troughwidth</th>
    <th align="left">minwidth</th>
    <th align="left">leftpeak</th>
    <th align="left">rightpeak</th>
    <th align="left">lefttrough</th>
    <th align="left">righttrough</th>
    <th align="left">p-p-distance</th>
    <th align="left">min-p-p-distance</th>
    <th align="left">relpeakampl</th>
  </tr>
  <tr>
    <th align="left">s</th>
    <th align="left">s</th>
    <th align="left">%</th>
    <th align="left">kHz</th>
    <th align="left">-</th>
    <th align="left">Hz</th>
    <th align="left">-</th>
    <th align="left">Hz</th>
    <th align="left">a.u.</th>
    <th align="left">dB</th>
    <th align="left">dB</th>
    <th align="left">%</th>
    <th align="left">dB</th>
    <th align="left">dB</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">-</th>
    <th align="left">-</th>
    <th align="left">-</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">%</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td align="right">4.25</td>
    <td align="right">8.00</td>
    <td align="right">0.00</td>
    <td align="right">32.000</td>
    <td align="right">131072</td>
    <td align="right">0.24</td>
    <td align="right">0</td>
    <td align="right">580.08</td>
    <td align="right">0.22755</td>
    <td align="right">-21.28</td>
    <td align="right">-19.05</td>
    <td align="right">149.81</td>
    <td align="right">2.93</td>
    <td align="right">-9.22</td>
    <td align="right">0.3</td>
    <td align="right">0.36</td>
    <td align="right">0.0</td>
    <td align="right">0</td>
    <td align="right">3300</td>
    <td align="right">1</td>
    <td align="right">76.15</td>
    <td align="right">23.85</td>
    <td align="right">23.85</td>
    <td align="right">69.12</td>
    <td align="right">7.03</td>
    <td align="right">11.10</td>
    <td align="right">12.75</td>
    <td align="right">18.13</td>
    <td align="right">18.13</td>
    <td align="right">75.73</td>
  </tr>
  <tr>
    <td align="right">4.25</td>
    <td align="right">8.00</td>
    <td align="right">0.00</td>
    <td align="right">32.000</td>
    <td align="right">131072</td>
    <td align="right">0.24</td>
    <td align="right">1</td>
    <td align="right">111.08</td>
    <td align="right">0.05387</td>
    <td align="right">-31.84</td>
    <td align="right">-30.09</td>
    <td align="right">69.07</td>
    <td align="right">4.12</td>
    <td align="right">-30.74</td>
    <td align="right">4.5</td>
    <td align="right">0.66</td>
    <td align="right">0.0</td>
    <td align="right">0</td>
    <td align="right">886</td>
    <td align="right">2</td>
    <td align="right">58.56</td>
    <td align="right">41.44</td>
    <td align="right">41.44</td>
    <td align="right">18.77</td>
    <td align="right">39.79</td>
    <td align="right">19.92</td>
    <td align="right">21.52</td>
    <td align="right">59.71</td>
    <td align="right">40.29</td>
    <td align="right">58.70</td>
  </tr>
  <tr>
    <td align="right">4.25</td>
    <td align="right">8.00</td>
    <td align="right">0.00</td>
    <td align="right">32.000</td>
    <td align="right">131072</td>
    <td align="right">0.24</td>
    <td align="right">2</td>
    <td align="right">133.06</td>
    <td align="right">0.02668</td>
    <td align="right">-37.91</td>
    <td align="right">-33.92</td>
    <td align="right">62.16</td>
    <td align="right">5.93</td>
    <td align="right">-33.64</td>
    <td align="right">8.4</td>
    <td align="right">0.45</td>
    <td align="right">0.0</td>
    <td align="right">0</td>
    <td align="right">1061</td>
    <td align="right">2</td>
    <td align="right">42.13</td>
    <td align="right">57.87</td>
    <td align="right">42.13</td>
    <td align="right">20.90</td>
    <td align="right">21.23</td>
    <td align="right">19.93</td>
    <td align="right">37.94</td>
    <td align="right">41.16</td>
    <td align="right">41.16</td>
    <td align="right">57.90</td>
  </tr>
  <tr>
    <td align="right">4.25</td>
    <td align="right">8.00</td>
    <td align="right">0.00</td>
    <td align="right">32.000</td>
    <td align="right">131072</td>
    <td align="right">0.24</td>
    <td align="right">3</td>
    <td align="right">608.64</td>
    <td align="right">0.01460</td>
    <td align="right">-44.82</td>
    <td align="right">-40.98</td>
    <td align="right">120.54</td>
    <td align="right">4.91</td>
    <td align="right">-22.21</td>
    <td align="right">7.2</td>
    <td align="right">0.41</td>
    <td align="right">0.0</td>
    <td align="right">0</td>
    <td align="right">4866</td>
    <td align="right">1</td>
    <td align="right">69.73</td>
    <td align="right">30.27</td>
    <td align="right">30.27</td>
    <td align="right">54.20</td>
    <td align="right">15.52</td>
    <td align="right">11.10</td>
    <td align="right">19.17</td>
    <td align="right">26.63</td>
    <td align="right">26.63</td>
    <td align="right">63.59</td>
  </tr>
  <tr>
    <td align="right">4.25</td>
    <td align="right">8.00</td>
    <td align="right">0.00</td>
    <td align="right">32.000</td>
    <td align="right">131072</td>
    <td align="right">0.24</td>
    <td align="right">4</td>
    <td align="right">1979.49</td>
    <td align="right">0.00177</td>
    <td align="right">-61.18</td>
    <td align="right">-58.72</td>
    <td align="right">58.05</td>
    <td align="right">13.10</td>
    <td align="right">-24.18</td>
    <td align="right">33.0</td>
    <td align="right">2.08</td>
    <td align="right">0.0</td>
    <td align="right">0</td>
    <td align="right">15833</td>
    <td align="right">2</td>
    <td align="right">53.94</td>
    <td align="right">46.06</td>
    <td align="right">46.06</td>
    <td align="right">22.94</td>
    <td align="right">31.00</td>
    <td align="right">24.67</td>
    <td align="right">21.38</td>
    <td align="right">55.67</td>
    <td align="right">44.33</td>
    <td align="right">56.82</td>
  </tr>
</tbody>
</table>

The columns contain:

1. `twin` Start time of the analysis window in the recording in seconds.
2. `window` Duration of the analysis window in seconds.
3. `winclipped`: Fraction of analysis window that is clipped.
4. `samplerate`: Sampling rate of the recording.
5. `nfft`: Number of samples used for FFT to compute power spectrum.
6. `dfreq`: Frequency resolution of power spectrum.
7. `index` Index of the fish (the number that is also used to number the files).
8. `EODf` EOD frequency in Hertz.
9. `p-p-amplitude` Peak-to-peak amplitude of the extracted waveform in the units of the input data.
10. `power` Power of the extracted EOD waveform, i.e. sum of the squared Fourier amplitudes, in decibel.
11. `datapower` Power of the EOD waveform from the spectrum of the original data in decibel.
12. `thd`: Total harmonic distortion, i.e. square root of sum of amplitudes squared
   of harmonics relative to amplitude of fundamental.
13. `dbdiff` Smoothness of power spectrum as standard deviation of differences in decibel power.
14. `maxdb` Maximum power of higher harmonics relative to peak power in decibel.
15. `noise` Root-mean-squared standard error of the averaged EOD waveform relative to the peak-to_peak amplitude in percent.
16. `rmserror` Root-mean-squared difference between the averaged EOD waveform and the fit of the Fourier series relative to the peak-to_peak amplitude in percent.
17. `clipped` Percentage of recording that is clipped.
18. `flipped` Whether the waveform was flipped.
19. `n` Number of EODs used for computing the averaged EOD waveform.
20. `ncrossings` Number of zero crossing per EOD period.
21. `peakwidth` Width of the peak at the averaged amplitude relative to EOD period.
22. `troughwidth` Width of the trough at the averaged amplitude relative to EOD period.
23. `minwidth`: `peakwidth` or `troughwidth`, whichever is smaller.
24. `leftpeak` Time from positive zero crossing to peak relative to EOD period.
25. `rightpeak` Time from peak to negative zero crossing relative to EOD period.
26. `lefttrough` Time from negative zero crossing to trough relative to EOD period.
27. `righttrough` Time from trough to positive zero crossing relative to EOD period.
28. `p-p-distance` Time between peak and trough relative to EOD period.
29. `min-p-p-distance`: `p-p-distance` or EOD period minus `p-p-distance`, whichever is smaller, relative to EOD period.
30. `relpeakampl` Amplitude of peak or trough, whichever is larger, relative to p-p amplitude.


### RECORDING-CHANNEL-TIME-wavespectrum-N.EXT

The parameter of the Fourier series fitted to the waveform of a wave-type fish.

<table>
<thead>
  <tr>
    <th align="left">harmonics</th>
    <th align="left">frequency</th>
    <th align="left">amplitude</th>
    <th align="left">relampl</th>
    <th align="left">relpower</th>
    <th align="left">phase</th>
    <th align="left">datapower</th>
  </tr>
  <tr>
    <th align="left">-</th>
    <th align="left">Hz</th>
    <th align="left">a.u.</th>
    <th align="left">%</th>
    <th align="left">dB</th>
    <th align="left">rad</th>
    <th align="left">a.u.^2/Hz</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td align="right">0</td>
    <td align="right">728.16</td>
    <td align="right">0.32610</td>
    <td align="right">100.00</td>
    <td align="right">0.00</td>
    <td align="right">0.0000</td>
    <td align="right">1.0137e-01</td>
  </tr>
  <tr>
    <td align="right">1</td>
    <td align="right">1456.32</td>
    <td align="right">0.22146</td>
    <td align="right">67.91</td>
    <td align="right">-3.36</td>
    <td align="right">2.4706</td>
    <td align="right">4.1881e-02</td>
  </tr>
  <tr>
    <td align="right">2</td>
    <td align="right">2184.48</td>
    <td align="right">0.03215</td>
    <td align="right">9.86</td>
    <td align="right">-20.12</td>
    <td align="right">-1.9333</td>
    <td align="right">7.6623e-04</td>
  </tr>
  <tr>
    <td align="right">3</td>
    <td align="right">2912.63</td>
    <td align="right">0.03733</td>
    <td align="right">11.45</td>
    <td align="right">-18.83</td>
    <td align="right">-0.6807</td>
    <td align="right">8.6311e-04</td>
  </tr>
  <tr>
    <td align="right">4</td>
    <td align="right">3640.79</td>
    <td align="right">0.02039</td>
    <td align="right">6.25</td>
    <td align="right">-24.08</td>
    <td align="right">3.0997</td>
    <td align="right">2.3089e-04</td>
  </tr>
</tbody>
</table>

The columns contain:

1. `harmonics` Index of the harmonics. The first one with index 0 is the fundamental frequency.
2. `frequency` Frequency of the harmonics in Hertz.
3. `amplitude` Amplitude of each harmonics obtained by fitting a Fourier series to the data in the unit of the input data.
4. `relampl` Amplitude of each harmonics relative to the amplitude of the fundamental in percent.
5. `relpower` Power of each harmonics relative to fundamental in decibel.
6. `phase` Phase of each harmonics obtained by fitting a Fourier series to the data in radians ranging from 0 to 2 pi.
7. `datapower` Power spectral density of the harmonics from the original power spectrum of the data.


### RECORDING-CHANNEL-TIME-pulsefish.EXT

Properties of each pulse-type fish detected in the recording.

<table>
<thead>
  <tr>
    <th align="left" colspan="6">recording</th>
    <th align="left" colspan="21">waveform</th>
    <th align="left" colspan="8">spectrum</th>
  </tr>
  <tr>
    <th align="left">twin</th>
    <th align="left">window</th>
    <th align="left">winclipped</th>
    <th align="left">samplerate</th>
    <th align="left">nfft</th>
    <th align="left">dfreq</th>
    <th align="left">index</th>
    <th align="left">EODf</th>
    <th align="left">period</th>
    <th align="left">pos-ampl</th>
    <th align="left">neg-ampl</th>
    <th align="left">p-p-amplitude</th>
    <th align="left">noise</th>
    <th align="left">clipped</th>
    <th align="left">flipped</th>
    <th align="left">tstart</th>
    <th align="left">tend</th>
    <th align="left">width</th>
    <th align="left">peak-dist</th>
    <th align="left">tau</th>
    <th align="left">firstphase</th>
    <th align="left">lastphase</th>
    <th align="left">totalarea</th>
    <th align="left">pos-area</th>
    <th align="left">neg-area</th>
    <th align="left">polaritybalance</th>
    <th align="left">n</th>
    <th align="left">peakfreq</th>
    <th align="left">peakenergy</th>
    <th align="left">troughfreq</th>
    <th align="left">troughenergy</th>
    <th align="left">energyatt5</th>
    <th align="left">energyatt50</th>
    <th align="left">lowcutoff</th>
    <th align="left">highcutoff</th>
  </tr>
  <tr>
    <th align="left">s</th>
    <th align="left">s</th>
    <th align="left">%</th>
    <th align="left">kHz</th>
    <th align="left">-</th>
    <th align="left">Hz</th>
    <th align="left">-</th>
    <th align="left">Hz</th>
    <th align="left">ms</th>
    <th align="left">a.u.</th>
    <th align="left">a.u.</th>
    <th align="left">a.u.</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">-</th>
    <th align="left">ms</th>
    <th align="left">ms</th>
    <th align="left">ms</th>
    <th align="left">ms</th>
    <th align="left">ms</th>
    <th align="left">-</th>
    <th align="left">-</th>
    <th align="left">a.u.*ms</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">%</th>
    <th align="left">-</th>
    <th align="left">Hz</th>
    <th align="left">a.u.^2s/Hz</th>
    <th align="left">Hz</th>
    <th align="left">a.u.^2s/Hz</th>
    <th align="left">dB</th>
    <th align="left">dB</th>
    <th align="left">Hz</th>
    <th align="left">Hz</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td align="right">4.00</td>
    <td align="right">8.00</td>
    <td align="right">0.00</td>
    <td align="right">32.000</td>
    <td align="right">0</td>
    <td align="right">-</td>
    <td align="right">0</td>
    <td align="right">32.23</td>
    <td align="right">31.03</td>
    <td align="right">0.26548</td>
    <td align="right">0.21925</td>
    <td align="right">0.48473</td>
    <td align="right">0.10</td>
    <td align="right">0.00</td>
    <td align="right">0</td>
    <td align="right">-0.344</td>
    <td align="right">1.438</td>
    <td align="right">1.781</td>
    <td align="right">0.250</td>
    <td align="right">0.087</td>
    <td align="right">1</td>
    <td align="right">2</td>
    <td align="right">0.1218</td>
    <td align="right">50.61</td>
    <td align="right">-49.39</td>
    <td align="right">1.21</td>
    <td align="right">237</td>
    <td align="right">1125.98</td>
    <td align="right">1.4e-08</td>
    <td align="right">0.00</td>
    <td align="right">8.45e-11</td>
    <td align="right">-22.17</td>
    <td align="right">-19.99</td>
    <td align="right">135.74</td>
    <td align="right">1858.40</td>
  </tr>
</tbody>
</table>

The columns contain:

1. `twin` Start time of the analysis window in the recording in seconds.
2. `window` Duration of the analysis window in seconds.
3. `winclipped`: Fraction of analysis window that is clipped.
4. `samplerate`: Sampling rate of the recording.
5. `nfft`: Number of samples used for FFT to compute power spectrum.
6. `dfreq`: Frequency resolution of power spectrum.
7. `index` Index of the fish (the number that is also used to number the files).
8. `n` Number of EODs used for computing the averaged EOD waveform.
9. `EODf` EOD frequency in Hertz.
10. `period` Period between two pulses (1/EODf) in milliseconds.
11. `aoffs` Offset that was subtracted from the average EOD waveform.
12. `pos-ampl` Amplitude of the largest phase (P1 phase) in the units of the input data.
13. `neg-ampl` Amplitude of the largest trough in the units of the input data.
14. `max-ampl` Maximum of largest peak or trough amplitude in the units of the input data.
15. `p-p-amplitude` Peak-to-peak amplitude in the units of the input data.
16. `p-p-dist`: Distance between minimum and maximum phase in milliseconds.
17. `noise` Average standard error of the averaged EOD waveform relative to the
   peak-to_peak amplitude in percent.
18. `rmserror`: Root-mean-square error between fit with sum of Gaussians and EOD waveform relative to the p-p amplitude. Infinity if fit failed.
19. `clipped` Percentage of recording that is clipped.
20. `flipped` Whether the waveform was flipped.
21. `startendthresh` The actually used threshold for start and end time as a fraction of the p-p amplitude in percent.
22. `peakthresh` The actually used threshold for detecting peaks and troughs time as a fraction of the p-p amplitude in percent.
23. `tstart` Time where the pulse starts relative to P1 in milliseconds.
24. `tend` Time where the pulse ends relative to P1 in milliseconds.
25. `width` Total width of the pulse in milliseconds.
26. `totalarea` Sum of areas under positive and negative phases.
27. `pos-area` Area under positive phases relative to total area.
28. `neg-area` Area under negative phases relative to total area.
29. `polaritybalance` Contrast between areas under positive and negative phases.
30. `median` Median of the distribution of the absolute EOD waveform.
31. `quartile1` First quartile of the distribution of the absolute EOD waveform.
32. `quartile3` Third quartile of the distribution of the absolute EOD waveform.
33. `iq-range` Inter-quartile range of the distribution of the absolute EOD waveform.
34. `tau` Time constant of the exponential decay of the tail of the pulse in milliseconds.
35. `firstphase` Index of the first phase in the pulse (i.e. -1 for P-1).
36. `lastphase` Index of the last phase in the pulse (i.e. 3 for P3).
37. `peakfreq` Frequency at the peak energy of the single pulse spectrum in Hertz.
38. `peakenergy` Peak energy of the single pulse spectrum.
39. `troughfreq` Frequency at trough before peak in Hertz.
40. `troughenergy` Energy of trough before peak in x^2 s/Hz.
41. `energyatt5` Attenuation of average energy below 5 Hz relative to peak energy in decibel. 
42. `energyatt50` Attenuation of average energy below 50 Hz relative to peak energy in decibel.
43. `lowcutoff` Frequency at which the energy reached half of the peak energy relative to the DC energy in Hertz.
44. `high_cutoff`: 3dB roll-off frequency in Hertz.


### RECORDING-CHANNEL-TIME-pulsephases-N.EXT

Properties of phases of a pulse-type fish's EOD.

<table>
<thead>
  <tr>
    <th align="left">P</th>
    <th align="left">time</th>
    <th align="left">amplitude</th>
    <th align="left">relampl</th>
    <th align="left">width</th>
    <th align="left">area</th>
    <th align="left">relarea</th>
  </tr>
  <tr>
    <th align="left">-</th>
    <th align="left">ms</th>
    <th align="left">a.u.</th>
    <th align="left">%</th>
    <th align="left">ms</th>
    <th align="left">a.u.*ms</th>
    <th align="left">%</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td align="right">1</td>
    <td align="right">0.000</td>
    <td align="right">0.26548</td>
    <td align="right">100.00</td>
    <td align="right">0.225</td>
    <td align="right">0.0616</td>
    <td align="right">50.76</td>
  </tr>
  <tr>
    <td align="right">2</td>
    <td align="right">0.250</td>
    <td align="right">-0.21925</td>
    <td align="right">-82.59</td>
    <td align="right">0.221</td>
    <td align="right">-0.0598</td>
    <td align="right">-49.24</td>
  </tr>
</tbody>
</table>

The columns contain:

1. `P` Name of the phase. Phases are numbered sequentially. P1 is the 
   largest phase with positive amplitude.
2. `time` Time of the phase's peak/trough relative to P1 in milliseconds.
3. `amplitude` Amplitude of the phase in the unit of the input data.
4. `relampl` Amplitude of the phase relative to the amplitude of P1 in percent.
5. `width` Width of the phase at half height in milliseconds. 
6. `area` Area under the phase.
7. `relaarea` Area of the phase relative to total area in percent.


### RECORDING-CHANNEL-TIME-pulsegaussians-N.EXT

For each pulse-type fish properties of Gaussians fitting the EOD phases.

<table>
<thead>
  <tr>
    <th align="left">times</th>
    <th align="left">amplitudes</th>
    <th align="left">stdevs</th>
  </tr>
  <tr>
    <th align="left">ms</th>
    <th align="left">a.u.</th>
    <th align="left">ms</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td align="right">0.058</td>
    <td align="right">0.58302</td>
    <td align="right">0.128</td>
  </tr>
  <tr>
    <td align="right">0.162</td>
    <td align="right">-0.47997</td>
    <td align="right">0.148</td>
  </tr>
</tbody>
</table>

The columns contain:

1. `times` Position of each Gaussian
2. `amplitudes` Amplitude of each Gaussian
3. `stdevs` Standard deviation of each Gaussian


### RECORDING-CHANNEL-TIME-pulsetimes-N.EXT

Time points of detected pulse-type EODs.

<table>
<thead>
  <tr>
    <th align="left">time</th>
  </tr>
  <tr>
    <th align="left">s</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td align="right">0.1043</td>
  </tr>
  <tr>
    <td align="right">0.1353</td>
  </tr>
  <tr>
    <td align="right">0.1662</td>
  </tr>
  <tr>
    <td align="right">0.1971</td>
  </tr>
  <tr>
    <td align="right">0.2279</td>
  </tr>
  <tr>
    <td align="right">0.2589</td>
  </tr>
  <tr>
    <td align="right">0.2898</td>
  </tr>
  <tr>
    <td align="right">0.3207</td>
  </tr>
</tbody>
</table>

The columns contain:

1. The times of pulse-type EODs in seconds.


### RECORDING-CHANNEL-TIME-pulsespectrum-N.EXT

The energy spectrum of a single EOD pulse of a pulse-type fish:

<table>
<thead>
  <tr>
    <th align="left">frequency</th>
    <th align="left">energy</th>
  </tr>
  <tr>
    <th align="left">Hz</th>
    <th align="left">a.u.^2s/Hz</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td align="right">0.00</td>
    <td align="right">8.4498e-11</td>
  </tr>
  <tr>
    <td align="right">0.98</td>
    <td align="right">8.4563e-11</td>
  </tr>
  <tr>
    <td align="right">1.95</td>
    <td align="right">8.4758e-11</td>
  </tr>
  <tr>
    <td align="right">2.93</td>
    <td align="right">8.5083e-11</td>
  </tr>
  <tr>
    <td align="right">3.91</td>
    <td align="right">8.5539e-11</td>
  </tr>
  <tr>
    <td align="right">4.88</td>
    <td align="right">8.6124e-11</td>
  </tr>
</tbody>
</table>

The columns contain:

1. `frequency` Frequency in Hertz.
2. `energy` Energy spectral density in x^2 s/Hz.

